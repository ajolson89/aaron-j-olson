
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Identifying Edible Plants</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="author" content="Scott Xu, Divya Babu, Aaron Olson" />
    <meta name="description" content="Combination of cloud computing and edge device for inference utilizing tensforflow image categorization model" />
    <meta name="keywords" content="python tensorflow, tensorrt, edge device, cloud computing">
<!-- Facebook and Twitter integration -->
<meta property="og:site_name" content="Aaron J. Olson - Portfolio"/>
<meta property="og:title" content="Identifying Edible Plants"/>
<meta property="og:description" content="Combination of cloud computing and edge device for inference utilizing tensforflow image categorization model"/>
<meta property="og:url" content="https://aaron-j-olson.com/edibleplants.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-12-08 20:00:00-05:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://aaron-j-olson.com/author/scott-xu-divya-babu-aaron-olson.html">
<meta property="article:section" content="posts"/>
    <meta property="article:tag" content="python tensorflow"/>
    <meta property="article:tag" content="tensorrt"/>
    <meta property="article:tag" content="edge device"/>
    <meta property="article:tag" content="cloud computing"/>
    <meta property="og:image" content="\images\olson.JPG">

    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700" rel="stylesheet">

    <!-- Animate.css -->
    <link rel="stylesheet" href="https://aaron-j-olson.com/theme/css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="https://aaron-j-olson.com/theme/css/icomoon.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="https://aaron-j-olson.com/theme/css/bootstrap.css">
    <!-- Flexslider  -->
    <link rel="stylesheet" href="https://aaron-j-olson.com/theme/css/flexslider.css">
    <!-- Theme style  -->
    <link rel="stylesheet" href="https://aaron-j-olson.com/theme/css/style.css">
    <!-- Custom style  -->
    <link rel="stylesheet" href="https://aaron-j-olson.com/theme/css/custom.css">
    <!-- pygments code highlight -->
    <link rel="stylesheet" href="https://aaron-j-olson.com/theme/css/pygments.css">
    <!-- tipue search -->
    <link rel="stylesheet" href="https://aaron-j-olson.com/theme/tipuesearch/css/tipuesearch.css">

    <!-- Modernizr JS -->
    <script src="https://aaron-j-olson.com/theme/js/modernizr-2.6.2.min.js"></script>
    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
    <script src="/theme/js/respond.min.js"></script>
    <![endif]-->
        <link href="https://aaron-j-olson.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Aaron J. Olson - Portfolio Atom">



    </head>
    <body>
    <div id="fh5co-page">
        <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
        <aside id="fh5co-aside" role="complementary" class="border js-fullheight">

            <nav class="fh5co-main-menu" role="navigation">
            </nav>
            <div class="clearfix"></div>
            <h1  id="fh5co-logo">
                <a href="https://aaron-j-olson.com/index.html">
                    <img src="\images\olson.JPG" />
                </a>
            </h1>
            <nav class="fh5co-main-menu" role="navigation">
<ul>
    <!-- home link -->
    <li><a href="https://aaron-j-olson.com/">Home</a></li>

    <!-- page links -->
            <li><a href="https://aaron-j-olson.com/pages/home.html">About Me</a></li>

    <!-- categories -->
        <li><a href="https://aaron-j-olson.com/categories.html">Categories</a></li>

    <!-- tags -->
        <li><a href="https://aaron-j-olson.com/tags.html">Tags</a></li>

    <!-- additional menu items from config -->
        <!-- <li class="nav-title">Misc</li> -->
            <li><a href="https://aaron-j-olson.com/archives.html">Archive</a></li>
            <li><a href="https://aaron-j-olson.com/contact.html">Contact</a></li>

</ul>
            </nav>

<ul id="social">
            <li><a href="https://github.com/ajolson89" alt="Github"><i class="icon-github"></i></a></li>

            <li><a href="https://www.linkedin.com/in/aaron-j-olson/" alt="LinkedIn"><i class="icon-linkedin2"></i></a></li>

</ul>
        </aside>

        <div id="fh5co-main">

    <div class="fh5co-narrow-content article-content">
        <h1 class="fh5co-heading-colored">Identifying Edible Plants</h1>

        <div>by
                <a href="author/scott-xu-divya-babu-aaron-olson.html">Scott Xu, Divya Babu, Aaron Olson</a> - Sun 08 December 2019
        </div>

            <div><span>Tags: </span>
                    <span><a href="https://aaron-j-olson.com/tag/python-tensorflow.html">#python tensorflow</a> </span>
                    <span><a href="https://aaron-j-olson.com/tag/tensorrt.html">#tensorrt</a> </span>
                    <span><a href="https://aaron-j-olson.com/tag/edge-device.html">#edge device</a> </span>
                    <span><a href="https://aaron-j-olson.com/tag/cloud-computing.html">#cloud computing</a> </span>
            </div>

        <div class="animate-box" data-animate-effect="fadeInLeft">
            <p class="animate-box" data-animate-effect="fadeInLeft"><p>The Intent of this final project is to develop an image recognition program that can accurately identify edible and/or poisonous plants in the wild. This endeavor has been attempted by several apps and other programs - however all of these realize an edge architecture that relies on a remote server connection in order to upload the file and run through the model. </p>
<p>This paper explores the difference performance options in order to arrive at the best performing model. We then work to reduce the model size in order to fit on an edge device for real time diagnosis. </p>
<p>In order to get a baseline model for image recognition, we used a transfer learning technique where the model weights and architecture of ResNet50 was applied. ResNet50 was chosen for its performance as well as its size. Training on the volume of images for the duration that ResNet50 was done would not be reasonable - therefore we have used this baseline model to improve the baseline prediction. On top of this we explore different model architectures in order to define which architecture performs the best.</p>
<p>In order to get the best performing model we needed to remember to balance model performance with edge device performance. In the case of poisonous plants the consequences of a bad prediction can be high - however the utility of an app that takes 60 min to make a prediction is impacted. Therefore at the end of this notebook we examine the relationship with building the model on a virtual machine (for training) vs inference on the edge device (time to predict vs accuracy). The overall training and model structure is defined below - the larger resources consuming actions will be conducted in the cloud enabling inference at the edge - which provides an advantage to prior work as no active network is required for inference: </p>
<table><tr>
    <td> <img src="images/edibleplants/Final Model/ModelStructure.JPG" alt="Drawing" style="width: 750px;"/> </td>
</tr></table>

<p>This paper can be broken down into the following sections: 
1. Exploratory Data Analysis &amp; Understanding of the Training Dataset
2. Image Augmentation - impacts of different augmentation techniques and best performing augmentation
3. Discussion of Base Model choice
4. Model Architecture
5. Image Classification on VM - Model Peformance
6. Binary Classification on VM - Model Performance
7. Model Transfer to Edge Device and discussion of performance vs inference time &amp; resource constraints
8. Conclusion</p>
<p>We begin by examining the training dataset:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">imread</span><span class="p">,</span> <span class="n">imshow</span><span class="p">,</span> <span class="n">subplots</span><span class="p">,</span> <span class="n">show</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s2">&quot;ModelStructure.jpg&quot;</span><span class="p">)</span>
<span class="n">images</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="output_1_0.png"></p>
<h2><strong>Section 1: Exploratory Data Analysis</strong></h2>
<p>Our traning datasets were downloaded from Kaggle [https://www.kaggle.com/gverzea/edible-wild-plants, https://www.kaggle.com/nitron/poisonous-plants-images]. The datasets are comprised of:
- Total of 6962 pictures:
    - 6552 of these pictures are of edible wild plants
    - 410 pictures are of poisonous plants. 
- There are:
    - 62 categories of edible plants
    - 8 categories of poisonous plants</p>
<p>From this data it is evident that our dataset is skewed (more edible pictures and categories than poisonous). Additionally, the dataset does not comprise all wild plants - and is only a rather small subset of wild plants. We will treat this dataset as our primary for training purposes. We do have two other datasets that can be utlized for further training on a larger array of edible plant types. The average number of images per category is 99 - however we can see in the plot below that the mean count of image per category is closer to 50 with some categories having a large number of images.  </p>
<table><tr>
    <td> <img src="images/edibleplants/CountbyCateogry.JPG" alt="Drawing" style="width: 750px;"/> </td>
</tr></table>

<p>Having 50 images per class does indicate that there is hopefully some variability in terms of image orientation, quality, etc. Having this variety will have a beneficial impact on the training process. We can further improve the variety of images by utilizing image augmentation. </p>
<p>In addition to increasing image variety, augmentation also helps to increase the trianing dataset size. Because we have a limited dataset (considering we will be training on Dense, CNN or ReLu layers) we can utilize augmentation and increase both the variety and total number of images in order to improve our trianing process. Furthermore, In the latter portion of our analysis, we attempt to make a prediction of poisonous or edible (rather than plant category). Because we have a biased training set for the binary label problem - we will increase image count of the poisonous images by utilizing image augmentation - explained in the next section. </p>
<p>Depicted below are a few sample images taken from the datasets. </p>
<table><tr>
    <td> <img src="images/edibleplants/How-To-Grow-Rhubarb.jpg" alt="Drawing" style="width: 250px;"/> </td>
    <td> <img src="images/edibleplants/Chicory20.jpg" alt="Drawing" style="width: 350px;"/> </td>
    <td> <img src="images/edibleplants/asparagus8.jpg" alt="Drawing" style="width: 350px;"/> </td>
</tr></table>

<h2><strong>Section 2: Image Augmentation</strong></h2>
<p>With the baseline model established, we understand that there will likely be a difference in the cleanliness of the images taken for the training dataset, vs the images taken in the field when a user wants to succesfully identify a plant. We therefore utilize image augmentation, to achieve a couple of tasks: </p>
<ul>
<li>Affect the image quality, orientation, etc in order to make the model more versatile </li>
<li>Create more training images in order to train the model.</li>
</ul>
<p>Data augmentation encompasses a wide range of techniques used to generate new training samples from the original ones by randomly transforming the original image via a series of random translations, rotations, changing brightness levels of the image etc. Keras deep learning library provides the capability to use data augmentation when training a model.</p>
<p>Image data augmentation is supported in the Keras via the ImageDataGenerator class. This class generates batches of tensor image data with real-time data augmentation. The ImageDataGenerator class is instantiated and the configuration for different types of data augmentation are passed in the form of arguments to the class constructor.</p>
<p>ImageDataGenerator supports a range of data augmentation techniques as well as pixel scaling methods.
We have focused on the below techniques for our dataset</p>
<ul>
<li>Width_shift_range and height_shift_range arguments - Image shifts horizontally and vertically</li>
<li>horizontal_flip and vertical_flip arguments- Image flips horizontally and vertically</li>
<li>rotation_range argument - Image rotates by specified degrees</li>
<li>brightness_range argument - Image brightness levels are modified</li>
<li>zoom_range argument - Image zoom levels are altered</li>
</ul>
<p>Here's the original image:       </p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.image</span> <span class="kn">import</span> <span class="n">ImageDataGenerator</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">imread</span><span class="p">,</span> <span class="n">imshow</span><span class="p">,</span> <span class="n">subplots</span><span class="p">,</span> <span class="n">show</span>


<span class="k">def</span> <span class="nf">plot_images</span><span class="p">(</span><span class="n">image_augmentor</span><span class="p">):</span>
    <span class="n">image_augmentor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
    <span class="n">augmented_images</span> <span class="o">=</span> <span class="n">image_augmentor</span><span class="o">.</span><span class="n">flow</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">18</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="n">row</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">augmented_images</span><span class="o">.</span><span class="n">next</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">))</span>
        <span class="n">row</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">show</span><span class="p">()</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s2">&quot;asparagus2.jpg&quot;</span><span class="p">)</span>

<span class="c1"># Show the original image</span>
<span class="n">images</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

<span class="n">imshow</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>


<table><tr>
    <td> <img src="images/edibleplants/output_4_0.png" alt="Drawing" style="width: 750px;"/> </td>
</tr></table>

<h3>Examples of images after Data Augmentation</h3>
<h4>Horizontal and Vertical Shift Augmentation</h4>
<p>The ImageDataGenerator constructor control the amount of horizontal and vertical shift using the arguments The width_shift_range and height_shift_range respectively, a number of pixels can be specified to shift the image. </p>
<p>A shift to an image means moving all pixels of the image in one direction, either horizontally or vertically, while keeping the image dimensions the same. The shift clips off some of the pixels from the image and there will be a region of the image where empty pixel values will have to be specified, by default the closest pixel value is chosen and repeated for all the empty values.</p>
<h4>Horizontal Shift Augmentation</h4>
<div class="highlight"><pre><span></span><span class="n">image_augmentor</span> <span class="o">=</span> <span class="n">ImageDataGenerator</span><span class="p">(</span><span class="n">width_shift_range</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plot_images</span><span class="p">(</span><span class="n">image_augmentor</span><span class="p">)</span>
</pre></div>


<table><tr>
    <td> <img src="images/edibleplants/output_80.png" alt="Drawing" style="width: 750px;"/> </td>
</tr></table>

<h4>Vertical Shift Augmentation</h4>
<div class="highlight"><pre><span></span><span class="n">image_augmentor</span> <span class="o">=</span> <span class="n">ImageDataGenerator</span><span class="p">(</span><span class="n">height_shift_range</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plot_images</span><span class="p">(</span><span class="n">image_augmentor</span><span class="p">)</span>
</pre></div>


<table><tr>
    <td> <img src="images/edibleplants/output_10_0.png" alt="Drawing" style="width: 750px;"/> </td>
</tr></table>

<h4>Horizontal and Vertical Flip Augmentation</h4>
<p>An image flip means reversing the rows or columns of pixels in the case of a vertical or horizontal flip respectively.</p>
<p>The flip augmentation is specified by a boolean horizontal_flip or vertical_flip argument to the ImageDataGenerator class constructor.</p>
<h4>Horizontal Flip Augmentation</h4>
<div class="highlight"><pre><span></span><span class="n">image_augmentor</span> <span class="o">=</span> <span class="n">ImageDataGenerator</span><span class="p">(</span><span class="n">horizontal_flip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_images</span><span class="p">(</span><span class="n">image_augmentor</span><span class="p">)</span>
</pre></div>


<table><tr>
    <td> <img src="images/edibleplants/output_13_0.png" alt="Drawing" style="width: 750px;"/> </td>
</tr></table>

<h4>Vertical Flip Augmentation</h4>
<div class="highlight"><pre><span></span><span class="n">image_augmentor</span> <span class="o">=</span> <span class="n">ImageDataGenerator</span><span class="p">(</span><span class="n">vertical_flip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_images</span><span class="p">(</span><span class="n">image_augmentor</span><span class="p">)</span>
</pre></div>


<table><tr>
    <td> <img src="images/edibleplants/output_15_0.png" alt="Drawing" style="width: 750px;"/> </td>
</tr></table>

<h4>Rotation Augmentation</h4>
<p>A rotation augmentation randomly rotates the image clockwise by a specified number of degrees from 0 to 360.
The rotation will likely rotate pixels out of the image frame and leave areas of the frame with no pixel data that must be filled in, by default the closest pixel value is chosen and repeated for all the empty values.</p>
<div class="highlight"><pre><span></span><span class="n">image_augmentor</span> <span class="o">=</span> <span class="n">ImageDataGenerator</span><span class="p">(</span><span class="n">rotation_range</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plot_images</span><span class="p">(</span><span class="n">image_augmentor</span><span class="p">)</span>
</pre></div>


<table><tr>
    <td> <img src="images/edibleplants/output_17_0.png" alt="Drawing" style="width: 750px;"/> </td>
</tr></table>

<h4>Brightness Augmentation</h4>
<p>The brightness of the image can be augmented by either randomly changing the brightness levels of the image.
generated images could be dark or light or both.</p>
<p>This helps the model to generalize across images captured in different lighting levels.
brightness_range argument is passed to the ImageDataGenerator() constructor that specifies min and max range as a floating point number representing the percentage for selecting the brightness levels.
1.0 has no effect on brightness, Values less than 1.0 darken the image, e.g. [0.5, 1.0], whereas values larger than 1.0 brighten the image, e.g. [1.0, 1.5].</p>
<div class="highlight"><pre><span></span><span class="n">image_augmentor</span> <span class="o">=</span> <span class="n">ImageDataGenerator</span><span class="p">(</span><span class="n">brightness_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">))</span>
<span class="n">plot_images</span><span class="p">(</span><span class="n">image_augmentor</span><span class="p">)</span>
</pre></div>


<table><tr>
    <td> <img src="images/edibleplants/output_19_0.png" alt="Drawing" style="width: 750px;"/> </td>
</tr></table>

<h4>Zoom Augmentation</h4>
<p>Zoom augmentation randomly zooms the image in and out, either adds new pixel values around the image or interpolates pixel values respectively.</p>
<p>zoom_range argument is passed to the ImageDataGenerator constructor to enable Image zooming. You can specify the percentage of the zoom as a single float or a range.</p>
<p>If a float is specified, then the range for the zoom will be [1-value, 1+value]. 
For example, if you specify 0.3, then the range will be [0.7, 1.3], or between 70% (zoom in) and 130% (zoom out).</p>
<p>As seen below, random zoom in is different on both the width and height dimensions as well as the aspect ratio of the object in the image.</p>
<div class="highlight"><pre><span></span><span class="n">image_augmentor</span> <span class="o">=</span> <span class="n">ImageDataGenerator</span><span class="p">(</span><span class="n">zoom_range</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
<span class="n">plot_images</span><span class="p">(</span><span class="n">image_augmentor</span><span class="p">)</span>
</pre></div>


<table><tr>
    <td> <img src="images/edibleplants/output_21_0.png" alt="Drawing" style="width: 750px;"/> </td>
</tr></table>

<p><strong>Data augmentation makes the model more robust to slight variations, and hence prevents the model from overfitting.</strong></p>
<p>Below we explore different effects of image augmentation and show below the effects of model performance:</p>
<h2><strong>Section 3: Base Model - ResNet Model Choice</strong></h2>
<p>With the problem of image classification we understood that utilizing transfer learning would speed the training process. We chose to utilize the ResNet50 model due to its: 
- Accuracy proven on the ImageNet dataset
- Overall size (50 ReLu layers)</p>
<p>The ResNet50 dataset was trained on the ImageNet dataset which is a large volume dataset with classes associated with common everyday items (broccoli, horse, etc). Reviewing the categories the model has already been trained on, it currently doesn't have any that match the classes in our training dataset - however it has been trained on many plant and food related items. </p>
<p>ResNet is a model built upon the Residual layer structure. It has been noted in literature where deeper networks tend to have lower accuracy compared to it's shallower counterpart. This is essentially because it can be hard for a dense layer to learn the y = x relationship when the training has become saturated. A Residual Layer has an impliminatation similar to  y = F(x) + x where the function F(x) can reduce to 0 and bypass the degradation problem. </p>
<table><tr>
    <td> <img src="images/edibleplants/ResidualLayer.JPG" alt="Drawing" style="width: 500px;"/> </td>
</tr></table>

<p>Picture above is one layer of a residual layer which shows how the input can bypass the learned weights and become the output. This type of layer has shown high accuracy in image classification problems. He, K., Zhang, X., Ren, S., &amp; Sun, J. (2015). Deep Residual Leraning for Image Recognition. Cornell University.</p>
<p>In addition to a well trained model we also needed to control the size and the inference time of the model. The intent of this paper is to train in a data center (where volume of data and computing power can be large) in order to bring the model to an edge device for inference. We therefore need to ensure the model is sufficiently small (such that the memory requirements won't exhaust the hardware of an edge device), fit on a limited storage device, and provide image inference at a reasonable time. Because of this constraint we chose to use ResNet50 as our baselayer vs ResNet 100, 1000 for example.</p>
<div class="highlight"><pre><span></span><span class="c1"># Load ResNet50 baseline model</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.applications.resnet50</span> <span class="kn">import</span> <span class="n">ResNet50</span><span class="p">,</span> <span class="n">preprocess_input</span>

<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">300</span>

<span class="n">base_model</span> <span class="o">=</span> <span class="n">ResNet50</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="s1">&#39;imagenet&#39;</span><span class="p">,</span> 
                      <span class="n">include_top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                      <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="n">HEIGHT</span><span class="p">,</span> <span class="n">WIDTH</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>


<h3>Image Classification Model Analysis</h3>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>

<span class="n">IMAGECLASS_TRAIN_DIR</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span>
<span class="n">IMAGECLASS_VALIDATION_DIR</span> <span class="o">=</span> <span class="s2">&quot;validation&quot;</span>
<span class="n">IMAGECLASS_TEST_DIR</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>

<span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">IMAGECLASS_TRAIN_DIR</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;*.jpg&#39;</span><span class="p">))]</span>
<span class="n">classes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">y</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]))</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">32</span>
</pre></div>


<h3>Train Data Generator</h3>
<div class="highlight"><pre><span></span><span class="c1"># Image augmentation</span>

<span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.image</span> <span class="kn">import</span> <span class="n">ImageDataGenerator</span>

<span class="n">imageClass_train_datagen</span> <span class="o">=</span>  <span class="n">ImageDataGenerator</span><span class="p">(</span>
    <span class="n">preprocessing_function</span><span class="o">=</span><span class="n">preprocess_input</span><span class="p">,</span>
    <span class="n">rescale</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span>
    <span class="n">width_shift_range</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">height_shift_range</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">horizontal_flip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">vertical_flip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">rotation_range</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
    <span class="n">zoom_range</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span>
    <span class="n">brightness_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
    <span class="p">)</span>

<span class="n">imageClass_train_generator</span> <span class="o">=</span> <span class="n">imageClass_train_datagen</span><span class="o">.</span><span class="n">flow_from_directory</span><span class="p">(</span><span class="n">IMAGECLASS_TRAIN_DIR</span><span class="p">,</span> 
                                                    <span class="n">target_size</span><span class="o">=</span><span class="p">(</span><span class="n">HEIGHT</span><span class="p">,</span> <span class="n">WIDTH</span><span class="p">),</span> 
                                                    <span class="n">batch_size</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">,</span>
                                                    <span class="n">class_mode</span><span class="o">=</span><span class="s1">&#39;categorical&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Found 8000 images belonging to 70 classes.</span>
</pre></div>


<h3>Validation data generator</h3>
<p>Generally, only apply data augmentation to the training examples. In this case, only rescale the validation images and convert them into batches using ImageDataGenerator.</p>
<div class="highlight"><pre><span></span><span class="n">imageClass_val_datagen</span> <span class="o">=</span> <span class="n">ImageDataGenerator</span><span class="p">(</span><span class="n">rescale</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
<span class="n">imageClass_validation_generator</span> <span class="o">=</span> <span class="n">imageClass_val_datagen</span><span class="o">.</span><span class="n">flow_from_directory</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">,</span>
                                                 <span class="n">directory</span><span class="o">=</span><span class="n">IMAGECLASS_VALIDATION_DIR</span><span class="p">,</span>
                                                 <span class="n">target_size</span><span class="o">=</span><span class="p">(</span><span class="n">HEIGHT</span><span class="p">,</span> <span class="n">WIDTH</span><span class="p">),</span>
                                                 <span class="n">class_mode</span><span class="o">=</span><span class="s1">&#39;categorical&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Found 479 images belonging to 70 classes.</span>
</pre></div>


<h2><strong>Section 4: Model Architecture - Predicting Plant Class</strong></h2>
<p>Building on the baseline model, we have explored adding different layers (size, type, etc) in order to produce the 'best' performing model. See above and later discussions as to how we define 'best' model. For this paper we explored both accurately predicting the class of the plant in an image - which would help users understand more information about the specific plant they have taken the picture of, as well as predicting whether a plant is poisonous or not without the context of exact plant type. </p>
<p>We first explored keeping all the base model layers static (no change to the model weights) and only training on the additional layers - we explore the following layer architecture: 
- Dense layers (different nodes and depths)
- CNN with pooling layers given the image classification problem
- Residual layer based on our chosen base model architecture</p>
<p>In order to narrow model choice we chose to train for 100 epochs on 15,000 images with a batch size of 64. Our specific trials are captured and analyzed below. Below we show the code that was used during model training (both for image classification as well as binary classification (poison yes/no)). Below the model architecture we detail performance of varying model architectures.</p>
<div class="highlight"><pre><span></span><span class="n">base_model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">TensorShape([Dimension(None), Dimension(10), Dimension(10), Dimension(2048)])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Activation</span><span class="p">,</span> <span class="n">Flatten</span><span class="p">,</span> <span class="n">Dropout</span><span class="p">,</span> <span class="n">Conv2D</span><span class="p">,</span> <span class="n">MaxPooling2D</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span><span class="p">,</span> <span class="n">Model</span>

<span class="k">def</span> <span class="nf">build_finetune_model</span><span class="p">(</span><span class="n">base_model</span><span class="p">,</span> <span class="n">dropout</span><span class="p">,</span> <span class="n">fc_layers</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">base_model</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">trainable</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">base_model</span><span class="o">.</span><span class="n">output</span>

<span class="c1">#     x = Conv2D(32, kernel_size=(3, 3),</span>
<span class="c1">#                  activation=&#39;relu&#39;,</span>
<span class="c1">#                  input_shape=base_model.output.shape)(x)</span>
<span class="c1">#     #x = Conv2D(64, (3, 3), activation=&#39;relu&#39;)(x)</span>
<span class="c1">#     x = MaxPooling2D(pool_size=(2, 2))(x)</span>
<span class="c1">#     x = Dropout(dropout)(x)</span>
<span class="c1">#     #x.add(Flatten())</span>

<span class="c1"># Add CNN</span>
<span class="c1">#     x = Conv2D(32, kernel_size=(3, 3),</span>
<span class="c1">#              activation=&#39;relu&#39;)(x)</span>
<span class="c1">#     x = Conv2D(64, (3, 3), activation=&#39;relu&#39;)(x)</span>
<span class="c1">#     x = MaxPooling2D(pool_size=(2, 2))(x)</span>

<span class="c1"># Add Residual Layers</span>
<span class="c1">#     conv1 = Conv2D(64, (3,3), padding = &#39;same&#39;, activation = &#39;relu&#39;, kernel_initializer=&#39;he_normal&#39;)(x)</span>
<span class="c1">#     conv2 = Conv2D(2048,(3,3), padding = &#39;same&#39;, activation = &#39;linear&#39;, kernel_initializer=&#39;he_normal&#39;)(conv1)</span>
<span class="c1">#     layer_out = add([conv2, x])</span>
<span class="c1">#     x = Activation(&#39;relu&#39;)(layer_out)</span>
<span class="c1">#     conv1 = Conv2D(64, (3,3), padding = &#39;same&#39;, activation = &#39;relu&#39;, kernel_initializer=&#39;he_normal&#39;)(x)</span>
<span class="c1">#     conv2 = Conv2D(2048,(3,3), padding = &#39;same&#39;, activation = &#39;linear&#39;, kernel_initializer=&#39;he_normal&#39;)(conv1)</span>
<span class="c1">#     layer_out = add([conv2, x])</span>
<span class="c1">#     x = Activation(&#39;relu&#39;)(layer_out)</span>
<span class="c1">#     conv1 = Conv2D(64, (3,3), padding = &#39;same&#39;, activation = &#39;relu&#39;, kernel_initializer=&#39;he_normal&#39;)(x)</span>
<span class="c1">#     conv2 = Conv2D(2048,(3,3), padding = &#39;same&#39;, activation = &#39;linear&#39;, kernel_initializer=&#39;he_normal&#39;)(conv1)</span>
<span class="c1">#     layer_out = add([conv2, x])</span>
<span class="c1">#     x = Activation(&#39;relu&#39;)(layer_out)</span>
<span class="c1">#     conv1 = Conv2D(64, (3,3), padding = &#39;same&#39;, activation = &#39;relu&#39;, kernel_initializer=&#39;he_normal&#39;)(x)</span>
<span class="c1">#     conv2 = Conv2D(2048,(3,3), padding = &#39;same&#39;, activation = &#39;linear&#39;, kernel_initializer=&#39;he_normal&#39;)(conv1)</span>
<span class="c1">#     layer_out = add([conv2, x])</span>
<span class="c1">#     x = Activation(&#39;relu&#39;)(layer_out)</span>
<span class="c1">#     conv1 = Conv2D(64, (3,3), padding = &#39;same&#39;, activation = &#39;relu&#39;, kernel_initializer=&#39;he_normal&#39;)(x)</span>
<span class="c1">#     conv2 = Conv2D(2048,(3,3), padding = &#39;same&#39;, activation = &#39;linear&#39;, kernel_initializer=&#39;he_normal&#39;)(conv1)</span>
<span class="c1">#     layer_out = add([conv2, x])</span>
<span class="c1">#     x = Activation(&#39;relu&#39;)(layer_out)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">Flatten</span><span class="p">()(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">fc</span> <span class="ow">in</span> <span class="n">fc_layers</span><span class="p">:</span>
        <span class="c1"># Can look here if adding different types of layers has an effect</span>
        <span class="c1"># Also explore differences in changing activation function</span>
        <span class="c1"># Can also iterate on droupout amount</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span> 
        <span class="n">x</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">dropout</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># New softmax layer</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">num_classes</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span> 

    <span class="n">finetune_model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">base_model</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">predictions</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">finetune_model</span>

<span class="c1"># Can change the model architecture here</span>
<span class="n">FC_LAYERS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span><span class="mi">32</span><span class="p">]</span>
<span class="n">dropout</span> <span class="o">=</span> <span class="mf">0.3</span>

<span class="n">imageClass_finetune_model</span> <span class="o">=</span> <span class="n">build_finetune_model</span><span class="p">(</span><span class="n">base_model</span><span class="p">,</span> 
                                      <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span> 
                                      <span class="n">fc_layers</span><span class="o">=</span><span class="n">FC_LAYERS</span><span class="p">,</span> 
                                      <span class="n">num_classes</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">WARNING</span><span class="p">:</span><span class="n">tensorflow</span><span class="p">:</span><span class="k">From</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="p">.</span><span class="mi">6</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">tensorflow</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">keras</span><span class="o">/</span><span class="n">layers</span><span class="o">/</span><span class="n">core</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">143</span><span class="p">:</span> <span class="n">calling</span> <span class="nf">dropout</span> <span class="p">(</span><span class="k">from</span> <span class="n">tensorflow</span><span class="p">.</span><span class="n">python</span><span class="p">.</span><span class="n">ops</span><span class="p">.</span><span class="n">nn_ops</span><span class="p">)</span> <span class="k">with</span> <span class="n">keep_prob</span> <span class="k">is</span> <span class="n">deprecated</span> <span class="k">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="k">in</span> <span class="n">a</span> <span class="n">future</span> <span class="n">version</span><span class="p">.</span>
<span class="n">Instructions</span> <span class="k">for</span> <span class="n">updating</span><span class="p">:</span>
<span class="n">Please</span> <span class="k">use</span> <span class="ss">`rate`</span> <span class="n">instead</span> <span class="n">of</span> <span class="ss">`keep_prob`</span><span class="p">.</span> <span class="n">Rate</span> <span class="n">should</span> <span class="n">be</span> <span class="kt">set</span> <span class="k">to</span> <span class="ss">`rate = 1 - keep_prob`</span><span class="p">.</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">SGD</span><span class="p">,</span> <span class="n">Adam</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">ModelCheckpoint</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">numpy</span>   

<span class="c1"># For the baseline model will use 100 epochs and 15000 images to test model performance</span>
<span class="c1"># Will then use &#39;optimized&#39; model parameters to train for longer time and explore</span>
<span class="c1"># Size vs Accuracy for edge compute purposes</span>
<span class="n">NUM_EPOCHS</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">num_train_images</span> <span class="o">=</span> <span class="mi">15000</span>
<span class="n">num_val_images</span> <span class="o">=</span> <span class="mi">479</span>

<span class="n">adam</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="mf">0.00001</span><span class="p">)</span>
<span class="c1"># Can look into whether </span>
<span class="c1">#finetune_model.compile(adam, loss=&#39;categorical_crossentropy&#39;, metrics=[&#39;accuracy&#39;])</span>

<span class="n">imageClass_finetune_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">adam</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;categorical_crossentropy&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;categorical_accuracy&#39;</span><span class="p">])</span>
<span class="c1"># Checkpoin is overwritten at each epoch - can look at line below where datetime is used to create time based file names</span>
<span class="n">filepath</span><span class="o">=</span><span class="s2">&quot;/root/w251_finalproject/checkpoint/model&quot;</span>
<span class="n">checkpoint</span> <span class="o">=</span> <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;categorical_accuracy&quot;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>


<span class="c1"># history = finetune_model.fit_generator(train_generator, epochs=NUM_EPOCHS, </span>
<span class="c1">#                                        steps_per_epoch=num_train_images // BATCH_SIZE, </span>
<span class="c1">#                                        shuffle=True)# , callbacks=[checkpoint])</span>

<span class="n">imageClass_history</span> <span class="o">=</span> <span class="n">imageClass_finetune_model</span><span class="o">.</span><span class="n">fit_generator</span><span class="p">(</span>
    <span class="n">imageClass_train_generator</span><span class="p">,</span>
    <span class="n">steps_per_epoch</span><span class="o">=</span> <span class="n">num_train_images</span> <span class="o">//</span> <span class="n">BATCH_SIZE</span><span class="p">,</span>
    <span class="n">epochs</span><span class="o">=</span><span class="n">NUM_EPOCHS</span><span class="p">,</span>
    <span class="n">validation_data</span><span class="o">=</span><span class="n">imageClass_validation_generator</span><span class="p">,</span>
    <span class="n">validation_steps</span><span class="o">=</span> <span class="n">num_val_images</span> <span class="o">//</span> <span class="n">BATCH_SIZE</span>
<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">WARNING</span><span class="o">:</span><span class="n">tensorflow</span><span class="o">:</span><span class="n">From</span> <span class="sr">/opt/conda/lib/python3.6/site-packages/tensorflow/python/ops/</span><span class="n">math_ops</span><span class="o">.</span><span class="na">py</span><span class="o">:</span><span class="mi">3066</span><span class="o">:</span> <span class="n">to_int32</span> <span class="o">(</span><span class="n">from</span> <span class="n">tensorflow</span><span class="o">.</span><span class="na">python</span><span class="o">.</span><span class="na">ops</span><span class="o">.</span><span class="na">math_ops</span><span class="o">)</span> <span class="k">is</span> <span class="n">deprecated</span> <span class="n">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="k">in</span> <span class="n">a</span> <span class="n">future</span> <span class="n">version</span><span class="o">.</span>
<span class="n">Instructions</span> <span class="k">for</span> <span class="n">updating</span><span class="o">:</span>
<span class="n">Use</span> <span class="n">tf</span><span class="o">.</span><span class="na">cast</span> <span class="n">instead</span><span class="o">.</span>
<span class="n">Epoch</span> <span class="mi">1</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 16s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.6113</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.0021</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 275s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.0240</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.0878</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.6113</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.0021</span>
<span class="n">Epoch</span> <span class="mi">2</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 917ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.4534</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.0146</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5324</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1896</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.4534</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.0146</span>
<span class="n">Epoch</span> <span class="mi">3</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 971ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.0701</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1065</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 259s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.3367</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2323</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.0701</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1065</span>
<span class="n">Epoch</span> <span class="mi">4</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 967ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.9508</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1211</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 255s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.2017</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2606</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.9508</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1211</span>
<span class="n">Epoch</span> <span class="mi">5</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 965ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.0411</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1148</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 255s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.1179</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2804</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.0411</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1148</span>
<span class="n">Epoch</span> <span class="mi">6</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 946ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.2681</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1065</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 255s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">2.9306</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3212</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.2681</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1065</span>
<span class="n">Epoch</span> <span class="mi">8</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 968ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.9663</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1378</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 256s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">2.8664</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3361</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.9663</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1378</span>
<span class="n">Epoch</span> <span class="mi">9</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 964ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.9804</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1608</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 256s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">2.7547</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3501</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.9804</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1608</span>
<span class="n">Epoch</span> <span class="mi">10</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.7974</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1670</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 258s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">2.6922</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3721</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.7974</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1670</span>
<span class="n">Epoch</span> <span class="mi">11</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 921ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.8230</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1816</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 255s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">2.6142</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3760</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.8230</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1816</span>
<span class="n">Epoch</span> <span class="mi">12</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 967ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.7753</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1858</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">2.5413</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3975</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.7753</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1858</span>
<span class="n">Epoch</span> <span class="mi">13</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 965ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.6889</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1921</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 258s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">2.4730</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.4126</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.6889</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1921</span>
<span class="n">Epoch</span> <span class="mi">14</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 939ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.6455</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2276</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 255s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">2.3795</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.4391</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.6455</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2276</span>
<span class="n">Epoch</span> <span class="mi">15</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 965ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.6641</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2234</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">2.3306</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.4415</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.6641</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2234</span>
<span class="n">Epoch</span> <span class="mi">16</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 948ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.7792</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1942</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">2.2660</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.4557</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.7792</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.1942</span>
<span class="n">Epoch</span> <span class="mi">17</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 941ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.6185</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2589</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">2.2083</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.4675</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.6185</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2589</span>
<span class="n">Epoch</span> <span class="mi">18</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 967ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.6167</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2463</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 258s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">2.1713</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.4840</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.6167</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2463</span>
<span class="n">Epoch</span> <span class="mi">19</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 993ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5697</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2401</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 256s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">2.1389</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.4877</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.5697</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2401</span>
<span class="n">Epoch</span> <span class="mi">20</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5496</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2568</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 258s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">2.0664</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.5042</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.5496</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2568</span>
<span class="n">Epoch</span> <span class="mi">21</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5511</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2484</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 259s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.9967</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.5138</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.5511</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2484</span>
<span class="n">Epoch</span> <span class="mi">22</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 969ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5397</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2484</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 254s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.9682</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.5229</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.5397</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2484</span>
<span class="n">Epoch</span> <span class="mi">23</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 981ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5904</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2025</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 253s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.9404</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.5297</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.5904</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2025</span>
<span class="n">Epoch</span> <span class="mi">24</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 950ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5082</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2881</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.8630</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.5409</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.5082</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2881</span>
<span class="n">Epoch</span> <span class="mi">25</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 924ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5616</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2317</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 256s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.8223</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.5524</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.5616</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2317</span>
<span class="n">Epoch</span> <span class="mi">26</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 913ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5328</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2672</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 256s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.7936</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.5583</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.5328</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2672</span>
<span class="n">Epoch</span> <span class="mi">27</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 13s 888ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5321</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2672</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.7634</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.5666</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.5321</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2672</span>
<span class="n">Epoch</span> <span class="mi">28</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 966ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5500</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2777</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 256s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.7230</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.5836</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.5500</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2777</span>
<span class="n">Epoch</span> <span class="mi">29</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 906ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.4617</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2818</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 255s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.6478</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.5955</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.4617</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2818</span>
<span class="n">Epoch</span> <span class="mi">30</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 986ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.6146</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2651</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 262s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.6235</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.6016</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.6146</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2651</span>
<span class="n">Epoch</span> <span class="mi">31</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 997ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.4886</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3027</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 261s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.5974</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.6085</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.4886</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3027</span>
<span class="n">Epoch</span> <span class="mi">32</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 968ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5459</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2839</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 259s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.5677</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.6140</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.5459</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2839</span>
<span class="n">Epoch</span> <span class="mi">33</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 983ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5736</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3006</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 259s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.5307</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.6216</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.5736</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3006</span>
<span class="n">Epoch</span> <span class="mi">34</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 908ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.4280</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3027</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.4952</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.6324</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.4280</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3027</span>
<span class="n">Epoch</span> <span class="mi">35</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 998ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.4712</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2881</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 256s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.4786</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.6285</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.4712</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2881</span>
<span class="n">Epoch</span> <span class="mi">36</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.4030</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2965</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 259s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.4276</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.6444</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.4030</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2965</span>
<span class="n">Epoch</span> <span class="mi">37</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 952ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5726</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2944</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 256s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.3896</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.6544</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.5726</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2944</span>
<span class="n">Epoch</span> <span class="mi">38</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 956ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.4549</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3027</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.3655</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.6545</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.4549</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3027</span>
<span class="n">Epoch</span> <span class="mi">39</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 943ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5666</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3173</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 256s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.3410</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.6658</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.5666</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3173</span>
<span class="n">Epoch</span> <span class="mi">40</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 966ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.6170</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3048</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.3112</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.6714</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.6170</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3048</span>
<span class="n">Epoch</span> <span class="mi">41</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5953</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3319</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 260s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.2718</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.6812</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.5953</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3319</span>
<span class="n">Epoch</span> <span class="mi">42</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 931ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5098</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3194</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 258s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.2447</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.6844</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.5098</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3194</span>
<span class="n">Epoch</span> <span class="mi">43</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 971ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.6556</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3152</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 259s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.2331</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.6902</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.6556</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3152</span>
<span class="n">Epoch</span> <span class="mi">44</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 1000ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5623</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3215</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.2130</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.6959</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.5623</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3215</span>
<span class="n">Epoch</span> <span class="mi">45</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 978ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.6266</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3215</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 256s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.2125</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.6986</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.6266</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3215</span>
<span class="n">Epoch</span> <span class="mi">46</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.6584</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3215</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 258s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.1844</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.6992</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.6584</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3215</span>
<span class="n">Epoch</span> <span class="mi">47</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 937ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.5813</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2881</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 256s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.1422</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7136</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.5813</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2881</span>
<span class="n">Epoch</span> <span class="mi">48</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 985ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.8531</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2797</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 259s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.1035</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7182</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.8531</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.2797</span>
<span class="n">Epoch</span> <span class="mi">49</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 13s 899ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.6830</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3111</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 254s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.0691</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7261</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.6830</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3111</span>
<span class="n">Epoch</span> <span class="mi">50</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 918ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.6863</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3340</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 258s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.0809</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7249</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.6863</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3340</span>
<span class="n">Epoch</span> <span class="mi">51</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 937ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.7512</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3486</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 259s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">1.0247</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7364</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.7512</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3486</span>
<span class="n">Epoch</span> <span class="mi">52</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 913ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.9033</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3215</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 261s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.9978</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7473</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.9033</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3215</span>
<span class="n">Epoch</span> <span class="mi">54</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.7908</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3299</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 260s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.9881</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7496</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.7908</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3299</span>
<span class="n">Epoch</span> <span class="mi">55</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 966ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.0360</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3466</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 262s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.9534</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7566</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.0360</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3466</span>
<span class="n">Epoch</span> <span class="mi">56</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 930ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.8476</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3507</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 256s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.9511</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7573</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.8476</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3507</span>
<span class="n">Epoch</span> <span class="mi">57</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 958ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.9393</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3299</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.9410</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7561</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.9393</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3299</span>
<span class="n">Epoch</span> <span class="mi">58</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 985ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.7561</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3633</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 256s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.8995</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7704</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.7561</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3633</span>
<span class="n">Epoch</span> <span class="mi">59</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 937ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.8762</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3194</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 258s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.8891</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7661</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.8762</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3194</span>
<span class="n">Epoch</span> <span class="mi">60</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 970ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.8328</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3633</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.8770</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7700</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.8328</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3633</span>
<span class="n">Epoch</span> <span class="mi">61</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 945ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.9193</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3215</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.8926</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7691</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.9193</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3215</span>
<span class="n">Epoch</span> <span class="mi">62</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 940ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.8608</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3236</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 261s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.8651</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7757</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.8608</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3236</span>
<span class="n">Epoch</span> <span class="mi">64</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 963ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.8405</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3570</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 256s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.8078</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7897</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.8405</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3570</span>
<span class="n">Epoch</span> <span class="mi">65</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 923ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.8981</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3382</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 259s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.8157</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7897</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.8981</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3382</span>
<span class="n">Epoch</span> <span class="mi">66</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 933ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.8738</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3633</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 256s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.7686</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7964</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.8738</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3633</span>
<span class="n">Epoch</span> <span class="mi">67</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 952ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.9339</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3507</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 259s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.7749</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.7993</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.9339</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3507</span>
<span class="n">Epoch</span> <span class="mi">68</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 946ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.9571</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3466</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.7536</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8021</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.9571</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3466</span>
<span class="n">Epoch</span> <span class="mi">69</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 969ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.8007</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3466</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 255s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.7473</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8030</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.8007</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3466</span>
<span class="n">Epoch</span> <span class="mi">70</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 952ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.9706</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3236</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 258s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.7411</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8111</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.9706</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3236</span>
<span class="n">Epoch</span> <span class="mi">71</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 992ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.0217</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3090</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 260s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.7040</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8175</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.0217</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3090</span>
<span class="n">Epoch</span> <span class="mi">73</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 984ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.2207</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3236</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 260s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.7035</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8163</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.2207</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3236</span>
<span class="n">Epoch</span> <span class="mi">74</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.0939</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3424</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 261s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.6778</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8236</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.0939</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3424</span>
<span class="n">Epoch</span> <span class="mi">75</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 948ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.2614</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3048</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 260s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.6627</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8261</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.2614</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3048</span>
<span class="n">Epoch</span> <span class="mi">76</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 964ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.1499</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3466</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 260s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.6598</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8281</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.1499</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3466</span>
<span class="n">Epoch</span> <span class="mi">77</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 955ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.0080</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3612</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 258s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.6407</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8349</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.0080</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3612</span>
<span class="n">Epoch</span> <span class="mi">78</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.9263</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3779</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 260s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.6510</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8344</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.9263</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3779</span>
<span class="n">Epoch</span> <span class="mi">79</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 16s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.1673</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3570</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 256s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.6200</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8320</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.1673</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3570</span>
<span class="n">Epoch</span> <span class="mi">80</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 924ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.9761</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3841</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 254s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.6182</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8349</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.9761</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3841</span>
<span class="n">Epoch</span> <span class="mi">81</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 952ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.0217</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3653</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 259s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.6103</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8404</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.0217</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3653</span>
<span class="n">Epoch</span> <span class="mi">82</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 951ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.1091</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3695</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 258s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.6012</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8440</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.1091</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3695</span>
<span class="n">Epoch</span> <span class="mi">83</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 936ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.3138</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3612</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 258s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.5759</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8465</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.3138</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3612</span>
<span class="n">Epoch</span> <span class="mi">84</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 993ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.2785</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3633</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 263s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.5842</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8461</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.2785</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3633</span>
<span class="n">Epoch</span> <span class="mi">85</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 942ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.4895</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3507</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.5625</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8519</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.4895</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3507</span>
<span class="n">Epoch</span> <span class="mi">86</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 946ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.0008</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3841</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 258s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.5547</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8559</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.0008</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3841</span>
<span class="n">Epoch</span> <span class="mi">87</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 924ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.3086</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3591</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.5477</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8593</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.3086</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3591</span>
<span class="n">Epoch</span> <span class="mi">88</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 932ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.1903</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3633</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 258s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.5408</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8590</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.1903</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3633</span>
<span class="n">Epoch</span> <span class="mi">89</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 983ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">3.9609</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3925</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 262s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.5284</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8569</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">3.9609</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3925</span>
<span class="n">Epoch</span> <span class="mi">90</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 969ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.3176</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3319</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.5195</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8571</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.3176</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3319</span>
<span class="n">Epoch</span> <span class="mi">91</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.3151</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3612</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 258s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.4904</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8698</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.3151</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3612</span>
<span class="n">Epoch</span> <span class="mi">92</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 967ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.1877</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3612</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 257s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.5116</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8645</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.1877</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3612</span>
<span class="n">Epoch</span> <span class="mi">93</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 982ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.2800</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3674</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 256s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.4985</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8670</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.2800</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3674</span>
<span class="n">Epoch</span> <span class="mi">94</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 923ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.2524</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3674</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 256s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.5113</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8652</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.2524</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3674</span>
<span class="n">Epoch</span> <span class="mi">95</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 987ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.3309</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3633</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 260s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.4773</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8708</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.3309</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3633</span>
<span class="n">Epoch</span> <span class="mi">96</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 926ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.3465</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3674</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 255s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.4611</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8808</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.3465</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3674</span>
<span class="n">Epoch</span> <span class="mi">97</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 14s 925ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.3581</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3820</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 259s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.4688</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8735</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.3581</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3820</span>
<span class="n">Epoch</span> <span class="mi">98</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 990ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.3597</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3779</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 260s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.4677</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8754</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.3597</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3779</span>
<span class="n">Epoch</span> <span class="mi">99</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 973ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.5483</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3674</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 258s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.4481</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8826</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.5483</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3674</span>
<span class="n">Epoch</span> <span class="mi">100</span><span class="o">/</span><span class="mi">100</span>
<span class="mi">15</span><span class="sr">/15 [==============================] - 15s 971ms/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">4.4849</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3674</span>
<span class="mi">250</span><span class="sr">/250 [==============================] - 259s 1s/s</span><span class="n">tep</span> <span class="o">-</span> <span class="n">loss</span><span class="o">:</span> <span class="mf">0.4404</span> <span class="o">-</span> <span class="n">categorical_accuracy</span><span class="o">:</span> <span class="mf">0.8810</span> <span class="o">-</span> <span class="n">val_loss</span><span class="o">:</span> <span class="mf">4.4849</span> <span class="o">-</span> <span class="n">val_categorical_accuracy</span><span class="o">:</span> <span class="mf">0.3674</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Save model performance in order to plot / compare later</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s1">&#39;ImageClass_loss_history.txt&#39;</span><span class="p">,</span> 
              <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imageClass_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">]),</span> <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s1">&#39;ImageClass_acc_history.txt&#39;</span><span class="p">,</span> 
              <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imageClass_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;categorical_accuracy&#39;</span><span class="p">]),</span> <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>
</pre></div>


<h2><strong>Section 5: Image classification model Inference in VM before deploying to TX2</strong></h2>
<p>The code below depicts the training run for the code provided above. The code base for both image classification (plant type) as well as binary classification (poison vs edible) is the same and won't be duplicated. The only differences between the two are the accuracy (categorical vs binary) - and the chosen optimum model. The following discussion details the training of an image classification model - followed by the binary model.</p>
<div class="highlight"><pre><span></span><span class="c1"># Visualize model performance</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">imageClass_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;categorical_accuracy&#39;</span><span class="p">]</span>
<span class="n">val_acc</span> <span class="o">=</span> <span class="n">imageClass_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_categorical_accuracy&#39;</span><span class="p">]</span>

<span class="n">loss</span> <span class="o">=</span> <span class="n">imageClass_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">]</span>
<span class="n">val_loss</span> <span class="o">=</span> <span class="n">imageClass_history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">]</span>

<span class="n">epochs_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_EPOCHS</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epochs_range</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Training Accuracy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epochs_range</span><span class="p">,</span> <span class="n">val_acc</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validation Accuracy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Training and Validation Accuracy&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epochs_range</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Training Loss&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epochs_range</span><span class="p">,</span> <span class="n">val_loss</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validation Loss&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Training and Validation Loss&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<table><tr>
    <td> <img src="images/edibleplants/output_37_0.png" alt="Drawing" style="width: 750px;"/> </td>
</tr></table>

<p>The accuracy and loss plots above suggest that we are potentially over-fitting our model towards the training dataset. We can see that high accuracy is achieved in the image classification - which is typically hard given the number of classes we are trying to predict. After 100 epochs we are achieving &gt;90% accuracy on the training set, but &lt;40% accuracy on the validation set. Additionally, validation accuracy appears to have plateaued at this level.</p>
<p>Similarly if we analyze the loss graph, we can see that loss is minimized for the validation dataset near 40 epochs and begins to rise - while the training loss continues to decrease. This structure was similar amongst the models that were analyzed using different layer and node architectures as well as activation functions. </p>
<p>In the future we would like to:
- Change the dropout rate - perhaps 0.3 is too low and allows the deep model to over-fit
- Use larger datasets. Perhaps there is a feature contained within the image augmented photos that the model is fitting to - whereby the validation dataset doesn't have augmented photos. The purpose of image augmentation is to increase the training dataset size as well as improve model performance to a variety of photos. This will need further investigation to prove whether this assumption is true.</p>
<p>It should be noted that our best performance was found when we enabled training on the base model layers (ResNet50). Presumably the residual layer architecture helped improve training inference above and beyond what the additional layers on top of the base model could provide. While this did impact training time on the VM (~36sec per epoch vs ~24 sec/epoch) the increase is marginal. Since training is done offline (only model inference at the edge needs to be performant) the tradeoff in training time vs accuracy is worthwhile. </p>
<p>While this model can further be optimized in order to increase validation accuracy - we understand that image classification - especially given the dataset similarity (all pictures of plants), can be difficult. We have chosen to move forward with this model which is lean (only uses 2 dense layers on top of the ResNet50 base model). This should help with model performance on the edge device. Future work will continue to improve model performance while also retaining a small network size. </p>
<h3>Save Model for deployment</h3>
<div class="highlight"><pre><span></span><span class="n">imageClass_finetune_model</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">&lt;tensorflow.python.keras.engine.training.Model at 0x7facc022eef0&gt;</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;./model&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">imageClass_finetune_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;./model/imageclass_model2.h5&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">keras</span> <span class="kn">import</span> <span class="n">backend</span> <span class="k">as</span> <span class="n">K</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span>  <span class="nn">tensorflow.python.keras.models</span> <span class="kn">import</span> <span class="n">load_model</span>
<span class="c1"># This line must be executed before loading Keras model.</span>
<span class="n">K</span><span class="o">.</span><span class="n">set_learning_phase</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Using TensorFlow backend.</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">imageClass_model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s1">&#39;./model/imageclass_model2.h5&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">imageClass_model</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">&lt;tensorflow.python.keras.engine.training.Model at 0x7fd41c59eda0&gt;</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">imageClass_model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">__________________________________________________________________________________________________</span>
<span class="err">Layer (type)                    Output Shape         Param #     Connected to                     </span>
<span class="err">==================================================================================================</span>
<span class="err">input_1 (InputLayer)            (None, 300, 300, 3)  0                                            </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">conv1_pad (ZeroPadding2D)       (None, 306, 306, 3)  0           input_1[0][0]                    </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">conv1 (Conv2D)                  (None, 150, 150, 64) 9472        conv1_pad[0][0]                  </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn_conv1 (BatchNormalizationV1) (None, 150, 150, 64) 256         conv1[0][0]                      </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation (Activation)         (None, 150, 150, 64) 0           bn_conv1[0][0]                   </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">pool1_pad (ZeroPadding2D)       (None, 152, 152, 64) 0           activation[0][0]                 </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">max_pooling2d (MaxPooling2D)    (None, 75, 75, 64)   0           pool1_pad[0][0]                  </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res2a_branch2a (Conv2D)         (None, 75, 75, 64)   4160        max_pooling2d[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn2a_branch2a (BatchNormalizati (None, 75, 75, 64)   256         res2a_branch2a[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_1 (Activation)       (None, 75, 75, 64)   0           bn2a_branch2a[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res2a_branch2b (Conv2D)         (None, 75, 75, 64)   36928       activation_1[0][0]               </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn2a_branch2b (BatchNormalizati (None, 75, 75, 64)   256         res2a_branch2b[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_2 (Activation)       (None, 75, 75, 64)   0           bn2a_branch2b[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res2a_branch2c (Conv2D)         (None, 75, 75, 256)  16640       activation_2[0][0]               </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res2a_branch1 (Conv2D)          (None, 75, 75, 256)  16640       max_pooling2d[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn2a_branch2c (BatchNormalizati (None, 75, 75, 256)  1024        res2a_branch2c[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn2a_branch1 (BatchNormalizatio (None, 75, 75, 256)  1024        res2a_branch1[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">add (Add)                       (None, 75, 75, 256)  0           bn2a_branch2c[0][0]              </span>
<span class="err">                                                                 bn2a_branch1[0][0]               </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_3 (Activation)       (None, 75, 75, 256)  0           add[0][0]                        </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res2b_branch2a (Conv2D)         (None, 75, 75, 64)   16448       activation_3[0][0]               </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn2b_branch2a (BatchNormalizati (None, 75, 75, 64)   256         res2b_branch2a[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_4 (Activation)       (None, 75, 75, 64)   0           bn2b_branch2a[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res2b_branch2b (Conv2D)         (None, 75, 75, 64)   36928       activation_4[0][0]               </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn2b_branch2b (BatchNormalizati (None, 75, 75, 64)   256         res2b_branch2b[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_5 (Activation)       (None, 75, 75, 64)   0           bn2b_branch2b[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res2b_branch2c (Conv2D)         (None, 75, 75, 256)  16640       activation_5[0][0]               </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn2b_branch2c (BatchNormalizati (None, 75, 75, 256)  1024        res2b_branch2c[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">add_1 (Add)                     (None, 75, 75, 256)  0           bn2b_branch2c[0][0]              </span>
<span class="err">                                                                 activation_3[0][0]               </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_6 (Activation)       (None, 75, 75, 256)  0           add_1[0][0]                      </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res2c_branch2a (Conv2D)         (None, 75, 75, 64)   16448       activation_6[0][0]               </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn2c_branch2a (BatchNormalizati (None, 75, 75, 64)   256         res2c_branch2a[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_7 (Activation)       (None, 75, 75, 64)   0           bn2c_branch2a[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res2c_branch2b (Conv2D)         (None, 75, 75, 64)   36928       activation_7[0][0]               </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn2c_branch2b (BatchNormalizati (None, 75, 75, 64)   256         res2c_branch2b[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_8 (Activation)       (None, 75, 75, 64)   0           bn2c_branch2b[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res2c_branch2c (Conv2D)         (None, 75, 75, 256)  16640       activation_8[0][0]               </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn2c_branch2c (BatchNormalizati (None, 75, 75, 256)  1024        res2c_branch2c[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">add_2 (Add)                     (None, 75, 75, 256)  0           bn2c_branch2c[0][0]              </span>
<span class="err">                                                                 activation_6[0][0]               </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_9 (Activation)       (None, 75, 75, 256)  0           add_2[0][0]                      </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res3a_branch2a (Conv2D)         (None, 38, 38, 128)  32896       activation_9[0][0]               </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn3a_branch2a (BatchNormalizati (None, 38, 38, 128)  512         res3a_branch2a[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_10 (Activation)      (None, 38, 38, 128)  0           bn3a_branch2a[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res3a_branch2b (Conv2D)         (None, 38, 38, 128)  147584      activation_10[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn3a_branch2b (BatchNormalizati (None, 38, 38, 128)  512         res3a_branch2b[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_11 (Activation)      (None, 38, 38, 128)  0           bn3a_branch2b[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res3a_branch2c (Conv2D)         (None, 38, 38, 512)  66048       activation_11[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res3a_branch1 (Conv2D)          (None, 38, 38, 512)  131584      activation_9[0][0]               </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn3a_branch2c (BatchNormalizati (None, 38, 38, 512)  2048        res3a_branch2c[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn3a_branch1 (BatchNormalizatio (None, 38, 38, 512)  2048        res3a_branch1[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">add_3 (Add)                     (None, 38, 38, 512)  0           bn3a_branch2c[0][0]              </span>
<span class="err">                                                                 bn3a_branch1[0][0]               </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_12 (Activation)      (None, 38, 38, 512)  0           add_3[0][0]                      </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res3b_branch2a (Conv2D)         (None, 38, 38, 128)  65664       activation_12[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn3b_branch2a (BatchNormalizati (None, 38, 38, 128)  512         res3b_branch2a[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_13 (Activation)      (None, 38, 38, 128)  0           bn3b_branch2a[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res3b_branch2b (Conv2D)         (None, 38, 38, 128)  147584      activation_13[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn3b_branch2b (BatchNormalizati (None, 38, 38, 128)  512         res3b_branch2b[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_14 (Activation)      (None, 38, 38, 128)  0           bn3b_branch2b[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res3b_branch2c (Conv2D)         (None, 38, 38, 512)  66048       activation_14[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn3b_branch2c (BatchNormalizati (None, 38, 38, 512)  2048        res3b_branch2c[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">add_4 (Add)                     (None, 38, 38, 512)  0           bn3b_branch2c[0][0]              </span>
<span class="err">                                                                 activation_12[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_15 (Activation)      (None, 38, 38, 512)  0           add_4[0][0]                      </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res3c_branch2a (Conv2D)         (None, 38, 38, 128)  65664       activation_15[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn3c_branch2a (BatchNormalizati (None, 38, 38, 128)  512         res3c_branch2a[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_16 (Activation)      (None, 38, 38, 128)  0           bn3c_branch2a[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res3c_branch2b (Conv2D)         (None, 38, 38, 128)  147584      activation_16[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn3c_branch2b (BatchNormalizati (None, 38, 38, 128)  512         res3c_branch2b[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_17 (Activation)      (None, 38, 38, 128)  0           bn3c_branch2b[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res3c_branch2c (Conv2D)         (None, 38, 38, 512)  66048       activation_17[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn3c_branch2c (BatchNormalizati (None, 38, 38, 512)  2048        res3c_branch2c[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">add_5 (Add)                     (None, 38, 38, 512)  0           bn3c_branch2c[0][0]              </span>
<span class="err">                                                                 activation_15[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_18 (Activation)      (None, 38, 38, 512)  0           add_5[0][0]                      </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res3d_branch2a (Conv2D)         (None, 38, 38, 128)  65664       activation_18[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn3d_branch2a (BatchNormalizati (None, 38, 38, 128)  512         res3d_branch2a[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_19 (Activation)      (None, 38, 38, 128)  0           bn3d_branch2a[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res3d_branch2b (Conv2D)         (None, 38, 38, 128)  147584      activation_19[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn3d_branch2b (BatchNormalizati (None, 38, 38, 128)  512         res3d_branch2b[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_20 (Activation)      (None, 38, 38, 128)  0           bn3d_branch2b[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res3d_branch2c (Conv2D)         (None, 38, 38, 512)  66048       activation_20[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn3d_branch2c (BatchNormalizati (None, 38, 38, 512)  2048        res3d_branch2c[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">add_6 (Add)                     (None, 38, 38, 512)  0           bn3d_branch2c[0][0]              </span>
<span class="err">                                                                 activation_18[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_21 (Activation)      (None, 38, 38, 512)  0           add_6[0][0]                      </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4a_branch2a (Conv2D)         (None, 19, 19, 256)  131328      activation_21[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4a_branch2a (BatchNormalizati (None, 19, 19, 256)  1024        res4a_branch2a[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_22 (Activation)      (None, 19, 19, 256)  0           bn4a_branch2a[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4a_branch2b (Conv2D)         (None, 19, 19, 256)  590080      activation_22[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4a_branch2b (BatchNormalizati (None, 19, 19, 256)  1024        res4a_branch2b[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_23 (Activation)      (None, 19, 19, 256)  0           bn4a_branch2b[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4a_branch2c (Conv2D)         (None, 19, 19, 1024) 263168      activation_23[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4a_branch1 (Conv2D)          (None, 19, 19, 1024) 525312      activation_21[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4a_branch2c (BatchNormalizati (None, 19, 19, 1024) 4096        res4a_branch2c[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4a_branch1 (BatchNormalizatio (None, 19, 19, 1024) 4096        res4a_branch1[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">add_7 (Add)                     (None, 19, 19, 1024) 0           bn4a_branch2c[0][0]              </span>
<span class="err">                                                                 bn4a_branch1[0][0]               </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_24 (Activation)      (None, 19, 19, 1024) 0           add_7[0][0]                      </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4b_branch2a (Conv2D)         (None, 19, 19, 256)  262400      activation_24[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4b_branch2a (BatchNormalizati (None, 19, 19, 256)  1024        res4b_branch2a[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_25 (Activation)      (None, 19, 19, 256)  0           bn4b_branch2a[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4b_branch2b (Conv2D)         (None, 19, 19, 256)  590080      activation_25[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4b_branch2b (BatchNormalizati (None, 19, 19, 256)  1024        res4b_branch2b[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_26 (Activation)      (None, 19, 19, 256)  0           bn4b_branch2b[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4b_branch2c (Conv2D)         (None, 19, 19, 1024) 263168      activation_26[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4b_branch2c (BatchNormalizati (None, 19, 19, 1024) 4096        res4b_branch2c[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">add_8 (Add)                     (None, 19, 19, 1024) 0           bn4b_branch2c[0][0]              </span>
<span class="err">                                                                 activation_24[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_27 (Activation)      (None, 19, 19, 1024) 0           add_8[0][0]                      </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4c_branch2a (Conv2D)         (None, 19, 19, 256)  262400      activation_27[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4c_branch2a (BatchNormalizati (None, 19, 19, 256)  1024        res4c_branch2a[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_28 (Activation)      (None, 19, 19, 256)  0           bn4c_branch2a[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4c_branch2b (Conv2D)         (None, 19, 19, 256)  590080      activation_28[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4c_branch2b (BatchNormalizati (None, 19, 19, 256)  1024        res4c_branch2b[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_29 (Activation)      (None, 19, 19, 256)  0           bn4c_branch2b[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4c_branch2c (Conv2D)         (None, 19, 19, 1024) 263168      activation_29[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4c_branch2c (BatchNormalizati (None, 19, 19, 1024) 4096        res4c_branch2c[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">add_9 (Add)                     (None, 19, 19, 1024) 0           bn4c_branch2c[0][0]              </span>
<span class="err">                                                                 activation_27[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_30 (Activation)      (None, 19, 19, 1024) 0           add_9[0][0]                      </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4d_branch2a (Conv2D)         (None, 19, 19, 256)  262400      activation_30[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4d_branch2a (BatchNormalizati (None, 19, 19, 256)  1024        res4d_branch2a[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_31 (Activation)      (None, 19, 19, 256)  0           bn4d_branch2a[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4d_branch2b (Conv2D)         (None, 19, 19, 256)  590080      activation_31[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4d_branch2b (BatchNormalizati (None, 19, 19, 256)  1024        res4d_branch2b[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_32 (Activation)      (None, 19, 19, 256)  0           bn4d_branch2b[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4d_branch2c (Conv2D)         (None, 19, 19, 1024) 263168      activation_32[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4d_branch2c (BatchNormalizati (None, 19, 19, 1024) 4096        res4d_branch2c[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">add_10 (Add)                    (None, 19, 19, 1024) 0           bn4d_branch2c[0][0]              </span>
<span class="err">                                                                 activation_30[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_33 (Activation)      (None, 19, 19, 1024) 0           add_10[0][0]                     </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4e_branch2a (Conv2D)         (None, 19, 19, 256)  262400      activation_33[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4e_branch2a (BatchNormalizati (None, 19, 19, 256)  1024        res4e_branch2a[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_34 (Activation)      (None, 19, 19, 256)  0           bn4e_branch2a[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4e_branch2b (Conv2D)         (None, 19, 19, 256)  590080      activation_34[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4e_branch2b (BatchNormalizati (None, 19, 19, 256)  1024        res4e_branch2b[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_35 (Activation)      (None, 19, 19, 256)  0           bn4e_branch2b[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4e_branch2c (Conv2D)         (None, 19, 19, 1024) 263168      activation_35[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4e_branch2c (BatchNormalizati (None, 19, 19, 1024) 4096        res4e_branch2c[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">add_11 (Add)                    (None, 19, 19, 1024) 0           bn4e_branch2c[0][0]              </span>
<span class="err">                                                                 activation_33[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_36 (Activation)      (None, 19, 19, 1024) 0           add_11[0][0]                     </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4f_branch2a (Conv2D)         (None, 19, 19, 256)  262400      activation_36[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4f_branch2a (BatchNormalizati (None, 19, 19, 256)  1024        res4f_branch2a[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_37 (Activation)      (None, 19, 19, 256)  0           bn4f_branch2a[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4f_branch2b (Conv2D)         (None, 19, 19, 256)  590080      activation_37[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4f_branch2b (BatchNormalizati (None, 19, 19, 256)  1024        res4f_branch2b[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_38 (Activation)      (None, 19, 19, 256)  0           bn4f_branch2b[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res4f_branch2c (Conv2D)         (None, 19, 19, 1024) 263168      activation_38[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn4f_branch2c (BatchNormalizati (None, 19, 19, 1024) 4096        res4f_branch2c[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">add_12 (Add)                    (None, 19, 19, 1024) 0           bn4f_branch2c[0][0]              </span>
<span class="err">                                                                 activation_36[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_39 (Activation)      (None, 19, 19, 1024) 0           add_12[0][0]                     </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res5a_branch2a (Conv2D)         (None, 10, 10, 512)  524800      activation_39[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn5a_branch2a (BatchNormalizati (None, 10, 10, 512)  2048        res5a_branch2a[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_40 (Activation)      (None, 10, 10, 512)  0           bn5a_branch2a[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res5a_branch2b (Conv2D)         (None, 10, 10, 512)  2359808     activation_40[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn5a_branch2b (BatchNormalizati (None, 10, 10, 512)  2048        res5a_branch2b[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_41 (Activation)      (None, 10, 10, 512)  0           bn5a_branch2b[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res5a_branch2c (Conv2D)         (None, 10, 10, 2048) 1050624     activation_41[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res5a_branch1 (Conv2D)          (None, 10, 10, 2048) 2099200     activation_39[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn5a_branch2c (BatchNormalizati (None, 10, 10, 2048) 8192        res5a_branch2c[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn5a_branch1 (BatchNormalizatio (None, 10, 10, 2048) 8192        res5a_branch1[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">add_13 (Add)                    (None, 10, 10, 2048) 0           bn5a_branch2c[0][0]              </span>
<span class="err">                                                                 bn5a_branch1[0][0]               </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_42 (Activation)      (None, 10, 10, 2048) 0           add_13[0][0]                     </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res5b_branch2a (Conv2D)         (None, 10, 10, 512)  1049088     activation_42[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn5b_branch2a (BatchNormalizati (None, 10, 10, 512)  2048        res5b_branch2a[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_43 (Activation)      (None, 10, 10, 512)  0           bn5b_branch2a[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res5b_branch2b (Conv2D)         (None, 10, 10, 512)  2359808     activation_43[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn5b_branch2b (BatchNormalizati (None, 10, 10, 512)  2048        res5b_branch2b[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_44 (Activation)      (None, 10, 10, 512)  0           bn5b_branch2b[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res5b_branch2c (Conv2D)         (None, 10, 10, 2048) 1050624     activation_44[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn5b_branch2c (BatchNormalizati (None, 10, 10, 2048) 8192        res5b_branch2c[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">add_14 (Add)                    (None, 10, 10, 2048) 0           bn5b_branch2c[0][0]              </span>
<span class="err">                                                                 activation_42[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_45 (Activation)      (None, 10, 10, 2048) 0           add_14[0][0]                     </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res5c_branch2a (Conv2D)         (None, 10, 10, 512)  1049088     activation_45[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn5c_branch2a (BatchNormalizati (None, 10, 10, 512)  2048        res5c_branch2a[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_46 (Activation)      (None, 10, 10, 512)  0           bn5c_branch2a[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res5c_branch2b (Conv2D)         (None, 10, 10, 512)  2359808     activation_46[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn5c_branch2b (BatchNormalizati (None, 10, 10, 512)  2048        res5c_branch2b[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_47 (Activation)      (None, 10, 10, 512)  0           bn5c_branch2b[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">res5c_branch2c (Conv2D)         (None, 10, 10, 2048) 1050624     activation_47[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">bn5c_branch2c (BatchNormalizati (None, 10, 10, 2048) 8192        res5c_branch2c[0][0]             </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">add_15 (Add)                    (None, 10, 10, 2048) 0           bn5c_branch2c[0][0]              </span>
<span class="err">                                                                 activation_45[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">activation_48 (Activation)      (None, 10, 10, 2048) 0           add_15[0][0]                     </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">flatten (Flatten)               (None, 204800)       0           activation_48[0][0]              </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">dense (Dense)                   (None, 128)          26214528    flatten[0][0]                    </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">dropout (Dropout)               (None, 128)          0           dense[0][0]                      </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">dense_1 (Dense)                 (None, 32)           4128        dropout[0][0]                    </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">dropout_1 (Dropout)             (None, 32)           0           dense_1[0][0]                    </span>
<span class="err">__________________________________________________________________________________________________</span>
<span class="err">dense_2 (Dense)                 (None, 70)           2310        dropout_1[0][0]                  </span>
<span class="err">==================================================================================================</span>
<span class="err">Total params: 49,808,678</span>
<span class="err">Trainable params: 49,755,558</span>
<span class="err">Non-trainable params: 53,120</span>
<span class="err">__________________________________________________________________________________________________</span>
</pre></div>


<p>We can see that, even though we chose ResNet50 as the base model due to its size - there are still a number of parameters that are contained within our overall model (the model summariezed above allows training on many of the ResNet50 layers as this gave better accuracy). In the inference section we will detail model performance both with and without TensorRT optimization and show how a large model such as the one depicted above can be difficult on the resources provided at the edge.</p>
<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">imageClass_model</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">imageClass_model</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">[&lt;tf.Tensor &#39;input_1_1:0&#39; shape=(?, 300, 300, 3) dtype=float32&gt;]</span>
<span class="k">[&lt;tf.Tensor &#39;dense_2_1/Softmax:0&#39; shape=(?, 70) dtype=float32&gt;]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1">#labels_path = tf.keras.utils.get_file(&#39;cats_dogs_labels.txt&#39;,&#39;http://localhost:8888/edit/cats_dogs/cats_dogs_labels.txt&#39;)</span>
<span class="n">labels_path</span> <span class="o">=</span> <span class="s1">&#39;Plant_Class_Labels.txt&#39;</span>
<span class="n">class_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">labels_path</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>
<span class="n">class_labels</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">array([&#39;Alfalfa&#39;, &#39;Asparagus&#39;, &#39;Blue_Vervain&#39;, &#39;Broadleaf_Plantain&#39;,</span>
<span class="err">       &#39;Bull_Thistle&#39;, &#39;castor_oil_plant&#39;, &#39;Cattail&#39;, &#39;Chickweed&#39;,</span>
<span class="err">       &#39;Chicory&#39;, &#39;Cleavers&#39;, &#39;Coltsfoot&#39;, &#39;Common_Sow_Thistle&#39;,</span>
<span class="err">       &#39;Common_Yarrow&#39;, &#39;Coneflower&#39;, &#39;Creeping_Charlie&#39;,</span>
<span class="err">       &#39;Crimson_Clover&#39;, &#39;Curly_Dock&#39;, &#39;Daisy_Fleabane&#39;, &#39;Dandellion&#39;,</span>
<span class="err">       &#39;dieffenbachia&#39;, &#39;Downy_Yellow_Violet&#39;, &#39;Elderberry&#39;,</span>
<span class="err">       &#39;Evening_Primrose&#39;, &#39;Fern_Leaf_Yarrow&#39;, &#39;Field_Pennycress&#39;,</span>
<span class="err">       &#39;Fireweed&#39;, &#39;Forget_Me_Not&#39;, &#39;foxglove&#39;, &#39;Garlic_Mustard&#39;,</span>
<span class="err">       &#39;Harebell&#39;, &#39;Henbit&#39;, &#39;Herb_Robert&#39;, &#39;Japanese_Knotweed&#39;,</span>
<span class="err">       &#39;Joe_Pye_Weed&#39;, &#39;Knapweed&#39;, &#39;Kudzu&#39;, &#39;Lambs_Quarters&#39;, &#39;lilies&#39;,</span>
<span class="err">       &#39;lily_of_the_valley&#39;, &#39;Mallow&#39;, &#39;Mayapple&#39;, &#39;Meadowsweet&#39;,</span>
<span class="err">       &#39;Milk_Thistle&#39;, &#39;Mullein&#39;, &#39;New_England_Aster&#39;, &#39;oleander&#39;,</span>
<span class="err">       &#39;Partridgeberry&#39;, &#39;Peppergrass&#39;, &#39;Pickerelweed&#39;, &#39;Pineapple_Weed&#39;,</span>
<span class="err">       &#39;Prickly_Pear_Cactus&#39;, &#39;Purple_Deadnettle&#39;, &#39;Queen_Annes_Lace&#39;,</span>
<span class="err">       &#39;Red_Clover&#39;, &#39;rhubarb&#39;, &#39;Sheep_Sorrel&#39;, &#39;Shepherds_Purse&#39;,</span>
<span class="err">       &#39;Spring_Beauty&#39;, &#39;Sunflower&#39;, &#39;Supplejack_Vine&#39;, &#39;Tea_Plant&#39;,</span>
<span class="err">       &#39;Teasel&#39;, &#39;Toothwort&#39;, &#39;Vervain_Mallow&#39;, &#39;Wild_Bee_Balm&#39;,</span>
<span class="err">       &#39;Wild_Black_Cherry&#39;, &#39;Wild_Grape_Vine&#39;, &#39;Wild_Leek&#39;, &#39;wisteria&#39;,</span>
<span class="err">       &#39;Wood_Sorrel&#39;], dtype=&#39;&lt;U19&#39;)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.image</span> <span class="kn">import</span> <span class="n">ImageDataGenerator</span>
<span class="n">IMAGECLASS_TEST_DIR</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>
<span class="n">image_generator</span> <span class="o">=</span> <span class="n">ImageDataGenerator</span><span class="p">(</span><span class="n">rescale</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>

<span class="n">image_data</span> <span class="o">=</span> <span class="n">image_generator</span><span class="o">.</span><span class="n">flow_from_directory</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">IMAGECLASS_TEST_DIR</span><span class="p">,</span>
                                                 <span class="n">target_size</span><span class="o">=</span><span class="p">(</span><span class="n">HEIGHT</span><span class="p">,</span> <span class="n">WIDTH</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Found 157 images belonging to 70 classes.</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">image_batch</span><span class="p">,</span> <span class="n">label_batch</span> <span class="ow">in</span> <span class="n">image_data</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image batch shape: &quot;</span><span class="p">,</span> <span class="n">image_batch</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Label batch shape: &quot;</span><span class="p">,</span> <span class="n">label_batch</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
  <span class="k">break</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Image batch shape:  (32, 300, 300, 3)</span>
<span class="err">Label batch shape:  (32, 70)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">result_batch</span> <span class="o">=</span> <span class="n">imageClass_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image_batch</span><span class="p">)</span>
<span class="n">result_batch</span><span class="o">.</span><span class="n">shape</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">(32, 70)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">predicted_class_names</span> <span class="o">=</span> <span class="n">class_labels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">result_batch</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">predicted_class_names</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">array([&#39;Vervain_Mallow&#39;, &#39;Daisy_Fleabane&#39;, &#39;Purple_Deadnettle&#39;,</span>
<span class="err">       &#39;Wild_Bee_Balm&#39;, &#39;lilies&#39;, &#39;Vervain_Mallow&#39;, &#39;Daisy_Fleabane&#39;,</span>
<span class="err">       &#39;Knapweed&#39;, &#39;Red_Clover&#39;, &#39;Toothwort&#39;, &#39;Meadowsweet&#39;, &#39;Knapweed&#39;,</span>
<span class="err">       &#39;rhubarb&#39;, &#39;Common_Sow_Thistle&#39;, &#39;Alfalfa&#39;, &#39;Wild_Leek&#39;, &#39;Alfalfa&#39;,</span>
<span class="err">       &#39;Elderberry&#39;, &#39;Wild_Bee_Balm&#39;, &#39;Fern_Leaf_Yarrow&#39;, &#39;Spring_Beauty&#39;,</span>
<span class="err">       &#39;Mallow&#39;, &#39;Wild_Bee_Balm&#39;, &#39;Asparagus&#39;, &#39;Joe_Pye_Weed&#39;,</span>
<span class="err">       &#39;Joe_Pye_Weed&#39;, &#39;Curly_Dock&#39;, &#39;Wood_Sorrel&#39;, &#39;Field_Pennycress&#39;,</span>
<span class="err">       &#39;dieffenbachia&#39;, &#39;Wood_Sorrel&#39;, &#39;Herb_Robert&#39;], dtype=&#39;&lt;U19&#39;)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_batch</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">predicted_class_names</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;ImageNet predictions&quot;</span><span class="p">)</span>
</pre></div>


<table><tr>
    <td> <img src="images/edibleplants/output_53_0.png" alt="Drawing" style="width: 750px;"/> </td>
</tr></table>

<p>In general many of the predicted image labels were correct. As can be seen above - the nuances in plant images in order to assign a class from over 70 total classes is a difficult problem. While our training accuracy gave good results - further model development will be needed in order to improve validation accuracy. </p>
<p>As stated in the introduction - we understood that image classification was likely a difficult problem to obtain high accuracy. While it is optimal to have the specific plant species depicted in the photo (in order to not only obtain edible/poison information - but also plant background/and other facts), we also need to optimize the solution of whether the plant is edible or poisonous. Having &lt;40% accuracy on the validation datset does not lend enoguh confidence to utlize the model at the edge if debating to eat a plant based on the model prediction. </p>
<p>We therefore developed another model (binary model) in order to obtain higher accuracy to provide confidence to the user whether or not a plant is edible or poisonous. </p>
<h2><strong>Section 6: Binary Poison Detection Model Analysis</strong></h2>
<p>While having the ability to reveal plant identification via image classification provides a richer context of the plant background (name, species, description, etc) - we have seen that the model cannot predict with a high accuracy (&gt;90%) whether or not a plant is poisonous. From a users perspective, this lack of confidence likely isn't worthwhile to utilize the model as the consequences of a wrong prediction are severe. </p>
<p>In addition to the image classification problem described above we also explored whether or not features contained in the images of poisonous and edible plants could be extracted in order to predict whether or not a plant was poisonous (without regard to the specific species or genome of the plant). We similarly started with ResNet50 as this provides a good starting point for model architecture as well as the image classification problem. </p>
<p>Similar to image classification - we attempted different model architectures in order to obtain the best performing model. In the first iteration of model performance we examined:
- Training on an imbalanced training set (remember we have &gt;6k images of edible plants and only 410 of poisonous plants)
- Using image augmentation on the poisonous plants dataset in order to balance the training dataset
- Different model depths (baseline model contains layers with [128,64,32,16] nodes). Expanded to six different layers containing up to 1024 nodes. All layers were Dense in the original round of training
- Changing dropout rate - generally performed worse (perhaps needed longer training time) - performance not shown below
- Different activation functions (specifically tanh) 
- Training the entire model (including the ResNet50 base model)
- Different layer architecture (Dense, CNN, Pooling, Residual)</p>
<p>Depicted below is the performance of these different training episodes:
<table><tr>
    <td> <img src="images/edibleplants/Binary_Accuracy.JPG" alt="Drawing" style="width: 500px;"/> </td>
</tr></table></p>
<p>In the legend, equal infers the training set is balanced, tanh refers to a different activation function (default was relu), trainentiremodel refers to un-freezing the base ResNet50 model for training. As can be seen, while certain model architecture changes did impact performance in the earlier training epochs - the best performing model by far was the model that trained all layers (including ResNet50) as well as having additional dense layers above. Presumably this showcases the improved accuracy that the residual layers have in terms of the image classification/detection problem over and above a series of dense layers. </p>
<p>Surprisingly training the entire model did not have a large effect on training time. For 100 epochs training on only the dense layers we averaged 24sec per epoch training on a P100 GPU with a batch size of 64. When expanding and training on the entire model our average epoch time was 32sec. </p>
<p>In terms of other model performance - there wasn't very much of a performance boost by equalizing the dataset. The blue and green lines show approximately similar performance across the training epochs. This is likely due to the image augmentation that's already taking place during training in order to increase our total image size to 15,000. Increasing the depth of the model didn't show significant model performance improvement. This may be due to a small change in overall model architecture - moving from a layer configuration of [128,64,32,16] to [512,256,128,64,32,16]. This also may be due to the aforementioned degradation problem with deeper networks. </p>
<p>In order to explore different layer architectures - we also varied the types of layers as depicted below. Dense, CNN and Residual layers were all tested. During the early training periods we noticed that these different types of architectures likely required longer training periods to infer the appropriate weights. We therefore expanded our analysis to 500 epochs. </p>
<p>As the training periods depicted above plateaued around 96% accuracy, we wanted to analyze whether different layers could produce better results. We attempted three different model architectures on top of the base ResNet50 model: 
- Dense layers: similar to what has previously been trained
- CNN layer with Pooling: has been shown to be useful for image classification and detection problems
- Residual layers (2): this is the model architecture for ResNet50 - we wanted to determine if a similar architecture would help improve model performance</p>
<table><tr>
    <td> <img src="images/edibleplants/Binary_Accuracy_ModelLayer.JPG" alt="Drawing" style="width: 350px;"/> </td>
    <td> <img src="images/edibleplants/Binary_Precision_ModelLayer.JPG" alt="Drawing" style="width: 350px;"/> </td>
    <td> <img src="images/edibleplants/Binary_Recall_ModelLayer.JPG" alt="Drawing" style="width: 350px;"/> </td>
</tr></table>

<p>As previously mentioned, accuracy isn't the only metric in which we need to track for the binary detection problem. While a accuracy of 100% would be phenomenal, it isn't likely. However we also need to be cognizant that a model that can predict 100% of the time correctly when there is a poisonous plant is very important. This is because the consequences of predicting a plant is poisonous when it isn't (false positive) is much less severe than predicting a plant is edible when it's poisonous (false negative). We therefore also track recall, precision and F1 scores. Of these scores recall is likely the most important since it tracks true positives vs the number of poisonous plants in the dataset. </p>
<p>The graphs above depict accuracy, precision and recall in that order. In general all three match each other. From the plots we can see that CNN was the best performing model. The model that trained the entire ResNet50 along with two additional Residual layers may have outperformed - however the training time was significantly longer for this model. </p>
<p>During validation testing we noted that overall performance was lower for many models compared to training accuracy ~50-85% compared to &gt;90% on all models for training. This may be a consequence of over-fitting the model. We therefore attempted to train with a higher dropout (0.7 vs 0.3). As can be seen in the plots above this caused the model to fail to improve - perhaps because there was too much dropout. Further iterations would include refining the choice of dropout hyperparameter. Below is depicted a confusion matrix based on the final binary model: </p>
<table><tr>
    <td> <img src="images/edibleplants/ConfusionMatrix.JPG" alt="Drawing" style="width: 500px;"/> </td>
</tr></table>

<p>We can see that overall performance on the validation dataset is fairly good (accuracy 97.5% and recall 100%). The biggest benefit is the recall is 100% - so in no case did the model predict an edible plant when it was in fact poisonous. </p>
<p>While training it was noted that the best performing model in terms of training and validation accuracy &amp; recall was using the model that enabled training for all layers and included an additional CNN + pooling layer, coupled with 4 additional dense layers. Future work may iterate over different nuanced design choices to develop the best performing model with the smallest footprint. This would not only hopefully help improve accuracy and recall - but also improve inference time and resources on the edge device. </p>
<p>While this model architecutre is fairly large - we will use TensorRT in order to reduce the model size and improve inference. This is detailed in the sections below. </p>
<h2><strong>Section 7: Inference on TX2 (Edge Device)</strong></h2>
<p>Initially we wanted to see whether inference is possible on an edge device. We utilized a TX2 - which is more powerful than a typical edge device (smartphone / etc). When loading the model and attempting to make inference we found that most models wouldn't even load to memory. The larger model (detailed above with CNN and dense layers) frequently gave OOM errors indicating this model (without the benefit of TensorRT isn't applicable for edge devices). When the models would load we would frequently see nearly 100% memory utilization as depicted below:</p>
<table><tr>
    <td> <img src="images/edibleplants/Memory_Inference2.png" alt="Drawing" style="width: 500px;"/> </td>
</tr></table>

<p>It is therefore important that we utilize TensorRT in order to improve model performance on lower powered edge devices. </p>
<h3>TensorRT vs TensorFlow</h3>
<p>In order to get the best inference performance on TX2, we utilized the TensorRT.</p>
<p>TensorRT is a platform that optimizes neural network models and speeds up for inference across GPU-accelerated platforms. It optimizes the neural network by the following way 1) eliminate the unused output layers to save the computation. 2) fuse the convolution layer, Relu layer and bias as one single layer 3) Aggregate the layers horizontally. It also leverages FP16 precision to lower the memory requirement on the GPU. It can go further to INT8 but it requires more calibartion when convert/freeze the model in TensorFlow while the precision is still FP32. For this exercise, we plan to use FP16. Others worth mentioning: better integrate with TensorFlow 2.0 (our model is under TensorFlow 1.x) and TensorBoard. And it only optimized from a freeze inteference graph. </p>
<p>The benchmark on ResNet50 is that TensorRT is 8x faster than TensorFlow on interference.</p>
<h3>Convert Keras model to TensorFlow PB file</h3>
<p>As first step, We will need to convert Keras model(.h5) to tensorflow pb file. at same time freeze the graph so that TensorRT can use that. The graph is a plan to excute the computation which covers varibles and connections.</p>
<p>Then we will be able to save the freeze model into PB file so that model can be loaded in TX2. The overall structure is detailed in the image below: 
<table><tr>
    <td> <img src="images/edibleplants/tensorrt.JPG" alt="Drawing" style="width: 750px;"/> </td>
</tr></table></p>
<div class="highlight"><pre><span></span><span class="c1"># Load model from .h5 file and convert to Tensorflow</span>
<span class="c1"># Adapted from https://github.com/ardianumam/Tensorflow-TensorRT</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">keras</span> <span class="kn">import</span> <span class="n">backend</span> <span class="k">as</span> <span class="n">K</span>
<span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set_learning_phase</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">recall</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">true_positives</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">y_true</span> <span class="o">*</span> <span class="n">y_pred</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">possible_positives</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">recall</span> <span class="o">=</span> <span class="n">true_positives</span> <span class="o">/</span> <span class="p">(</span><span class="n">possible_positives</span> <span class="o">+</span> <span class="n">K</span><span class="o">.</span><span class="n">epsilon</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">recall</span>

<span class="k">def</span> <span class="nf">precision</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">true_positives</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">y_true</span> <span class="o">*</span> <span class="n">y_pred</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">predicted_positives</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">precision</span> <span class="o">=</span> <span class="n">true_positives</span> <span class="o">/</span> <span class="p">(</span><span class="n">predicted_positives</span> <span class="o">+</span> <span class="n">K</span><span class="o">.</span><span class="n">epsilon</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">precision</span>

<span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">precision</span> <span class="o">=</span> <span class="n">precision_m</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">recall</span> <span class="o">=</span> <span class="n">recall_m</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">precision</span><span class="o">*</span><span class="n">recall</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">precision</span><span class="o">+</span><span class="n">recall</span><span class="o">+</span><span class="n">K</span><span class="o">.</span><span class="n">epsilon</span><span class="p">()))</span>

<span class="k">def</span> <span class="nf">fbeta</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">precision</span> <span class="o">=</span> <span class="n">precision_m</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">recall</span> <span class="o">=</span> <span class="n">recall_m</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">precision</span><span class="o">*</span><span class="n">recall</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">precision</span><span class="o">+</span><span class="n">recall</span><span class="o">+</span><span class="n">K</span><span class="o">.</span><span class="n">epsilon</span><span class="p">()))</span>

<span class="k">def</span> <span class="nf">recall_m</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">true_positives</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">y_true</span> <span class="o">*</span> <span class="n">y_pred</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">possible_positives</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">recall</span> <span class="o">=</span> <span class="n">true_positives</span> <span class="o">/</span> <span class="p">(</span><span class="n">possible_positives</span> <span class="o">+</span> <span class="n">K</span><span class="o">.</span><span class="n">epsilon</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">recall</span>

<span class="k">def</span> <span class="nf">precision_m</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">true_positives</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">y_true</span> <span class="o">*</span> <span class="n">y_pred</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">predicted_positives</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">precision</span> <span class="o">=</span> <span class="n">true_positives</span> <span class="o">/</span> <span class="p">(</span><span class="n">predicted_positives</span> <span class="o">+</span> <span class="n">K</span><span class="o">.</span><span class="n">epsilon</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">precision</span>

<span class="c1"># Load model without TensorRT improvement</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">load_model</span>
<span class="n">filepath</span> <span class="o">=</span> <span class="s1">&#39;./model_params/binary_equal_trainentiremodel_50kimage_300epoch_model_weights.h5&#39;</span> 

<span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">custom_objects</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span> <span class="s1">&#39;recall&#39;</span><span class="p">:</span><span class="n">recall</span><span class="p">,</span> <span class="s1">&#39;f1&#39;</span><span class="p">:</span><span class="n">f1</span><span class="p">,</span> <span class="s1">&#39;fbeta&#39;</span><span class="p">:</span><span class="n">fbeta</span><span class="p">,</span>
                                            <span class="s1">&#39;precision_m&#39;</span><span class="p">:</span> <span class="n">precision_m</span><span class="p">,</span> <span class="s1">&#39;recall_m&#39;</span><span class="p">:</span><span class="n">recall_m</span><span class="p">})</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
<span class="n">model_name</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">WARNING</span><span class="p">:</span> <span class="n">Logging</span> <span class="k">before</span> <span class="n">flag</span> <span class="n">parsing</span> <span class="n">goes</span> <span class="k">to</span> <span class="n">stderr</span><span class="p">.</span>
<span class="n">W1209</span> <span class="mi">03</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">47</span><span class="p">.</span><span class="mi">527824</span> <span class="mi">548146294800</span> <span class="n">deprecation_wrapper</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">119</span><span class="p">]</span> <span class="k">From</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="p">.</span><span class="mi">6</span><span class="o">/</span><span class="n">dist</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">keras</span><span class="o">/</span><span class="n">backend</span><span class="o">/</span><span class="n">tensorflow_backend</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">541</span><span class="p">:</span> <span class="n">The</span> <span class="n">name</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span> <span class="k">is</span> <span class="n">deprecated</span><span class="p">.</span> <span class="n">Please</span> <span class="k">use</span> <span class="n">tf</span><span class="p">.</span><span class="n">compat</span><span class="p">.</span><span class="n">v1</span><span class="p">.</span><span class="n">placeholder</span> <span class="n">instead</span><span class="p">.</span>

<span class="n">W1209</span> <span class="mi">03</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">47</span><span class="p">.</span><span class="mi">644511</span> <span class="mi">548146294800</span> <span class="n">deprecation_wrapper</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">119</span><span class="p">]</span> <span class="k">From</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="p">.</span><span class="mi">6</span><span class="o">/</span><span class="n">dist</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">keras</span><span class="o">/</span><span class="n">backend</span><span class="o">/</span><span class="n">tensorflow_backend</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">4479</span><span class="p">:</span> <span class="n">The</span> <span class="n">name</span> <span class="n">tf</span><span class="p">.</span><span class="n">truncated_normal</span> <span class="k">is</span> <span class="n">deprecated</span><span class="p">.</span> <span class="n">Please</span> <span class="k">use</span> <span class="n">tf</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">truncated_normal</span> <span class="n">instead</span><span class="p">.</span>

<span class="n">W1209</span> <span class="mi">03</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">47</span><span class="p">.</span><span class="mi">770972</span> <span class="mi">548146294800</span> <span class="n">deprecation_wrapper</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">119</span><span class="p">]</span> <span class="k">From</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="p">.</span><span class="mi">6</span><span class="o">/</span><span class="n">dist</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">keras</span><span class="o">/</span><span class="n">backend</span><span class="o">/</span><span class="n">tensorflow_backend</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">66</span><span class="p">:</span> <span class="n">The</span> <span class="n">name</span> <span class="n">tf</span><span class="p">.</span><span class="n">get_default_graph</span> <span class="k">is</span> <span class="n">deprecated</span><span class="p">.</span> <span class="n">Please</span> <span class="k">use</span> <span class="n">tf</span><span class="p">.</span><span class="n">compat</span><span class="p">.</span><span class="n">v1</span><span class="p">.</span><span class="n">get_default_graph</span> <span class="n">instead</span><span class="p">.</span>

<span class="n">W1209</span> <span class="mi">03</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">47</span><span class="p">.</span><span class="mi">774623</span> <span class="mi">548146294800</span> <span class="n">deprecation_wrapper</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">119</span><span class="p">]</span> <span class="k">From</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="p">.</span><span class="mi">6</span><span class="o">/</span><span class="n">dist</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">keras</span><span class="o">/</span><span class="n">backend</span><span class="o">/</span><span class="n">tensorflow_backend</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">190</span><span class="p">:</span> <span class="n">The</span> <span class="n">name</span> <span class="n">tf</span><span class="p">.</span><span class="n">get_default_session</span> <span class="k">is</span> <span class="n">deprecated</span><span class="p">.</span> <span class="n">Please</span> <span class="k">use</span> <span class="n">tf</span><span class="p">.</span><span class="n">compat</span><span class="p">.</span><span class="n">v1</span><span class="p">.</span><span class="n">get_default_session</span> <span class="n">instead</span><span class="p">.</span>

<span class="n">W1209</span> <span class="mi">03</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">47</span><span class="p">.</span><span class="mi">777615</span> <span class="mi">548146294800</span> <span class="n">deprecation_wrapper</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">119</span><span class="p">]</span> <span class="k">From</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="p">.</span><span class="mi">6</span><span class="o">/</span><span class="n">dist</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">keras</span><span class="o">/</span><span class="n">backend</span><span class="o">/</span><span class="n">tensorflow_backend</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">197</span><span class="p">:</span> <span class="n">The</span> <span class="n">name</span> <span class="n">tf</span><span class="p">.</span><span class="n">ConfigProto</span> <span class="k">is</span> <span class="n">deprecated</span><span class="p">.</span> <span class="n">Please</span> <span class="k">use</span> <span class="n">tf</span><span class="p">.</span><span class="n">compat</span><span class="p">.</span><span class="n">v1</span><span class="p">.</span><span class="n">ConfigProto</span> <span class="n">instead</span><span class="p">.</span>

<span class="n">W1209</span> <span class="mi">03</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">51</span><span class="p">.</span><span class="mi">494961</span> <span class="mi">548146294800</span> <span class="n">deprecation_wrapper</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">119</span><span class="p">]</span> <span class="k">From</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="p">.</span><span class="mi">6</span><span class="o">/</span><span class="n">dist</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">keras</span><span class="o">/</span><span class="n">backend</span><span class="o">/</span><span class="n">tensorflow_backend</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">2041</span><span class="p">:</span> <span class="n">The</span> <span class="n">name</span> <span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">fused_batch_norm</span> <span class="k">is</span> <span class="n">deprecated</span><span class="p">.</span> <span class="n">Please</span> <span class="k">use</span> <span class="n">tf</span><span class="p">.</span><span class="n">compat</span><span class="p">.</span><span class="n">v1</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">fused_batch_norm</span> <span class="n">instead</span><span class="p">.</span>

<span class="n">W1209</span> <span class="mi">03</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">51</span><span class="p">.</span><span class="mi">732384</span> <span class="mi">548146294800</span> <span class="n">deprecation_wrapper</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">119</span><span class="p">]</span> <span class="k">From</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="p">.</span><span class="mi">6</span><span class="o">/</span><span class="n">dist</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">keras</span><span class="o">/</span><span class="n">backend</span><span class="o">/</span><span class="n">tensorflow_backend</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">4267</span><span class="p">:</span> <span class="n">The</span> <span class="n">name</span> <span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">max_pool</span> <span class="k">is</span> <span class="n">deprecated</span><span class="p">.</span> <span class="n">Please</span> <span class="k">use</span> <span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">max_pool2d</span> <span class="n">instead</span><span class="p">.</span>

<span class="n">W1209</span> <span class="mi">03</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">08</span><span class="p">.</span><span class="mi">064690</span> <span class="mi">548146294800</span> <span class="n">deprecation</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">506</span><span class="p">]</span> <span class="k">From</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="p">.</span><span class="mi">6</span><span class="o">/</span><span class="n">dist</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">keras</span><span class="o">/</span><span class="n">backend</span><span class="o">/</span><span class="n">tensorflow_backend</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">3733</span><span class="p">:</span> <span class="n">calling</span> <span class="nf">dropout</span> <span class="p">(</span><span class="k">from</span> <span class="n">tensorflow</span><span class="p">.</span><span class="n">python</span><span class="p">.</span><span class="n">ops</span><span class="p">.</span><span class="n">nn_ops</span><span class="p">)</span> <span class="k">with</span> <span class="n">keep_prob</span> <span class="k">is</span> <span class="n">deprecated</span> <span class="k">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="k">in</span> <span class="n">a</span> <span class="n">future</span> <span class="n">version</span><span class="p">.</span>
<span class="n">Instructions</span> <span class="k">for</span> <span class="n">updating</span><span class="p">:</span>
<span class="n">Please</span> <span class="k">use</span> <span class="ss">`rate`</span> <span class="n">instead</span> <span class="n">of</span> <span class="ss">`keep_prob`</span><span class="p">.</span> <span class="n">Rate</span> <span class="n">should</span> <span class="n">be</span> <span class="kt">set</span> <span class="k">to</span> <span class="ss">`rate = 1 - keep_prob`</span><span class="p">.</span>
<span class="n">W1209</span> <span class="mi">03</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">26</span><span class="p">.</span><span class="mi">412646</span> <span class="mi">548146294800</span> <span class="n">deprecation_wrapper</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">119</span><span class="p">]</span> <span class="k">From</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="p">.</span><span class="mi">6</span><span class="o">/</span><span class="n">dist</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">keras</span><span class="o">/</span><span class="n">optimizers</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">793</span><span class="p">:</span> <span class="n">The</span> <span class="n">name</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">Optimizer</span> <span class="k">is</span> <span class="n">deprecated</span><span class="p">.</span> <span class="n">Please</span> <span class="k">use</span> <span class="n">tf</span><span class="p">.</span><span class="n">compat</span><span class="p">.</span><span class="n">v1</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">Optimizer</span> <span class="n">instead</span><span class="p">.</span>

<span class="n">W1209</span> <span class="mi">03</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">26</span><span class="p">.</span><span class="mi">449203</span> <span class="mi">548146294800</span> <span class="n">deprecation</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">323</span><span class="p">]</span> <span class="k">From</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="p">.</span><span class="mi">6</span><span class="o">/</span><span class="n">dist</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">tensorflow</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">nn_impl</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">180</span><span class="p">:</span> <span class="n">add_dispatch_support</span><span class="p">.</span><span class="o">&lt;</span><span class="n">locals</span><span class="o">&gt;</span><span class="p">.</span><span class="nf">wrapper</span> <span class="p">(</span><span class="k">from</span> <span class="n">tensorflow</span><span class="p">.</span><span class="n">python</span><span class="p">.</span><span class="n">ops</span><span class="p">.</span><span class="n">array_ops</span><span class="p">)</span> <span class="k">is</span> <span class="n">deprecated</span> <span class="k">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="k">in</span> <span class="n">a</span> <span class="n">future</span> <span class="n">version</span><span class="p">.</span>
<span class="n">Instructions</span> <span class="k">for</span> <span class="n">updating</span><span class="p">:</span>
<span class="k">Use</span> <span class="n">tf</span><span class="p">.</span><span class="k">where</span> <span class="k">in</span> <span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">which</span> <span class="n">has</span> <span class="n">the</span> <span class="n">same</span> <span class="n">broadcast</span> <span class="n">rule</span> <span class="k">as</span> <span class="n">np</span><span class="p">.</span><span class="k">where</span>





<span class="s1">&#39;binary_equal_trainentiremodel_50kimage_300epoch_model_weights&#39;</span>
</pre></div>


<h3>Convert keras model to Tensorflow and Save Frozen Graph</h3>
<div class="highlight"><pre><span></span><span class="c1"># import the needed libraries</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">tensorflow.contrib.tensorrt</span> <span class="k">as</span> <span class="nn">trt</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.platform</span> <span class="kn">import</span> <span class="n">gfile</span>


<span class="n">output_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dense_15/Softmax&#39;</span><span class="p">]</span>
<span class="n">input_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;input_2&#39;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">freeze_session</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">keep_var_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clear_devices</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Freezes the state of a session into a pruned computation graph.</span>

<span class="sd">    Creates a new computation graph where variable nodes are replaced by</span>
<span class="sd">    constants taking their current value in the session. The new graph will be</span>
<span class="sd">    pruned so subgraphs that are not necessary to compute the requested</span>
<span class="sd">    outputs are removed.</span>
<span class="sd">    @param session The TensorFlow session to be frozen.</span>
<span class="sd">    @param keep_var_names A list of variable names that should not be frozen,</span>
<span class="sd">                          or None to freeze all the variables in the graph.</span>
<span class="sd">    @param output_names Names of the relevant graph outputs.</span>
<span class="sd">    @param clear_devices Remove the device directives from the graph for better portability.</span>
<span class="sd">    @return The frozen graph definition.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">graph</span>
    <span class="k">with</span> <span class="n">graph</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span>
        <span class="n">freeze_var_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tf</span><span class="o">.</span><span class="n">global_variables</span><span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">keep_var_names</span> <span class="ow">or</span> <span class="p">[]))</span>
        <span class="n">output_names</span> <span class="o">=</span> <span class="n">output_names</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">output_names</span> <span class="o">+=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tf</span><span class="o">.</span><span class="n">global_variables</span><span class="p">()]</span>
        <span class="n">input_graph_def</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">as_graph_def</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">clear_devices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">input_graph_def</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">frozen_graph</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">graph_util</span><span class="o">.</span><span class="n">convert_variables_to_constants</span><span class="p">(</span>
            <span class="n">session</span><span class="p">,</span> <span class="n">input_graph_def</span><span class="p">,</span> <span class="n">output_names</span><span class="p">,</span> <span class="n">freeze_var_names</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">frozen_graph</span>

<span class="kn">from</span> <span class="nn">keras</span> <span class="kn">import</span> <span class="n">backend</span> <span class="k">as</span> <span class="n">K</span>

<span class="c1"># Create, compile and train model...</span>

<span class="n">frozen_graph</span> <span class="o">=</span> <span class="n">freeze_session</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">get_session</span><span class="p">(),</span>
                              <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="n">out</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">outputs</span><span class="p">])</span>
<span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">write_graph</span><span class="p">(</span><span class="n">frozen_graph</span><span class="p">,</span> <span class="s2">&quot;../../model_params&quot;</span><span class="p">,</span> <span class="s2">&quot;frozen_&quot;</span> <span class="o">+</span> <span class="n">model_name</span> <span class="o">+</span> <span class="s2">&quot;.pb&quot;</span><span class="p">,</span> <span class="n">as_text</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">W1209</span> <span class="mi">03</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">17</span><span class="p">.</span><span class="mi">866091</span> <span class="mi">548146294800</span> <span class="n">deprecation</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">323</span><span class="p">]</span> <span class="k">From</span> <span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="k">input</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="mi">1</span><span class="n">e01e96d2692</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span> <span class="n">convert_variables_to_constants</span> <span class="p">(</span><span class="k">from</span> <span class="n">tensorflow</span><span class="p">.</span><span class="n">python</span><span class="p">.</span><span class="n">framework</span><span class="p">.</span><span class="n">graph_util_impl</span><span class="p">)</span> <span class="k">is</span> <span class="n">deprecated</span> <span class="k">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="k">in</span> <span class="n">a</span> <span class="n">future</span> <span class="k">version</span><span class="p">.</span>
<span class="n">Instructions</span> <span class="k">for</span> <span class="n">updating</span><span class="p">:</span>
<span class="n">Use</span> <span class="o">`</span><span class="n">tf</span><span class="p">.</span><span class="n">compat</span><span class="p">.</span><span class="n">v1</span><span class="p">.</span><span class="n">graph_util</span><span class="p">.</span><span class="n">convert_variables_to_constants</span><span class="o">`</span>
<span class="n">W1209</span> <span class="mi">03</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">17</span><span class="p">.</span><span class="mi">874302</span> <span class="mi">548146294800</span> <span class="n">deprecation</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">323</span><span class="p">]</span> <span class="k">From</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="p">.</span><span class="mi">6</span><span class="o">/</span><span class="n">dist</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">tensorflow</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">framework</span><span class="o">/</span><span class="n">graph_util_impl</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">270</span><span class="p">:</span> <span class="n">extract_sub_graph</span> <span class="p">(</span><span class="k">from</span> <span class="n">tensorflow</span><span class="p">.</span><span class="n">python</span><span class="p">.</span><span class="n">framework</span><span class="p">.</span><span class="n">graph_util_impl</span><span class="p">)</span> <span class="k">is</span> <span class="n">deprecated</span> <span class="k">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="k">in</span> <span class="n">a</span> <span class="n">future</span> <span class="k">version</span><span class="p">.</span>
<span class="n">Instructions</span> <span class="k">for</span> <span class="n">updating</span><span class="p">:</span>
<span class="n">Use</span> <span class="o">`</span><span class="n">tf</span><span class="p">.</span><span class="n">compat</span><span class="p">.</span><span class="n">v1</span><span class="p">.</span><span class="n">graph_util</span><span class="p">.</span><span class="n">extract_sub_graph</span><span class="o">`</span>





<span class="s1">&#39;../../model_params/frozen_binary_equal_trainentiremodel_50kimage_300epoch_model_weights.pb&#39;</span>
</pre></div>


<h3>Optimize Using TensorRT</h3>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">tensorflow.contrib.tensorrt</span> <span class="k">as</span> <span class="nn">trt</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.platform</span> <span class="kn">import</span> <span class="n">gfile</span>

<span class="n">your_outputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">out</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">outputs</span><span class="p">]</span>
<span class="c1"># convert (optimize) frozen model to TensorRT model</span>
<span class="n">trt_graph</span> <span class="o">=</span> <span class="n">trt</span><span class="o">.</span><span class="n">create_inference_graph</span><span class="p">(</span>
    <span class="n">input_graph_def</span><span class="o">=</span><span class="n">frozen_graph</span><span class="p">,</span><span class="c1"># frozen model</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">your_outputs</span><span class="p">,</span>
    <span class="n">max_batch_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="c1"># specify your max batch size</span>
    <span class="n">max_workspace_size_bytes</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">9</span><span class="p">),</span><span class="c1"># specify the max workspace</span>
    <span class="n">precision_mode</span><span class="o">=</span><span class="s2">&quot;FP32&quot;</span><span class="p">)</span> <span class="c1"># precision, can be &quot;FP32&quot; (32 floating point precision) or &quot;FP16&quot;</span>

<span class="c1">#write the TensorRT model to be used later for inference</span>
<span class="k">with</span> <span class="n">gfile</span><span class="o">.</span><span class="n">FastGFile</span><span class="p">(</span><span class="s2">&quot;../../model_params/tensort_&quot;</span> <span class="o">+</span> <span class="n">model_name</span> <span class="o">+</span> <span class="s2">&quot;.pb&quot;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">trt_graph</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TensorRT model is successfully stored!&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">W1209</span> <span class="mi">03</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">16</span><span class="p">.</span><span class="mi">449128</span> <span class="mi">548146294800</span> <span class="n">deprecation</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">323</span><span class="p">]</span> <span class="k">From</span> <span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="k">input</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">cc4bab4a24b5</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span> <span class="n">FastGFile</span><span class="p">.</span><span class="n">__init__</span> <span class="p">(</span><span class="k">from</span> <span class="n">tensorflow</span><span class="p">.</span><span class="n">python</span><span class="p">.</span><span class="n">platform</span><span class="p">.</span><span class="n">gfile</span><span class="p">)</span> <span class="k">is</span> <span class="n">deprecated</span> <span class="k">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="k">in</span> <span class="n">a</span> <span class="n">future</span> <span class="k">version</span><span class="p">.</span>
<span class="n">Instructions</span> <span class="k">for</span> <span class="n">updating</span><span class="p">:</span>
<span class="n">Use</span> <span class="n">tf</span><span class="p">.</span><span class="n">gfile</span><span class="p">.</span><span class="n">GFile</span><span class="p">.</span>


<span class="n">TensorRT</span> <span class="n">model</span> <span class="k">is</span> <span class="n">successfully</span> <span class="n">stored</span><span class="o">!</span>
</pre></div>


<h3>Compare Models</h3>
<div class="highlight"><pre><span></span><span class="c1"># check how many ops of the original frozen model</span>
<span class="n">all_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">frozen_graph</span><span class="o">.</span><span class="n">node</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;numb. of all_nodes in frozen graph:&quot;</span><span class="p">,</span> <span class="n">all_nodes</span><span class="p">)</span>

<span class="c1"># check how many ops that is converted to TensorRT engine</span>
<span class="n">trt_engine_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">trt_graph</span><span class="o">.</span><span class="n">node</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">op</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;TRTEngineOp&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;numb. of trt_engine_nodes in TensorRT graph:&quot;</span><span class="p">,</span> <span class="n">trt_engine_nodes</span><span class="p">)</span>
<span class="n">all_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">trt_graph</span><span class="o">.</span><span class="n">node</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;numb. of all_nodes in TensorRT graph:&quot;</span><span class="p">,</span> <span class="n">all_nodes</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">numb. of all_nodes in frozen graph: 2475</span>
<span class="err">numb. of trt_engine_nodes in TensorRT graph: 59</span>
<span class="err">numb. of all_nodes in TensorRT graph: 990</span>
</pre></div>


<p>Above we can see that the model structure is smaller by utilizing tensorrt. This will help improve inference time on the edge device. </p>
<h3>Inference on TX2</h3>
<div class="highlight"><pre><span></span><span class="c1"># import the needed libraries</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">tensorflow.contrib.tensorrt</span> <span class="k">as</span> <span class="nn">trt</span> <span class="c1"># must import this although we will not use it explicitly</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.platform</span> <span class="kn">import</span> <span class="n">gfile</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">keras.preprocessing.image</span> <span class="kn">import</span> <span class="n">load_img</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">load_img</span><span class="p">(</span><span class="s1">&#39;roasted-asparagus-horiz-a-1600.jpg&#39;</span><span class="p">,</span> <span class="n">target_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="mi">300</span><span class="p">))</span>
<span class="n">input_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># function to read a &quot;.pb&quot; model </span>
<span class="c1"># (can be used to read frozen model or TensorRT model)</span>
<span class="k">def</span> <span class="nf">read_pb_graph</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
  <span class="k">with</span> <span class="n">gfile</span><span class="o">.</span><span class="n">FastGFile</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">graph_def</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">GraphDef</span><span class="p">()</span>
    <span class="n">graph_def</span><span class="o">.</span><span class="n">ParseFromString</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
  <span class="k">return</span> <span class="n">graph_def</span>
</pre></div>


<h3>TensorRT Model</h3>
<div class="highlight"><pre><span></span><span class="c1"># variable</span>
<span class="n">TENSORRT_MODEL_PATH</span> <span class="o">=</span> <span class="s2">&quot;model_params/tensort_&quot;</span> <span class="o">+</span> <span class="n">model_name</span> <span class="o">+</span> <span class="s2">&quot;.pb&quot;</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<span class="k">with</span> <span class="n">graph</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">ConfigProto</span><span class="p">(</span><span class="n">gpu_options</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">GPUOptions</span><span class="p">(</span><span class="n">per_process_gpu_memory_fraction</span><span class="o">=</span><span class="mf">0.50</span><span class="p">)))</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
        <span class="c1"># read TensorRT model</span>
        <span class="n">trt_graph</span> <span class="o">=</span> <span class="n">read_pb_graph</span><span class="p">(</span><span class="n">TENSORRT_MODEL_PATH</span><span class="p">)</span>

        <span class="c1"># obtain the corresponding input-output tensor</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">import_graph_def</span><span class="p">(</span><span class="n">trt_graph</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="nb">input</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_tensor_by_name</span><span class="p">(</span><span class="s1">&#39;input_1:0&#39;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_tensor_by_name</span><span class="p">(</span><span class="s1">&#39;dense_10/Softmax:0&#39;</span><span class="p">)</span>

        <span class="c1"># in this case, it demonstrates to perform inference for 50 times</span>
        <span class="n">total_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n_time_inference</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">out_pred</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="nb">input</span><span class="p">:</span> <span class="n">input_img</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_time_inference</span><span class="p">):</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">out_pred</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="nb">input</span><span class="p">:</span> <span class="n">input_img</span><span class="p">})</span>
            <span class="n">t2</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">delta_time</span> <span class="o">=</span> <span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span>
            <span class="n">total_time</span> <span class="o">+=</span> <span class="n">delta_time</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;needed time in inference-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span><span class="p">,</span> <span class="n">delta_time</span><span class="p">)</span>
        <span class="n">avg_time_tensorRT</span> <span class="o">=</span> <span class="n">total_time</span> <span class="o">/</span> <span class="n">n_time_inference</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;average inference time: &quot;</span><span class="p">,</span> <span class="n">avg_time_tensorRT</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">needed time in inference-0:  0.27154040336608887</span>
<span class="err">needed time in inference-1:  0.12302851676940918</span>
<span class="err">needed time in inference-2:  0.11561846733093262</span>
<span class="err">needed time in inference-3:  0.11101841926574707</span>
<span class="err">needed time in inference-4:  0.1113739013671875</span>
<span class="err">needed time in inference-5:  0.11808514595031738</span>
<span class="err">needed time in inference-6:  0.11187052726745605</span>
<span class="err">needed time in inference-7:  0.11685538291931152</span>
<span class="err">needed time in inference-8:  0.10785388946533203</span>
<span class="err">needed time in inference-9:  0.0915677547454834</span>
<span class="err">needed time in inference-10:  0.11743283271789551</span>
<span class="err">needed time in inference-11:  0.11315226554870605</span>
<span class="err">needed time in inference-12:  0.11051702499389648</span>
<span class="err">needed time in inference-13:  0.10962986946105957</span>
<span class="err">needed time in inference-14:  0.11177444458007812</span>
<span class="err">needed time in inference-15:  0.11580991744995117</span>
<span class="err">needed time in inference-16:  0.1156463623046875</span>
<span class="err">needed time in inference-17:  0.1150197982788086</span>
<span class="err">needed time in inference-18:  0.11693429946899414</span>
<span class="err">needed time in inference-19:  0.10866832733154297</span>
<span class="err">needed time in inference-20:  0.11803007125854492</span>
<span class="err">needed time in inference-21:  0.11182045936584473</span>
<span class="err">needed time in inference-22:  0.11361956596374512</span>
<span class="err">needed time in inference-23:  0.10678911209106445</span>
<span class="err">needed time in inference-24:  0.11087584495544434</span>
<span class="err">needed time in inference-25:  0.10926699638366699</span>
<span class="err">needed time in inference-26:  0.1163034439086914</span>
<span class="err">needed time in inference-27:  0.11024737358093262</span>
<span class="err">needed time in inference-28:  0.11595368385314941</span>
<span class="err">needed time in inference-29:  0.11124372482299805</span>
<span class="err">needed time in inference-30:  0.11583399772644043</span>
<span class="err">needed time in inference-31:  0.11264348030090332</span>
<span class="err">needed time in inference-32:  0.10711812973022461</span>
<span class="err">needed time in inference-33:  0.10518836975097656</span>
<span class="err">needed time in inference-34:  0.11161422729492188</span>
<span class="err">needed time in inference-35:  0.11660170555114746</span>
<span class="err">needed time in inference-36:  0.12221097946166992</span>
<span class="err">needed time in inference-37:  0.11357808113098145</span>
<span class="err">needed time in inference-38:  0.1165313720703125</span>
<span class="err">needed time in inference-39:  0.11625814437866211</span>
<span class="err">needed time in inference-40:  0.11170506477355957</span>
<span class="err">needed time in inference-41:  0.12175679206848145</span>
<span class="err">needed time in inference-42:  0.11755537986755371</span>
<span class="err">needed time in inference-43:  0.11252164840698242</span>
<span class="err">needed time in inference-44:  0.11235952377319336</span>
<span class="err">needed time in inference-45:  0.11363649368286133</span>
<span class="err">needed time in inference-46:  0.11793255805969238</span>
<span class="err">needed time in inference-47:  0.1100304126739502</span>
<span class="err">needed time in inference-48:  0.11511778831481934</span>
<span class="err">needed time in inference-49:  0.11052775382995605</span>
<span class="err">average inference time:  0.11636539459228516</span>
</pre></div>


<h3>Non Optimized Model</h3>
<div class="highlight"><pre><span></span><span class="c1"># variable</span>
<span class="n">FROZEN_MODEL_PATH</span> <span class="o">=</span> <span class="s2">&quot;model_params/frozen_&quot;</span> <span class="o">+</span> <span class="n">model_name</span> <span class="o">+</span> <span class="s2">&quot;.pb&quot;</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<span class="k">with</span> <span class="n">graph</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
        <span class="c1"># read TensorRT model</span>
        <span class="n">frozen_graph</span> <span class="o">=</span> <span class="n">read_pb_graph</span><span class="p">(</span><span class="n">FROZEN_MODEL_PATH</span><span class="p">)</span>

        <span class="c1"># obtain the corresponding input-output tensor</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">import_graph_def</span><span class="p">(</span><span class="n">frozen_graph</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="nb">input</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_tensor_by_name</span><span class="p">(</span><span class="s1">&#39;input_1:0&#39;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_tensor_by_name</span><span class="p">(</span><span class="s1">&#39;dense_10/Softmax:0&#39;</span><span class="p">)</span>

        <span class="c1"># in this case, it demonstrates to perform inference for 50 times</span>
        <span class="n">total_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n_time_inference</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">out_pred</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="nb">input</span><span class="p">:</span> <span class="n">input_img</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_time_inference</span><span class="p">):</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">out_pred</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="nb">input</span><span class="p">:</span> <span class="n">input_img</span><span class="p">})</span>
            <span class="n">t2</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">delta_time</span> <span class="o">=</span> <span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span>
            <span class="n">total_time</span> <span class="o">+=</span> <span class="n">delta_time</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;needed time in inference-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span><span class="p">,</span> <span class="n">delta_time</span><span class="p">)</span>
        <span class="n">avg_time_original_model</span> <span class="o">=</span> <span class="n">total_time</span> <span class="o">/</span> <span class="n">n_time_inference</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;average inference time: &quot;</span><span class="p">,</span> <span class="n">avg_time_original_model</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TensorRT improvement compared to the original model:&quot;</span><span class="p">,</span> <span class="n">avg_time_original_model</span><span class="o">/</span><span class="n">avg_time_tensorRT</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">needed time in inference-0:  0.2708280086517334</span>
<span class="err">needed time in inference-1:  0.14234304428100586</span>
<span class="err">needed time in inference-2:  0.15391850471496582</span>
<span class="err">needed time in inference-3:  0.1341855525970459</span>
<span class="err">needed time in inference-4:  0.18431854248046875</span>
<span class="err">needed time in inference-5:  0.15240883827209473</span>
<span class="err">needed time in inference-6:  0.13216447830200195</span>
<span class="err">needed time in inference-7:  0.13918542861938477</span>
<span class="err">needed time in inference-8:  0.13611197471618652</span>
<span class="err">needed time in inference-9:  0.310025691986084</span>
<span class="err">needed time in inference-10:  0.13527488708496094</span>
<span class="err">needed time in inference-11:  0.13274240493774414</span>
<span class="err">needed time in inference-12:  0.13806581497192383</span>
<span class="err">needed time in inference-13:  0.13801264762878418</span>
<span class="err">needed time in inference-14:  0.13357114791870117</span>
<span class="err">needed time in inference-15:  0.13676691055297852</span>
<span class="err">needed time in inference-16:  0.13688015937805176</span>
<span class="err">needed time in inference-17:  0.13867568969726562</span>
<span class="err">needed time in inference-18:  0.14066481590270996</span>
<span class="err">needed time in inference-19:  0.13436508178710938</span>
<span class="err">needed time in inference-20:  0.13262057304382324</span>
<span class="err">needed time in inference-21:  0.1535184383392334</span>
<span class="err">needed time in inference-22:  0.13952279090881348</span>
<span class="err">needed time in inference-23:  0.16269540786743164</span>
<span class="err">needed time in inference-24:  0.14333367347717285</span>
<span class="err">needed time in inference-25:  0.14168095588684082</span>
<span class="err">needed time in inference-26:  0.1430208683013916</span>
<span class="err">needed time in inference-27:  0.1438302993774414</span>
<span class="err">needed time in inference-28:  0.1404411792755127</span>
<span class="err">needed time in inference-29:  0.14186882972717285</span>
<span class="err">needed time in inference-30:  0.14541316032409668</span>
<span class="err">needed time in inference-31:  0.14401459693908691</span>
<span class="err">needed time in inference-32:  0.13475871086120605</span>
<span class="err">needed time in inference-33:  0.13991355895996094</span>
<span class="err">needed time in inference-34:  0.1361076831817627</span>
<span class="err">needed time in inference-35:  0.13427162170410156</span>
<span class="err">needed time in inference-36:  0.1427154541015625</span>
<span class="err">needed time in inference-37:  0.13839292526245117</span>
<span class="err">needed time in inference-38:  0.1392209529876709</span>
<span class="err">needed time in inference-39:  0.13820719718933105</span>
<span class="err">needed time in inference-40:  0.13931012153625488</span>
<span class="err">needed time in inference-41:  0.1406848430633545</span>
<span class="err">needed time in inference-42:  0.13588500022888184</span>
<span class="err">needed time in inference-43:  0.13520193099975586</span>
<span class="err">needed time in inference-44:  0.14149022102355957</span>
<span class="err">needed time in inference-45:  0.13609766960144043</span>
<span class="err">needed time in inference-46:  0.13965892791748047</span>
<span class="err">needed time in inference-47:  0.13794231414794922</span>
<span class="err">needed time in inference-48:  0.18619012832641602</span>
<span class="err">needed time in inference-49:  0.1392371654510498</span>
<span class="err">average inference time:  0.14775513648986816</span>
<span class="err">TensorRT improvement compared to the original model: 1.2697515185469417</span>
</pre></div>


<p>The above output shows that the tensorrt model has achieved moderate improvement in inference time compared to the non-optimized model. What isn't captured in these statistics however is the resource constraints that are required for inference and model loading. In both the cases where the model was loaded via keras load_model module as well as loading from a .pb graph file - the resource constraints were nearly maxed out for the edge device. </p>
<p>The TensorRT optimized model did also require heavy resources - but more reliably ran the inference without crashing due to memory constraints. </p>
<p>In a production environment we will: 
- Utilize a larger training dataset
- Train the model periodically in the cloud and compare performance
- Write the pb file and optimize using tensorrt on a cloud device
- Copy the pb file to an edge device for inference</p>
<p>During the testing on the edge - we have found that loading and infering with the tensorrt model provided the most stable inference environment. Further model reduction would be beneficial in order to improve performance on a lower powered device than the TX2. </p>
<h2><strong>Section 8: Conclusion</strong></h2>
<p>In this paper we successfully: 
- Used image augmentation to provide variety and bulk to the training dataset
- Utilized transfer learning in order to apply a base model (ResNet50) to a different dataset but similar problem
- Added to the model in order to learn the specific image classification tasks given our plant dataset
- Used different model architectures in order to balance accuracy and performance with model size
- Optimized the best performing model for inference at the edge
- Deployed to an edge device (TX2) and compared inference time along with discussion of memory/resource constraints</p>
<p>While our validation accuracy on the image classification problem was not optimal and requires additional model tuning and optimally larger dataset (with more classes/etc) in order to improve model performance. We did however achieve &gt;97% accuracy on the binary model (poison vs edible) and in the validation dataset observed recall of 100% meaning there were no predictions that wrongfully predicted the plant was edible when it was in fact poisonous. </p>
<p>The benefit of our model architecture is that it doesn't require a data network in order to upload an image to the cloud for inference - inference is achieved at the edge, something not achieved in the available plant identification apps/models. Our model sizes range from 100MB to 600MB so we must ensure both inference, resource and size constraints are met for lower powered devices. </p>
<p>Future Work: Given the model architecture laid out in this paper - we would like to improve model performance by exploring the following: 
- Larger training set: the USDA has a plant dataset [https://plants.sc.egov.usda.gov/gallery.html]. We have scraped from this site and would like to train on this datset which contains &gt;50k images and many more classes of plants found in the US
- Continue to optimize model performance and size - primarily in order to improve validation and test set performance
- Testing on lower powered edge devices. In this analysis we used a TX2 - however we would ideally like this model to be contained within an app for a smartphone so the user can take pictures with their device and determine the species of plant in the wild</p></p>
        </div>
    </div>

<div class="fh5co-narrow-content">
<div class="animate-box" data-animate-effect="fadeInLeft">
    <h2><!-- <i class="icon-speech-bubble"></i>  -->Comments</h2>
</div>
<div class="animate-box" data-animate-effect="fadeInLeft">
    <div id="disqus_thread"></div>
</div>

<script>
var disqus_config = function () { 
  this.language = "english";
};
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript><a href="https://disqus.com/?ref_noscript">Please enable JavaScript to view the comments powered by Disqus.</a></noscript>
<div class="fh5co-footer">
    <p><small>&copy; 2016 Blend Free HTML5. All Rights Reserved.</span> <span>Designed by <a href="http://freehtml5.co/" target="_blank">FreeHTML5.co</a></span>
    <br /><span>Pelican Theme by: <a href="https://github.com/claudio-walser/pelican-fh5co-marble" target="_blank">Claudio Walser</a></span></small></p>

</div>                
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://aaron-j-olson.com/theme/js/jquery.min.js"></script>
    <!-- jQuery Easing -->
    <script src="https://aaron-j-olson.com/theme/js/jquery.easing.1.3.js"></script>
    <!-- Bootstrap -->
    <script src="https://aaron-j-olson.com/theme/js/bootstrap.min.js"></script>
    <!-- Waypoints -->
    <script src="https://aaron-j-olson.com/theme/js/jquery.waypoints.min.js"></script>
    <!-- Flexslider -->
    <script src="https://aaron-j-olson.com/theme/js/jquery.flexslider-min.js"></script>


    <!-- MAIN JS -->
    <script src="https://aaron-j-olson.com/theme/js/main.js"></script>
    </body>
</html>
