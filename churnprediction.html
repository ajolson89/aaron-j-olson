
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Music Churn Prediction</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="author" content="Cameron Kennedy, Gaurav Khanna, Aaron Olson" />
    <meta name="description" content="Handle large dataset >30GB in order to predict music churn" />
    <meta name="keywords" content="big query, python, sci-kit learn, boosted trees, xgboost">
<!-- Facebook and Twitter integration -->
<meta property="og:site_name" content="Aaron J. Olson - Portfolio"/>
<meta property="og:title" content="Music Churn Prediction"/>
<meta property="og:description" content="Handle large dataset >30GB in order to predict music churn"/>
<meta property="og:url" content="https://aaron-j-olson.com/churnprediction.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2018-09-08 20:00:00-04:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://aaron-j-olson.com/author/cameron-kennedy-gaurav-khanna-aaron-olson.html">
<meta property="article:section" content="posts"/>
    <meta property="article:tag" content="big query"/>
    <meta property="article:tag" content="python"/>
    <meta property="article:tag" content="sci-kit learn"/>
    <meta property="article:tag" content="boosted trees"/>
    <meta property="article:tag" content="xgboost"/>
    <meta property="og:image" content="\images\olson.jpg">

    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700" rel="stylesheet">

    <!-- Animate.css -->
    <link rel="stylesheet" href="https://aaron-j-olson.com/theme/css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="https://aaron-j-olson.com/theme/css/icomoon.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="https://aaron-j-olson.com/theme/css/bootstrap.css">
    <!-- Flexslider  -->
    <link rel="stylesheet" href="https://aaron-j-olson.com/theme/css/flexslider.css">
    <!-- Theme style  -->
    <link rel="stylesheet" href="https://aaron-j-olson.com/theme/css/style.css">
    <!-- Custom style  -->
    <link rel="stylesheet" href="https://aaron-j-olson.com/theme/css/custom.css">
    <!-- pygments code highlight -->
    <link rel="stylesheet" href="https://aaron-j-olson.com/theme/css/pygments.css">
    <!-- tipue search -->
    <link rel="stylesheet" href="https://aaron-j-olson.com/theme/tipuesearch/css/tipuesearch.css">

    <!-- Modernizr JS -->
    <script src="https://aaron-j-olson.com/theme/js/modernizr-2.6.2.min.js"></script>
    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
    <script src="/theme/js/respond.min.js"></script>
    <![endif]-->
        <link href="https://aaron-j-olson.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Aaron J. Olson - Portfolio Atom">



    </head>
    <body>
    <div id="fh5co-page">
        <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
        <aside id="fh5co-aside" role="complementary" class="border js-fullheight">

            <nav class="fh5co-main-menu" role="navigation">
            </nav>
            <div class="clearfix"></div>
            <h1  id="fh5co-logo">
                <a href="https://aaron-j-olson.com/index.html">
                    <img src="\images\olson.jpg" />
                </a>
            </h1>
            <nav class="fh5co-main-menu" role="navigation">
<ul>
    <!-- home link -->
    <li><a href="https://aaron-j-olson.com/">Home</a></li>

    <!-- page links -->
            <li><a href="https://aaron-j-olson.com/pages/home.html">About Me</a></li>

    <!-- categories -->
        <li><a href="https://aaron-j-olson.com/categories.html">Categories</a></li>

    <!-- tags -->
        <li><a href="https://aaron-j-olson.com/tags.html">Tags</a></li>

    <!-- additional menu items from config -->
        <!-- <li class="nav-title">Misc</li> -->
            <li><a href="https://aaron-j-olson.com/archives.html">Archive</a></li>
            <li><a href="https://aaron-j-olson.com/contact.html">Contact</a></li>

</ul>
            </nav>

<ul id="social">
            <li><a href="https://github.com/ajolson89" alt="Github"><i class="icon-github"></i></a></li>

            <li><a href="https://www.linkedin.com/in/aaron-j-olson/" alt="LinkedIn"><i class="icon-linkedin2"></i></a></li>

</ul>
        </aside>

        <div id="fh5co-main">

    <div class="fh5co-narrow-content article-content">
        <h1 class="fh5co-heading-colored">Music Churn Prediction</h1>

        <div>by
                <a href="author/cameron-kennedy-gaurav-khanna-aaron-olson.html">Cameron Kennedy, Gaurav Khanna, Aaron Olson</a> - Sat 08 September 2018
        </div>

            <div><span>Tags: </span>
                    <span><a href="https://aaron-j-olson.com/tag/big-query.html">#big query</a> </span>
                    <span><a href="https://aaron-j-olson.com/tag/python.html">#python</a> </span>
                    <span><a href="https://aaron-j-olson.com/tag/sci-kit-learn.html">#sci-kit learn</a> </span>
                    <span><a href="https://aaron-j-olson.com/tag/boosted-trees.html">#boosted trees</a> </span>
                    <span><a href="https://aaron-j-olson.com/tag/xgboost.html">#xgboost</a> </span>
            </div>

        <div class="animate-box" data-animate-effect="fadeInLeft">
            <p class="animate-box" data-animate-effect="fadeInLeft"><h2>Overview of Notebooks</h2>
<p>For this project, the team created 3 separate Jupyter Notebooks to document its work:</p>
<p><strong>1) Data Preparation / Feature Extraction Notebook:</strong>  This notebook gives an overview of the project, and then takes the raw data, performs some initial exploration, and generates features for the predictive models.  It also performs a brief exploratory data analysis on the feature set.  The output this notebook output a .pkl file of features for the second notebook to read, which saves considerable time when building the models.</p>
<p><strong>2) Predictive Modeling Notebook:</strong>  This notebook reads the .pkl file, builds machine learning models to predict user churn, calculates and calibrates churn probabilities, and generates a projected economic impact of users who leave.</p>
<p><strong>3) Initial Data Sourcing and Validation Notebook (HTML file):</strong>  This is a static notebook (uploaded as HTML file - not intended for executing code) that documents two other aspects of the project that don't logically fit in either of the first two notebooks:</p>
<ul>
<li>
<p>First, it contains the initial data extraction code used in Google BigQuery to reduce the data set from ~30GB down to ~1.6GB, to enable it to run on local machines.</p>
</li>
<li>
<p>Second, it contains some code that performs data integrity checks, validating that the items extracted in our smaller data set approximately match those in the full data set (e.g., same level of churn, the same timeframe, etc.)</p>
</li>
</ul>
<h2>Table of Contents (this notebook only)</h2>
<ol>
<li>Project Overview</li>
<li>Data Set Overview</li>
<li>Initial Data Loading</li>
<li>User Logs Data: Preparation and Feature Extraction</li>
<li>Transaction Data: Preparation and Feature Extraction</li>
<li>Joining Features and Data Manipulation</li>
<li>Quick Exploratory Data Analysis</li>
<li>Writing Output</li>
</ol>
<h1>1. Project Overview</h1>
<p>This dataset is comprised of data collected by WSDM regarding a music streaming subscription available through KKBOX.</p>
<h2>Project Goals:</h2>
<p>The project aims to accomplish the following goals:</p>
<ul>
<li>Create a model to predict customer churn from usage and transaction data</li>
<li>Create an economic model for retention</li>
<li>Recommend a process for keeping the churn and economic retention models updated with latest information</li>
</ul>
<h1>2. Data Set Overview</h1>
<p>The initial data set contains 24 variables (25 input variables and 1 variable to predict), these are spread across 4 tables.  Additional details:  </p>
<ul>
<li><strong>Original format:</strong> csv</li>
<li><strong>Total Size:</strong> 31.14 GB, reduced to 1.6GB for analysis on local machines.</li>
<li><strong> User Count:</strong> 1.02 million labeled users contained in the Train table (88,544 users after reduction)</li>
<li><strong>Date Range:</strong> The data of customer usage and trasactions with the service spans 26 months, from Jan. 2015 to Feb. 2017.  However, one of the data fields is initial date users joined the service, with dates ranging from 2004 to 2017.</li>
<li><strong>Balance:</strong> Approximately 6% of users in the data churned (positive labels); the remaining 94% stayed (negative labels).</li>
</ul>
<p>Listed below are the tables and variables or features available for study:</p>
<h2>Table: Transactions</h2>
<p>This table contains transaction data for each user. Each row is a payment transaction.</p>
<ul>
<li><strong>Data Shape:</strong> 21.5M rows X 9 columns</li>
<li><strong>Data Size:</strong> 1.6GB</li>
</ul>
<h3>Data Fields:</h3>
<ul>
<li><strong>Msno:</strong> User ID</li>
<li><strong>Payment_method_id:</strong> Payment Method</li>
<li><strong>Payment_plan_days:</strong> Length of plan</li>
<li><strong>Plan_list_price:</strong> Price for the plan</li>
<li><strong>Actual_amount_paid:</strong> Amount paid </li>
<li><strong>Is_auto_renew:</strong> T/F flag determining whether membership is auto-renew or not</li>
<li><strong>Transaction Date:</strong> Date of purchase</li>
<li><strong>Membership_expire_date:</strong> Expiry date</li>
<li><strong>Is_cancel:</strong> T/F flag determining whether or not the user canceled service. This field is correlated with the is_churn category, though it isn’t identical, as it also captures users who change service.</li>
</ul>
<h2>Table: User Logs</h2>
<p>This table lists who, how, and when users used the service.  Each row is a unique user-date combination.</p>
<ul>
<li><strong>Data Shape:</strong> 392M rows X 9 columns</li>
<li><strong>Data Size:</strong> 29.1GB</li>
</ul>
<h3>Data Fields:</h3>
<ul>
<li><strong>Msno:</strong> User ID</li>
<li><strong>Date:</strong> Date of the logged activity </li>
<li><strong>Num_25:</strong> Number of songs played &lt; 25% of song length</li>
<li><strong>Num_50:</strong> Number of songs played between 25% and 50%</li>
<li><strong>Num_75:</strong> Number of songs played between 50% and 75%</li>
<li><strong>Num_985:</strong> Number of songs played between 75% and 98.5%</li>
<li><strong>Num_100:</strong> Number of songs played between 98.5% and 100%</li>
<li><strong>Num_unq:</strong> Number of unique songs played</li>
<li><strong>Total_secs:</strong> Total seconds played</li>
</ul>
<h2>Table: Members</h2>
<p>Demographic data on each user.  Each row represents a unique user.</p>
<ul>
<li><strong>Data Shape:</strong> 6.8M rows X 6 columns</li>
<li><strong>Data Size:</strong> 0.4GB</li>
</ul>
<h3>Data Fields:</h3>
<ul>
<li><strong>Msno:</strong> User ID</li>
<li><strong>City:</strong> City of the user</li>
<li><strong>BD:</strong> Age of the user</li>
<li><strong>Gender:</strong> Male, Female or Blank</li>
<li><strong>Registered_via:</strong> Registration method</li>
<li><strong>Registration_init_time:</strong> Initial time of registration</li>
<li><strong>Expiration_date:</strong> Expiration of membership</li>
</ul>
<h2>Table: Train</h2>
<p>Labels of which users churned.  Each row represents a unique user.
* <strong>Data Shape:</strong> 1.0M rows X 2 columns
* <strong>Data Size:</strong> 45MB</p>
<h3>Data Fields:</h3>
<ul>
<li><strong>Msno:</strong> User ID</li>
<li><strong>Is_churn:</strong>  T/F flag variable we are trying to predict.</li>
</ul>
<h1>3. Initial Data Loading</h1>
<p>This analysis is performed in the cells below.</p>
<div class="highlight"><pre><span></span><span class="c1">#Import Required Libraries</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="c1">#Set initial parameter(s)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_columns</span> <span class="o">=</span> <span class="mi">2000</span>
</pre></div>


<p>Loading the data indexing with the primary key (MSNO: String like/Object, represents the user)</p>
<div class="highlight"><pre><span></span><span class="c1">#Load the data</span>
<span class="n">members</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;members_filtered.csv&#39;</span><span class="p">)</span>
<span class="n">transactions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;transactions_filtered.csv&#39;</span><span class="p">)</span>
<span class="n">user_logs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;user_logs_filtered.csv&#39;</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;labels_filtered.csv&#39;</span><span class="p">)</span>

<span class="c1">#Set indices</span>
<span class="n">members</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;msno&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">labels</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;msno&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">user_logs</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>date</th>
      <th>num_25</th>
      <th>num_50</th>
      <th>num_75</th>
      <th>num_985</th>
      <th>num_100</th>
      <th>num_unq</th>
      <th>total_secs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MVODUEUlSocm1sXa+zVGpJazPrRFiD4IzEQk0QCdg4U=</td>
      <td>20170217</td>
      <td>37</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>30</td>
      <td>66</td>
      <td>9022.818</td>
    </tr>
    <tr>
      <th>1</th>
      <td>o3Dg7baW8dXq7Jq7NzlVrWG4mZNVvqp62oWBDO/ybeE=</td>
      <td>20160209</td>
      <td>36</td>
      <td>5</td>
      <td>2</td>
      <td>3</td>
      <td>48</td>
      <td>71</td>
      <td>13895.453</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6ERcO7aqAKvrQ2CAvah79dVC7tJVZSjNti1MBfpNVW4=</td>
      <td>20151210</td>
      <td>26</td>
      <td>9</td>
      <td>3</td>
      <td>0</td>
      <td>51</td>
      <td>54</td>
      <td>13919.805</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Xt9VAHNtHuST21tkcZSnGKjwv8vF8/COnsf6z28+fKk=</td>
      <td>20161025</td>
      <td>22</td>
      <td>8</td>
      <td>4</td>
      <td>2</td>
      <td>49</td>
      <td>75</td>
      <td>15147.842</td>
    </tr>
    <tr>
      <th>4</th>
      <td>zSgTJqoosTiFF7ZZi1DPTHgxLbnd99IgOEsTIDCcZHc=</td>
      <td>20160904</td>
      <td>26</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>39</td>
      <td>60</td>
      <td>10558.829</td>
    </tr>
  </tbody>
</table>
</div>

<p>Performing a quick inspection of the data:</p>
<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Transactions: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">transactions</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;User Logs: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">user_logs</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Members: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">members</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;User Logs:&#39;</span><span class="p">)</span>
<span class="n">labels</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">Transactions</span><span class="p">:</span>

<span class="o">&lt;</span><span class="k">class</span> <span class="s1">&#39;pandas.core.frame.DataFrame&#39;</span><span class="o">&gt;</span>
<span class="n">RangeIndex</span><span class="p">:</span> <span class="mi">1353459</span> <span class="n">entries</span><span class="p">,</span> <span class="mi">0</span> <span class="k">to</span> <span class="mi">1353458</span>
<span class="k">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">9</span> <span class="n">columns</span><span class="p">):</span>
<span class="n">msno</span>                      <span class="mi">1353459</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="k">object</span>
<span class="n">payment_method_id</span>         <span class="mi">1353459</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">int64</span>
<span class="n">payment_plan_days</span>         <span class="mi">1353459</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">int64</span>
<span class="n">plan_list_price</span>           <span class="mi">1353459</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">int64</span>
<span class="n">actual_amount_paid</span>        <span class="mi">1353459</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">int64</span>
<span class="n">is_auto_renew</span>             <span class="mi">1353459</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">int64</span>
<span class="n">transaction_date</span>          <span class="mi">1353459</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">int64</span>
<span class="n">membership_expire_date</span>    <span class="mi">1353459</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">int64</span>
<span class="n">is_cancel</span>                 <span class="mi">1353459</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">int64</span>
<span class="n">dtypes</span><span class="p">:</span> <span class="n">int64</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="k">object</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">memory</span> <span class="k">usage</span><span class="p">:</span> <span class="mi">92</span><span class="p">.</span><span class="mi">9</span><span class="o">+</span> <span class="n">MB</span>
<span class="k">User</span> <span class="n">Logs</span><span class="p">:</span>

<span class="o">&lt;</span><span class="k">class</span> <span class="s1">&#39;pandas.core.frame.DataFrame&#39;</span><span class="o">&gt;</span>
<span class="n">RangeIndex</span><span class="p">:</span> <span class="mi">19710631</span> <span class="n">entries</span><span class="p">,</span> <span class="mi">0</span> <span class="k">to</span> <span class="mi">19710630</span>
<span class="k">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">9</span> <span class="n">columns</span><span class="p">):</span>
<span class="n">msno</span>          <span class="k">object</span>
<span class="nb">date</span>          <span class="n">int64</span>
<span class="n">num_25</span>        <span class="n">int64</span>
<span class="n">num_50</span>        <span class="n">int64</span>
<span class="n">num_75</span>        <span class="n">int64</span>
<span class="n">num_985</span>       <span class="n">int64</span>
<span class="n">num_100</span>       <span class="n">int64</span>
<span class="n">num_unq</span>       <span class="n">int64</span>
<span class="n">total_secs</span>    <span class="n">float64</span>
<span class="n">dtypes</span><span class="p">:</span> <span class="n">float64</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">int64</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="k">object</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">memory</span> <span class="k">usage</span><span class="p">:</span> <span class="mi">1</span><span class="p">.</span><span class="mi">3</span><span class="o">+</span> <span class="n">GB</span>
<span class="n">Members</span><span class="p">:</span>

<span class="o">&lt;</span><span class="k">class</span> <span class="s1">&#39;pandas.core.frame.DataFrame&#39;</span><span class="o">&gt;</span>
<span class="k">Index</span><span class="p">:</span> <span class="mi">89473</span> <span class="n">entries</span><span class="p">,</span> <span class="n">mKfgXQAmVeSKzN4rXW37qz0HbGCuYBspTBM3ONXZudg</span><span class="o">=</span> <span class="k">to</span> <span class="n">EFbHYa9</span><span class="o">/</span><span class="n">MiKYiyrl05cZ34Cky0FDeHxTYij0pXwkr2A</span><span class="o">=</span>
<span class="k">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">5</span> <span class="n">columns</span><span class="p">):</span>
<span class="n">city</span>                      <span class="mi">89473</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">int64</span>
<span class="n">bd</span>                        <span class="mi">89473</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">int64</span>
<span class="n">gender</span>                    <span class="mi">46137</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="k">object</span>
<span class="n">registered_via</span>            <span class="mi">89473</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">int64</span>
<span class="n">registration_init_time</span>    <span class="mi">89473</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">int64</span>
<span class="n">dtypes</span><span class="p">:</span> <span class="n">int64</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="k">object</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">memory</span> <span class="k">usage</span><span class="p">:</span> <span class="mi">4</span><span class="p">.</span><span class="mi">1</span><span class="o">+</span> <span class="n">MB</span>
<span class="k">User</span> <span class="n">Logs</span><span class="p">:</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="s1">&#39;pandas.core.frame.DataFrame&#39;</span><span class="o">&gt;</span>
<span class="k">Index</span><span class="p">:</span> <span class="mi">99825</span> <span class="n">entries</span><span class="p">,</span> <span class="mi">3</span><span class="n">lh94wH</span><span class="o">+</span><span class="n">UPK7ENgnA5svzFMYfJJRMZHU</span><span class="o">/</span><span class="n">WjgvhRJPzc</span><span class="o">=</span> <span class="k">to</span> <span class="n">DIgxCOJBeanFdqLOOPMTzwwkqgREVG</span><span class="o">+</span><span class="n">g1pwfY5LWvC4</span><span class="o">=</span>
<span class="k">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">1</span> <span class="n">columns</span><span class="p">):</span>
<span class="n">is_churn</span>    <span class="mi">99825</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">int64</span>
<span class="n">dtypes</span><span class="p">:</span> <span class="n">int64</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">memory</span> <span class="k">usage</span><span class="p">:</span> <span class="mi">1</span><span class="p">.</span><span class="mi">5</span><span class="o">+</span> <span class="n">MB</span>
</pre></div>


<p>Helper routine to format the date for visualization:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">pd_to_date</span><span class="p">(</span><span class="n">df_col</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to convert a pandas dataframe column from %Y%m%d format to datetime format.</span>

<span class="sd">    Args:</span>
<span class="sd">        df_col (column in a pandas dataframe):  The column to be changed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The same column in datetime format.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df_col</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_col</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df_col</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#Convert date column to date format</span>
<span class="n">user_logs</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd_to_date</span><span class="p">(</span><span class="n">user_logs</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
</pre></div>


<p>The next two sections prepare the 2 major data tables/frames (User Logs &amp; Transactions) independently and then bring them together for analysis.</p>
<h1>4. User Logs Data:  Preparation and Feature Extraction</h1>
<p>We first create our groupby object to ultimately aggregate data by users:</p>
<div class="highlight"><pre><span></span><span class="c1">#Create our groupby user object </span>
<span class="n">user_logs_gb</span> <span class="o">=</span> <span class="n">user_logs</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;msno&#39;</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>


<p>The next cell creates three new columns:</p>
<ul>
<li><strong>max_date:</strong>  The latest date each user has a transaction</li>
<li><strong>days_before_max_date:</strong>  The the number of days between the max date and the date of the current record.</li>
<li><strong>listening_tenure:</strong>  The the number of days between the max date and min date of the current user.  The hypothesis for this feature is that a user who's been using the service for a long time may be less likely to churn than one who's been using the service for a short time.</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1">#Append max date to every row in main table</span>
<span class="n">user_logs</span><span class="p">[</span><span class="s1">&#39;max_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_logs_gb</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
<span class="n">user_logs</span><span class="p">[</span><span class="s1">&#39;days_before_max_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_logs</span><span class="p">[</span><span class="s1">&#39;max_date&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">user_logs</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
    <span class="c1">#The .apply(lambda...  just converts it from datetime to an integer, for easier comparisons later.</span>

<span class="c1">#Generate user&#39;s first date, last date, and tenure</span>
<span class="c1">#Also, the user_logs_features table will be the primary table to return from the transactions table</span>
<span class="n">user_logs_features</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_logs_gb</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:[</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">days</span><span class="p">]})</span>  <span class="c1">#.days converts to int</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="s1">&#39;max_date&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="s1">&#39;min_date&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;lambda&gt;&#39;</span><span class="p">:</span><span class="s1">&#39;listening_tenure&#39;</span><span class="p">})</span>
                      <span class="p">)</span>
<span class="c1">#Add a 3rd level, used for joining data later</span>
<span class="n">user_logs_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">user_logs_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date_features&#39;</span><span class="p">])</span>
</pre></div>


<p>Let's take a look at our initial users table:</p>
<div class="highlight"><pre><span></span><span class="n">user_logs_features</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">date_features</th>
    </tr>
    <tr>
      <th></th>
      <th colspan="3" halign="left">date</th>
    </tr>
    <tr>
      <th></th>
      <th>max_date</th>
      <th>min_date</th>
      <th>listening_tenure</th>
    </tr>
    <tr>
      <th>msno</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MVODUEUlSocm1sXa+zVGpJazPrRFiD4IzEQk0QCdg4U=</th>
      <td>2017-02-27</td>
      <td>2015-07-11</td>
      <td>597</td>
    </tr>
    <tr>
      <th>o3Dg7baW8dXq7Jq7NzlVrWG4mZNVvqp62oWBDO/ybeE=</th>
      <td>2017-02-07</td>
      <td>2015-03-10</td>
      <td>700</td>
    </tr>
    <tr>
      <th>6ERcO7aqAKvrQ2CAvah79dVC7tJVZSjNti1MBfpNVW4=</th>
      <td>2017-02-17</td>
      <td>2015-01-01</td>
      <td>778</td>
    </tr>
    <tr>
      <th>Xt9VAHNtHuST21tkcZSnGKjwv8vF8/COnsf6z28+fKk=</th>
      <td>2017-02-28</td>
      <td>2016-09-08</td>
      <td>173</td>
    </tr>
    <tr>
      <th>zSgTJqoosTiFF7ZZi1DPTHgxLbnd99IgOEsTIDCcZHc=</th>
      <td>2017-02-13</td>
      <td>2015-01-01</td>
      <td>774</td>
    </tr>
  </tbody>
</table>
</div>

<p>We now create features to look at patters of usage over the past X days, where X is days_before_max_date, to see what a user has been doing "lately".  We apply this rationale to all of the usage columns in the user_logs table, giving us combinations of the following elements of our data:</p>
<ul>
<li>Number of songs played &lt; Y% of song length, where Y is 100, 985, 75, 50, and 25, plus the number of unique songs and total seconds played.</li>
<li>Activity over the last day, last 7, 30, 90, 180, 365, and total days, noting that the date range is relative to user's most recent activity.</li>
</ul>
<p>For each of these combinations, we calulate (using groupby and aggregate) both the sum and mean of each feature.  And finally we also create a single, total count column (number of rows) for the past number of days.  In total, this generates 120 features, which we then append to the user_logs_features table above.</p>
<div class="highlight"><pre><span></span><span class="c1">#Create Features:</span>
    <span class="c1"># Total X=(seconds, 100, 985, 75, 50, 25, unique), avg per day of X, maybe median per day of X</span>
    <span class="c1"># Last day, last 7 days, last 30 days, last 90, 180, 365, total (note last day is relative to user)</span>

<span class="k">for</span> <span class="n">num_days</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">365</span><span class="p">,</span> <span class="mi">9999</span><span class="p">]:</span>
    <span class="c1">#Create groupby object for items with x days</span>
    <span class="n">ul_gb_xdays</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_logs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">user_logs</span><span class="p">[</span><span class="s1">&#39;days_before_max_date&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">num_days</span><span class="p">)]</span>
                   <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;msno&#39;</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="c1">#Generate sum and mean (and count, once) for all the user logs stats</span>
    <span class="n">past_xdays_by_user</span> <span class="o">=</span> <span class="p">(</span><span class="n">ul_gb_xdays</span>
        <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;num_unq&#39;</span><span class="p">:[</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">],</span>
              <span class="s1">&#39;total_secs&#39;</span><span class="p">:[</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">],</span>
              <span class="s1">&#39;num_25&#39;</span><span class="p">:[</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">],</span>
              <span class="s1">&#39;num_50&#39;</span><span class="p">:[</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">],</span>
              <span class="s1">&#39;num_75&#39;</span><span class="p">:[</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">],</span>
              <span class="s1">&#39;num_985&#39;</span><span class="p">:[</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">],</span>
              <span class="s1">&#39;num_100&#39;</span><span class="p">:[</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">],</span>
             <span class="p">})</span>
                      <span class="p">)</span>
    <span class="c1">#Append level header</span>
    <span class="n">past_xdays_by_user</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">past_xdays_by_user</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;within_days_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_days</span><span class="p">)])</span>

    <span class="c1">#Join (append) to user_logs_features table</span>
    <span class="n">user_logs_features</span> <span class="o">=</span> <span class="n">user_logs_features</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">past_xdays_by_user</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
</pre></div>


<p>Taking a quick look at our table now:</p>
<div class="highlight"><pre><span></span><span class="n">user_logs_features</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">date_features</th>
      <th colspan="15" halign="left">within_days_1</th>
      <th colspan="15" halign="left">within_days_7</th>
      <th colspan="15" halign="left">within_days_14</th>
      <th colspan="15" halign="left">within_days_31</th>
      <th colspan="15" halign="left">within_days_90</th>
      <th colspan="15" halign="left">within_days_180</th>
      <th colspan="15" halign="left">within_days_365</th>
      <th colspan="15" halign="left">within_days_9999</th>
    </tr>
    <tr>
      <th></th>
      <th colspan="3" halign="left">date</th>
      <th colspan="3" halign="left">num_unq</th>
      <th colspan="2" halign="left">total_secs</th>
      <th colspan="2" halign="left">num_25</th>
      <th colspan="2" halign="left">num_50</th>
      <th colspan="2" halign="left">num_75</th>
      <th colspan="2" halign="left">num_985</th>
      <th colspan="2" halign="left">num_100</th>
      <th colspan="3" halign="left">num_unq</th>
      <th colspan="2" halign="left">total_secs</th>
      <th colspan="2" halign="left">num_25</th>
      <th colspan="2" halign="left">num_50</th>
      <th colspan="2" halign="left">num_75</th>
      <th colspan="2" halign="left">num_985</th>
      <th colspan="2" halign="left">num_100</th>
      <th colspan="3" halign="left">num_unq</th>
      <th colspan="2" halign="left">total_secs</th>
      <th colspan="2" halign="left">num_25</th>
      <th colspan="2" halign="left">num_50</th>
      <th colspan="2" halign="left">num_75</th>
      <th colspan="2" halign="left">num_985</th>
      <th colspan="2" halign="left">num_100</th>
      <th colspan="3" halign="left">num_unq</th>
      <th colspan="2" halign="left">total_secs</th>
      <th colspan="2" halign="left">num_25</th>
      <th colspan="2" halign="left">num_50</th>
      <th colspan="2" halign="left">num_75</th>
      <th colspan="2" halign="left">num_985</th>
      <th colspan="2" halign="left">num_100</th>
      <th colspan="3" halign="left">num_unq</th>
      <th colspan="2" halign="left">total_secs</th>
      <th colspan="2" halign="left">num_25</th>
      <th colspan="2" halign="left">num_50</th>
      <th colspan="2" halign="left">num_75</th>
      <th colspan="2" halign="left">num_985</th>
      <th colspan="2" halign="left">num_100</th>
      <th colspan="3" halign="left">num_unq</th>
      <th colspan="2" halign="left">total_secs</th>
      <th colspan="2" halign="left">num_25</th>
      <th colspan="2" halign="left">num_50</th>
      <th colspan="2" halign="left">num_75</th>
      <th colspan="2" halign="left">num_985</th>
      <th colspan="2" halign="left">num_100</th>
      <th colspan="3" halign="left">num_unq</th>
      <th colspan="2" halign="left">total_secs</th>
      <th colspan="2" halign="left">num_25</th>
      <th colspan="2" halign="left">num_50</th>
      <th colspan="2" halign="left">num_75</th>
      <th colspan="2" halign="left">num_985</th>
      <th colspan="2" halign="left">num_100</th>
      <th colspan="3" halign="left">num_unq</th>
      <th colspan="2" halign="left">total_secs</th>
      <th colspan="2" halign="left">num_25</th>
      <th colspan="2" halign="left">num_50</th>
      <th colspan="2" halign="left">num_75</th>
      <th colspan="2" halign="left">num_985</th>
      <th colspan="2" halign="left">num_100</th>
    </tr>
    <tr>
      <th></th>
      <th>max_date</th>
      <th>min_date</th>
      <th>listening_tenure</th>
      <th>sum</th>
      <th>mean</th>
      <th>count</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>count</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>count</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>count</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>count</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>count</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>count</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>count</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
    </tr>
    <tr>
      <th>msno</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MVODUEUlSocm1sXa+zVGpJazPrRFiD4IzEQk0QCdg4U=</th>
      <td>2017-02-27</td>
      <td>2015-07-11</td>
      <td>597</td>
      <td>17</td>
      <td>17</td>
      <td>1</td>
      <td>29802.123</td>
      <td>29802.123</td>
      <td>17</td>
      <td>17</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>115</td>
      <td>115</td>
      <td>161</td>
      <td>26.833333</td>
      <td>6</td>
      <td>72502.206</td>
      <td>12083.70100</td>
      <td>99</td>
      <td>16.500000</td>
      <td>13</td>
      <td>2.166667</td>
      <td>11</td>
      <td>1.833333</td>
      <td>9</td>
      <td>1.50</td>
      <td>275</td>
      <td>45.833333</td>
      <td>478</td>
      <td>39.833333</td>
      <td>12</td>
      <td>154157.897</td>
      <td>12846.491417</td>
      <td>207</td>
      <td>17.250000</td>
      <td>24</td>
      <td>2.000000</td>
      <td>16</td>
      <td>1.333333</td>
      <td>19</td>
      <td>1.583333</td>
      <td>595</td>
      <td>49.583333</td>
      <td>1040</td>
      <td>41.600000</td>
      <td>25</td>
      <td>299571.033</td>
      <td>11982.841320</td>
      <td>448</td>
      <td>17.920000</td>
      <td>53</td>
      <td>2.120000</td>
      <td>27</td>
      <td>1.080000</td>
      <td>43</td>
      <td>1.720000</td>
      <td>1153</td>
      <td>46.120000</td>
      <td>2723</td>
      <td>43.919355</td>
      <td>62</td>
      <td>610185.373</td>
      <td>9841.699565</td>
      <td>1227</td>
      <td>19.790323</td>
      <td>222</td>
      <td>3.580645</td>
      <td>103</td>
      <td>1.661290</td>
      <td>132</td>
      <td>2.129032</td>
      <td>2244</td>
      <td>36.193548</td>
      <td>5805</td>
      <td>47.975207</td>
      <td>121</td>
      <td>1195064.265</td>
      <td>9876.564174</td>
      <td>2792</td>
      <td>23.074380</td>
      <td>543</td>
      <td>4.487603</td>
      <td>261</td>
      <td>2.157025</td>
      <td>252</td>
      <td>2.082645</td>
      <td>4267</td>
      <td>35.264463</td>
      <td>10396</td>
      <td>45.004329</td>
      <td>231</td>
      <td>1989225.131</td>
      <td>8611.364203</td>
      <td>4768</td>
      <td>20.640693</td>
      <td>1243</td>
      <td>5.380952</td>
      <td>513</td>
      <td>2.220779</td>
      <td>479</td>
      <td>2.073593</td>
      <td>6908</td>
      <td>29.904762</td>
      <td>17549</td>
      <td>46.181579</td>
      <td>380</td>
      <td>3134336.415</td>
      <td>8248.253724</td>
      <td>10198</td>
      <td>26.836842</td>
      <td>2395</td>
      <td>6.302632</td>
      <td>972</td>
      <td>2.557895</td>
      <td>806</td>
      <td>2.121053</td>
      <td>10495</td>
      <td>27.618421</td>
    </tr>
    <tr>
      <th>o3Dg7baW8dXq7Jq7NzlVrWG4mZNVvqp62oWBDO/ybeE=</th>
      <td>2017-02-07</td>
      <td>2015-03-10</td>
      <td>700</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>274.176</td>
      <td>274.176</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>161</td>
      <td>26.833333</td>
      <td>6</td>
      <td>40311.015</td>
      <td>6718.50250</td>
      <td>52</td>
      <td>8.666667</td>
      <td>7</td>
      <td>1.166667</td>
      <td>7</td>
      <td>1.166667</td>
      <td>15</td>
      <td>2.50</td>
      <td>137</td>
      <td>22.833333</td>
      <td>253</td>
      <td>25.300000</td>
      <td>10</td>
      <td>65631.235</td>
      <td>6563.123500</td>
      <td>84</td>
      <td>8.400000</td>
      <td>16</td>
      <td>1.600000</td>
      <td>16</td>
      <td>1.600000</td>
      <td>25</td>
      <td>2.500000</td>
      <td>218</td>
      <td>21.800000</td>
      <td>811</td>
      <td>38.619048</td>
      <td>21</td>
      <td>201286.586</td>
      <td>9585.075524</td>
      <td>236</td>
      <td>11.238095</td>
      <td>43</td>
      <td>2.047619</td>
      <td>38</td>
      <td>1.809524</td>
      <td>53</td>
      <td>2.523810</td>
      <td>699</td>
      <td>33.285714</td>
      <td>1428</td>
      <td>33.209302</td>
      <td>43</td>
      <td>408254.891</td>
      <td>9494.299791</td>
      <td>460</td>
      <td>10.697674</td>
      <td>78</td>
      <td>1.813953</td>
      <td>69</td>
      <td>1.604651</td>
      <td>101</td>
      <td>2.348837</td>
      <td>1430</td>
      <td>33.255814</td>
      <td>1648</td>
      <td>32.313725</td>
      <td>51</td>
      <td>487842.759</td>
      <td>9565.544294</td>
      <td>495</td>
      <td>9.705882</td>
      <td>92</td>
      <td>1.803922</td>
      <td>76</td>
      <td>1.490196</td>
      <td>105</td>
      <td>2.058824</td>
      <td>1735</td>
      <td>34.019608</td>
      <td>3255</td>
      <td>29.062500</td>
      <td>112</td>
      <td>968253.587</td>
      <td>8645.121312</td>
      <td>1114</td>
      <td>9.946429</td>
      <td>206</td>
      <td>1.839286</td>
      <td>164</td>
      <td>1.464286</td>
      <td>230</td>
      <td>2.053571</td>
      <td>3430</td>
      <td>30.625000</td>
      <td>7475</td>
      <td>25.775862</td>
      <td>290</td>
      <td>2826851.820</td>
      <td>9747.764897</td>
      <td>3059</td>
      <td>10.548276</td>
      <td>692</td>
      <td>2.386207</td>
      <td>535</td>
      <td>1.844828</td>
      <td>567</td>
      <td>1.955172</td>
      <td>10075</td>
      <td>34.741379</td>
    </tr>
    <tr>
      <th>6ERcO7aqAKvrQ2CAvah79dVC7tJVZSjNti1MBfpNVW4=</th>
      <td>2017-02-17</td>
      <td>2015-01-01</td>
      <td>778</td>
      <td>13</td>
      <td>13</td>
      <td>1</td>
      <td>10363.972</td>
      <td>10363.972</td>
      <td>5</td>
      <td>5</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>4</td>
      <td>41</td>
      <td>41</td>
      <td>219</td>
      <td>43.800000</td>
      <td>5</td>
      <td>68118.548</td>
      <td>13623.70960</td>
      <td>25</td>
      <td>5.000000</td>
      <td>6</td>
      <td>1.200000</td>
      <td>6</td>
      <td>1.200000</td>
      <td>7</td>
      <td>1.40</td>
      <td>289</td>
      <td>57.800000</td>
      <td>480</td>
      <td>48.000000</td>
      <td>10</td>
      <td>121094.373</td>
      <td>12109.437300</td>
      <td>83</td>
      <td>8.300000</td>
      <td>24</td>
      <td>2.400000</td>
      <td>9</td>
      <td>0.900000</td>
      <td>11</td>
      <td>1.100000</td>
      <td>498</td>
      <td>49.800000</td>
      <td>870</td>
      <td>43.500000</td>
      <td>20</td>
      <td>210674.360</td>
      <td>10533.718000</td>
      <td>190</td>
      <td>9.500000</td>
      <td>37</td>
      <td>1.850000</td>
      <td>20</td>
      <td>1.000000</td>
      <td>28</td>
      <td>1.400000</td>
      <td>827</td>
      <td>41.350000</td>
      <td>2390</td>
      <td>44.259259</td>
      <td>54</td>
      <td>604775.769</td>
      <td>11199.551278</td>
      <td>490</td>
      <td>9.074074</td>
      <td>116</td>
      <td>2.148148</td>
      <td>79</td>
      <td>1.462963</td>
      <td>92</td>
      <td>1.703704</td>
      <td>2318</td>
      <td>42.925926</td>
      <td>4427</td>
      <td>41.764151</td>
      <td>106</td>
      <td>1186775.568</td>
      <td>11195.995925</td>
      <td>750</td>
      <td>7.075472</td>
      <td>212</td>
      <td>2.000000</td>
      <td>143</td>
      <td>1.349057</td>
      <td>179</td>
      <td>1.688679</td>
      <td>4631</td>
      <td>43.688679</td>
      <td>9683</td>
      <td>41.917749</td>
      <td>231</td>
      <td>2677487.134</td>
      <td>11590.853394</td>
      <td>1323</td>
      <td>5.727273</td>
      <td>425</td>
      <td>1.839827</td>
      <td>340</td>
      <td>1.471861</td>
      <td>396</td>
      <td>1.714286</td>
      <td>10499</td>
      <td>45.450216</td>
      <td>17589</td>
      <td>35.605263</td>
      <td>494</td>
      <td>4836694.885</td>
      <td>9790.880334</td>
      <td>2799</td>
      <td>5.665992</td>
      <td>1023</td>
      <td>2.070850</td>
      <td>772</td>
      <td>1.562753</td>
      <td>770</td>
      <td>1.558704</td>
      <td>18443</td>
      <td>37.334008</td>
    </tr>
    <tr>
      <th>Xt9VAHNtHuST21tkcZSnGKjwv8vF8/COnsf6z28+fKk=</th>
      <td>2017-02-28</td>
      <td>2016-09-08</td>
      <td>173</td>
      <td>86</td>
      <td>86</td>
      <td>1</td>
      <td>21094.770</td>
      <td>21094.770</td>
      <td>10</td>
      <td>10</td>
      <td>6</td>
      <td>6</td>
      <td>7</td>
      <td>7</td>
      <td>4</td>
      <td>4</td>
      <td>72</td>
      <td>72</td>
      <td>133</td>
      <td>26.600000</td>
      <td>5</td>
      <td>32936.237</td>
      <td>6587.24740</td>
      <td>18</td>
      <td>3.600000</td>
      <td>8</td>
      <td>1.600000</td>
      <td>7</td>
      <td>1.400000</td>
      <td>8</td>
      <td>1.60</td>
      <td>112</td>
      <td>22.400000</td>
      <td>313</td>
      <td>31.300000</td>
      <td>10</td>
      <td>72406.047</td>
      <td>7240.604700</td>
      <td>86</td>
      <td>8.600000</td>
      <td>18</td>
      <td>1.800000</td>
      <td>11</td>
      <td>1.100000</td>
      <td>13</td>
      <td>1.300000</td>
      <td>251</td>
      <td>25.100000</td>
      <td>493</td>
      <td>21.434783</td>
      <td>23</td>
      <td>114170.059</td>
      <td>4963.915609</td>
      <td>126</td>
      <td>5.478261</td>
      <td>27</td>
      <td>1.173913</td>
      <td>16</td>
      <td>0.695652</td>
      <td>16</td>
      <td>0.695652</td>
      <td>395</td>
      <td>17.173913</td>
      <td>2060</td>
      <td>34.915254</td>
      <td>59</td>
      <td>406402.278</td>
      <td>6888.174203</td>
      <td>781</td>
      <td>13.237288</td>
      <td>116</td>
      <td>1.966102</td>
      <td>75</td>
      <td>1.271186</td>
      <td>69</td>
      <td>1.169492</td>
      <td>1404</td>
      <td>23.796610</td>
      <td>3840</td>
      <td>37.281553</td>
      <td>103</td>
      <td>799700.121</td>
      <td>7764.078845</td>
      <td>1387</td>
      <td>13.466019</td>
      <td>219</td>
      <td>2.126214</td>
      <td>159</td>
      <td>1.543689</td>
      <td>168</td>
      <td>1.631068</td>
      <td>2696</td>
      <td>26.174757</td>
      <td>3840</td>
      <td>37.281553</td>
      <td>103</td>
      <td>799700.121</td>
      <td>7764.078845</td>
      <td>1387</td>
      <td>13.466019</td>
      <td>219</td>
      <td>2.126214</td>
      <td>159</td>
      <td>1.543689</td>
      <td>168</td>
      <td>1.631068</td>
      <td>2696</td>
      <td>26.174757</td>
      <td>3840</td>
      <td>37.281553</td>
      <td>103</td>
      <td>799700.121</td>
      <td>7764.078845</td>
      <td>1387</td>
      <td>13.466019</td>
      <td>219</td>
      <td>2.126214</td>
      <td>159</td>
      <td>1.543689</td>
      <td>168</td>
      <td>1.631068</td>
      <td>2696</td>
      <td>26.174757</td>
    </tr>
    <tr>
      <th>zSgTJqoosTiFF7ZZi1DPTHgxLbnd99IgOEsTIDCcZHc=</th>
      <td>2017-02-13</td>
      <td>2015-01-01</td>
      <td>774</td>
      <td>22</td>
      <td>22</td>
      <td>1</td>
      <td>2803.117</td>
      <td>2803.117</td>
      <td>9</td>
      <td>9</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>10</td>
      <td>10</td>
      <td>50</td>
      <td>12.500000</td>
      <td>4</td>
      <td>7935.679</td>
      <td>1983.91975</td>
      <td>17</td>
      <td>4.250000</td>
      <td>2</td>
      <td>0.500000</td>
      <td>3</td>
      <td>0.750000</td>
      <td>1</td>
      <td>0.25</td>
      <td>31</td>
      <td>7.750000</td>
      <td>101</td>
      <td>14.428571</td>
      <td>7</td>
      <td>17605.267</td>
      <td>2515.038143</td>
      <td>41</td>
      <td>5.857143</td>
      <td>5</td>
      <td>0.714286</td>
      <td>4</td>
      <td>0.571429</td>
      <td>1</td>
      <td>0.142857</td>
      <td>71</td>
      <td>10.142857</td>
      <td>301</td>
      <td>21.500000</td>
      <td>14</td>
      <td>40235.862</td>
      <td>2873.990143</td>
      <td>148</td>
      <td>10.571429</td>
      <td>15</td>
      <td>1.071429</td>
      <td>9</td>
      <td>0.642857</td>
      <td>7</td>
      <td>0.500000</td>
      <td>152</td>
      <td>10.857143</td>
      <td>759</td>
      <td>23.000000</td>
      <td>33</td>
      <td>124239.481</td>
      <td>3764.832758</td>
      <td>284</td>
      <td>8.606061</td>
      <td>28</td>
      <td>0.848485</td>
      <td>21</td>
      <td>0.636364</td>
      <td>24</td>
      <td>0.727273</td>
      <td>466</td>
      <td>14.121212</td>
      <td>2722</td>
      <td>32.023529</td>
      <td>85</td>
      <td>461324.690</td>
      <td>5427.349294</td>
      <td>1185</td>
      <td>13.941176</td>
      <td>96</td>
      <td>1.129412</td>
      <td>70</td>
      <td>0.823529</td>
      <td>123</td>
      <td>1.447059</td>
      <td>1712</td>
      <td>20.141176</td>
      <td>9576</td>
      <td>46.712195</td>
      <td>205</td>
      <td>1931032.095</td>
      <td>9419.668756</td>
      <td>3431</td>
      <td>16.736585</td>
      <td>401</td>
      <td>1.956098</td>
      <td>278</td>
      <td>1.356098</td>
      <td>376</td>
      <td>1.834146</td>
      <td>7359</td>
      <td>35.897561</td>
      <td>16913</td>
      <td>57.921233</td>
      <td>292</td>
      <td>3583828.437</td>
      <td>12273.385058</td>
      <td>5126</td>
      <td>17.554795</td>
      <td>591</td>
      <td>2.023973</td>
      <td>440</td>
      <td>1.506849</td>
      <td>559</td>
      <td>1.914384</td>
      <td>13815</td>
      <td>47.311644</td>
    </tr>
  </tbody>
</table>
</div>

<p>Good, we get the expected number of columns.</p>
<h1>5. Transaction Data: Preparation and Feature Extraction</h1>
<p>Having completed feature extraction for user logs, we now move on to creating features for the transaction data.</p>
<p>We begin grouping the data by user.</p>
<div class="highlight"><pre><span></span><span class="c1"># Grouping by the member (msno)</span>
<span class="n">transactions_gb</span> <span class="o">=</span> <span class="n">transactions</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;transaction_date&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;msno&#39;</span><span class="p">])</span>

<span class="c1"># How many groups i.e. members i.e. msno&#39;s. We&#39;re good if this is the same number as the members table</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Groups/msnos&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transactions_gb</span><span class="o">.</span><span class="n">groups</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Features&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transactions</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">99825 Groups/msnos</span>
<span class="err">9 Features</span>
</pre></div>


<p>We plan to create the following features from the transactions table:
* Simple featuers from the latest transaction
    * Plan no of days
    * plan total amount paid
    * plan list price
    * Is_auto_renew
    * is_cancel
* Synthetic features from the latest transaction
    * Plan actual amount paid/day 
* Aggregate values
    * Total number of plan days
    * Total of all the amounts paid for the plan
* Comparing transactions
    * Plan day difference among the latest and previous transaction
    * Amount paid/day difference among the latest and previous transaction</p>
<p>We begin by creating the total_plan_days and total_amount_paid:</p>
<div class="highlight"><pre><span></span><span class="c1"># Features: Total_plan_days, Total_amount_paid</span>
<span class="n">transactions_features</span> <span class="o">=</span> <span class="p">(</span><span class="n">transactions_gb</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;payment_plan_days&#39;</span><span class="p">:</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;actual_amount_paid&#39;</span><span class="p">:</span><span class="s1">&#39;sum&#39;</span> <span class="p">})</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;payment_plan_days&#39;</span><span class="p">:</span> <span class="s1">&#39;total_plan_days&#39;</span><span class="p">,</span> <span class="s1">&#39;actual_amount_paid&#39;</span><span class="p">:</span> <span class="s1">&#39;total_amount_paid&#39;</span><span class="p">,})</span>
          <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Entries in the DF: &#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transactions_features</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Features&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transactions_features</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>

<span class="n">transactions_features</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">99825 Entries in the DF: </span>
<span class="err">2 Features</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_plan_days</th>
      <th>total_amount_paid</th>
    </tr>
    <tr>
      <th>msno</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>+++l/EXNMLTijfLBa8p2TUVVVp2aFGSuUI/h7mLmthw=</th>
      <td>543</td>
      <td>2831</td>
    </tr>
    <tr>
      <th>++5nv+2nsvrWM7dOT+ZiWJ5uTZOzQS0NEvqu3jidTjU=</th>
      <td>90</td>
      <td>297</td>
    </tr>
    <tr>
      <th>++7IULiyKbNc8jllqhRuyKZjX1J4mPF4tsudFCJfv4k=</th>
      <td>513</td>
      <td>2682</td>
    </tr>
    <tr>
      <th>++Ck01c3EF07Ejek2jfXlKut+sEfg+0ry+A5uWeL9vY=</th>
      <td>270</td>
      <td>891</td>
    </tr>
    <tr>
      <th>++FPL1dXZBXC3Cf6gE0HQiIHg1Pd+DBdK7w52xcUmX0=</th>
      <td>457</td>
      <td>2235</td>
    </tr>
  </tbody>
</table>
</div>

<p>Next, we add amount_paid_per_day for a user's entire tenure:</p>
<div class="highlight"><pre><span></span><span class="c1"># Plan actual amount paid/day for all the transactions by a user</span>
<span class="c1"># Adding the collumn amount_paid_per_day</span>
<span class="n">transactions_features</span><span class="p">[</span><span class="s1">&#39;amount_paid_per_day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">transactions_features</span><span class="p">[</span><span class="s1">&#39;total_amount_paid&#39;</span><span class="p">]</span>
                                                <span class="o">/</span><span class="n">transactions_features</span><span class="p">[</span><span class="s1">&#39;total_plan_days&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Entries in the DF: &#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transactions_features</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Features&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transactions_features</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>

<span class="n">transactions_features</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">99825 Entries in the DF: </span>
<span class="err">3 Features</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_plan_days</th>
      <th>total_amount_paid</th>
      <th>amount_paid_per_day</th>
    </tr>
    <tr>
      <th>msno</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>+++l/EXNMLTijfLBa8p2TUVVVp2aFGSuUI/h7mLmthw=</th>
      <td>543</td>
      <td>2831</td>
      <td>5.213628</td>
    </tr>
    <tr>
      <th>++5nv+2nsvrWM7dOT+ZiWJ5uTZOzQS0NEvqu3jidTjU=</th>
      <td>90</td>
      <td>297</td>
      <td>3.300000</td>
    </tr>
    <tr>
      <th>++7IULiyKbNc8jllqhRuyKZjX1J4mPF4tsudFCJfv4k=</th>
      <td>513</td>
      <td>2682</td>
      <td>5.228070</td>
    </tr>
    <tr>
      <th>++Ck01c3EF07Ejek2jfXlKut+sEfg+0ry+A5uWeL9vY=</th>
      <td>270</td>
      <td>891</td>
      <td>3.300000</td>
    </tr>
    <tr>
      <th>++FPL1dXZBXC3Cf6gE0HQiIHg1Pd+DBdK7w52xcUmX0=</th>
      <td>457</td>
      <td>2235</td>
      <td>4.890591</td>
    </tr>
  </tbody>
</table>
</div>

<p>Next, we add latest_payment_method_id, latest_plan_days, latest_plan_list_price, latest_amount_paid, latest_auto_renew, latest_transaction_date, latest_expire_date, and latest_is_cancel.  We accomplish this by picking from the bottom of the ordered (by date) rows in groups.</p>
<div class="highlight"><pre><span></span><span class="c1"># Features: latest transaction, renaming the collumns</span>
<span class="c1"># V1- Fixed the name for plan_list_price collumn (now called latest_plan_list_price)</span>

<span class="n">latest_transaction</span><span class="o">=</span> <span class="n">transactions_gb</span><span class="o">.</span><span class="n">tail</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;payment_method_id&#39;</span><span class="p">:</span> <span class="s1">&#39;latest_payment_method_id&#39;</span><span class="p">,</span>
                                                                  <span class="s1">&#39;payment_plan_days&#39;</span><span class="p">:</span> <span class="s1">&#39;latest_plan_days&#39;</span><span class="p">,</span>
                                                                  <span class="s1">&#39;plan_list_price&#39;</span><span class="p">:</span> <span class="s1">&#39;latest_plan_list_price&#39;</span><span class="p">,</span>
                                                                  <span class="s1">&#39;actual_amount_paid&#39;</span><span class="p">:</span> <span class="s1">&#39;latest_amount_paid&#39;</span><span class="p">,</span>
                                                                  <span class="s1">&#39;is_auto_renew&#39;</span><span class="p">:</span> <span class="s1">&#39;latest_auto_renew&#39;</span><span class="p">,</span> 
                                                                  <span class="s1">&#39;transaction_date&#39;</span><span class="p">:</span> <span class="s1">&#39;latest_transaction_date&#39;</span><span class="p">,</span>
                                                                  <span class="s1">&#39;membership_expire_date&#39;</span><span class="p">:</span> <span class="s1">&#39;latest_expire_date&#39;</span><span class="p">,</span>
                                                                  <span class="s1">&#39;is_cancel&#39;</span><span class="p">:</span> <span class="s1">&#39;latest_is_cancel&#39;</span> <span class="p">})</span>

<span class="c1"># Index by msno</span>
<span class="n">latest_transaction</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;msno&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Entries in the DF: &#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">latest_transaction</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Features&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">latest_transaction</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>

<span class="n">latest_transaction</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">99825 Entries in the DF: </span>
<span class="err">8 Features</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>latest_payment_method_id</th>
      <th>latest_plan_days</th>
      <th>latest_plan_list_price</th>
      <th>latest_amount_paid</th>
      <th>latest_auto_renew</th>
      <th>latest_transaction_date</th>
      <th>latest_expire_date</th>
      <th>latest_is_cancel</th>
    </tr>
    <tr>
      <th>msno</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>z1Lm/BlRQraiaWJ7RaQWe0+l0Z40ACj7W+zk29FiaS4=</th>
      <td>38</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>0</td>
      <td>20150102</td>
      <td>20150503</td>
      <td>0</td>
    </tr>
    <tr>
      <th>IwE/pih8PuqrY/rsnoZ/4TazDliyH9S8VWNc2/d7mJg=</th>
      <td>38</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>0</td>
      <td>20150102</td>
      <td>20150702</td>
      <td>0</td>
    </tr>
    <tr>
      <th>ea9rY0uEPY0ImD2QVbYFb+z3zi5wniKWMUM1V8os7OY=</th>
      <td>32</td>
      <td>410</td>
      <td>1788</td>
      <td>1788</td>
      <td>0</td>
      <td>20150104</td>
      <td>20170213</td>
      <td>0</td>
    </tr>
    <tr>
      <th>plhzwjmNJp0HW04NidfVa35JE216RaFYpSeUCwT11zQ=</th>
      <td>38</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>0</td>
      <td>20150120</td>
      <td>20170103</td>
      <td>0</td>
    </tr>
    <tr>
      <th>PbSQ2KxR4gRnzjsRd8Up75qMYb70iuMwGk10/jPRljk=</th>
      <td>38</td>
      <td>360</td>
      <td>1200</td>
      <td>1200</td>
      <td>0</td>
      <td>20150123</td>
      <td>20170212</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Next, we add latest_amount_paid_per_day:</p>
<div class="highlight"><pre><span></span><span class="c1"># Plan actual amount paid/day for the latest transaction</span>
<span class="c1"># Adding the collumn amount_paid_per_day</span>

<span class="n">latest_transaction</span><span class="p">[</span><span class="s1">&#39;latest_amount_paid_per_day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">latest_transaction</span><span class="p">[</span><span class="s1">&#39;latest_amount_paid&#39;</span><span class="p">]</span>
                                                <span class="o">/</span><span class="n">latest_transaction</span><span class="p">[</span><span class="s1">&#39;latest_plan_days&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Entries in the DF: &#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">latest_transaction</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Features&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">latest_transaction</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>

<span class="n">latest_transaction</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">99825 Entries in the DF: </span>
<span class="err">9 Features</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>latest_payment_method_id</th>
      <th>latest_plan_days</th>
      <th>latest_plan_list_price</th>
      <th>latest_amount_paid</th>
      <th>latest_auto_renew</th>
      <th>latest_transaction_date</th>
      <th>latest_expire_date</th>
      <th>latest_is_cancel</th>
      <th>latest_amount_paid_per_day</th>
    </tr>
    <tr>
      <th>msno</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>z1Lm/BlRQraiaWJ7RaQWe0+l0Z40ACj7W+zk29FiaS4=</th>
      <td>38</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>0</td>
      <td>20150102</td>
      <td>20150503</td>
      <td>0</td>
      <td>4.966667</td>
    </tr>
    <tr>
      <th>IwE/pih8PuqrY/rsnoZ/4TazDliyH9S8VWNc2/d7mJg=</th>
      <td>38</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>0</td>
      <td>20150102</td>
      <td>20150702</td>
      <td>0</td>
      <td>4.966667</td>
    </tr>
    <tr>
      <th>ea9rY0uEPY0ImD2QVbYFb+z3zi5wniKWMUM1V8os7OY=</th>
      <td>32</td>
      <td>410</td>
      <td>1788</td>
      <td>1788</td>
      <td>0</td>
      <td>20150104</td>
      <td>20170213</td>
      <td>0</td>
      <td>4.360976</td>
    </tr>
    <tr>
      <th>plhzwjmNJp0HW04NidfVa35JE216RaFYpSeUCwT11zQ=</th>
      <td>38</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>0</td>
      <td>20150120</td>
      <td>20170103</td>
      <td>0</td>
      <td>4.966667</td>
    </tr>
    <tr>
      <th>PbSQ2KxR4gRnzjsRd8Up75qMYb70iuMwGk10/jPRljk=</th>
      <td>38</td>
      <td>360</td>
      <td>1200</td>
      <td>1200</td>
      <td>0</td>
      <td>20150123</td>
      <td>20170212</td>
      <td>0</td>
      <td>3.333333</td>
    </tr>
  </tbody>
</table>
</div>

<p>Next, we compare two different items in our transaction data:</p>
<ul>
<li>Plan duration difference among the last 2 transactons</li>
<li>Cost difference among the last 2 transactions</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1"># Getting the 2 latest transactions and grouping by msno again</span>
<span class="n">latest_transaction2_gb</span> <span class="o">=</span> <span class="n">transactions_gb</span><span class="o">.</span><span class="n">tail</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;msno&#39;</span><span class="p">])</span>

<span class="c1"># Getting the latest but one transaction</span>
<span class="n">latest2_transaction</span> <span class="o">=</span> <span class="n">latest_transaction2_gb</span><span class="o">.</span><span class="n">head</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Index by msno</span>
<span class="n">latest2_transaction</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;msno&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># Amount paid per day for the 2nd latest transaction</span>
<span class="n">latest2_transaction</span><span class="p">[</span><span class="s1">&#39;latest2_amount_paid_per_day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">latest2_transaction</span><span class="p">[</span><span class="s1">&#39;actual_amount_paid&#39;</span><span class="p">]</span>
                                                <span class="o">/</span><span class="n">latest2_transaction</span><span class="p">[</span><span class="s1">&#39;payment_plan_days&#39;</span><span class="p">])</span>

<span class="c1"># Difference in the renewal length among the latest 2 transactions</span>
<span class="n">transactions_features</span><span class="p">[</span><span class="s1">&#39;diff_renewal_duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">latest_transaction</span><span class="p">[</span><span class="s1">&#39;latest_plan_days&#39;</span><span class="p">]</span>
                                                <span class="o">-</span> <span class="n">latest2_transaction</span><span class="p">[</span><span class="s1">&#39;payment_plan_days&#39;</span><span class="p">])</span>

<span class="c1"># Different in plan cost among the latest 2 transactions</span>
<span class="n">transactions_features</span><span class="p">[</span><span class="s1">&#39;diff_plan_amount_paid_per_day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">latest_transaction</span><span class="p">[</span><span class="s1">&#39;latest_amount_paid_per_day&#39;</span><span class="p">]</span> 
                                                          <span class="o">-</span> <span class="n">latest2_transaction</span><span class="p">[</span><span class="s1">&#39;latest2_amount_paid_per_day&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Entries in the DF: &#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transactions_features</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Features&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transactions_features</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>

<span class="n">transactions_features</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">ipykernel_launcher</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span> <span class="n">SettingWithCopyWarning</span><span class="p">:</span> 
<span class="n">A</span> <span class="n">value</span> <span class="k">is</span> <span class="n">trying</span> <span class="k">to</span> <span class="n">be</span> <span class="k">set</span> <span class="k">on</span> <span class="n">a</span> <span class="k">copy</span> <span class="k">of</span> <span class="n">a</span> <span class="n">slice</span> <span class="k">from</span> <span class="n">a</span> <span class="n">DataFrame</span><span class="p">.</span>
<span class="n">Try</span> <span class="k">using</span> <span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row_indexer</span><span class="p">,</span><span class="n">col_indexer</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="k">instead</span>

<span class="n">See</span> <span class="n">the</span> <span class="n">caveats</span> <span class="k">in</span> <span class="n">the</span> <span class="n">documentation</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">pandas</span><span class="p">.</span><span class="n">pydata</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">pandas</span><span class="o">-</span><span class="n">docs</span><span class="o">/</span><span class="k">stable</span><span class="o">/</span><span class="n">indexing</span><span class="p">.</span><span class="n">html</span><span class="o">#</span><span class="n">indexing</span><span class="o">-</span><span class="k">view</span><span class="o">-</span><span class="n">versus</span><span class="o">-</span><span class="k">copy</span>
  <span class="k">if</span> <span class="n">sys</span><span class="p">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>


<span class="mi">99825</span> <span class="n">Entries</span> <span class="k">in</span> <span class="n">the</span> <span class="n">DF</span><span class="p">:</span> 
<span class="mi">5</span> <span class="n">Features</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_plan_days</th>
      <th>total_amount_paid</th>
      <th>amount_paid_per_day</th>
      <th>diff_renewal_duration</th>
      <th>diff_plan_amount_paid_per_day</th>
    </tr>
    <tr>
      <th>msno</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>+++l/EXNMLTijfLBa8p2TUVVVp2aFGSuUI/h7mLmthw=</th>
      <td>543</td>
      <td>2831</td>
      <td>5.213628</td>
      <td>0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>++5nv+2nsvrWM7dOT+ZiWJ5uTZOzQS0NEvqu3jidTjU=</th>
      <td>90</td>
      <td>297</td>
      <td>3.300000</td>
      <td>0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>++7IULiyKbNc8jllqhRuyKZjX1J4mPF4tsudFCJfv4k=</th>
      <td>513</td>
      <td>2682</td>
      <td>5.228070</td>
      <td>0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>++Ck01c3EF07Ejek2jfXlKut+sEfg+0ry+A5uWeL9vY=</th>
      <td>270</td>
      <td>891</td>
      <td>3.300000</td>
      <td>0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>++FPL1dXZBXC3Cf6gE0HQiIHg1Pd+DBdK7w52xcUmX0=</th>
      <td>457</td>
      <td>2235</td>
      <td>4.890591</td>
      <td>23</td>
      <td>4.966667</td>
    </tr>
  </tbody>
</table>
</div>

<p>Finally, we join all the features into a single data frame:</p>
<div class="highlight"><pre><span></span><span class="c1"># Get all transaction features in a single DF</span>
<span class="n">transactions_features</span> <span class="o">=</span> <span class="n">transactions_features</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">latest_transaction</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">)</span>

<span class="c1"># Test</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Entries in the DF: &#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transactions_features</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Features&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transactions_features</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>

<span class="n">transactions_features</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">99825 Entries in the DF: </span>
<span class="err">14 Features</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_plan_days</th>
      <th>total_amount_paid</th>
      <th>amount_paid_per_day</th>
      <th>diff_renewal_duration</th>
      <th>diff_plan_amount_paid_per_day</th>
      <th>latest_payment_method_id</th>
      <th>latest_plan_days</th>
      <th>latest_plan_list_price</th>
      <th>latest_amount_paid</th>
      <th>latest_auto_renew</th>
      <th>latest_transaction_date</th>
      <th>latest_expire_date</th>
      <th>latest_is_cancel</th>
      <th>latest_amount_paid_per_day</th>
    </tr>
    <tr>
      <th>msno</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>+++l/EXNMLTijfLBa8p2TUVVVp2aFGSuUI/h7mLmthw=</th>
      <td>543</td>
      <td>2831</td>
      <td>5.213628</td>
      <td>0</td>
      <td>0.000000</td>
      <td>39</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>20170131</td>
      <td>20170319</td>
      <td>0</td>
      <td>4.966667</td>
    </tr>
    <tr>
      <th>++5nv+2nsvrWM7dOT+ZiWJ5uTZOzQS0NEvqu3jidTjU=</th>
      <td>90</td>
      <td>297</td>
      <td>3.300000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>41</td>
      <td>30</td>
      <td>99</td>
      <td>99</td>
      <td>1</td>
      <td>20170201</td>
      <td>20170301</td>
      <td>0</td>
      <td>3.300000</td>
    </tr>
    <tr>
      <th>++7IULiyKbNc8jllqhRuyKZjX1J4mPF4tsudFCJfv4k=</th>
      <td>513</td>
      <td>2682</td>
      <td>5.228070</td>
      <td>0</td>
      <td>0.000000</td>
      <td>37</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>20170201</td>
      <td>20170301</td>
      <td>0</td>
      <td>4.966667</td>
    </tr>
    <tr>
      <th>++Ck01c3EF07Ejek2jfXlKut+sEfg+0ry+A5uWeL9vY=</th>
      <td>270</td>
      <td>891</td>
      <td>3.300000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>41</td>
      <td>30</td>
      <td>99</td>
      <td>99</td>
      <td>1</td>
      <td>20170214</td>
      <td>20170314</td>
      <td>0</td>
      <td>3.300000</td>
    </tr>
    <tr>
      <th>++FPL1dXZBXC3Cf6gE0HQiIHg1Pd+DBdK7w52xcUmX0=</th>
      <td>457</td>
      <td>2235</td>
      <td>4.890591</td>
      <td>23</td>
      <td>4.966667</td>
      <td>41</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>20160225</td>
      <td>20160225</td>
      <td>1</td>
      <td>4.966667</td>
    </tr>
  </tbody>
</table>
</div>

<h1>6. Joining Features and Data Manipulation</h1>
<h2>Joining Features</h2>
<p>Having completed features by user from the User Logs and Transactions tables, we will now join the features from these tables together with the Members and Labels (a.k.a., train) tables into a single data frame for predictive modeling.</p>
<p>First, we'll join the Members and Labels together:</p>
<div class="highlight"><pre><span></span><span class="c1">#Join members and labels files</span>
<span class="n">df_fa</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">df_fa</span> <span class="o">=</span> <span class="n">members</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>

<span class="n">df_fa</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>city</th>
      <th>bd</th>
      <th>gender</th>
      <th>registered_via</th>
      <th>registration_init_time</th>
      <th>is_churn</th>
    </tr>
    <tr>
      <th>msno</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mKfgXQAmVeSKzN4rXW37qz0HbGCuYBspTBM3ONXZudg=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20170120</td>
      <td>0</td>
    </tr>
    <tr>
      <th>AFcKYsrudzim8OFa+fL/c9g5gZabAbhaJnoM0qmlJfo=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20160907</td>
      <td>0</td>
    </tr>
    <tr>
      <th>qk4mEZUYZq+4sQE7bzRYKc5Pvj+Xc7Wmu25DrCzltEU=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20160902</td>
      <td>0</td>
    </tr>
    <tr>
      <th>G2UGNLph2J6euGmZ7WIa1+Kc+dPZBJI0HbLPu5YtrZw=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20161028</td>
      <td>0</td>
    </tr>
    <tr>
      <th>EqSHZpMj5uddJvv2gXcHvuOKFOdS5NN6RalHfzEhhaI=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20161004</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Next, we join the User Logs features table with the combined Members and the Labels table:</p>
<div class="highlight"><pre><span></span><span class="n">df_fa</span> <span class="o">=</span> <span class="n">df_fa</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">user_logs_features</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
<span class="c1">#Note, the warning is okay, and actually helps us by flattening our column headers.</span>

<span class="n">df_fa</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c">C:\Users\AOlson\AppData\Local\Continuum\anaconda3\lib\site-packages\pandas\core\reshape\merge.py:558: UserWarning: merging between different levels can give an unintended result (1 levels on the left, 3 on the right)</span>
<span class="c">  warnings.warn(msg, UserWarning)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>city</th>
      <th>bd</th>
      <th>gender</th>
      <th>registered_via</th>
      <th>registration_init_time</th>
      <th>is_churn</th>
      <th>(date_features, date, max_date)</th>
      <th>(date_features, date, min_date)</th>
      <th>(date_features, date, listening_tenure)</th>
      <th>(within_days_1, num_unq, sum)</th>
      <th>(within_days_1, num_unq, mean)</th>
      <th>(within_days_1, num_unq, count)</th>
      <th>(within_days_1, total_secs, sum)</th>
      <th>(within_days_1, total_secs, mean)</th>
      <th>(within_days_1, num_25, sum)</th>
      <th>(within_days_1, num_25, mean)</th>
      <th>(within_days_1, num_50, sum)</th>
      <th>(within_days_1, num_50, mean)</th>
      <th>(within_days_1, num_75, sum)</th>
      <th>(within_days_1, num_75, mean)</th>
      <th>(within_days_1, num_985, sum)</th>
      <th>(within_days_1, num_985, mean)</th>
      <th>(within_days_1, num_100, sum)</th>
      <th>(within_days_1, num_100, mean)</th>
      <th>(within_days_7, num_unq, sum)</th>
      <th>(within_days_7, num_unq, mean)</th>
      <th>(within_days_7, num_unq, count)</th>
      <th>(within_days_7, total_secs, sum)</th>
      <th>(within_days_7, total_secs, mean)</th>
      <th>(within_days_7, num_25, sum)</th>
      <th>(within_days_7, num_25, mean)</th>
      <th>(within_days_7, num_50, sum)</th>
      <th>(within_days_7, num_50, mean)</th>
      <th>(within_days_7, num_75, sum)</th>
      <th>(within_days_7, num_75, mean)</th>
      <th>(within_days_7, num_985, sum)</th>
      <th>(within_days_7, num_985, mean)</th>
      <th>(within_days_7, num_100, sum)</th>
      <th>(within_days_7, num_100, mean)</th>
      <th>(within_days_14, num_unq, sum)</th>
      <th>(within_days_14, num_unq, mean)</th>
      <th>(within_days_14, num_unq, count)</th>
      <th>(within_days_14, total_secs, sum)</th>
      <th>(within_days_14, total_secs, mean)</th>
      <th>(within_days_14, num_25, sum)</th>
      <th>(within_days_14, num_25, mean)</th>
      <th>(within_days_14, num_50, sum)</th>
      <th>(within_days_14, num_50, mean)</th>
      <th>(within_days_14, num_75, sum)</th>
      <th>(within_days_14, num_75, mean)</th>
      <th>(within_days_14, num_985, sum)</th>
      <th>(within_days_14, num_985, mean)</th>
      <th>(within_days_14, num_100, sum)</th>
      <th>(within_days_14, num_100, mean)</th>
      <th>(within_days_31, num_unq, sum)</th>
      <th>(within_days_31, num_unq, mean)</th>
      <th>(within_days_31, num_unq, count)</th>
      <th>(within_days_31, total_secs, sum)</th>
      <th>(within_days_31, total_secs, mean)</th>
      <th>(within_days_31, num_25, sum)</th>
      <th>(within_days_31, num_25, mean)</th>
      <th>(within_days_31, num_50, sum)</th>
      <th>(within_days_31, num_50, mean)</th>
      <th>(within_days_31, num_75, sum)</th>
      <th>(within_days_31, num_75, mean)</th>
      <th>(within_days_31, num_985, sum)</th>
      <th>(within_days_31, num_985, mean)</th>
      <th>(within_days_31, num_100, sum)</th>
      <th>(within_days_31, num_100, mean)</th>
      <th>(within_days_90, num_unq, sum)</th>
      <th>(within_days_90, num_unq, mean)</th>
      <th>(within_days_90, num_unq, count)</th>
      <th>(within_days_90, total_secs, sum)</th>
      <th>(within_days_90, total_secs, mean)</th>
      <th>(within_days_90, num_25, sum)</th>
      <th>(within_days_90, num_25, mean)</th>
      <th>(within_days_90, num_50, sum)</th>
      <th>(within_days_90, num_50, mean)</th>
      <th>(within_days_90, num_75, sum)</th>
      <th>(within_days_90, num_75, mean)</th>
      <th>(within_days_90, num_985, sum)</th>
      <th>(within_days_90, num_985, mean)</th>
      <th>(within_days_90, num_100, sum)</th>
      <th>(within_days_90, num_100, mean)</th>
      <th>(within_days_180, num_unq, sum)</th>
      <th>(within_days_180, num_unq, mean)</th>
      <th>(within_days_180, num_unq, count)</th>
      <th>(within_days_180, total_secs, sum)</th>
      <th>(within_days_180, total_secs, mean)</th>
      <th>(within_days_180, num_25, sum)</th>
      <th>(within_days_180, num_25, mean)</th>
      <th>(within_days_180, num_50, sum)</th>
      <th>(within_days_180, num_50, mean)</th>
      <th>(within_days_180, num_75, sum)</th>
      <th>(within_days_180, num_75, mean)</th>
      <th>(within_days_180, num_985, sum)</th>
      <th>(within_days_180, num_985, mean)</th>
      <th>(within_days_180, num_100, sum)</th>
      <th>(within_days_180, num_100, mean)</th>
      <th>(within_days_365, num_unq, sum)</th>
      <th>(within_days_365, num_unq, mean)</th>
      <th>(within_days_365, num_unq, count)</th>
      <th>(within_days_365, total_secs, sum)</th>
      <th>(within_days_365, total_secs, mean)</th>
      <th>(within_days_365, num_25, sum)</th>
      <th>(within_days_365, num_25, mean)</th>
      <th>(within_days_365, num_50, sum)</th>
      <th>(within_days_365, num_50, mean)</th>
      <th>(within_days_365, num_75, sum)</th>
      <th>(within_days_365, num_75, mean)</th>
      <th>(within_days_365, num_985, sum)</th>
      <th>(within_days_365, num_985, mean)</th>
      <th>(within_days_365, num_100, sum)</th>
      <th>(within_days_365, num_100, mean)</th>
      <th>(within_days_9999, num_unq, sum)</th>
      <th>(within_days_9999, num_unq, mean)</th>
      <th>(within_days_9999, num_unq, count)</th>
      <th>(within_days_9999, total_secs, sum)</th>
      <th>(within_days_9999, total_secs, mean)</th>
      <th>(within_days_9999, num_25, sum)</th>
      <th>(within_days_9999, num_25, mean)</th>
      <th>(within_days_9999, num_50, sum)</th>
      <th>(within_days_9999, num_50, mean)</th>
      <th>(within_days_9999, num_75, sum)</th>
      <th>(within_days_9999, num_75, mean)</th>
      <th>(within_days_9999, num_985, sum)</th>
      <th>(within_days_9999, num_985, mean)</th>
      <th>(within_days_9999, num_100, sum)</th>
      <th>(within_days_9999, num_100, mean)</th>
    </tr>
    <tr>
      <th>msno</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mKfgXQAmVeSKzN4rXW37qz0HbGCuYBspTBM3ONXZudg=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20170120</td>
      <td>0</td>
      <td>2017-02-24</td>
      <td>2017-01-20</td>
      <td>35</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>10.068</td>
      <td>10.068</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1.000000</td>
      <td>1</td>
      <td>10.068</td>
      <td>10.068000</td>
      <td>2</td>
      <td>2.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1</td>
      <td>1.000000</td>
      <td>1</td>
      <td>10.068</td>
      <td>10.068000</td>
      <td>2</td>
      <td>2.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>27</td>
      <td>6.750000</td>
      <td>4</td>
      <td>3158.450</td>
      <td>789.612500</td>
      <td>33</td>
      <td>8.250000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>9</td>
      <td>2.250000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
    </tr>
    <tr>
      <th>AFcKYsrudzim8OFa+fL/c9g5gZabAbhaJnoM0qmlJfo=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20160907</td>
      <td>0</td>
      <td>2017-02-27</td>
      <td>2016-09-07</td>
      <td>173</td>
      <td>21</td>
      <td>21</td>
      <td>1</td>
      <td>2633.631</td>
      <td>2633.631</td>
      <td>13</td>
      <td>13</td>
      <td>3</td>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>8</td>
      <td>8</td>
      <td>228</td>
      <td>32.571429</td>
      <td>7</td>
      <td>32731.138</td>
      <td>4675.876857</td>
      <td>140</td>
      <td>20.000000</td>
      <td>29</td>
      <td>4.142857</td>
      <td>14</td>
      <td>2.000000</td>
      <td>20</td>
      <td>2.857143</td>
      <td>95</td>
      <td>13.571429</td>
      <td>512</td>
      <td>36.571429</td>
      <td>14</td>
      <td>98422.408</td>
      <td>7030.172000</td>
      <td>301</td>
      <td>21.500000</td>
      <td>71</td>
      <td>5.071429</td>
      <td>34</td>
      <td>2.428571</td>
      <td>42</td>
      <td>3.000000</td>
      <td>305</td>
      <td>21.785714</td>
      <td>1044</td>
      <td>36.000000</td>
      <td>29</td>
      <td>178909.861</td>
      <td>6169.305552</td>
      <td>656</td>
      <td>22.620690</td>
      <td>135</td>
      <td>4.655172</td>
      <td>61</td>
      <td>2.103448</td>
      <td>74</td>
      <td>2.551724</td>
      <td>571</td>
      <td>19.689655</td>
      <td>4298</td>
      <td>58.876712</td>
      <td>73</td>
      <td>632743.845</td>
      <td>8667.723904</td>
      <td>2717</td>
      <td>37.219178</td>
      <td>393</td>
      <td>5.383562</td>
      <td>188</td>
      <td>2.575342</td>
      <td>189</td>
      <td>2.589041</td>
      <td>2094</td>
      <td>28.684932</td>
      <td>9218</td>
      <td>59.857143</td>
      <td>154</td>
      <td>1232770.399</td>
      <td>8005.002591</td>
      <td>5289</td>
      <td>34.344156</td>
      <td>838</td>
      <td>5.441558</td>
      <td>410</td>
      <td>2.662338</td>
      <td>323</td>
      <td>2.097403</td>
      <td>4204</td>
      <td>27.298701</td>
      <td>9218</td>
      <td>59.857143</td>
      <td>154</td>
      <td>1232770.399</td>
      <td>8005.002591</td>
      <td>5289</td>
      <td>34.344156</td>
      <td>838</td>
      <td>5.441558</td>
      <td>410</td>
      <td>2.662338</td>
      <td>323</td>
      <td>2.097403</td>
      <td>4204</td>
      <td>27.298701</td>
      <td>9218</td>
      <td>59.857143</td>
      <td>154</td>
      <td>1232770.399</td>
      <td>8005.002591</td>
      <td>5289</td>
      <td>34.344156</td>
      <td>838</td>
      <td>5.441558</td>
      <td>410</td>
      <td>2.662338</td>
      <td>323</td>
      <td>2.097403</td>
      <td>4204</td>
      <td>27.298701</td>
    </tr>
    <tr>
      <th>qk4mEZUYZq+4sQE7bzRYKc5Pvj+Xc7Wmu25DrCzltEU=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20160902</td>
      <td>0</td>
      <td>2017-02-26</td>
      <td>2016-09-02</td>
      <td>177</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>271.093</td>
      <td>271.093</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>243</td>
      <td>34.714286</td>
      <td>7</td>
      <td>60581.740</td>
      <td>8654.534286</td>
      <td>3</td>
      <td>0.428571</td>
      <td>1</td>
      <td>0.142857</td>
      <td>2</td>
      <td>0.285714</td>
      <td>1</td>
      <td>0.142857</td>
      <td>238</td>
      <td>34.000000</td>
      <td>489</td>
      <td>34.928571</td>
      <td>14</td>
      <td>122772.792</td>
      <td>8769.485143</td>
      <td>32</td>
      <td>2.285714</td>
      <td>2</td>
      <td>0.142857</td>
      <td>5</td>
      <td>0.357143</td>
      <td>11</td>
      <td>0.785714</td>
      <td>476</td>
      <td>34.000000</td>
      <td>899</td>
      <td>32.107143</td>
      <td>28</td>
      <td>231622.820</td>
      <td>8272.243571</td>
      <td>73</td>
      <td>2.607143</td>
      <td>7</td>
      <td>0.250000</td>
      <td>11</td>
      <td>0.392857</td>
      <td>14</td>
      <td>0.500000</td>
      <td>893</td>
      <td>31.892857</td>
      <td>2396</td>
      <td>35.235294</td>
      <td>68</td>
      <td>770040.608</td>
      <td>11324.126588</td>
      <td>180</td>
      <td>2.647059</td>
      <td>32</td>
      <td>0.470588</td>
      <td>32</td>
      <td>0.470588</td>
      <td>33</td>
      <td>0.485294</td>
      <td>2953</td>
      <td>43.426471</td>
      <td>3580</td>
      <td>32.844037</td>
      <td>109</td>
      <td>1137009.556</td>
      <td>10431.280330</td>
      <td>423</td>
      <td>3.880734</td>
      <td>72</td>
      <td>0.660550</td>
      <td>58</td>
      <td>0.532110</td>
      <td>58</td>
      <td>0.532110</td>
      <td>4308</td>
      <td>39.522936</td>
      <td>3580</td>
      <td>32.844037</td>
      <td>109</td>
      <td>1137009.556</td>
      <td>10431.280330</td>
      <td>423</td>
      <td>3.880734</td>
      <td>72</td>
      <td>0.660550</td>
      <td>58</td>
      <td>0.532110</td>
      <td>58</td>
      <td>0.532110</td>
      <td>4308</td>
      <td>39.522936</td>
      <td>3580</td>
      <td>32.844037</td>
      <td>109</td>
      <td>1137009.556</td>
      <td>10431.280330</td>
      <td>423</td>
      <td>3.880734</td>
      <td>72</td>
      <td>0.660550</td>
      <td>58</td>
      <td>0.532110</td>
      <td>58</td>
      <td>0.532110</td>
      <td>4308</td>
      <td>39.522936</td>
    </tr>
    <tr>
      <th>G2UGNLph2J6euGmZ7WIa1+Kc+dPZBJI0HbLPu5YtrZw=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20161028</td>
      <td>0</td>
      <td>2017-02-28</td>
      <td>2016-10-28</td>
      <td>123</td>
      <td>17</td>
      <td>17</td>
      <td>1</td>
      <td>1626.704</td>
      <td>1626.704</td>
      <td>15</td>
      <td>15</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>6</td>
      <td>121</td>
      <td>24.200000</td>
      <td>5</td>
      <td>30054.147</td>
      <td>6010.829400</td>
      <td>29</td>
      <td>5.800000</td>
      <td>10</td>
      <td>2.000000</td>
      <td>5</td>
      <td>1.000000</td>
      <td>2</td>
      <td>0.400000</td>
      <td>123</td>
      <td>24.600000</td>
      <td>192</td>
      <td>17.454545</td>
      <td>11</td>
      <td>43518.795</td>
      <td>3956.254091</td>
      <td>44</td>
      <td>4.000000</td>
      <td>11</td>
      <td>1.000000</td>
      <td>7</td>
      <td>0.636364</td>
      <td>7</td>
      <td>0.636364</td>
      <td>174</td>
      <td>15.818182</td>
      <td>457</td>
      <td>17.576923</td>
      <td>26</td>
      <td>111841.140</td>
      <td>4301.582308</td>
      <td>80</td>
      <td>3.076923</td>
      <td>23</td>
      <td>0.884615</td>
      <td>15</td>
      <td>0.576923</td>
      <td>15</td>
      <td>0.576923</td>
      <td>456</td>
      <td>17.538462</td>
      <td>1229</td>
      <td>21.189655</td>
      <td>58</td>
      <td>287422.839</td>
      <td>4955.566190</td>
      <td>203</td>
      <td>3.500000</td>
      <td>81</td>
      <td>1.396552</td>
      <td>55</td>
      <td>0.948276</td>
      <td>60</td>
      <td>1.034483</td>
      <td>1145</td>
      <td>19.741379</td>
      <td>1441</td>
      <td>20.884058</td>
      <td>69</td>
      <td>326268.069</td>
      <td>4728.522739</td>
      <td>247</td>
      <td>3.579710</td>
      <td>115</td>
      <td>1.666667</td>
      <td>74</td>
      <td>1.072464</td>
      <td>76</td>
      <td>1.101449</td>
      <td>1272</td>
      <td>18.434783</td>
      <td>1441</td>
      <td>20.884058</td>
      <td>69</td>
      <td>326268.069</td>
      <td>4728.522739</td>
      <td>247</td>
      <td>3.579710</td>
      <td>115</td>
      <td>1.666667</td>
      <td>74</td>
      <td>1.072464</td>
      <td>76</td>
      <td>1.101449</td>
      <td>1272</td>
      <td>18.434783</td>
      <td>1441</td>
      <td>20.884058</td>
      <td>69</td>
      <td>326268.069</td>
      <td>4728.522739</td>
      <td>247</td>
      <td>3.579710</td>
      <td>115</td>
      <td>1.666667</td>
      <td>74</td>
      <td>1.072464</td>
      <td>76</td>
      <td>1.101449</td>
      <td>1272</td>
      <td>18.434783</td>
    </tr>
    <tr>
      <th>EqSHZpMj5uddJvv2gXcHvuOKFOdS5NN6RalHfzEhhaI=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20161004</td>
      <td>0</td>
      <td>2016-10-26</td>
      <td>2016-10-04</td>
      <td>22</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>156.204</td>
      <td>156.204</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14</td>
      <td>7.000000</td>
      <td>2</td>
      <td>2399.824</td>
      <td>1199.912000</td>
      <td>4</td>
      <td>2.000000</td>
      <td>5</td>
      <td>2.500000</td>
      <td>4</td>
      <td>2.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>5</td>
      <td>2.500000</td>
      <td>17</td>
      <td>4.250000</td>
      <td>4</td>
      <td>2630.818</td>
      <td>657.704500</td>
      <td>5</td>
      <td>1.250000</td>
      <td>7</td>
      <td>1.750000</td>
      <td>4</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>5</td>
      <td>1.250000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
    </tr>
  </tbody>
</table>
</div>

<p>Finally, we'll join in our Transaction features:</p>
<div class="highlight"><pre><span></span><span class="c1"># Joining feature DF&#39;s</span>
<span class="n">df_fa</span> <span class="o">=</span> <span class="n">df_fa</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">transactions_features</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Entries in the DF: &#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_fa</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Features&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_fa</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
<span class="n">df_fa</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">88544 Entries in the DF: </span>
<span class="err">143 Features</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>city</th>
      <th>bd</th>
      <th>gender</th>
      <th>registered_via</th>
      <th>registration_init_time</th>
      <th>is_churn</th>
      <th>(date_features, date, max_date)</th>
      <th>(date_features, date, min_date)</th>
      <th>(date_features, date, listening_tenure)</th>
      <th>(within_days_1, num_unq, sum)</th>
      <th>(within_days_1, num_unq, mean)</th>
      <th>(within_days_1, num_unq, count)</th>
      <th>(within_days_1, total_secs, sum)</th>
      <th>(within_days_1, total_secs, mean)</th>
      <th>(within_days_1, num_25, sum)</th>
      <th>(within_days_1, num_25, mean)</th>
      <th>(within_days_1, num_50, sum)</th>
      <th>(within_days_1, num_50, mean)</th>
      <th>(within_days_1, num_75, sum)</th>
      <th>(within_days_1, num_75, mean)</th>
      <th>(within_days_1, num_985, sum)</th>
      <th>(within_days_1, num_985, mean)</th>
      <th>(within_days_1, num_100, sum)</th>
      <th>(within_days_1, num_100, mean)</th>
      <th>(within_days_7, num_unq, sum)</th>
      <th>(within_days_7, num_unq, mean)</th>
      <th>(within_days_7, num_unq, count)</th>
      <th>(within_days_7, total_secs, sum)</th>
      <th>(within_days_7, total_secs, mean)</th>
      <th>(within_days_7, num_25, sum)</th>
      <th>(within_days_7, num_25, mean)</th>
      <th>(within_days_7, num_50, sum)</th>
      <th>(within_days_7, num_50, mean)</th>
      <th>(within_days_7, num_75, sum)</th>
      <th>(within_days_7, num_75, mean)</th>
      <th>(within_days_7, num_985, sum)</th>
      <th>(within_days_7, num_985, mean)</th>
      <th>(within_days_7, num_100, sum)</th>
      <th>(within_days_7, num_100, mean)</th>
      <th>(within_days_14, num_unq, sum)</th>
      <th>(within_days_14, num_unq, mean)</th>
      <th>(within_days_14, num_unq, count)</th>
      <th>(within_days_14, total_secs, sum)</th>
      <th>(within_days_14, total_secs, mean)</th>
      <th>(within_days_14, num_25, sum)</th>
      <th>(within_days_14, num_25, mean)</th>
      <th>(within_days_14, num_50, sum)</th>
      <th>(within_days_14, num_50, mean)</th>
      <th>(within_days_14, num_75, sum)</th>
      <th>(within_days_14, num_75, mean)</th>
      <th>(within_days_14, num_985, sum)</th>
      <th>(within_days_14, num_985, mean)</th>
      <th>(within_days_14, num_100, sum)</th>
      <th>(within_days_14, num_100, mean)</th>
      <th>(within_days_31, num_unq, sum)</th>
      <th>(within_days_31, num_unq, mean)</th>
      <th>(within_days_31, num_unq, count)</th>
      <th>(within_days_31, total_secs, sum)</th>
      <th>(within_days_31, total_secs, mean)</th>
      <th>(within_days_31, num_25, sum)</th>
      <th>(within_days_31, num_25, mean)</th>
      <th>(within_days_31, num_50, sum)</th>
      <th>(within_days_31, num_50, mean)</th>
      <th>(within_days_31, num_75, sum)</th>
      <th>(within_days_31, num_75, mean)</th>
      <th>(within_days_31, num_985, sum)</th>
      <th>(within_days_31, num_985, mean)</th>
      <th>(within_days_31, num_100, sum)</th>
      <th>(within_days_31, num_100, mean)</th>
      <th>(within_days_90, num_unq, sum)</th>
      <th>(within_days_90, num_unq, mean)</th>
      <th>(within_days_90, num_unq, count)</th>
      <th>(within_days_90, total_secs, sum)</th>
      <th>(within_days_90, total_secs, mean)</th>
      <th>(within_days_90, num_25, sum)</th>
      <th>(within_days_90, num_25, mean)</th>
      <th>(within_days_90, num_50, sum)</th>
      <th>(within_days_90, num_50, mean)</th>
      <th>(within_days_90, num_75, sum)</th>
      <th>(within_days_90, num_75, mean)</th>
      <th>(within_days_90, num_985, sum)</th>
      <th>(within_days_90, num_985, mean)</th>
      <th>(within_days_90, num_100, sum)</th>
      <th>(within_days_90, num_100, mean)</th>
      <th>(within_days_180, num_unq, sum)</th>
      <th>(within_days_180, num_unq, mean)</th>
      <th>(within_days_180, num_unq, count)</th>
      <th>(within_days_180, total_secs, sum)</th>
      <th>(within_days_180, total_secs, mean)</th>
      <th>(within_days_180, num_25, sum)</th>
      <th>(within_days_180, num_25, mean)</th>
      <th>(within_days_180, num_50, sum)</th>
      <th>(within_days_180, num_50, mean)</th>
      <th>(within_days_180, num_75, sum)</th>
      <th>(within_days_180, num_75, mean)</th>
      <th>(within_days_180, num_985, sum)</th>
      <th>(within_days_180, num_985, mean)</th>
      <th>(within_days_180, num_100, sum)</th>
      <th>(within_days_180, num_100, mean)</th>
      <th>(within_days_365, num_unq, sum)</th>
      <th>(within_days_365, num_unq, mean)</th>
      <th>(within_days_365, num_unq, count)</th>
      <th>(within_days_365, total_secs, sum)</th>
      <th>(within_days_365, total_secs, mean)</th>
      <th>(within_days_365, num_25, sum)</th>
      <th>(within_days_365, num_25, mean)</th>
      <th>(within_days_365, num_50, sum)</th>
      <th>(within_days_365, num_50, mean)</th>
      <th>(within_days_365, num_75, sum)</th>
      <th>(within_days_365, num_75, mean)</th>
      <th>(within_days_365, num_985, sum)</th>
      <th>(within_days_365, num_985, mean)</th>
      <th>(within_days_365, num_100, sum)</th>
      <th>(within_days_365, num_100, mean)</th>
      <th>(within_days_9999, num_unq, sum)</th>
      <th>(within_days_9999, num_unq, mean)</th>
      <th>(within_days_9999, num_unq, count)</th>
      <th>(within_days_9999, total_secs, sum)</th>
      <th>(within_days_9999, total_secs, mean)</th>
      <th>(within_days_9999, num_25, sum)</th>
      <th>(within_days_9999, num_25, mean)</th>
      <th>(within_days_9999, num_50, sum)</th>
      <th>(within_days_9999, num_50, mean)</th>
      <th>(within_days_9999, num_75, sum)</th>
      <th>(within_days_9999, num_75, mean)</th>
      <th>(within_days_9999, num_985, sum)</th>
      <th>(within_days_9999, num_985, mean)</th>
      <th>(within_days_9999, num_100, sum)</th>
      <th>(within_days_9999, num_100, mean)</th>
      <th>total_plan_days</th>
      <th>total_amount_paid</th>
      <th>amount_paid_per_day</th>
      <th>diff_renewal_duration</th>
      <th>diff_plan_amount_paid_per_day</th>
      <th>latest_payment_method_id</th>
      <th>latest_plan_days</th>
      <th>latest_plan_list_price</th>
      <th>latest_amount_paid</th>
      <th>latest_auto_renew</th>
      <th>latest_transaction_date</th>
      <th>latest_expire_date</th>
      <th>latest_is_cancel</th>
      <th>latest_amount_paid_per_day</th>
    </tr>
    <tr>
      <th>msno</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mKfgXQAmVeSKzN4rXW37qz0HbGCuYBspTBM3ONXZudg=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20170120</td>
      <td>0</td>
      <td>2017-02-24</td>
      <td>2017-01-20</td>
      <td>35</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>10.068</td>
      <td>10.068</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1.000000</td>
      <td>1</td>
      <td>10.068</td>
      <td>10.068000</td>
      <td>2</td>
      <td>2.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1</td>
      <td>1.000000</td>
      <td>1</td>
      <td>10.068</td>
      <td>10.068000</td>
      <td>2</td>
      <td>2.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>27</td>
      <td>6.750000</td>
      <td>4</td>
      <td>3158.450</td>
      <td>789.612500</td>
      <td>33</td>
      <td>8.250000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>9</td>
      <td>2.250000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>60</td>
      <td>258</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>20170220</td>
      <td>20170319</td>
      <td>0</td>
      <td>4.300000</td>
    </tr>
    <tr>
      <th>AFcKYsrudzim8OFa+fL/c9g5gZabAbhaJnoM0qmlJfo=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20160907</td>
      <td>0</td>
      <td>2017-02-27</td>
      <td>2016-09-07</td>
      <td>173</td>
      <td>21</td>
      <td>21</td>
      <td>1</td>
      <td>2633.631</td>
      <td>2633.631</td>
      <td>13</td>
      <td>13</td>
      <td>3</td>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>8</td>
      <td>8</td>
      <td>228</td>
      <td>32.571429</td>
      <td>7</td>
      <td>32731.138</td>
      <td>4675.876857</td>
      <td>140</td>
      <td>20.000000</td>
      <td>29</td>
      <td>4.142857</td>
      <td>14</td>
      <td>2.000000</td>
      <td>20</td>
      <td>2.857143</td>
      <td>95</td>
      <td>13.571429</td>
      <td>512</td>
      <td>36.571429</td>
      <td>14</td>
      <td>98422.408</td>
      <td>7030.172000</td>
      <td>301</td>
      <td>21.500000</td>
      <td>71</td>
      <td>5.071429</td>
      <td>34</td>
      <td>2.428571</td>
      <td>42</td>
      <td>3.000000</td>
      <td>305</td>
      <td>21.785714</td>
      <td>1044</td>
      <td>36.000000</td>
      <td>29</td>
      <td>178909.861</td>
      <td>6169.305552</td>
      <td>656</td>
      <td>22.620690</td>
      <td>135</td>
      <td>4.655172</td>
      <td>61</td>
      <td>2.103448</td>
      <td>74</td>
      <td>2.551724</td>
      <td>571</td>
      <td>19.689655</td>
      <td>4298</td>
      <td>58.876712</td>
      <td>73</td>
      <td>632743.845</td>
      <td>8667.723904</td>
      <td>2717</td>
      <td>37.219178</td>
      <td>393</td>
      <td>5.383562</td>
      <td>188</td>
      <td>2.575342</td>
      <td>189</td>
      <td>2.589041</td>
      <td>2094</td>
      <td>28.684932</td>
      <td>9218</td>
      <td>59.857143</td>
      <td>154</td>
      <td>1232770.399</td>
      <td>8005.002591</td>
      <td>5289</td>
      <td>34.344156</td>
      <td>838</td>
      <td>5.441558</td>
      <td>410</td>
      <td>2.662338</td>
      <td>323</td>
      <td>2.097403</td>
      <td>4204</td>
      <td>27.298701</td>
      <td>9218</td>
      <td>59.857143</td>
      <td>154</td>
      <td>1232770.399</td>
      <td>8005.002591</td>
      <td>5289</td>
      <td>34.344156</td>
      <td>838</td>
      <td>5.441558</td>
      <td>410</td>
      <td>2.662338</td>
      <td>323</td>
      <td>2.097403</td>
      <td>4204</td>
      <td>27.298701</td>
      <td>9218</td>
      <td>59.857143</td>
      <td>154</td>
      <td>1232770.399</td>
      <td>8005.002591</td>
      <td>5289</td>
      <td>34.344156</td>
      <td>838</td>
      <td>5.441558</td>
      <td>410</td>
      <td>2.662338</td>
      <td>323</td>
      <td>2.097403</td>
      <td>4204</td>
      <td>27.298701</td>
      <td>180</td>
      <td>774</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>20170207</td>
      <td>20170306</td>
      <td>0</td>
      <td>4.300000</td>
    </tr>
    <tr>
      <th>qk4mEZUYZq+4sQE7bzRYKc5Pvj+Xc7Wmu25DrCzltEU=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20160902</td>
      <td>0</td>
      <td>2017-02-26</td>
      <td>2016-09-02</td>
      <td>177</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>271.093</td>
      <td>271.093</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>243</td>
      <td>34.714286</td>
      <td>7</td>
      <td>60581.740</td>
      <td>8654.534286</td>
      <td>3</td>
      <td>0.428571</td>
      <td>1</td>
      <td>0.142857</td>
      <td>2</td>
      <td>0.285714</td>
      <td>1</td>
      <td>0.142857</td>
      <td>238</td>
      <td>34.000000</td>
      <td>489</td>
      <td>34.928571</td>
      <td>14</td>
      <td>122772.792</td>
      <td>8769.485143</td>
      <td>32</td>
      <td>2.285714</td>
      <td>2</td>
      <td>0.142857</td>
      <td>5</td>
      <td>0.357143</td>
      <td>11</td>
      <td>0.785714</td>
      <td>476</td>
      <td>34.000000</td>
      <td>899</td>
      <td>32.107143</td>
      <td>28</td>
      <td>231622.820</td>
      <td>8272.243571</td>
      <td>73</td>
      <td>2.607143</td>
      <td>7</td>
      <td>0.250000</td>
      <td>11</td>
      <td>0.392857</td>
      <td>14</td>
      <td>0.500000</td>
      <td>893</td>
      <td>31.892857</td>
      <td>2396</td>
      <td>35.235294</td>
      <td>68</td>
      <td>770040.608</td>
      <td>11324.126588</td>
      <td>180</td>
      <td>2.647059</td>
      <td>32</td>
      <td>0.470588</td>
      <td>32</td>
      <td>0.470588</td>
      <td>33</td>
      <td>0.485294</td>
      <td>2953</td>
      <td>43.426471</td>
      <td>3580</td>
      <td>32.844037</td>
      <td>109</td>
      <td>1137009.556</td>
      <td>10431.280330</td>
      <td>423</td>
      <td>3.880734</td>
      <td>72</td>
      <td>0.660550</td>
      <td>58</td>
      <td>0.532110</td>
      <td>58</td>
      <td>0.532110</td>
      <td>4308</td>
      <td>39.522936</td>
      <td>3580</td>
      <td>32.844037</td>
      <td>109</td>
      <td>1137009.556</td>
      <td>10431.280330</td>
      <td>423</td>
      <td>3.880734</td>
      <td>72</td>
      <td>0.660550</td>
      <td>58</td>
      <td>0.532110</td>
      <td>58</td>
      <td>0.532110</td>
      <td>4308</td>
      <td>39.522936</td>
      <td>3580</td>
      <td>32.844037</td>
      <td>109</td>
      <td>1137009.556</td>
      <td>10431.280330</td>
      <td>423</td>
      <td>3.880734</td>
      <td>72</td>
      <td>0.660550</td>
      <td>58</td>
      <td>0.532110</td>
      <td>58</td>
      <td>0.532110</td>
      <td>4308</td>
      <td>39.522936</td>
      <td>180</td>
      <td>774</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>20170202</td>
      <td>20170301</td>
      <td>0</td>
      <td>4.300000</td>
    </tr>
    <tr>
      <th>G2UGNLph2J6euGmZ7WIa1+Kc+dPZBJI0HbLPu5YtrZw=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20161028</td>
      <td>0</td>
      <td>2017-02-28</td>
      <td>2016-10-28</td>
      <td>123</td>
      <td>17</td>
      <td>17</td>
      <td>1</td>
      <td>1626.704</td>
      <td>1626.704</td>
      <td>15</td>
      <td>15</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>6</td>
      <td>121</td>
      <td>24.200000</td>
      <td>5</td>
      <td>30054.147</td>
      <td>6010.829400</td>
      <td>29</td>
      <td>5.800000</td>
      <td>10</td>
      <td>2.000000</td>
      <td>5</td>
      <td>1.000000</td>
      <td>2</td>
      <td>0.400000</td>
      <td>123</td>
      <td>24.600000</td>
      <td>192</td>
      <td>17.454545</td>
      <td>11</td>
      <td>43518.795</td>
      <td>3956.254091</td>
      <td>44</td>
      <td>4.000000</td>
      <td>11</td>
      <td>1.000000</td>
      <td>7</td>
      <td>0.636364</td>
      <td>7</td>
      <td>0.636364</td>
      <td>174</td>
      <td>15.818182</td>
      <td>457</td>
      <td>17.576923</td>
      <td>26</td>
      <td>111841.140</td>
      <td>4301.582308</td>
      <td>80</td>
      <td>3.076923</td>
      <td>23</td>
      <td>0.884615</td>
      <td>15</td>
      <td>0.576923</td>
      <td>15</td>
      <td>0.576923</td>
      <td>456</td>
      <td>17.538462</td>
      <td>1229</td>
      <td>21.189655</td>
      <td>58</td>
      <td>287422.839</td>
      <td>4955.566190</td>
      <td>203</td>
      <td>3.500000</td>
      <td>81</td>
      <td>1.396552</td>
      <td>55</td>
      <td>0.948276</td>
      <td>60</td>
      <td>1.034483</td>
      <td>1145</td>
      <td>19.741379</td>
      <td>1441</td>
      <td>20.884058</td>
      <td>69</td>
      <td>326268.069</td>
      <td>4728.522739</td>
      <td>247</td>
      <td>3.579710</td>
      <td>115</td>
      <td>1.666667</td>
      <td>74</td>
      <td>1.072464</td>
      <td>76</td>
      <td>1.101449</td>
      <td>1272</td>
      <td>18.434783</td>
      <td>1441</td>
      <td>20.884058</td>
      <td>69</td>
      <td>326268.069</td>
      <td>4728.522739</td>
      <td>247</td>
      <td>3.579710</td>
      <td>115</td>
      <td>1.666667</td>
      <td>74</td>
      <td>1.072464</td>
      <td>76</td>
      <td>1.101449</td>
      <td>1272</td>
      <td>18.434783</td>
      <td>1441</td>
      <td>20.884058</td>
      <td>69</td>
      <td>326268.069</td>
      <td>4728.522739</td>
      <td>247</td>
      <td>3.579710</td>
      <td>115</td>
      <td>1.666667</td>
      <td>74</td>
      <td>1.072464</td>
      <td>76</td>
      <td>1.101449</td>
      <td>1272</td>
      <td>18.434783</td>
      <td>150</td>
      <td>596</td>
      <td>3.973333</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>20170228</td>
      <td>20170327</td>
      <td>0</td>
      <td>4.966667</td>
    </tr>
    <tr>
      <th>EqSHZpMj5uddJvv2gXcHvuOKFOdS5NN6RalHfzEhhaI=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20161004</td>
      <td>0</td>
      <td>2016-10-26</td>
      <td>2016-10-04</td>
      <td>22</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>156.204</td>
      <td>156.204</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14</td>
      <td>7.000000</td>
      <td>2</td>
      <td>2399.824</td>
      <td>1199.912000</td>
      <td>4</td>
      <td>2.000000</td>
      <td>5</td>
      <td>2.500000</td>
      <td>4</td>
      <td>2.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>5</td>
      <td>2.500000</td>
      <td>17</td>
      <td>4.250000</td>
      <td>4</td>
      <td>2630.818</td>
      <td>657.704500</td>
      <td>5</td>
      <td>1.250000</td>
      <td>7</td>
      <td>1.750000</td>
      <td>4</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>5</td>
      <td>1.250000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>150</td>
      <td>645</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>20170204</td>
      <td>20170303</td>
      <td>0</td>
      <td>4.300000</td>
    </tr>
  </tbody>
</table>
</div>

<h2>Data Manipulation</h2>
<p>Having joined all the features into a single file, we will now perform some data manipulation tasks to prepare the table for predictive modeling.</p>
<p>First, we will fix the column headers:</p>
<div class="highlight"><pre><span></span><span class="c1">#Fix column headers</span>
<span class="n">df_fa</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df_fa</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">)</span>
<span class="n">df_fa</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>city</th>
      <th>bd</th>
      <th>gender</th>
      <th>registered_via</th>
      <th>registration_init_time</th>
      <th>is_churn</th>
      <th>date_featuresdatemax_date</th>
      <th>date_featuresdatemin_date</th>
      <th>date_featuresdatelistening_tenure</th>
      <th>within_days_1num_unqsum</th>
      <th>within_days_1num_unqmean</th>
      <th>within_days_1num_unqcount</th>
      <th>within_days_1total_secssum</th>
      <th>within_days_1total_secsmean</th>
      <th>within_days_1num_25sum</th>
      <th>within_days_1num_25mean</th>
      <th>within_days_1num_50sum</th>
      <th>within_days_1num_50mean</th>
      <th>within_days_1num_75sum</th>
      <th>within_days_1num_75mean</th>
      <th>within_days_1num_985sum</th>
      <th>within_days_1num_985mean</th>
      <th>within_days_1num_100sum</th>
      <th>within_days_1num_100mean</th>
      <th>within_days_7num_unqsum</th>
      <th>within_days_7num_unqmean</th>
      <th>within_days_7num_unqcount</th>
      <th>within_days_7total_secssum</th>
      <th>within_days_7total_secsmean</th>
      <th>within_days_7num_25sum</th>
      <th>within_days_7num_25mean</th>
      <th>within_days_7num_50sum</th>
      <th>within_days_7num_50mean</th>
      <th>within_days_7num_75sum</th>
      <th>within_days_7num_75mean</th>
      <th>within_days_7num_985sum</th>
      <th>within_days_7num_985mean</th>
      <th>within_days_7num_100sum</th>
      <th>within_days_7num_100mean</th>
      <th>within_days_14num_unqsum</th>
      <th>within_days_14num_unqmean</th>
      <th>within_days_14num_unqcount</th>
      <th>within_days_14total_secssum</th>
      <th>within_days_14total_secsmean</th>
      <th>within_days_14num_25sum</th>
      <th>within_days_14num_25mean</th>
      <th>within_days_14num_50sum</th>
      <th>within_days_14num_50mean</th>
      <th>within_days_14num_75sum</th>
      <th>within_days_14num_75mean</th>
      <th>within_days_14num_985sum</th>
      <th>within_days_14num_985mean</th>
      <th>within_days_14num_100sum</th>
      <th>within_days_14num_100mean</th>
      <th>within_days_31num_unqsum</th>
      <th>within_days_31num_unqmean</th>
      <th>within_days_31num_unqcount</th>
      <th>within_days_31total_secssum</th>
      <th>within_days_31total_secsmean</th>
      <th>within_days_31num_25sum</th>
      <th>within_days_31num_25mean</th>
      <th>within_days_31num_50sum</th>
      <th>within_days_31num_50mean</th>
      <th>within_days_31num_75sum</th>
      <th>within_days_31num_75mean</th>
      <th>within_days_31num_985sum</th>
      <th>within_days_31num_985mean</th>
      <th>within_days_31num_100sum</th>
      <th>within_days_31num_100mean</th>
      <th>within_days_90num_unqsum</th>
      <th>within_days_90num_unqmean</th>
      <th>within_days_90num_unqcount</th>
      <th>within_days_90total_secssum</th>
      <th>within_days_90total_secsmean</th>
      <th>within_days_90num_25sum</th>
      <th>within_days_90num_25mean</th>
      <th>within_days_90num_50sum</th>
      <th>within_days_90num_50mean</th>
      <th>within_days_90num_75sum</th>
      <th>within_days_90num_75mean</th>
      <th>within_days_90num_985sum</th>
      <th>within_days_90num_985mean</th>
      <th>within_days_90num_100sum</th>
      <th>within_days_90num_100mean</th>
      <th>within_days_180num_unqsum</th>
      <th>within_days_180num_unqmean</th>
      <th>within_days_180num_unqcount</th>
      <th>within_days_180total_secssum</th>
      <th>within_days_180total_secsmean</th>
      <th>within_days_180num_25sum</th>
      <th>within_days_180num_25mean</th>
      <th>within_days_180num_50sum</th>
      <th>within_days_180num_50mean</th>
      <th>within_days_180num_75sum</th>
      <th>within_days_180num_75mean</th>
      <th>within_days_180num_985sum</th>
      <th>within_days_180num_985mean</th>
      <th>within_days_180num_100sum</th>
      <th>within_days_180num_100mean</th>
      <th>within_days_365num_unqsum</th>
      <th>within_days_365num_unqmean</th>
      <th>within_days_365num_unqcount</th>
      <th>within_days_365total_secssum</th>
      <th>within_days_365total_secsmean</th>
      <th>within_days_365num_25sum</th>
      <th>within_days_365num_25mean</th>
      <th>within_days_365num_50sum</th>
      <th>within_days_365num_50mean</th>
      <th>within_days_365num_75sum</th>
      <th>within_days_365num_75mean</th>
      <th>within_days_365num_985sum</th>
      <th>within_days_365num_985mean</th>
      <th>within_days_365num_100sum</th>
      <th>within_days_365num_100mean</th>
      <th>within_days_9999num_unqsum</th>
      <th>within_days_9999num_unqmean</th>
      <th>within_days_9999num_unqcount</th>
      <th>within_days_9999total_secssum</th>
      <th>within_days_9999total_secsmean</th>
      <th>within_days_9999num_25sum</th>
      <th>within_days_9999num_25mean</th>
      <th>within_days_9999num_50sum</th>
      <th>within_days_9999num_50mean</th>
      <th>within_days_9999num_75sum</th>
      <th>within_days_9999num_75mean</th>
      <th>within_days_9999num_985sum</th>
      <th>within_days_9999num_985mean</th>
      <th>within_days_9999num_100sum</th>
      <th>within_days_9999num_100mean</th>
      <th>total_plan_days</th>
      <th>total_amount_paid</th>
      <th>amount_paid_per_day</th>
      <th>diff_renewal_duration</th>
      <th>diff_plan_amount_paid_per_day</th>
      <th>latest_payment_method_id</th>
      <th>latest_plan_days</th>
      <th>latest_plan_list_price</th>
      <th>latest_amount_paid</th>
      <th>latest_auto_renew</th>
      <th>latest_transaction_date</th>
      <th>latest_expire_date</th>
      <th>latest_is_cancel</th>
      <th>latest_amount_paid_per_day</th>
    </tr>
    <tr>
      <th>msno</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mKfgXQAmVeSKzN4rXW37qz0HbGCuYBspTBM3ONXZudg=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20170120</td>
      <td>0</td>
      <td>2017-02-24</td>
      <td>2017-01-20</td>
      <td>35</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>10.068</td>
      <td>10.068</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1.000000</td>
      <td>1</td>
      <td>10.068</td>
      <td>10.068000</td>
      <td>2</td>
      <td>2.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1</td>
      <td>1.000000</td>
      <td>1</td>
      <td>10.068</td>
      <td>10.068000</td>
      <td>2</td>
      <td>2.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>27</td>
      <td>6.750000</td>
      <td>4</td>
      <td>3158.450</td>
      <td>789.612500</td>
      <td>33</td>
      <td>8.250000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>9</td>
      <td>2.250000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>60</td>
      <td>258</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>20170220</td>
      <td>20170319</td>
      <td>0</td>
      <td>4.300000</td>
    </tr>
    <tr>
      <th>AFcKYsrudzim8OFa+fL/c9g5gZabAbhaJnoM0qmlJfo=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20160907</td>
      <td>0</td>
      <td>2017-02-27</td>
      <td>2016-09-07</td>
      <td>173</td>
      <td>21</td>
      <td>21</td>
      <td>1</td>
      <td>2633.631</td>
      <td>2633.631</td>
      <td>13</td>
      <td>13</td>
      <td>3</td>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>8</td>
      <td>8</td>
      <td>228</td>
      <td>32.571429</td>
      <td>7</td>
      <td>32731.138</td>
      <td>4675.876857</td>
      <td>140</td>
      <td>20.000000</td>
      <td>29</td>
      <td>4.142857</td>
      <td>14</td>
      <td>2.000000</td>
      <td>20</td>
      <td>2.857143</td>
      <td>95</td>
      <td>13.571429</td>
      <td>512</td>
      <td>36.571429</td>
      <td>14</td>
      <td>98422.408</td>
      <td>7030.172000</td>
      <td>301</td>
      <td>21.500000</td>
      <td>71</td>
      <td>5.071429</td>
      <td>34</td>
      <td>2.428571</td>
      <td>42</td>
      <td>3.000000</td>
      <td>305</td>
      <td>21.785714</td>
      <td>1044</td>
      <td>36.000000</td>
      <td>29</td>
      <td>178909.861</td>
      <td>6169.305552</td>
      <td>656</td>
      <td>22.620690</td>
      <td>135</td>
      <td>4.655172</td>
      <td>61</td>
      <td>2.103448</td>
      <td>74</td>
      <td>2.551724</td>
      <td>571</td>
      <td>19.689655</td>
      <td>4298</td>
      <td>58.876712</td>
      <td>73</td>
      <td>632743.845</td>
      <td>8667.723904</td>
      <td>2717</td>
      <td>37.219178</td>
      <td>393</td>
      <td>5.383562</td>
      <td>188</td>
      <td>2.575342</td>
      <td>189</td>
      <td>2.589041</td>
      <td>2094</td>
      <td>28.684932</td>
      <td>9218</td>
      <td>59.857143</td>
      <td>154</td>
      <td>1232770.399</td>
      <td>8005.002591</td>
      <td>5289</td>
      <td>34.344156</td>
      <td>838</td>
      <td>5.441558</td>
      <td>410</td>
      <td>2.662338</td>
      <td>323</td>
      <td>2.097403</td>
      <td>4204</td>
      <td>27.298701</td>
      <td>9218</td>
      <td>59.857143</td>
      <td>154</td>
      <td>1232770.399</td>
      <td>8005.002591</td>
      <td>5289</td>
      <td>34.344156</td>
      <td>838</td>
      <td>5.441558</td>
      <td>410</td>
      <td>2.662338</td>
      <td>323</td>
      <td>2.097403</td>
      <td>4204</td>
      <td>27.298701</td>
      <td>9218</td>
      <td>59.857143</td>
      <td>154</td>
      <td>1232770.399</td>
      <td>8005.002591</td>
      <td>5289</td>
      <td>34.344156</td>
      <td>838</td>
      <td>5.441558</td>
      <td>410</td>
      <td>2.662338</td>
      <td>323</td>
      <td>2.097403</td>
      <td>4204</td>
      <td>27.298701</td>
      <td>180</td>
      <td>774</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>20170207</td>
      <td>20170306</td>
      <td>0</td>
      <td>4.300000</td>
    </tr>
    <tr>
      <th>qk4mEZUYZq+4sQE7bzRYKc5Pvj+Xc7Wmu25DrCzltEU=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20160902</td>
      <td>0</td>
      <td>2017-02-26</td>
      <td>2016-09-02</td>
      <td>177</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>271.093</td>
      <td>271.093</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>243</td>
      <td>34.714286</td>
      <td>7</td>
      <td>60581.740</td>
      <td>8654.534286</td>
      <td>3</td>
      <td>0.428571</td>
      <td>1</td>
      <td>0.142857</td>
      <td>2</td>
      <td>0.285714</td>
      <td>1</td>
      <td>0.142857</td>
      <td>238</td>
      <td>34.000000</td>
      <td>489</td>
      <td>34.928571</td>
      <td>14</td>
      <td>122772.792</td>
      <td>8769.485143</td>
      <td>32</td>
      <td>2.285714</td>
      <td>2</td>
      <td>0.142857</td>
      <td>5</td>
      <td>0.357143</td>
      <td>11</td>
      <td>0.785714</td>
      <td>476</td>
      <td>34.000000</td>
      <td>899</td>
      <td>32.107143</td>
      <td>28</td>
      <td>231622.820</td>
      <td>8272.243571</td>
      <td>73</td>
      <td>2.607143</td>
      <td>7</td>
      <td>0.250000</td>
      <td>11</td>
      <td>0.392857</td>
      <td>14</td>
      <td>0.500000</td>
      <td>893</td>
      <td>31.892857</td>
      <td>2396</td>
      <td>35.235294</td>
      <td>68</td>
      <td>770040.608</td>
      <td>11324.126588</td>
      <td>180</td>
      <td>2.647059</td>
      <td>32</td>
      <td>0.470588</td>
      <td>32</td>
      <td>0.470588</td>
      <td>33</td>
      <td>0.485294</td>
      <td>2953</td>
      <td>43.426471</td>
      <td>3580</td>
      <td>32.844037</td>
      <td>109</td>
      <td>1137009.556</td>
      <td>10431.280330</td>
      <td>423</td>
      <td>3.880734</td>
      <td>72</td>
      <td>0.660550</td>
      <td>58</td>
      <td>0.532110</td>
      <td>58</td>
      <td>0.532110</td>
      <td>4308</td>
      <td>39.522936</td>
      <td>3580</td>
      <td>32.844037</td>
      <td>109</td>
      <td>1137009.556</td>
      <td>10431.280330</td>
      <td>423</td>
      <td>3.880734</td>
      <td>72</td>
      <td>0.660550</td>
      <td>58</td>
      <td>0.532110</td>
      <td>58</td>
      <td>0.532110</td>
      <td>4308</td>
      <td>39.522936</td>
      <td>3580</td>
      <td>32.844037</td>
      <td>109</td>
      <td>1137009.556</td>
      <td>10431.280330</td>
      <td>423</td>
      <td>3.880734</td>
      <td>72</td>
      <td>0.660550</td>
      <td>58</td>
      <td>0.532110</td>
      <td>58</td>
      <td>0.532110</td>
      <td>4308</td>
      <td>39.522936</td>
      <td>180</td>
      <td>774</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>20170202</td>
      <td>20170301</td>
      <td>0</td>
      <td>4.300000</td>
    </tr>
    <tr>
      <th>G2UGNLph2J6euGmZ7WIa1+Kc+dPZBJI0HbLPu5YtrZw=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20161028</td>
      <td>0</td>
      <td>2017-02-28</td>
      <td>2016-10-28</td>
      <td>123</td>
      <td>17</td>
      <td>17</td>
      <td>1</td>
      <td>1626.704</td>
      <td>1626.704</td>
      <td>15</td>
      <td>15</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>6</td>
      <td>121</td>
      <td>24.200000</td>
      <td>5</td>
      <td>30054.147</td>
      <td>6010.829400</td>
      <td>29</td>
      <td>5.800000</td>
      <td>10</td>
      <td>2.000000</td>
      <td>5</td>
      <td>1.000000</td>
      <td>2</td>
      <td>0.400000</td>
      <td>123</td>
      <td>24.600000</td>
      <td>192</td>
      <td>17.454545</td>
      <td>11</td>
      <td>43518.795</td>
      <td>3956.254091</td>
      <td>44</td>
      <td>4.000000</td>
      <td>11</td>
      <td>1.000000</td>
      <td>7</td>
      <td>0.636364</td>
      <td>7</td>
      <td>0.636364</td>
      <td>174</td>
      <td>15.818182</td>
      <td>457</td>
      <td>17.576923</td>
      <td>26</td>
      <td>111841.140</td>
      <td>4301.582308</td>
      <td>80</td>
      <td>3.076923</td>
      <td>23</td>
      <td>0.884615</td>
      <td>15</td>
      <td>0.576923</td>
      <td>15</td>
      <td>0.576923</td>
      <td>456</td>
      <td>17.538462</td>
      <td>1229</td>
      <td>21.189655</td>
      <td>58</td>
      <td>287422.839</td>
      <td>4955.566190</td>
      <td>203</td>
      <td>3.500000</td>
      <td>81</td>
      <td>1.396552</td>
      <td>55</td>
      <td>0.948276</td>
      <td>60</td>
      <td>1.034483</td>
      <td>1145</td>
      <td>19.741379</td>
      <td>1441</td>
      <td>20.884058</td>
      <td>69</td>
      <td>326268.069</td>
      <td>4728.522739</td>
      <td>247</td>
      <td>3.579710</td>
      <td>115</td>
      <td>1.666667</td>
      <td>74</td>
      <td>1.072464</td>
      <td>76</td>
      <td>1.101449</td>
      <td>1272</td>
      <td>18.434783</td>
      <td>1441</td>
      <td>20.884058</td>
      <td>69</td>
      <td>326268.069</td>
      <td>4728.522739</td>
      <td>247</td>
      <td>3.579710</td>
      <td>115</td>
      <td>1.666667</td>
      <td>74</td>
      <td>1.072464</td>
      <td>76</td>
      <td>1.101449</td>
      <td>1272</td>
      <td>18.434783</td>
      <td>1441</td>
      <td>20.884058</td>
      <td>69</td>
      <td>326268.069</td>
      <td>4728.522739</td>
      <td>247</td>
      <td>3.579710</td>
      <td>115</td>
      <td>1.666667</td>
      <td>74</td>
      <td>1.072464</td>
      <td>76</td>
      <td>1.101449</td>
      <td>1272</td>
      <td>18.434783</td>
      <td>150</td>
      <td>596</td>
      <td>3.973333</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>20170228</td>
      <td>20170327</td>
      <td>0</td>
      <td>4.966667</td>
    </tr>
    <tr>
      <th>EqSHZpMj5uddJvv2gXcHvuOKFOdS5NN6RalHfzEhhaI=</th>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>13</td>
      <td>20161004</td>
      <td>0</td>
      <td>2016-10-26</td>
      <td>2016-10-04</td>
      <td>22</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>156.204</td>
      <td>156.204</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14</td>
      <td>7.000000</td>
      <td>2</td>
      <td>2399.824</td>
      <td>1199.912000</td>
      <td>4</td>
      <td>2.000000</td>
      <td>5</td>
      <td>2.500000</td>
      <td>4</td>
      <td>2.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>5</td>
      <td>2.500000</td>
      <td>17</td>
      <td>4.250000</td>
      <td>4</td>
      <td>2630.818</td>
      <td>657.704500</td>
      <td>5</td>
      <td>1.250000</td>
      <td>7</td>
      <td>1.750000</td>
      <td>4</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>5</td>
      <td>1.250000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>150</td>
      <td>645</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>20170204</td>
      <td>20170303</td>
      <td>0</td>
      <td>4.300000</td>
    </tr>
  </tbody>
</table>
</div>

<p>Next, we will change infinite and 'na' values to -9999, wildly different than other values in the range, so that our algorithms see them as 'different'.</p>
<div class="highlight"><pre><span></span><span class="c1">#Handle bad values</span>
<span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;amount_paid_per_day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="o">-</span><span class="mi">9999</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;latest_amount_paid_per_day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="o">-</span><span class="mi">9999</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;diff_plan_amount_paid_per_day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="o">-</span><span class="mi">9999</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;diff_plan_amount_paid_per_day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_fa</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">city                                 False</span>
<span class="err">bd                                   False</span>
<span class="err">gender                                True</span>
<span class="err">registered_via                       False</span>
<span class="err">registration_init_time               False</span>
<span class="err">is_churn                             False</span>
<span class="err">date_featuresdatemax_date            False</span>
<span class="err">date_featuresdatemin_date            False</span>
<span class="err">date_featuresdatelistening_tenure    False</span>
<span class="err">within_days_1num_unqsum              False</span>
<span class="err">within_days_1num_unqmean             False</span>
<span class="err">within_days_1num_unqcount            False</span>
<span class="err">within_days_1total_secssum           False</span>
<span class="err">within_days_1total_secsmean          False</span>
<span class="err">within_days_1num_25sum               False</span>
<span class="err">within_days_1num_25mean              False</span>
<span class="err">within_days_1num_50sum               False</span>
<span class="err">within_days_1num_50mean              False</span>
<span class="err">within_days_1num_75sum               False</span>
<span class="err">within_days_1num_75mean              False</span>
<span class="err">within_days_1num_985sum              False</span>
<span class="err">within_days_1num_985mean             False</span>
<span class="err">within_days_1num_100sum              False</span>
<span class="err">within_days_1num_100mean             False</span>
<span class="err">within_days_7num_unqsum              False</span>
<span class="err">within_days_7num_unqmean             False</span>
<span class="err">within_days_7num_unqcount            False</span>
<span class="err">within_days_7total_secssum           False</span>
<span class="err">within_days_7total_secsmean          False</span>
<span class="err">within_days_7num_25sum               False</span>
<span class="err">within_days_7num_25mean              False</span>
<span class="err">within_days_7num_50sum               False</span>
<span class="err">within_days_7num_50mean              False</span>
<span class="err">within_days_7num_75sum               False</span>
<span class="err">within_days_7num_75mean              False</span>
<span class="err">within_days_7num_985sum              False</span>
<span class="err">within_days_7num_985mean             False</span>
<span class="err">within_days_7num_100sum              False</span>
<span class="err">within_days_7num_100mean             False</span>
<span class="err">within_days_14num_unqsum             False</span>
<span class="err">within_days_14num_unqmean            False</span>
<span class="err">within_days_14num_unqcount           False</span>
<span class="err">within_days_14total_secssum          False</span>
<span class="err">within_days_14total_secsmean         False</span>
<span class="err">within_days_14num_25sum              False</span>
<span class="err">within_days_14num_25mean             False</span>
<span class="err">within_days_14num_50sum              False</span>
<span class="err">within_days_14num_50mean             False</span>
<span class="err">within_days_14num_75sum              False</span>
<span class="err">within_days_14num_75mean             False</span>
<span class="err">within_days_14num_985sum             False</span>
<span class="err">within_days_14num_985mean            False</span>
<span class="err">within_days_14num_100sum             False</span>
<span class="err">within_days_14num_100mean            False</span>
<span class="err">within_days_31num_unqsum             False</span>
<span class="err">within_days_31num_unqmean            False</span>
<span class="err">within_days_31num_unqcount           False</span>
<span class="err">within_days_31total_secssum          False</span>
<span class="err">within_days_31total_secsmean         False</span>
<span class="err">within_days_31num_25sum              False</span>
<span class="err">within_days_31num_25mean             False</span>
<span class="err">within_days_31num_50sum              False</span>
<span class="err">within_days_31num_50mean             False</span>
<span class="err">within_days_31num_75sum              False</span>
<span class="err">within_days_31num_75mean             False</span>
<span class="err">within_days_31num_985sum             False</span>
<span class="err">within_days_31num_985mean            False</span>
<span class="err">within_days_31num_100sum             False</span>
<span class="err">within_days_31num_100mean            False</span>
<span class="err">within_days_90num_unqsum             False</span>
<span class="err">within_days_90num_unqmean            False</span>
<span class="err">within_days_90num_unqcount           False</span>
<span class="err">within_days_90total_secssum          False</span>
<span class="err">within_days_90total_secsmean         False</span>
<span class="err">within_days_90num_25sum              False</span>
<span class="err">within_days_90num_25mean             False</span>
<span class="err">within_days_90num_50sum              False</span>
<span class="err">within_days_90num_50mean             False</span>
<span class="err">within_days_90num_75sum              False</span>
<span class="err">within_days_90num_75mean             False</span>
<span class="err">within_days_90num_985sum             False</span>
<span class="err">within_days_90num_985mean            False</span>
<span class="err">within_days_90num_100sum             False</span>
<span class="err">within_days_90num_100mean            False</span>
<span class="err">within_days_180num_unqsum            False</span>
<span class="err">within_days_180num_unqmean           False</span>
<span class="err">within_days_180num_unqcount          False</span>
<span class="err">within_days_180total_secssum         False</span>
<span class="err">within_days_180total_secsmean        False</span>
<span class="err">within_days_180num_25sum             False</span>
<span class="err">within_days_180num_25mean            False</span>
<span class="err">within_days_180num_50sum             False</span>
<span class="err">within_days_180num_50mean            False</span>
<span class="err">within_days_180num_75sum             False</span>
<span class="err">within_days_180num_75mean            False</span>
<span class="err">within_days_180num_985sum            False</span>
<span class="err">within_days_180num_985mean           False</span>
<span class="err">within_days_180num_100sum            False</span>
<span class="err">within_days_180num_100mean           False</span>
<span class="err">within_days_365num_unqsum            False</span>
<span class="err">within_days_365num_unqmean           False</span>
<span class="err">within_days_365num_unqcount          False</span>
<span class="err">within_days_365total_secssum         False</span>
<span class="err">within_days_365total_secsmean        False</span>
<span class="err">within_days_365num_25sum             False</span>
<span class="err">within_days_365num_25mean            False</span>
<span class="err">within_days_365num_50sum             False</span>
<span class="err">within_days_365num_50mean            False</span>
<span class="err">within_days_365num_75sum             False</span>
<span class="err">within_days_365num_75mean            False</span>
<span class="err">within_days_365num_985sum            False</span>
<span class="err">within_days_365num_985mean           False</span>
<span class="err">within_days_365num_100sum            False</span>
<span class="err">within_days_365num_100mean           False</span>
<span class="err">within_days_9999num_unqsum           False</span>
<span class="err">within_days_9999num_unqmean          False</span>
<span class="err">within_days_9999num_unqcount         False</span>
<span class="err">within_days_9999total_secssum        False</span>
<span class="err">within_days_9999total_secsmean       False</span>
<span class="err">within_days_9999num_25sum            False</span>
<span class="err">within_days_9999num_25mean           False</span>
<span class="err">within_days_9999num_50sum            False</span>
<span class="err">within_days_9999num_50mean           False</span>
<span class="err">within_days_9999num_75sum            False</span>
<span class="err">within_days_9999num_75mean           False</span>
<span class="err">within_days_9999num_985sum           False</span>
<span class="err">within_days_9999num_985mean          False</span>
<span class="err">within_days_9999num_100sum           False</span>
<span class="err">within_days_9999num_100mean          False</span>
<span class="err">total_plan_days                      False</span>
<span class="err">total_amount_paid                    False</span>
<span class="err">amount_paid_per_day                  False</span>
<span class="err">diff_renewal_duration                False</span>
<span class="err">diff_plan_amount_paid_per_day        False</span>
<span class="err">latest_payment_method_id             False</span>
<span class="err">latest_plan_days                     False</span>
<span class="err">latest_plan_list_price               False</span>
<span class="err">latest_amount_paid                   False</span>
<span class="err">latest_auto_renew                    False</span>
<span class="err">latest_transaction_date              False</span>
<span class="err">latest_expire_date                   False</span>
<span class="err">latest_is_cancel                     False</span>
<span class="err">latest_amount_paid_per_day           False</span>
<span class="c">dtype: bool</span>
</pre></div>


<p>The cell above uploads verifies we have no null values in our data.</p>
<p>Now let's inspect our data types:</p>
<div class="highlight"><pre><span></span><span class="n">df_fa</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">city</span><span class="w">                                          </span><span class="n">int64</span><span class="w"></span>
<span class="n">bd</span><span class="w">                                            </span><span class="n">int64</span><span class="w"></span>
<span class="n">gender</span><span class="w">                                       </span><span class="k">object</span><span class="w"></span>
<span class="n">registered_via</span><span class="w">                                </span><span class="n">int64</span><span class="w"></span>
<span class="n">registration_init_time</span><span class="w">                        </span><span class="n">int64</span><span class="w"></span>
<span class="n">is_churn</span><span class="w">                                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">date_featuresdatemax_date</span><span class="w">            </span><span class="n">datetime64</span><span class="o">[</span><span class="n">ns</span><span class="o">]</span><span class="w"></span>
<span class="n">date_featuresdatemin_date</span><span class="w">            </span><span class="n">datetime64</span><span class="o">[</span><span class="n">ns</span><span class="o">]</span><span class="w"></span>
<span class="n">date_featuresdatelistening_tenure</span><span class="w">             </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_1num_unqsum</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_1num_unqmean</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_1num_unqcount</span><span class="w">                     </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_1total_secssum</span><span class="w">                  </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_1total_secsmean</span><span class="w">                 </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_1num_25sum</span><span class="w">                        </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_1num_25mean</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_1num_50sum</span><span class="w">                        </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_1num_50mean</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_1num_75sum</span><span class="w">                        </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_1num_75mean</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_1num_985sum</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_1num_985mean</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_1num_100sum</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_1num_100mean</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_7num_unqsum</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_7num_unqmean</span><span class="w">                    </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_7num_unqcount</span><span class="w">                     </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_7total_secssum</span><span class="w">                  </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_7total_secsmean</span><span class="w">                 </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_7num_25sum</span><span class="w">                        </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_7num_25mean</span><span class="w">                     </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_7num_50sum</span><span class="w">                        </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_7num_50mean</span><span class="w">                     </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_7num_75sum</span><span class="w">                        </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_7num_75mean</span><span class="w">                     </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_7num_985sum</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_7num_985mean</span><span class="w">                    </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_7num_100sum</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_7num_100mean</span><span class="w">                    </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_14num_unqsum</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_14num_unqmean</span><span class="w">                   </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_14num_unqcount</span><span class="w">                    </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_14total_secssum</span><span class="w">                 </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_14total_secsmean</span><span class="w">                </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_14num_25sum</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_14num_25mean</span><span class="w">                    </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_14num_50sum</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_14num_50mean</span><span class="w">                    </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_14num_75sum</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_14num_75mean</span><span class="w">                    </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_14num_985sum</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_14num_985mean</span><span class="w">                   </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_14num_100sum</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_14num_100mean</span><span class="w">                   </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_31num_unqsum</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_31num_unqmean</span><span class="w">                   </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_31num_unqcount</span><span class="w">                    </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_31total_secssum</span><span class="w">                 </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_31total_secsmean</span><span class="w">                </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_31num_25sum</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_31num_25mean</span><span class="w">                    </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_31num_50sum</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_31num_50mean</span><span class="w">                    </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_31num_75sum</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_31num_75mean</span><span class="w">                    </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_31num_985sum</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_31num_985mean</span><span class="w">                   </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_31num_100sum</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_31num_100mean</span><span class="w">                   </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_90num_unqsum</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_90num_unqmean</span><span class="w">                   </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_90num_unqcount</span><span class="w">                    </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_90total_secssum</span><span class="w">                 </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_90total_secsmean</span><span class="w">                </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_90num_25sum</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_90num_25mean</span><span class="w">                    </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_90num_50sum</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_90num_50mean</span><span class="w">                    </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_90num_75sum</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_90num_75mean</span><span class="w">                    </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_90num_985sum</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_90num_985mean</span><span class="w">                   </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_90num_100sum</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_90num_100mean</span><span class="w">                   </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_180num_unqsum</span><span class="w">                     </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_180num_unqmean</span><span class="w">                  </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_180num_unqcount</span><span class="w">                   </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_180total_secssum</span><span class="w">                </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_180total_secsmean</span><span class="w">               </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_180num_25sum</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_180num_25mean</span><span class="w">                   </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_180num_50sum</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_180num_50mean</span><span class="w">                   </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_180num_75sum</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_180num_75mean</span><span class="w">                   </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_180num_985sum</span><span class="w">                     </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_180num_985mean</span><span class="w">                  </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_180num_100sum</span><span class="w">                     </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_180num_100mean</span><span class="w">                  </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_365num_unqsum</span><span class="w">                     </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_365num_unqmean</span><span class="w">                  </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_365num_unqcount</span><span class="w">                   </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_365total_secssum</span><span class="w">                </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_365total_secsmean</span><span class="w">               </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_365num_25sum</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_365num_25mean</span><span class="w">                   </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_365num_50sum</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_365num_50mean</span><span class="w">                   </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_365num_75sum</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_365num_75mean</span><span class="w">                   </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_365num_985sum</span><span class="w">                     </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_365num_985mean</span><span class="w">                  </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_365num_100sum</span><span class="w">                     </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_365num_100mean</span><span class="w">                  </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_9999num_unqsum</span><span class="w">                    </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_9999num_unqmean</span><span class="w">                 </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_9999num_unqcount</span><span class="w">                  </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_9999total_secssum</span><span class="w">               </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_9999total_secsmean</span><span class="w">              </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_9999num_25sum</span><span class="w">                     </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_9999num_25mean</span><span class="w">                  </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_9999num_50sum</span><span class="w">                     </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_9999num_50mean</span><span class="w">                  </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_9999num_75sum</span><span class="w">                     </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_9999num_75mean</span><span class="w">                  </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_9999num_985sum</span><span class="w">                    </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_9999num_985mean</span><span class="w">                 </span><span class="n">float64</span><span class="w"></span>
<span class="n">within_days_9999num_100sum</span><span class="w">                    </span><span class="n">int64</span><span class="w"></span>
<span class="n">within_days_9999num_100mean</span><span class="w">                 </span><span class="n">float64</span><span class="w"></span>
<span class="n">total_plan_days</span><span class="w">                               </span><span class="n">int64</span><span class="w"></span>
<span class="n">total_amount_paid</span><span class="w">                             </span><span class="n">int64</span><span class="w"></span>
<span class="n">amount_paid_per_day</span><span class="w">                         </span><span class="n">float64</span><span class="w"></span>
<span class="n">diff_renewal_duration</span><span class="w">                         </span><span class="n">int64</span><span class="w"></span>
<span class="n">diff_plan_amount_paid_per_day</span><span class="w">               </span><span class="n">float64</span><span class="w"></span>
<span class="n">latest_payment_method_id</span><span class="w">                      </span><span class="n">int64</span><span class="w"></span>
<span class="n">latest_plan_days</span><span class="w">                              </span><span class="n">int64</span><span class="w"></span>
<span class="n">latest_plan_list_price</span><span class="w">                        </span><span class="n">int64</span><span class="w"></span>
<span class="n">latest_amount_paid</span><span class="w">                            </span><span class="n">int64</span><span class="w"></span>
<span class="n">latest_auto_renew</span><span class="w">                             </span><span class="n">int64</span><span class="w"></span>
<span class="n">latest_transaction_date</span><span class="w">                       </span><span class="n">int64</span><span class="w"></span>
<span class="n">latest_expire_date</span><span class="w">                            </span><span class="n">int64</span><span class="w"></span>
<span class="n">latest_is_cancel</span><span class="w">                              </span><span class="n">int64</span><span class="w"></span>
<span class="n">latest_amount_paid_per_day</span><span class="w">                  </span><span class="n">float64</span><span class="w"></span>
<span class="nl">dtype</span><span class="p">:</span><span class="w"> </span><span class="k">object</span><span class="w"></span>
</pre></div>


<p>We see we have a couple datetime objects in the file.  We'll need to address these, as the ML algorithms don't like them.  The code below breaks datetime formatted columns up into 4 separate columns.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">split_date_col</span><span class="p">(</span><span class="n">date_col_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function that takes a column of datetime64[ns] items and converts it into 4 columns:</span>
<span class="sd">        1) Year integer</span>
<span class="sd">        2) Month integer</span>
<span class="sd">        3) Day integer</span>
<span class="sd">        4) Days since January 1, 2001, as an integer</span>

<span class="sd">        It then deletes the original date </span>

<span class="sd">    Args:</span>
<span class="sd">        date_col_name (string):  The column name, as a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df_fa</span><span class="p">[</span><span class="n">date_col_name</span> <span class="o">+</span> <span class="s1">&#39;_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_fa</span><span class="p">[</span><span class="n">date_col_name</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
    <span class="n">df_fa</span><span class="p">[</span><span class="n">date_col_name</span> <span class="o">+</span> <span class="s1">&#39;_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_fa</span><span class="p">[</span><span class="n">date_col_name</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
    <span class="n">df_fa</span><span class="p">[</span><span class="n">date_col_name</span> <span class="o">+</span> <span class="s1">&#39;_day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_fa</span><span class="p">[</span><span class="n">date_col_name</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>
    <span class="n">df_fa</span><span class="p">[</span><span class="n">date_col_name</span> <span class="o">+</span> <span class="s1">&#39;_absday&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">df_fa</span><span class="p">[</span><span class="n">date_col_name</span><span class="p">]</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;1/1/2000&#39;</span><span class="p">))</span>
                                      <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;timedelta64[D]&#39;</span><span class="p">)</span>
                                      <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span>
                                     <span class="p">)</span>
    <span class="n">df_fa</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">date_col_name</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#Only run this cell once, else it will fail on the date columns it deletes</span>
<span class="n">split_date_col</span><span class="p">(</span><span class="s1">&#39;date_featuresdatemax_date&#39;</span><span class="p">)</span>
<span class="n">split_date_col</span><span class="p">(</span><span class="s1">&#39;date_featuresdatemin_date&#39;</span><span class="p">)</span>
</pre></div>


<p>Now let's re-check our cells:</p>
<div class="highlight"><pre><span></span><span class="n">df_fa</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">city                                   int64</span>
<span class="err">bd                                     int64</span>
<span class="err">gender                                object</span>
<span class="err">registered_via                         int64</span>
<span class="err">registration_init_time                 int64</span>
<span class="err">is_churn                               int64</span>
<span class="err">date_featuresdatelistening_tenure      int64</span>
<span class="err">within_days_1num_unqsum                int64</span>
<span class="err">within_days_1num_unqmean               int64</span>
<span class="err">within_days_1num_unqcount              int64</span>
<span class="err">within_days_1total_secssum           float64</span>
<span class="err">within_days_1total_secsmean          float64</span>
<span class="err">within_days_1num_25sum                 int64</span>
<span class="err">within_days_1num_25mean                int64</span>
<span class="err">within_days_1num_50sum                 int64</span>
<span class="err">within_days_1num_50mean                int64</span>
<span class="err">within_days_1num_75sum                 int64</span>
<span class="err">within_days_1num_75mean                int64</span>
<span class="err">within_days_1num_985sum                int64</span>
<span class="err">within_days_1num_985mean               int64</span>
<span class="err">within_days_1num_100sum                int64</span>
<span class="err">within_days_1num_100mean               int64</span>
<span class="err">within_days_7num_unqsum                int64</span>
<span class="err">within_days_7num_unqmean             float64</span>
<span class="err">within_days_7num_unqcount              int64</span>
<span class="err">within_days_7total_secssum           float64</span>
<span class="err">within_days_7total_secsmean          float64</span>
<span class="err">within_days_7num_25sum                 int64</span>
<span class="err">within_days_7num_25mean              float64</span>
<span class="err">within_days_7num_50sum                 int64</span>
<span class="err">within_days_7num_50mean              float64</span>
<span class="err">within_days_7num_75sum                 int64</span>
<span class="err">within_days_7num_75mean              float64</span>
<span class="err">within_days_7num_985sum                int64</span>
<span class="err">within_days_7num_985mean             float64</span>
<span class="err">within_days_7num_100sum                int64</span>
<span class="err">within_days_7num_100mean             float64</span>
<span class="err">within_days_14num_unqsum               int64</span>
<span class="err">within_days_14num_unqmean            float64</span>
<span class="err">within_days_14num_unqcount             int64</span>
<span class="err">within_days_14total_secssum          float64</span>
<span class="err">within_days_14total_secsmean         float64</span>
<span class="err">within_days_14num_25sum                int64</span>
<span class="err">within_days_14num_25mean             float64</span>
<span class="err">within_days_14num_50sum                int64</span>
<span class="err">within_days_14num_50mean             float64</span>
<span class="err">within_days_14num_75sum                int64</span>
<span class="err">within_days_14num_75mean             float64</span>
<span class="err">within_days_14num_985sum               int64</span>
<span class="err">within_days_14num_985mean            float64</span>
<span class="err">within_days_14num_100sum               int64</span>
<span class="err">within_days_14num_100mean            float64</span>
<span class="err">within_days_31num_unqsum               int64</span>
<span class="err">within_days_31num_unqmean            float64</span>
<span class="err">within_days_31num_unqcount             int64</span>
<span class="err">within_days_31total_secssum          float64</span>
<span class="err">within_days_31total_secsmean         float64</span>
<span class="err">within_days_31num_25sum                int64</span>
<span class="err">within_days_31num_25mean             float64</span>
<span class="err">within_days_31num_50sum                int64</span>
<span class="err">within_days_31num_50mean             float64</span>
<span class="err">within_days_31num_75sum                int64</span>
<span class="err">within_days_31num_75mean             float64</span>
<span class="err">within_days_31num_985sum               int64</span>
<span class="err">within_days_31num_985mean            float64</span>
<span class="err">within_days_31num_100sum               int64</span>
<span class="err">within_days_31num_100mean            float64</span>
<span class="err">within_days_90num_unqsum               int64</span>
<span class="err">within_days_90num_unqmean            float64</span>
<span class="err">within_days_90num_unqcount             int64</span>
<span class="err">within_days_90total_secssum          float64</span>
<span class="err">within_days_90total_secsmean         float64</span>
<span class="err">within_days_90num_25sum                int64</span>
<span class="err">within_days_90num_25mean             float64</span>
<span class="err">within_days_90num_50sum                int64</span>
<span class="err">within_days_90num_50mean             float64</span>
<span class="err">within_days_90num_75sum                int64</span>
<span class="err">within_days_90num_75mean             float64</span>
<span class="err">within_days_90num_985sum               int64</span>
<span class="err">within_days_90num_985mean            float64</span>
<span class="err">within_days_90num_100sum               int64</span>
<span class="err">within_days_90num_100mean            float64</span>
<span class="err">within_days_180num_unqsum              int64</span>
<span class="err">within_days_180num_unqmean           float64</span>
<span class="err">within_days_180num_unqcount            int64</span>
<span class="err">within_days_180total_secssum         float64</span>
<span class="err">within_days_180total_secsmean        float64</span>
<span class="err">within_days_180num_25sum               int64</span>
<span class="err">within_days_180num_25mean            float64</span>
<span class="err">within_days_180num_50sum               int64</span>
<span class="err">within_days_180num_50mean            float64</span>
<span class="err">within_days_180num_75sum               int64</span>
<span class="err">within_days_180num_75mean            float64</span>
<span class="err">within_days_180num_985sum              int64</span>
<span class="err">within_days_180num_985mean           float64</span>
<span class="err">within_days_180num_100sum              int64</span>
<span class="err">within_days_180num_100mean           float64</span>
<span class="err">within_days_365num_unqsum              int64</span>
<span class="err">within_days_365num_unqmean           float64</span>
<span class="err">within_days_365num_unqcount            int64</span>
<span class="err">within_days_365total_secssum         float64</span>
<span class="err">within_days_365total_secsmean        float64</span>
<span class="err">within_days_365num_25sum               int64</span>
<span class="err">within_days_365num_25mean            float64</span>
<span class="err">within_days_365num_50sum               int64</span>
<span class="err">within_days_365num_50mean            float64</span>
<span class="err">within_days_365num_75sum               int64</span>
<span class="err">within_days_365num_75mean            float64</span>
<span class="err">within_days_365num_985sum              int64</span>
<span class="err">within_days_365num_985mean           float64</span>
<span class="err">within_days_365num_100sum              int64</span>
<span class="err">within_days_365num_100mean           float64</span>
<span class="err">within_days_9999num_unqsum             int64</span>
<span class="err">within_days_9999num_unqmean          float64</span>
<span class="err">within_days_9999num_unqcount           int64</span>
<span class="err">within_days_9999total_secssum        float64</span>
<span class="err">within_days_9999total_secsmean       float64</span>
<span class="err">within_days_9999num_25sum              int64</span>
<span class="err">within_days_9999num_25mean           float64</span>
<span class="err">within_days_9999num_50sum              int64</span>
<span class="err">within_days_9999num_50mean           float64</span>
<span class="err">within_days_9999num_75sum              int64</span>
<span class="err">within_days_9999num_75mean           float64</span>
<span class="err">within_days_9999num_985sum             int64</span>
<span class="err">within_days_9999num_985mean          float64</span>
<span class="err">within_days_9999num_100sum             int64</span>
<span class="err">within_days_9999num_100mean          float64</span>
<span class="err">total_plan_days                        int64</span>
<span class="err">total_amount_paid                      int64</span>
<span class="err">amount_paid_per_day                  float64</span>
<span class="err">diff_renewal_duration                  int64</span>
<span class="err">diff_plan_amount_paid_per_day        float64</span>
<span class="err">latest_payment_method_id               int64</span>
<span class="err">latest_plan_days                       int64</span>
<span class="err">latest_plan_list_price                 int64</span>
<span class="err">latest_amount_paid                     int64</span>
<span class="err">latest_auto_renew                      int64</span>
<span class="err">latest_transaction_date                int64</span>
<span class="err">latest_expire_date                     int64</span>
<span class="err">latest_is_cancel                       int64</span>
<span class="err">latest_amount_paid_per_day           float64</span>
<span class="err">date_featuresdatemax_date_year         int64</span>
<span class="err">date_featuresdatemax_date_month        int64</span>
<span class="err">date_featuresdatemax_date_day          int64</span>
<span class="err">date_featuresdatemax_date_absday       int64</span>
<span class="err">date_featuresdatemin_date_year         int64</span>
<span class="err">date_featuresdatemin_date_month        int64</span>
<span class="err">date_featuresdatemin_date_day          int64</span>
<span class="err">date_featuresdatemin_date_absday       int64</span>
<span class="c">dtype: object</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">df_fa</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>city</th>
      <th>bd</th>
      <th>gender</th>
      <th>registered_via</th>
      <th>registration_init_time</th>
      <th>is_churn</th>
      <th>date_featuresdatelistening_tenure</th>
      <th>within_days_1num_unqsum</th>
      <th>within_days_1num_unqmean</th>
      <th>within_days_1num_unqcount</th>
      <th>within_days_1total_secssum</th>
      <th>within_days_1total_secsmean</th>
      <th>within_days_1num_25sum</th>
      <th>within_days_1num_25mean</th>
      <th>within_days_1num_50sum</th>
      <th>within_days_1num_50mean</th>
      <th>within_days_1num_75sum</th>
      <th>within_days_1num_75mean</th>
      <th>within_days_1num_985sum</th>
      <th>within_days_1num_985mean</th>
      <th>within_days_1num_100sum</th>
      <th>within_days_1num_100mean</th>
      <th>within_days_7num_unqsum</th>
      <th>within_days_7num_unqmean</th>
      <th>within_days_7num_unqcount</th>
      <th>within_days_7total_secssum</th>
      <th>within_days_7total_secsmean</th>
      <th>within_days_7num_25sum</th>
      <th>within_days_7num_25mean</th>
      <th>within_days_7num_50sum</th>
      <th>within_days_7num_50mean</th>
      <th>within_days_7num_75sum</th>
      <th>within_days_7num_75mean</th>
      <th>within_days_7num_985sum</th>
      <th>within_days_7num_985mean</th>
      <th>within_days_7num_100sum</th>
      <th>within_days_7num_100mean</th>
      <th>within_days_14num_unqsum</th>
      <th>within_days_14num_unqmean</th>
      <th>within_days_14num_unqcount</th>
      <th>within_days_14total_secssum</th>
      <th>within_days_14total_secsmean</th>
      <th>within_days_14num_25sum</th>
      <th>within_days_14num_25mean</th>
      <th>within_days_14num_50sum</th>
      <th>within_days_14num_50mean</th>
      <th>within_days_14num_75sum</th>
      <th>within_days_14num_75mean</th>
      <th>within_days_14num_985sum</th>
      <th>within_days_14num_985mean</th>
      <th>within_days_14num_100sum</th>
      <th>within_days_14num_100mean</th>
      <th>within_days_31num_unqsum</th>
      <th>within_days_31num_unqmean</th>
      <th>within_days_31num_unqcount</th>
      <th>within_days_31total_secssum</th>
      <th>within_days_31total_secsmean</th>
      <th>within_days_31num_25sum</th>
      <th>within_days_31num_25mean</th>
      <th>within_days_31num_50sum</th>
      <th>within_days_31num_50mean</th>
      <th>within_days_31num_75sum</th>
      <th>within_days_31num_75mean</th>
      <th>within_days_31num_985sum</th>
      <th>within_days_31num_985mean</th>
      <th>within_days_31num_100sum</th>
      <th>within_days_31num_100mean</th>
      <th>within_days_90num_unqsum</th>
      <th>within_days_90num_unqmean</th>
      <th>within_days_90num_unqcount</th>
      <th>within_days_90total_secssum</th>
      <th>within_days_90total_secsmean</th>
      <th>within_days_90num_25sum</th>
      <th>within_days_90num_25mean</th>
      <th>within_days_90num_50sum</th>
      <th>within_days_90num_50mean</th>
      <th>within_days_90num_75sum</th>
      <th>within_days_90num_75mean</th>
      <th>within_days_90num_985sum</th>
      <th>within_days_90num_985mean</th>
      <th>within_days_90num_100sum</th>
      <th>within_days_90num_100mean</th>
      <th>within_days_180num_unqsum</th>
      <th>within_days_180num_unqmean</th>
      <th>within_days_180num_unqcount</th>
      <th>within_days_180total_secssum</th>
      <th>within_days_180total_secsmean</th>
      <th>within_days_180num_25sum</th>
      <th>within_days_180num_25mean</th>
      <th>within_days_180num_50sum</th>
      <th>within_days_180num_50mean</th>
      <th>within_days_180num_75sum</th>
      <th>within_days_180num_75mean</th>
      <th>within_days_180num_985sum</th>
      <th>within_days_180num_985mean</th>
      <th>within_days_180num_100sum</th>
      <th>within_days_180num_100mean</th>
      <th>within_days_365num_unqsum</th>
      <th>within_days_365num_unqmean</th>
      <th>within_days_365num_unqcount</th>
      <th>within_days_365total_secssum</th>
      <th>within_days_365total_secsmean</th>
      <th>within_days_365num_25sum</th>
      <th>within_days_365num_25mean</th>
      <th>within_days_365num_50sum</th>
      <th>within_days_365num_50mean</th>
      <th>within_days_365num_75sum</th>
      <th>within_days_365num_75mean</th>
      <th>within_days_365num_985sum</th>
      <th>within_days_365num_985mean</th>
      <th>within_days_365num_100sum</th>
      <th>within_days_365num_100mean</th>
      <th>within_days_9999num_unqsum</th>
      <th>within_days_9999num_unqmean</th>
      <th>within_days_9999num_unqcount</th>
      <th>within_days_9999total_secssum</th>
      <th>within_days_9999total_secsmean</th>
      <th>within_days_9999num_25sum</th>
      <th>within_days_9999num_25mean</th>
      <th>within_days_9999num_50sum</th>
      <th>within_days_9999num_50mean</th>
      <th>within_days_9999num_75sum</th>
      <th>within_days_9999num_75mean</th>
      <th>within_days_9999num_985sum</th>
      <th>within_days_9999num_985mean</th>
      <th>within_days_9999num_100sum</th>
      <th>within_days_9999num_100mean</th>
      <th>total_plan_days</th>
      <th>total_amount_paid</th>
      <th>amount_paid_per_day</th>
      <th>diff_renewal_duration</th>
      <th>diff_plan_amount_paid_per_day</th>
      <th>latest_payment_method_id</th>
      <th>latest_plan_days</th>
      <th>latest_plan_list_price</th>
      <th>latest_amount_paid</th>
      <th>latest_auto_renew</th>
      <th>latest_transaction_date</th>
      <th>latest_expire_date</th>
      <th>latest_is_cancel</th>
      <th>latest_amount_paid_per_day</th>
      <th>date_featuresdatemax_date_year</th>
      <th>date_featuresdatemax_date_month</th>
      <th>date_featuresdatemax_date_day</th>
      <th>date_featuresdatemax_date_absday</th>
      <th>date_featuresdatemin_date_year</th>
      <th>date_featuresdatemin_date_month</th>
      <th>date_featuresdatemin_date_day</th>
      <th>date_featuresdatemin_date_absday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>45906</td>
      <td>88544.000000</td>
      <td>8.854400e+04</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.0</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>8.854400e+04</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>8.854400e+04</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>8.854400e+04</td>
      <td>8.854400e+04</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>8.854400e+04</td>
      <td>8.854400e+04</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>8.854400e+04</td>
      <td>8.854400e+04</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>8.854400e+04</td>
      <td>8.854400e+04</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>8.854400e+04</td>
      <td>8.854400e+04</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>2</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>top</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>male</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>24390</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>6.525038</td>
      <td>14.980733</td>
      <td>NaN</td>
      <td>6.635018</td>
      <td>2.013375e+07</td>
      <td>0.505590</td>
      <td>489.896266</td>
      <td>20.698794</td>
      <td>20.698794</td>
      <td>1.0</td>
      <td>5292.578450</td>
      <td>5292.578450</td>
      <td>4.751005</td>
      <td>4.751005</td>
      <td>1.181175</td>
      <td>1.181175</td>
      <td>0.712719</td>
      <td>0.712719</td>
      <td>0.790985</td>
      <td>0.790985</td>
      <td>20.047660</td>
      <td>20.047660</td>
      <td>94.714458</td>
      <td>21.900082</td>
      <td>3.630568</td>
      <td>25398.043300</td>
      <td>5679.751873</td>
      <td>20.606806</td>
      <td>5.048088</td>
      <td>5.118721</td>
      <td>1.264542</td>
      <td>3.193474</td>
      <td>0.764835</td>
      <td>3.609866</td>
      <td>0.839836</td>
      <td>96.809236</td>
      <td>21.497445</td>
      <td>180.072506</td>
      <td>22.383794</td>
      <td>6.679696</td>
      <td>4.851858e+04</td>
      <td>5818.581592</td>
      <td>38.873690</td>
      <td>5.179982</td>
      <td>9.669735</td>
      <td>1.298046</td>
      <td>6.069570</td>
      <td>0.785710</td>
      <td>6.831553</td>
      <td>0.857796</td>
      <td>185.109313</td>
      <td>22.017982</td>
      <td>386.728101</td>
      <td>23.271521</td>
      <td>13.902444</td>
      <td>1.039538e+05</td>
      <td>6040.184570</td>
      <td>84.352706</td>
      <td>5.450459</td>
      <td>20.850831</td>
      <td>1.359949</td>
      <td>13.151473</td>
      <td>0.825081</td>
      <td>14.948783</td>
      <td>0.904241</td>
      <td>396.595557</td>
      <td>22.841633</td>
      <td>1093.917736</td>
      <td>24.238664</td>
      <td>37.852435</td>
      <td>-8.333365e+11</td>
      <td>-1.651270e+10</td>
      <td>241.791143</td>
      <td>5.797655</td>
      <td>59.157650</td>
      <td>1.442505</td>
      <td>37.497256</td>
      <td>0.874044</td>
      <td>42.036321</td>
      <td>0.943332</td>
      <td>1121.233093</td>
      <td>23.773736</td>
      <td>2090.805633</td>
      <td>24.740990</td>
      <td>71.289811</td>
      <td>-1.979174e+12</td>
      <td>-2.291994e+10</td>
      <td>464.508132</td>
      <td>5.968142</td>
      <td>114.264603</td>
      <td>1.498918</td>
      <td>72.136554</td>
      <td>0.902613</td>
      <td>80.350267</td>
      <td>0.967418</td>
      <td>2124.856648</td>
      <td>24.115101</td>
      <td>3896.207400</td>
      <td>25.245055</td>
      <td>131.113401</td>
      <td>-6.041691e+12</td>
      <td>-3.677399e+10</td>
      <td>859.351520</td>
      <td>6.090492</td>
      <td>212.907018</td>
      <td>1.541631</td>
      <td>133.405527</td>
      <td>0.921047</td>
      <td>148.187715</td>
      <td>0.979698</td>
      <td>3949.711895</td>
      <td>24.569486</td>
      <td>6768.144403</td>
      <td>25.652204</td>
      <td>222.584850</td>
      <td>-2.994804e+14</td>
      <td>-7.498238e+11</td>
      <td>1476.962256</td>
      <td>6.214718</td>
      <td>367.734708</td>
      <td>1.582176</td>
      <td>229.020227</td>
      <td>0.940062</td>
      <td>254.208992</td>
      <td>0.992622</td>
      <td>6864.914574</td>
      <td>24.937062</td>
      <td>437.796169</td>
      <td>2037.669125</td>
      <td>4.602800</td>
      <td>2.989858</td>
      <td>-5.606482</td>
      <td>37.700296</td>
      <td>52.462742</td>
      <td>227.611199</td>
      <td>227.036185</td>
      <td>0.639874</td>
      <td>2.016869e+07</td>
      <td>2.016998e+07</td>
      <td>0.174659</td>
      <td>4.249737</td>
      <td>2016.881234</td>
      <td>2.525117</td>
      <td>21.763507</td>
      <td>6234.178363</td>
      <td>2015.427177</td>
      <td>4.265992</td>
      <td>11.133335</td>
      <td>5744.282097</td>
    </tr>
    <tr>
      <th>std</th>
      <td>6.551445</td>
      <td>18.431336</td>
      <td>NaN</td>
      <td>2.234529</td>
      <td>2.896439e+04</td>
      <td>0.499972</td>
      <td>271.954761</td>
      <td>26.816538</td>
      <td>26.816538</td>
      <td>0.0</td>
      <td>7839.883628</td>
      <td>7839.883628</td>
      <td>11.209580</td>
      <td>11.209580</td>
      <td>3.122491</td>
      <td>3.122491</td>
      <td>1.569186</td>
      <td>1.569186</td>
      <td>2.056548</td>
      <td>2.056548</td>
      <td>31.926074</td>
      <td>31.926074</td>
      <td>123.736267</td>
      <td>22.179267</td>
      <td>2.019227</td>
      <td>37825.652389</td>
      <td>6814.978016</td>
      <td>40.174639</td>
      <td>9.170749</td>
      <td>9.780551</td>
      <td>2.416056</td>
      <td>5.525064</td>
      <td>1.240117</td>
      <td>8.967416</td>
      <td>1.630039</td>
      <td>154.190616</td>
      <td>27.963725</td>
      <td>232.545094</td>
      <td>20.836810</td>
      <td>4.052415</td>
      <td>7.152130e+04</td>
      <td>6539.990675</td>
      <td>69.286828</td>
      <td>8.255339</td>
      <td>16.423555</td>
      <td>2.159017</td>
      <td>9.495713</td>
      <td>1.138329</td>
      <td>16.007510</td>
      <td>1.546520</td>
      <td>291.280077</td>
      <td>26.898005</td>
      <td>477.079939</td>
      <td>19.372295</td>
      <td>8.663977</td>
      <td>1.469971e+05</td>
      <td>6020.766839</td>
      <td>135.636164</td>
      <td>7.741246</td>
      <td>30.899691</td>
      <td>1.919181</td>
      <td>18.358084</td>
      <td>1.029136</td>
      <td>36.104464</td>
      <td>1.563621</td>
      <td>600.717536</td>
      <td>24.834585</td>
      <td>1341.237189</td>
      <td>18.684102</td>
      <td>25.324540</td>
      <td>2.191767e+14</td>
      <td>3.964256e+12</td>
      <td>382.272707</td>
      <td>7.515411</td>
      <td>82.445972</td>
      <td>1.770876</td>
      <td>50.426151</td>
      <td>0.969375</td>
      <td>89.884588</td>
      <td>1.397562</td>
      <td>1663.191691</td>
      <td>24.005779</td>
      <td>2583.529737</td>
      <td>18.290344</td>
      <td>50.173053</td>
      <td>2.754958e+14</td>
      <td>2.817791e+12</td>
      <td>890.415732</td>
      <td>7.904848</td>
      <td>158.377603</td>
      <td>1.721930</td>
      <td>96.141760</td>
      <td>0.912695</td>
      <td>166.964108</td>
      <td>1.336536</td>
      <td>3129.427760</td>
      <td>23.396972</td>
      <td>4890.713126</td>
      <td>17.842956</td>
      <td>99.124183</td>
      <td>3.640763e+14</td>
      <td>2.148897e+12</td>
      <td>2152.429448</td>
      <td>8.587733</td>
      <td>298.543419</td>
      <td>1.634560</td>
      <td>179.646957</td>
      <td>0.882435</td>
      <td>271.766276</td>
      <td>1.137067</td>
      <td>5839.985612</td>
      <td>22.801391</td>
      <td>9203.006883</td>
      <td>17.417302</td>
      <td>196.804976</td>
      <td>3.620312e+15</td>
      <td>9.459203e+12</td>
      <td>3814.395114</td>
      <td>8.261136</td>
      <td>548.144978</td>
      <td>1.622525</td>
      <td>327.643138</td>
      <td>0.872478</td>
      <td>440.184627</td>
      <td>1.023119</td>
      <td>10865.335596</td>
      <td>22.230638</td>
      <td>241.813007</td>
      <td>1234.637258</td>
      <td>1.085134</td>
      <td>51.117939</td>
      <td>237.546015</td>
      <td>4.484667</td>
      <td>79.217446</td>
      <td>332.886694</td>
      <td>333.154660</td>
      <td>0.480039</td>
      <td>3.996365e+03</td>
      <td>6.095780e+03</td>
      <td>0.379677</td>
      <td>47.556868</td>
      <td>0.372700</td>
      <td>2.183868</td>
      <td>8.070249</td>
      <td>94.115610</td>
      <td>0.580881</td>
      <td>3.899945</td>
      <td>9.493778</td>
      <td>261.169278</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>-49.000000</td>
      <td>NaN</td>
      <td>3.000000</td>
      <td>2.004033e+07</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.0</td>
      <td>0.030000</td>
      <td>0.030000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.078000</td>
      <td>0.078000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>7.800000e-02</td>
      <td>0.078000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>2.130000e-01</td>
      <td>0.213000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>-6.456360e+16</td>
      <td>-1.132695e+15</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>-7.378698e+16</td>
      <td>-6.895979e+14</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>-7.378698e+16</td>
      <td>-3.617009e+14</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>-3.135946e+17</td>
      <td>-8.384884e+14</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-420.000000</td>
      <td>-9999.000000</td>
      <td>3.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2.015010e+07</td>
      <td>1.970010e+07</td>
      <td>0.000000</td>
      <td>-9999.000000</td>
      <td>2015.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>5479.000000</td>
      <td>2015.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>5479.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>4.000000</td>
      <td>2.012053e+07</td>
      <td>0.000000</td>
      <td>248.000000</td>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>1.0</td>
      <td>821.058500</td>
      <td>821.058500</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>17.000000</td>
      <td>7.571429</td>
      <td>2.000000</td>
      <td>3718.143000</td>
      <td>1705.418000</td>
      <td>2.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>12.000000</td>
      <td>5.666667</td>
      <td>34.000000</td>
      <td>9.200000</td>
      <td>3.000000</td>
      <td>7.838667e+03</td>
      <td>2116.791375</td>
      <td>5.000000</td>
      <td>1.250000</td>
      <td>1.000000</td>
      <td>0.307692</td>
      <td>1.000000</td>
      <td>0.166667</td>
      <td>1.000000</td>
      <td>0.166667</td>
      <td>27.000000</td>
      <td>7.200000</td>
      <td>84.000000</td>
      <td>11.153846</td>
      <td>6.000000</td>
      <td>1.964592e+04</td>
      <td>2611.727415</td>
      <td>14.000000</td>
      <td>1.714286</td>
      <td>3.000000</td>
      <td>0.450000</td>
      <td>2.000000</td>
      <td>0.294118</td>
      <td>2.000000</td>
      <td>0.300000</td>
      <td>69.000000</td>
      <td>9.000000</td>
      <td>233.000000</td>
      <td>12.710028</td>
      <td>16.000000</td>
      <td>5.537270e+04</td>
      <td>2.998566e+03</td>
      <td>42.000000</td>
      <td>2.113636</td>
      <td>11.000000</td>
      <td>0.565217</td>
      <td>7.000000</td>
      <td>0.382353</td>
      <td>7.000000</td>
      <td>0.387097</td>
      <td>196.000000</td>
      <td>10.500000</td>
      <td>427.000000</td>
      <td>13.490147</td>
      <td>27.000000</td>
      <td>1.021806e+05</td>
      <td>3.180790e+03</td>
      <td>81.000000</td>
      <td>2.329249</td>
      <td>22.000000</td>
      <td>0.625000</td>
      <td>14.000000</td>
      <td>0.426950</td>
      <td>14.000000</td>
      <td>0.427574</td>
      <td>360.000000</td>
      <td>11.166667</td>
      <td>737.750000</td>
      <td>14.224490</td>
      <td>43.000000</td>
      <td>1.753236e+05</td>
      <td>3.351469e+03</td>
      <td>145.000000</td>
      <td>2.510204</td>
      <td>39.000000</td>
      <td>0.677632</td>
      <td>25.000000</td>
      <td>0.454545</td>
      <td>25.000000</td>
      <td>0.454545</td>
      <td>623.000000</td>
      <td>11.806058</td>
      <td>1002.000000</td>
      <td>14.798119</td>
      <td>56.000000</td>
      <td>2.145400e+05</td>
      <td>3.373914e+03</td>
      <td>205.000000</td>
      <td>2.651424</td>
      <td>56.000000</td>
      <td>0.722222</td>
      <td>35.000000</td>
      <td>0.481250</td>
      <td>35.000000</td>
      <td>0.478528</td>
      <td>853.000000</td>
      <td>12.291667</td>
      <td>240.000000</td>
      <td>990.000000</td>
      <td>3.936907</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>36.000000</td>
      <td>30.000000</td>
      <td>99.000000</td>
      <td>99.000000</td>
      <td>0.000000</td>
      <td>2.017012e+07</td>
      <td>2.017021e+07</td>
      <td>0.000000</td>
      <td>3.300000</td>
      <td>2017.000000</td>
      <td>2.000000</td>
      <td>17.000000</td>
      <td>6247.000000</td>
      <td>2015.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>5481.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>4.000000</td>
      <td>17.000000</td>
      <td>NaN</td>
      <td>7.000000</td>
      <td>2.014073e+07</td>
      <td>1.000000</td>
      <td>509.000000</td>
      <td>11.000000</td>
      <td>11.000000</td>
      <td>1.0</td>
      <td>2595.075000</td>
      <td>2595.075000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>9.000000</td>
      <td>9.000000</td>
      <td>53.000000</td>
      <td>16.000000</td>
      <td>3.000000</td>
      <td>12904.532500</td>
      <td>3780.617429</td>
      <td>8.000000</td>
      <td>2.600000</td>
      <td>2.000000</td>
      <td>0.666667</td>
      <td>1.000000</td>
      <td>0.500000</td>
      <td>2.000000</td>
      <td>0.500000</td>
      <td>47.000000</td>
      <td>13.750000</td>
      <td>105.000000</td>
      <td>17.100000</td>
      <td>6.000000</td>
      <td>2.553986e+04</td>
      <td>4091.579700</td>
      <td>17.000000</td>
      <td>3.000000</td>
      <td>4.000000</td>
      <td>0.800000</td>
      <td>3.000000</td>
      <td>0.500000</td>
      <td>3.000000</td>
      <td>0.538462</td>
      <td>93.000000</td>
      <td>15.000000</td>
      <td>238.000000</td>
      <td>18.777778</td>
      <td>13.000000</td>
      <td>5.835679e+04</td>
      <td>4496.575193</td>
      <td>42.000000</td>
      <td>3.500000</td>
      <td>11.000000</td>
      <td>0.928571</td>
      <td>7.000000</td>
      <td>0.612903</td>
      <td>8.000000</td>
      <td>0.636364</td>
      <td>214.000000</td>
      <td>16.500000</td>
      <td>667.000000</td>
      <td>19.993750</td>
      <td>36.000000</td>
      <td>1.652595e+05</td>
      <td>4.812825e+03</td>
      <td>123.000000</td>
      <td>3.935484</td>
      <td>33.000000</td>
      <td>1.000000</td>
      <td>22.000000</td>
      <td>0.671875</td>
      <td>22.000000</td>
      <td>0.692308</td>
      <td>605.000000</td>
      <td>17.683439</td>
      <td>1263.000000</td>
      <td>20.583333</td>
      <td>65.000000</td>
      <td>3.145153e+05</td>
      <td>4.970085e+03</td>
      <td>235.000000</td>
      <td>4.128933</td>
      <td>63.000000</td>
      <td>1.070945</td>
      <td>41.000000</td>
      <td>0.706897</td>
      <td>43.000000</td>
      <td>0.727273</td>
      <td>1149.000000</td>
      <td>18.196254</td>
      <td>2317.000000</td>
      <td>21.266667</td>
      <td>115.000000</td>
      <td>5.750376e+05</td>
      <td>5.154735e+03</td>
      <td>431.000000</td>
      <td>4.326370</td>
      <td>117.000000</td>
      <td>1.130952</td>
      <td>76.000000</td>
      <td>0.733333</td>
      <td>78.000000</td>
      <td>0.750000</td>
      <td>2102.000000</td>
      <td>18.867847</td>
      <td>3584.000000</td>
      <td>21.936890</td>
      <td>169.000000</td>
      <td>8.452459e+05</td>
      <td>5.233477e+03</td>
      <td>681.000000</td>
      <td>4.500000</td>
      <td>186.000000</td>
      <td>1.181818</td>
      <td>119.000000</td>
      <td>0.757725</td>
      <td>121.000000</td>
      <td>0.769231</td>
      <td>3299.000000</td>
      <td>19.508859</td>
      <td>440.000000</td>
      <td>1788.000000</td>
      <td>4.898667</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>39.000000</td>
      <td>30.000000</td>
      <td>149.000000</td>
      <td>149.000000</td>
      <td>1.000000</td>
      <td>2.017020e+07</td>
      <td>2.017030e+07</td>
      <td>0.000000</td>
      <td>4.966667</td>
      <td>2017.000000</td>
      <td>2.000000</td>
      <td>26.000000</td>
      <td>6265.000000</td>
      <td>2015.000000</td>
      <td>2.000000</td>
      <td>8.000000</td>
      <td>5710.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>13.000000</td>
      <td>27.000000</td>
      <td>NaN</td>
      <td>9.000000</td>
      <td>2.016012e+07</td>
      <td>1.000000</td>
      <td>776.000000</td>
      <td>27.000000</td>
      <td>27.000000</td>
      <td>1.0</td>
      <td>6509.136500</td>
      <td>6509.136500</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>24.000000</td>
      <td>24.000000</td>
      <td>124.000000</td>
      <td>28.666667</td>
      <td>5.000000</td>
      <td>31483.468500</td>
      <td>7136.028982</td>
      <td>24.000000</td>
      <td>6.000000</td>
      <td>6.000000</td>
      <td>1.500000</td>
      <td>4.000000</td>
      <td>1.000000</td>
      <td>4.000000</td>
      <td>1.000000</td>
      <td>118.000000</td>
      <td>26.833333</td>
      <td>236.000000</td>
      <td>29.000000</td>
      <td>10.000000</td>
      <td>5.991438e+04</td>
      <td>7206.990196</td>
      <td>46.000000</td>
      <td>6.285714</td>
      <td>12.000000</td>
      <td>1.571429</td>
      <td>8.000000</td>
      <td>1.000000</td>
      <td>8.000000</td>
      <td>1.000000</td>
      <td>225.000000</td>
      <td>27.090909</td>
      <td>511.000000</td>
      <td>29.545455</td>
      <td>20.000000</td>
      <td>1.296859e+05</td>
      <td>7375.110225</td>
      <td>103.000000</td>
      <td>6.720556</td>
      <td>26.000000</td>
      <td>1.666667</td>
      <td>17.000000</td>
      <td>1.052632</td>
      <td>18.000000</td>
      <td>1.125000</td>
      <td>484.000000</td>
      <td>27.826087</td>
      <td>1464.000000</td>
      <td>30.166667</td>
      <td>56.000000</td>
      <td>3.737988e+05</td>
      <td>7.603972e+03</td>
      <td>295.000000</td>
      <td>7.100000</td>
      <td>76.000000</td>
      <td>1.769231</td>
      <td>49.000000</td>
      <td>1.098120</td>
      <td>52.000000</td>
      <td>1.166667</td>
      <td>1394.000000</td>
      <td>28.634146</td>
      <td>2802.000000</td>
      <td>30.577022</td>
      <td>108.000000</td>
      <td>7.176428e+05</td>
      <td>7.747661e+03</td>
      <td>567.000000</td>
      <td>7.290698</td>
      <td>147.000000</td>
      <td>1.833333</td>
      <td>95.000000</td>
      <td>1.128512</td>
      <td>100.000000</td>
      <td>1.187500</td>
      <td>2663.000000</td>
      <td>29.039801</td>
      <td>5258.000000</td>
      <td>31.154067</td>
      <td>203.000000</td>
      <td>1.347311e+06</td>
      <td>7.914708e+03</td>
      <td>1058.000000</td>
      <td>7.466156</td>
      <td>275.000000</td>
      <td>1.888889</td>
      <td>175.000000</td>
      <td>1.149123</td>
      <td>185.000000</td>
      <td>1.200000</td>
      <td>5003.000000</td>
      <td>29.706403</td>
      <td>9046.250000</td>
      <td>31.791510</td>
      <td>346.000000</td>
      <td>2.223149e+06</td>
      <td>7.989009e+03</td>
      <td>1798.000000</td>
      <td>7.621627</td>
      <td>468.000000</td>
      <td>1.942504</td>
      <td>297.000000</td>
      <td>1.167134</td>
      <td>313.000000</td>
      <td>1.217949</td>
      <td>8601.250000</td>
      <td>30.343668</td>
      <td>615.000000</td>
      <td>3193.000000</td>
      <td>5.164424</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>41.000000</td>
      <td>30.000000</td>
      <td>149.000000</td>
      <td>149.000000</td>
      <td>1.000000</td>
      <td>2.017022e+07</td>
      <td>2.017032e+07</td>
      <td>0.000000</td>
      <td>4.966667</td>
      <td>2017.000000</td>
      <td>2.000000</td>
      <td>28.000000</td>
      <td>6268.000000</td>
      <td>2016.000000</td>
      <td>8.000000</td>
      <td>19.000000</td>
      <td>5959.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>22.000000</td>
      <td>1051.000000</td>
      <td>NaN</td>
      <td>13.000000</td>
      <td>2.017023e+07</td>
      <td>1.000000</td>
      <td>789.000000</td>
      <td>661.000000</td>
      <td>661.000000</td>
      <td>1.0</td>
      <td>437603.468000</td>
      <td>437603.468000</td>
      <td>570.000000</td>
      <td>570.000000</td>
      <td>195.000000</td>
      <td>195.000000</td>
      <td>71.000000</td>
      <td>71.000000</td>
      <td>224.000000</td>
      <td>224.000000</td>
      <td>1859.000000</td>
      <td>1859.000000</td>
      <td>2992.000000</td>
      <td>748.000000</td>
      <td>7.000000</td>
      <td>604487.476000</td>
      <td>437603.468000</td>
      <td>3957.000000</td>
      <td>989.250000</td>
      <td>354.000000</td>
      <td>132.500000</td>
      <td>369.000000</td>
      <td>65.500000</td>
      <td>1207.000000</td>
      <td>172.428571</td>
      <td>3211.000000</td>
      <td>1859.000000</td>
      <td>5290.000000</td>
      <td>661.000000</td>
      <td>14.000000</td>
      <td>1.209334e+06</td>
      <td>437603.468000</td>
      <td>5381.000000</td>
      <td>676.000000</td>
      <td>613.000000</td>
      <td>132.500000</td>
      <td>385.000000</td>
      <td>65.500000</td>
      <td>1877.000000</td>
      <td>156.416667</td>
      <td>5765.000000</td>
      <td>1859.000000</td>
      <td>10086.000000</td>
      <td>560.333333</td>
      <td>31.000000</td>
      <td>2.665440e+06</td>
      <td>187136.586000</td>
      <td>10384.000000</td>
      <td>676.000000</td>
      <td>1131.000000</td>
      <td>132.500000</td>
      <td>585.000000</td>
      <td>65.500000</td>
      <td>3930.000000</td>
      <td>151.826087</td>
      <td>13493.000000</td>
      <td>810.000000</td>
      <td>26703.000000</td>
      <td>560.333333</td>
      <td>90.000000</td>
      <td>7.546893e+06</td>
      <td>2.181567e+05</td>
      <td>35029.000000</td>
      <td>676.000000</td>
      <td>3017.000000</td>
      <td>88.333333</td>
      <td>1336.000000</td>
      <td>65.500000</td>
      <td>11151.000000</td>
      <td>159.300000</td>
      <td>35188.000000</td>
      <td>871.250000</td>
      <td>52598.000000</td>
      <td>560.333333</td>
      <td>180.000000</td>
      <td>1.519852e+07</td>
      <td>1.782986e+05</td>
      <td>166936.000000</td>
      <td>932.603352</td>
      <td>8311.000000</td>
      <td>104.333333</td>
      <td>3287.000000</td>
      <td>65.500000</td>
      <td>19803.000000</td>
      <td>133.446429</td>
      <td>64190.000000</td>
      <td>710.333333</td>
      <td>103640.000000</td>
      <td>560.333333</td>
      <td>365.000000</td>
      <td>2.993833e+07</td>
      <td>1.549087e+05</td>
      <td>519451.000000</td>
      <td>1427.063187</td>
      <td>19246.000000</td>
      <td>60.500000</td>
      <td>8016.000000</td>
      <td>65.500000</td>
      <td>26622.000000</td>
      <td>86.155340</td>
      <td>140785.000000</td>
      <td>647.666667</td>
      <td>234810.000000</td>
      <td>560.333333</td>
      <td>790.000000</td>
      <td>9.223372e+15</td>
      <td>1.358376e+13</td>
      <td>911417.000000</td>
      <td>1298.314815</td>
      <td>37859.000000</td>
      <td>60.500000</td>
      <td>16436.000000</td>
      <td>65.500000</td>
      <td>27315.000000</td>
      <td>58.358824</td>
      <td>387552.000000</td>
      <td>647.666667</td>
      <td>1690.000000</td>
      <td>5908.000000</td>
      <td>53.189189</td>
      <td>450.000000</td>
      <td>6.000000</td>
      <td>41.000000</td>
      <td>450.000000</td>
      <td>2000.000000</td>
      <td>2000.000000</td>
      <td>1.000000</td>
      <td>2.017023e+07</td>
      <td>2.017033e+07</td>
      <td>1.000000</td>
      <td>6.000000</td>
      <td>2017.000000</td>
      <td>12.000000</td>
      <td>31.000000</td>
      <td>6268.000000</td>
      <td>2017.000000</td>
      <td>12.000000</td>
      <td>31.000000</td>
      <td>6268.000000</td>
    </tr>
  </tbody>
</table>
</div>

<p>Next, we convert the gender variable (a string) to dummy encoding:</p>
<div class="highlight"><pre><span></span><span class="c1">#Convert gender variable:</span>
<span class="n">dummy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">])</span>
<span class="n">df_fa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_fa</span><span class="p">,</span> <span class="n">dummy</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_fa</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;Note, we&#39;re not concerned about collinearity having both a female and a male category,</span>
<span class="sd">as there are several cases where both values are 0, presumably because the user did not</span>
<span class="sd">supply the information.  Thus, the two columns, male and female, capture the 3 cases:</span>
<span class="sd">male, female, and &#39;not supplied&#39;. &quot;&quot;&quot;</span>
<span class="p">;</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">&#39;&#39;</span>
</pre></div>


<p>A couple more quick inspections:</p>
<div class="highlight"><pre><span></span><span class="n">df_fa</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>city</th>
      <th>bd</th>
      <th>registered_via</th>
      <th>registration_init_time</th>
      <th>is_churn</th>
      <th>date_featuresdatelistening_tenure</th>
      <th>within_days_1num_unqsum</th>
      <th>within_days_1num_unqmean</th>
      <th>within_days_1num_unqcount</th>
      <th>within_days_1total_secssum</th>
      <th>within_days_1total_secsmean</th>
      <th>within_days_1num_25sum</th>
      <th>within_days_1num_25mean</th>
      <th>within_days_1num_50sum</th>
      <th>within_days_1num_50mean</th>
      <th>within_days_1num_75sum</th>
      <th>within_days_1num_75mean</th>
      <th>within_days_1num_985sum</th>
      <th>within_days_1num_985mean</th>
      <th>within_days_1num_100sum</th>
      <th>within_days_1num_100mean</th>
      <th>within_days_7num_unqsum</th>
      <th>within_days_7num_unqmean</th>
      <th>within_days_7num_unqcount</th>
      <th>within_days_7total_secssum</th>
      <th>within_days_7total_secsmean</th>
      <th>within_days_7num_25sum</th>
      <th>within_days_7num_25mean</th>
      <th>within_days_7num_50sum</th>
      <th>within_days_7num_50mean</th>
      <th>within_days_7num_75sum</th>
      <th>within_days_7num_75mean</th>
      <th>within_days_7num_985sum</th>
      <th>within_days_7num_985mean</th>
      <th>within_days_7num_100sum</th>
      <th>within_days_7num_100mean</th>
      <th>within_days_14num_unqsum</th>
      <th>within_days_14num_unqmean</th>
      <th>within_days_14num_unqcount</th>
      <th>within_days_14total_secssum</th>
      <th>within_days_14total_secsmean</th>
      <th>within_days_14num_25sum</th>
      <th>within_days_14num_25mean</th>
      <th>within_days_14num_50sum</th>
      <th>within_days_14num_50mean</th>
      <th>within_days_14num_75sum</th>
      <th>within_days_14num_75mean</th>
      <th>within_days_14num_985sum</th>
      <th>within_days_14num_985mean</th>
      <th>within_days_14num_100sum</th>
      <th>within_days_14num_100mean</th>
      <th>within_days_31num_unqsum</th>
      <th>within_days_31num_unqmean</th>
      <th>within_days_31num_unqcount</th>
      <th>within_days_31total_secssum</th>
      <th>within_days_31total_secsmean</th>
      <th>within_days_31num_25sum</th>
      <th>within_days_31num_25mean</th>
      <th>within_days_31num_50sum</th>
      <th>within_days_31num_50mean</th>
      <th>within_days_31num_75sum</th>
      <th>within_days_31num_75mean</th>
      <th>within_days_31num_985sum</th>
      <th>within_days_31num_985mean</th>
      <th>within_days_31num_100sum</th>
      <th>within_days_31num_100mean</th>
      <th>within_days_90num_unqsum</th>
      <th>within_days_90num_unqmean</th>
      <th>within_days_90num_unqcount</th>
      <th>within_days_90total_secssum</th>
      <th>within_days_90total_secsmean</th>
      <th>within_days_90num_25sum</th>
      <th>within_days_90num_25mean</th>
      <th>within_days_90num_50sum</th>
      <th>within_days_90num_50mean</th>
      <th>within_days_90num_75sum</th>
      <th>within_days_90num_75mean</th>
      <th>within_days_90num_985sum</th>
      <th>within_days_90num_985mean</th>
      <th>within_days_90num_100sum</th>
      <th>within_days_90num_100mean</th>
      <th>within_days_180num_unqsum</th>
      <th>within_days_180num_unqmean</th>
      <th>within_days_180num_unqcount</th>
      <th>within_days_180total_secssum</th>
      <th>within_days_180total_secsmean</th>
      <th>within_days_180num_25sum</th>
      <th>within_days_180num_25mean</th>
      <th>within_days_180num_50sum</th>
      <th>within_days_180num_50mean</th>
      <th>within_days_180num_75sum</th>
      <th>within_days_180num_75mean</th>
      <th>within_days_180num_985sum</th>
      <th>within_days_180num_985mean</th>
      <th>within_days_180num_100sum</th>
      <th>within_days_180num_100mean</th>
      <th>within_days_365num_unqsum</th>
      <th>within_days_365num_unqmean</th>
      <th>within_days_365num_unqcount</th>
      <th>within_days_365total_secssum</th>
      <th>within_days_365total_secsmean</th>
      <th>within_days_365num_25sum</th>
      <th>within_days_365num_25mean</th>
      <th>within_days_365num_50sum</th>
      <th>within_days_365num_50mean</th>
      <th>within_days_365num_75sum</th>
      <th>within_days_365num_75mean</th>
      <th>within_days_365num_985sum</th>
      <th>within_days_365num_985mean</th>
      <th>within_days_365num_100sum</th>
      <th>within_days_365num_100mean</th>
      <th>within_days_9999num_unqsum</th>
      <th>within_days_9999num_unqmean</th>
      <th>within_days_9999num_unqcount</th>
      <th>within_days_9999total_secssum</th>
      <th>within_days_9999total_secsmean</th>
      <th>within_days_9999num_25sum</th>
      <th>within_days_9999num_25mean</th>
      <th>within_days_9999num_50sum</th>
      <th>within_days_9999num_50mean</th>
      <th>within_days_9999num_75sum</th>
      <th>within_days_9999num_75mean</th>
      <th>within_days_9999num_985sum</th>
      <th>within_days_9999num_985mean</th>
      <th>within_days_9999num_100sum</th>
      <th>within_days_9999num_100mean</th>
      <th>total_plan_days</th>
      <th>total_amount_paid</th>
      <th>amount_paid_per_day</th>
      <th>diff_renewal_duration</th>
      <th>diff_plan_amount_paid_per_day</th>
      <th>latest_payment_method_id</th>
      <th>latest_plan_days</th>
      <th>latest_plan_list_price</th>
      <th>latest_amount_paid</th>
      <th>latest_auto_renew</th>
      <th>latest_transaction_date</th>
      <th>latest_expire_date</th>
      <th>latest_is_cancel</th>
      <th>latest_amount_paid_per_day</th>
      <th>date_featuresdatemax_date_year</th>
      <th>date_featuresdatemax_date_month</th>
      <th>date_featuresdatemax_date_day</th>
      <th>date_featuresdatemax_date_absday</th>
      <th>date_featuresdatemin_date_year</th>
      <th>date_featuresdatemin_date_month</th>
      <th>date_featuresdatemin_date_day</th>
      <th>date_featuresdatemin_date_absday</th>
      <th>female</th>
      <th>male</th>
    </tr>
    <tr>
      <th>msno</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mKfgXQAmVeSKzN4rXW37qz0HbGCuYBspTBM3ONXZudg=</th>
      <td>1</td>
      <td>0</td>
      <td>13</td>
      <td>20170120</td>
      <td>0</td>
      <td>35</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>10.068</td>
      <td>10.068</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1.000000</td>
      <td>1</td>
      <td>10.068</td>
      <td>10.068000</td>
      <td>2</td>
      <td>2.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1</td>
      <td>1.000000</td>
      <td>1</td>
      <td>10.068</td>
      <td>10.068000</td>
      <td>2</td>
      <td>2.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>27</td>
      <td>6.750000</td>
      <td>4</td>
      <td>3158.450</td>
      <td>789.612500</td>
      <td>33</td>
      <td>8.250000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>9</td>
      <td>2.250000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>60</td>
      <td>258</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>20170220</td>
      <td>20170319</td>
      <td>0</td>
      <td>4.300000</td>
      <td>2017</td>
      <td>2</td>
      <td>24</td>
      <td>6264</td>
      <td>2017</td>
      <td>1</td>
      <td>20</td>
      <td>6229</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>AFcKYsrudzim8OFa+fL/c9g5gZabAbhaJnoM0qmlJfo=</th>
      <td>1</td>
      <td>0</td>
      <td>13</td>
      <td>20160907</td>
      <td>0</td>
      <td>173</td>
      <td>21</td>
      <td>21</td>
      <td>1</td>
      <td>2633.631</td>
      <td>2633.631</td>
      <td>13</td>
      <td>13</td>
      <td>3</td>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>8</td>
      <td>8</td>
      <td>228</td>
      <td>32.571429</td>
      <td>7</td>
      <td>32731.138</td>
      <td>4675.876857</td>
      <td>140</td>
      <td>20.000000</td>
      <td>29</td>
      <td>4.142857</td>
      <td>14</td>
      <td>2.000000</td>
      <td>20</td>
      <td>2.857143</td>
      <td>95</td>
      <td>13.571429</td>
      <td>512</td>
      <td>36.571429</td>
      <td>14</td>
      <td>98422.408</td>
      <td>7030.172000</td>
      <td>301</td>
      <td>21.500000</td>
      <td>71</td>
      <td>5.071429</td>
      <td>34</td>
      <td>2.428571</td>
      <td>42</td>
      <td>3.000000</td>
      <td>305</td>
      <td>21.785714</td>
      <td>1044</td>
      <td>36.000000</td>
      <td>29</td>
      <td>178909.861</td>
      <td>6169.305552</td>
      <td>656</td>
      <td>22.620690</td>
      <td>135</td>
      <td>4.655172</td>
      <td>61</td>
      <td>2.103448</td>
      <td>74</td>
      <td>2.551724</td>
      <td>571</td>
      <td>19.689655</td>
      <td>4298</td>
      <td>58.876712</td>
      <td>73</td>
      <td>632743.845</td>
      <td>8667.723904</td>
      <td>2717</td>
      <td>37.219178</td>
      <td>393</td>
      <td>5.383562</td>
      <td>188</td>
      <td>2.575342</td>
      <td>189</td>
      <td>2.589041</td>
      <td>2094</td>
      <td>28.684932</td>
      <td>9218</td>
      <td>59.857143</td>
      <td>154</td>
      <td>1232770.399</td>
      <td>8005.002591</td>
      <td>5289</td>
      <td>34.344156</td>
      <td>838</td>
      <td>5.441558</td>
      <td>410</td>
      <td>2.662338</td>
      <td>323</td>
      <td>2.097403</td>
      <td>4204</td>
      <td>27.298701</td>
      <td>9218</td>
      <td>59.857143</td>
      <td>154</td>
      <td>1232770.399</td>
      <td>8005.002591</td>
      <td>5289</td>
      <td>34.344156</td>
      <td>838</td>
      <td>5.441558</td>
      <td>410</td>
      <td>2.662338</td>
      <td>323</td>
      <td>2.097403</td>
      <td>4204</td>
      <td>27.298701</td>
      <td>9218</td>
      <td>59.857143</td>
      <td>154</td>
      <td>1232770.399</td>
      <td>8005.002591</td>
      <td>5289</td>
      <td>34.344156</td>
      <td>838</td>
      <td>5.441558</td>
      <td>410</td>
      <td>2.662338</td>
      <td>323</td>
      <td>2.097403</td>
      <td>4204</td>
      <td>27.298701</td>
      <td>180</td>
      <td>774</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>20170207</td>
      <td>20170306</td>
      <td>0</td>
      <td>4.300000</td>
      <td>2017</td>
      <td>2</td>
      <td>27</td>
      <td>6267</td>
      <td>2016</td>
      <td>9</td>
      <td>7</td>
      <td>6094</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>qk4mEZUYZq+4sQE7bzRYKc5Pvj+Xc7Wmu25DrCzltEU=</th>
      <td>1</td>
      <td>0</td>
      <td>13</td>
      <td>20160902</td>
      <td>0</td>
      <td>177</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>271.093</td>
      <td>271.093</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>243</td>
      <td>34.714286</td>
      <td>7</td>
      <td>60581.740</td>
      <td>8654.534286</td>
      <td>3</td>
      <td>0.428571</td>
      <td>1</td>
      <td>0.142857</td>
      <td>2</td>
      <td>0.285714</td>
      <td>1</td>
      <td>0.142857</td>
      <td>238</td>
      <td>34.000000</td>
      <td>489</td>
      <td>34.928571</td>
      <td>14</td>
      <td>122772.792</td>
      <td>8769.485143</td>
      <td>32</td>
      <td>2.285714</td>
      <td>2</td>
      <td>0.142857</td>
      <td>5</td>
      <td>0.357143</td>
      <td>11</td>
      <td>0.785714</td>
      <td>476</td>
      <td>34.000000</td>
      <td>899</td>
      <td>32.107143</td>
      <td>28</td>
      <td>231622.820</td>
      <td>8272.243571</td>
      <td>73</td>
      <td>2.607143</td>
      <td>7</td>
      <td>0.250000</td>
      <td>11</td>
      <td>0.392857</td>
      <td>14</td>
      <td>0.500000</td>
      <td>893</td>
      <td>31.892857</td>
      <td>2396</td>
      <td>35.235294</td>
      <td>68</td>
      <td>770040.608</td>
      <td>11324.126588</td>
      <td>180</td>
      <td>2.647059</td>
      <td>32</td>
      <td>0.470588</td>
      <td>32</td>
      <td>0.470588</td>
      <td>33</td>
      <td>0.485294</td>
      <td>2953</td>
      <td>43.426471</td>
      <td>3580</td>
      <td>32.844037</td>
      <td>109</td>
      <td>1137009.556</td>
      <td>10431.280330</td>
      <td>423</td>
      <td>3.880734</td>
      <td>72</td>
      <td>0.660550</td>
      <td>58</td>
      <td>0.532110</td>
      <td>58</td>
      <td>0.532110</td>
      <td>4308</td>
      <td>39.522936</td>
      <td>3580</td>
      <td>32.844037</td>
      <td>109</td>
      <td>1137009.556</td>
      <td>10431.280330</td>
      <td>423</td>
      <td>3.880734</td>
      <td>72</td>
      <td>0.660550</td>
      <td>58</td>
      <td>0.532110</td>
      <td>58</td>
      <td>0.532110</td>
      <td>4308</td>
      <td>39.522936</td>
      <td>3580</td>
      <td>32.844037</td>
      <td>109</td>
      <td>1137009.556</td>
      <td>10431.280330</td>
      <td>423</td>
      <td>3.880734</td>
      <td>72</td>
      <td>0.660550</td>
      <td>58</td>
      <td>0.532110</td>
      <td>58</td>
      <td>0.532110</td>
      <td>4308</td>
      <td>39.522936</td>
      <td>180</td>
      <td>774</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>20170202</td>
      <td>20170301</td>
      <td>0</td>
      <td>4.300000</td>
      <td>2017</td>
      <td>2</td>
      <td>26</td>
      <td>6266</td>
      <td>2016</td>
      <td>9</td>
      <td>2</td>
      <td>6089</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>G2UGNLph2J6euGmZ7WIa1+Kc+dPZBJI0HbLPu5YtrZw=</th>
      <td>1</td>
      <td>0</td>
      <td>13</td>
      <td>20161028</td>
      <td>0</td>
      <td>123</td>
      <td>17</td>
      <td>17</td>
      <td>1</td>
      <td>1626.704</td>
      <td>1626.704</td>
      <td>15</td>
      <td>15</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>6</td>
      <td>121</td>
      <td>24.200000</td>
      <td>5</td>
      <td>30054.147</td>
      <td>6010.829400</td>
      <td>29</td>
      <td>5.800000</td>
      <td>10</td>
      <td>2.000000</td>
      <td>5</td>
      <td>1.000000</td>
      <td>2</td>
      <td>0.400000</td>
      <td>123</td>
      <td>24.600000</td>
      <td>192</td>
      <td>17.454545</td>
      <td>11</td>
      <td>43518.795</td>
      <td>3956.254091</td>
      <td>44</td>
      <td>4.000000</td>
      <td>11</td>
      <td>1.000000</td>
      <td>7</td>
      <td>0.636364</td>
      <td>7</td>
      <td>0.636364</td>
      <td>174</td>
      <td>15.818182</td>
      <td>457</td>
      <td>17.576923</td>
      <td>26</td>
      <td>111841.140</td>
      <td>4301.582308</td>
      <td>80</td>
      <td>3.076923</td>
      <td>23</td>
      <td>0.884615</td>
      <td>15</td>
      <td>0.576923</td>
      <td>15</td>
      <td>0.576923</td>
      <td>456</td>
      <td>17.538462</td>
      <td>1229</td>
      <td>21.189655</td>
      <td>58</td>
      <td>287422.839</td>
      <td>4955.566190</td>
      <td>203</td>
      <td>3.500000</td>
      <td>81</td>
      <td>1.396552</td>
      <td>55</td>
      <td>0.948276</td>
      <td>60</td>
      <td>1.034483</td>
      <td>1145</td>
      <td>19.741379</td>
      <td>1441</td>
      <td>20.884058</td>
      <td>69</td>
      <td>326268.069</td>
      <td>4728.522739</td>
      <td>247</td>
      <td>3.579710</td>
      <td>115</td>
      <td>1.666667</td>
      <td>74</td>
      <td>1.072464</td>
      <td>76</td>
      <td>1.101449</td>
      <td>1272</td>
      <td>18.434783</td>
      <td>1441</td>
      <td>20.884058</td>
      <td>69</td>
      <td>326268.069</td>
      <td>4728.522739</td>
      <td>247</td>
      <td>3.579710</td>
      <td>115</td>
      <td>1.666667</td>
      <td>74</td>
      <td>1.072464</td>
      <td>76</td>
      <td>1.101449</td>
      <td>1272</td>
      <td>18.434783</td>
      <td>1441</td>
      <td>20.884058</td>
      <td>69</td>
      <td>326268.069</td>
      <td>4728.522739</td>
      <td>247</td>
      <td>3.579710</td>
      <td>115</td>
      <td>1.666667</td>
      <td>74</td>
      <td>1.072464</td>
      <td>76</td>
      <td>1.101449</td>
      <td>1272</td>
      <td>18.434783</td>
      <td>150</td>
      <td>596</td>
      <td>3.973333</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>20170228</td>
      <td>20170327</td>
      <td>0</td>
      <td>4.966667</td>
      <td>2017</td>
      <td>2</td>
      <td>28</td>
      <td>6268</td>
      <td>2016</td>
      <td>10</td>
      <td>28</td>
      <td>6145</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>EqSHZpMj5uddJvv2gXcHvuOKFOdS5NN6RalHfzEhhaI=</th>
      <td>1</td>
      <td>0</td>
      <td>13</td>
      <td>20161004</td>
      <td>0</td>
      <td>22</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>156.204</td>
      <td>156.204</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14</td>
      <td>7.000000</td>
      <td>2</td>
      <td>2399.824</td>
      <td>1199.912000</td>
      <td>4</td>
      <td>2.000000</td>
      <td>5</td>
      <td>2.500000</td>
      <td>4</td>
      <td>2.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>5</td>
      <td>2.500000</td>
      <td>17</td>
      <td>4.250000</td>
      <td>4</td>
      <td>2630.818</td>
      <td>657.704500</td>
      <td>5</td>
      <td>1.250000</td>
      <td>7</td>
      <td>1.750000</td>
      <td>4</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>5</td>
      <td>1.250000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>150</td>
      <td>645</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>20170204</td>
      <td>20170303</td>
      <td>0</td>
      <td>4.300000</td>
      <td>2016</td>
      <td>10</td>
      <td>26</td>
      <td>6143</td>
      <td>2016</td>
      <td>10</td>
      <td>4</td>
      <td>6121</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<p>The team added a few more features to improve the model, comparing (subtracting) the latest transaction date, latest expiry date, and latest user log date in the cell below:</p>
<div class="highlight"><pre><span></span><span class="c1">#First transform these into datetime, then into 4 components</span>
<span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;latest_transaction_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd_to_date</span><span class="p">(</span><span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;latest_transaction_date&#39;</span><span class="p">])</span>
<span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;latest_expire_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd_to_date</span><span class="p">(</span><span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;latest_expire_date&#39;</span><span class="p">])</span>
<span class="n">split_date_col</span><span class="p">(</span><span class="s1">&#39;latest_transaction_date&#39;</span><span class="p">)</span>
<span class="n">split_date_col</span><span class="p">(</span><span class="s1">&#39;latest_expire_date&#39;</span><span class="p">)</span>

<span class="c1">#Now perform the subtraction of all 3 combinations</span>
<span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;latest_trans_vs_expire&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;latest_transaction_date_absday&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;latest_expire_date_absday&#39;</span><span class="p">]</span>
<span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;latest_trans_vs_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;latest_transaction_date_absday&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;date_featuresdatemax_date_absday&#39;</span><span class="p">]</span>
<span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;latest_log_vs_expire&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;date_featuresdatemax_date_absday&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;latest_expire_date_absday&#39;</span><span class="p">]</span>

<span class="n">df_fa</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>city</th>
      <th>bd</th>
      <th>registered_via</th>
      <th>registration_init_time</th>
      <th>is_churn</th>
      <th>date_featuresdatelistening_tenure</th>
      <th>within_days_1num_unqsum</th>
      <th>within_days_1num_unqmean</th>
      <th>within_days_1num_unqcount</th>
      <th>within_days_1total_secssum</th>
      <th>within_days_1total_secsmean</th>
      <th>within_days_1num_25sum</th>
      <th>within_days_1num_25mean</th>
      <th>within_days_1num_50sum</th>
      <th>within_days_1num_50mean</th>
      <th>within_days_1num_75sum</th>
      <th>within_days_1num_75mean</th>
      <th>within_days_1num_985sum</th>
      <th>within_days_1num_985mean</th>
      <th>within_days_1num_100sum</th>
      <th>within_days_1num_100mean</th>
      <th>within_days_7num_unqsum</th>
      <th>within_days_7num_unqmean</th>
      <th>within_days_7num_unqcount</th>
      <th>within_days_7total_secssum</th>
      <th>within_days_7total_secsmean</th>
      <th>within_days_7num_25sum</th>
      <th>within_days_7num_25mean</th>
      <th>within_days_7num_50sum</th>
      <th>within_days_7num_50mean</th>
      <th>within_days_7num_75sum</th>
      <th>within_days_7num_75mean</th>
      <th>within_days_7num_985sum</th>
      <th>within_days_7num_985mean</th>
      <th>within_days_7num_100sum</th>
      <th>within_days_7num_100mean</th>
      <th>within_days_14num_unqsum</th>
      <th>within_days_14num_unqmean</th>
      <th>within_days_14num_unqcount</th>
      <th>within_days_14total_secssum</th>
      <th>within_days_14total_secsmean</th>
      <th>within_days_14num_25sum</th>
      <th>within_days_14num_25mean</th>
      <th>within_days_14num_50sum</th>
      <th>within_days_14num_50mean</th>
      <th>within_days_14num_75sum</th>
      <th>within_days_14num_75mean</th>
      <th>within_days_14num_985sum</th>
      <th>within_days_14num_985mean</th>
      <th>within_days_14num_100sum</th>
      <th>within_days_14num_100mean</th>
      <th>within_days_31num_unqsum</th>
      <th>within_days_31num_unqmean</th>
      <th>within_days_31num_unqcount</th>
      <th>within_days_31total_secssum</th>
      <th>within_days_31total_secsmean</th>
      <th>within_days_31num_25sum</th>
      <th>within_days_31num_25mean</th>
      <th>within_days_31num_50sum</th>
      <th>within_days_31num_50mean</th>
      <th>within_days_31num_75sum</th>
      <th>within_days_31num_75mean</th>
      <th>within_days_31num_985sum</th>
      <th>within_days_31num_985mean</th>
      <th>within_days_31num_100sum</th>
      <th>within_days_31num_100mean</th>
      <th>within_days_90num_unqsum</th>
      <th>within_days_90num_unqmean</th>
      <th>within_days_90num_unqcount</th>
      <th>within_days_90total_secssum</th>
      <th>within_days_90total_secsmean</th>
      <th>within_days_90num_25sum</th>
      <th>within_days_90num_25mean</th>
      <th>within_days_90num_50sum</th>
      <th>within_days_90num_50mean</th>
      <th>within_days_90num_75sum</th>
      <th>within_days_90num_75mean</th>
      <th>within_days_90num_985sum</th>
      <th>within_days_90num_985mean</th>
      <th>within_days_90num_100sum</th>
      <th>within_days_90num_100mean</th>
      <th>within_days_180num_unqsum</th>
      <th>within_days_180num_unqmean</th>
      <th>within_days_180num_unqcount</th>
      <th>within_days_180total_secssum</th>
      <th>within_days_180total_secsmean</th>
      <th>within_days_180num_25sum</th>
      <th>within_days_180num_25mean</th>
      <th>within_days_180num_50sum</th>
      <th>within_days_180num_50mean</th>
      <th>within_days_180num_75sum</th>
      <th>within_days_180num_75mean</th>
      <th>within_days_180num_985sum</th>
      <th>within_days_180num_985mean</th>
      <th>within_days_180num_100sum</th>
      <th>within_days_180num_100mean</th>
      <th>within_days_365num_unqsum</th>
      <th>within_days_365num_unqmean</th>
      <th>within_days_365num_unqcount</th>
      <th>within_days_365total_secssum</th>
      <th>within_days_365total_secsmean</th>
      <th>within_days_365num_25sum</th>
      <th>within_days_365num_25mean</th>
      <th>within_days_365num_50sum</th>
      <th>within_days_365num_50mean</th>
      <th>within_days_365num_75sum</th>
      <th>within_days_365num_75mean</th>
      <th>within_days_365num_985sum</th>
      <th>within_days_365num_985mean</th>
      <th>within_days_365num_100sum</th>
      <th>within_days_365num_100mean</th>
      <th>within_days_9999num_unqsum</th>
      <th>within_days_9999num_unqmean</th>
      <th>within_days_9999num_unqcount</th>
      <th>within_days_9999total_secssum</th>
      <th>within_days_9999total_secsmean</th>
      <th>within_days_9999num_25sum</th>
      <th>within_days_9999num_25mean</th>
      <th>within_days_9999num_50sum</th>
      <th>within_days_9999num_50mean</th>
      <th>within_days_9999num_75sum</th>
      <th>within_days_9999num_75mean</th>
      <th>within_days_9999num_985sum</th>
      <th>within_days_9999num_985mean</th>
      <th>within_days_9999num_100sum</th>
      <th>within_days_9999num_100mean</th>
      <th>total_plan_days</th>
      <th>total_amount_paid</th>
      <th>amount_paid_per_day</th>
      <th>diff_renewal_duration</th>
      <th>diff_plan_amount_paid_per_day</th>
      <th>latest_payment_method_id</th>
      <th>latest_plan_days</th>
      <th>latest_plan_list_price</th>
      <th>latest_amount_paid</th>
      <th>latest_auto_renew</th>
      <th>latest_is_cancel</th>
      <th>latest_amount_paid_per_day</th>
      <th>date_featuresdatemax_date_year</th>
      <th>date_featuresdatemax_date_month</th>
      <th>date_featuresdatemax_date_day</th>
      <th>date_featuresdatemax_date_absday</th>
      <th>date_featuresdatemin_date_year</th>
      <th>date_featuresdatemin_date_month</th>
      <th>date_featuresdatemin_date_day</th>
      <th>date_featuresdatemin_date_absday</th>
      <th>female</th>
      <th>male</th>
      <th>latest_transaction_date_year</th>
      <th>latest_transaction_date_month</th>
      <th>latest_transaction_date_day</th>
      <th>latest_transaction_date_absday</th>
      <th>latest_expire_date_year</th>
      <th>latest_expire_date_month</th>
      <th>latest_expire_date_day</th>
      <th>latest_expire_date_absday</th>
      <th>latest_trans_vs_expire</th>
      <th>latest_trans_vs_log</th>
      <th>latest_log_vs_expire</th>
    </tr>
    <tr>
      <th>msno</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mKfgXQAmVeSKzN4rXW37qz0HbGCuYBspTBM3ONXZudg=</th>
      <td>1</td>
      <td>0</td>
      <td>13</td>
      <td>20170120</td>
      <td>0</td>
      <td>35</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>10.068</td>
      <td>10.068</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1.000000</td>
      <td>1</td>
      <td>10.068</td>
      <td>10.068000</td>
      <td>2</td>
      <td>2.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1</td>
      <td>1.000000</td>
      <td>1</td>
      <td>10.068</td>
      <td>10.068000</td>
      <td>2</td>
      <td>2.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>27</td>
      <td>6.750000</td>
      <td>4</td>
      <td>3158.450</td>
      <td>789.612500</td>
      <td>33</td>
      <td>8.250000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>9</td>
      <td>2.250000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>60</td>
      <td>258</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>0</td>
      <td>4.300000</td>
      <td>2017</td>
      <td>2</td>
      <td>24</td>
      <td>6264</td>
      <td>2017</td>
      <td>1</td>
      <td>20</td>
      <td>6229</td>
      <td>0</td>
      <td>0</td>
      <td>2017</td>
      <td>2</td>
      <td>20</td>
      <td>6260</td>
      <td>2017</td>
      <td>3</td>
      <td>19</td>
      <td>6287</td>
      <td>-27</td>
      <td>-4</td>
      <td>-23</td>
    </tr>
    <tr>
      <th>AFcKYsrudzim8OFa+fL/c9g5gZabAbhaJnoM0qmlJfo=</th>
      <td>1</td>
      <td>0</td>
      <td>13</td>
      <td>20160907</td>
      <td>0</td>
      <td>173</td>
      <td>21</td>
      <td>21</td>
      <td>1</td>
      <td>2633.631</td>
      <td>2633.631</td>
      <td>13</td>
      <td>13</td>
      <td>3</td>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>8</td>
      <td>8</td>
      <td>228</td>
      <td>32.571429</td>
      <td>7</td>
      <td>32731.138</td>
      <td>4675.876857</td>
      <td>140</td>
      <td>20.000000</td>
      <td>29</td>
      <td>4.142857</td>
      <td>14</td>
      <td>2.000000</td>
      <td>20</td>
      <td>2.857143</td>
      <td>95</td>
      <td>13.571429</td>
      <td>512</td>
      <td>36.571429</td>
      <td>14</td>
      <td>98422.408</td>
      <td>7030.172000</td>
      <td>301</td>
      <td>21.500000</td>
      <td>71</td>
      <td>5.071429</td>
      <td>34</td>
      <td>2.428571</td>
      <td>42</td>
      <td>3.000000</td>
      <td>305</td>
      <td>21.785714</td>
      <td>1044</td>
      <td>36.000000</td>
      <td>29</td>
      <td>178909.861</td>
      <td>6169.305552</td>
      <td>656</td>
      <td>22.620690</td>
      <td>135</td>
      <td>4.655172</td>
      <td>61</td>
      <td>2.103448</td>
      <td>74</td>
      <td>2.551724</td>
      <td>571</td>
      <td>19.689655</td>
      <td>4298</td>
      <td>58.876712</td>
      <td>73</td>
      <td>632743.845</td>
      <td>8667.723904</td>
      <td>2717</td>
      <td>37.219178</td>
      <td>393</td>
      <td>5.383562</td>
      <td>188</td>
      <td>2.575342</td>
      <td>189</td>
      <td>2.589041</td>
      <td>2094</td>
      <td>28.684932</td>
      <td>9218</td>
      <td>59.857143</td>
      <td>154</td>
      <td>1232770.399</td>
      <td>8005.002591</td>
      <td>5289</td>
      <td>34.344156</td>
      <td>838</td>
      <td>5.441558</td>
      <td>410</td>
      <td>2.662338</td>
      <td>323</td>
      <td>2.097403</td>
      <td>4204</td>
      <td>27.298701</td>
      <td>9218</td>
      <td>59.857143</td>
      <td>154</td>
      <td>1232770.399</td>
      <td>8005.002591</td>
      <td>5289</td>
      <td>34.344156</td>
      <td>838</td>
      <td>5.441558</td>
      <td>410</td>
      <td>2.662338</td>
      <td>323</td>
      <td>2.097403</td>
      <td>4204</td>
      <td>27.298701</td>
      <td>9218</td>
      <td>59.857143</td>
      <td>154</td>
      <td>1232770.399</td>
      <td>8005.002591</td>
      <td>5289</td>
      <td>34.344156</td>
      <td>838</td>
      <td>5.441558</td>
      <td>410</td>
      <td>2.662338</td>
      <td>323</td>
      <td>2.097403</td>
      <td>4204</td>
      <td>27.298701</td>
      <td>180</td>
      <td>774</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>0</td>
      <td>4.300000</td>
      <td>2017</td>
      <td>2</td>
      <td>27</td>
      <td>6267</td>
      <td>2016</td>
      <td>9</td>
      <td>7</td>
      <td>6094</td>
      <td>0</td>
      <td>0</td>
      <td>2017</td>
      <td>2</td>
      <td>7</td>
      <td>6247</td>
      <td>2017</td>
      <td>3</td>
      <td>6</td>
      <td>6274</td>
      <td>-27</td>
      <td>-20</td>
      <td>-7</td>
    </tr>
    <tr>
      <th>qk4mEZUYZq+4sQE7bzRYKc5Pvj+Xc7Wmu25DrCzltEU=</th>
      <td>1</td>
      <td>0</td>
      <td>13</td>
      <td>20160902</td>
      <td>0</td>
      <td>177</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>271.093</td>
      <td>271.093</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>243</td>
      <td>34.714286</td>
      <td>7</td>
      <td>60581.740</td>
      <td>8654.534286</td>
      <td>3</td>
      <td>0.428571</td>
      <td>1</td>
      <td>0.142857</td>
      <td>2</td>
      <td>0.285714</td>
      <td>1</td>
      <td>0.142857</td>
      <td>238</td>
      <td>34.000000</td>
      <td>489</td>
      <td>34.928571</td>
      <td>14</td>
      <td>122772.792</td>
      <td>8769.485143</td>
      <td>32</td>
      <td>2.285714</td>
      <td>2</td>
      <td>0.142857</td>
      <td>5</td>
      <td>0.357143</td>
      <td>11</td>
      <td>0.785714</td>
      <td>476</td>
      <td>34.000000</td>
      <td>899</td>
      <td>32.107143</td>
      <td>28</td>
      <td>231622.820</td>
      <td>8272.243571</td>
      <td>73</td>
      <td>2.607143</td>
      <td>7</td>
      <td>0.250000</td>
      <td>11</td>
      <td>0.392857</td>
      <td>14</td>
      <td>0.500000</td>
      <td>893</td>
      <td>31.892857</td>
      <td>2396</td>
      <td>35.235294</td>
      <td>68</td>
      <td>770040.608</td>
      <td>11324.126588</td>
      <td>180</td>
      <td>2.647059</td>
      <td>32</td>
      <td>0.470588</td>
      <td>32</td>
      <td>0.470588</td>
      <td>33</td>
      <td>0.485294</td>
      <td>2953</td>
      <td>43.426471</td>
      <td>3580</td>
      <td>32.844037</td>
      <td>109</td>
      <td>1137009.556</td>
      <td>10431.280330</td>
      <td>423</td>
      <td>3.880734</td>
      <td>72</td>
      <td>0.660550</td>
      <td>58</td>
      <td>0.532110</td>
      <td>58</td>
      <td>0.532110</td>
      <td>4308</td>
      <td>39.522936</td>
      <td>3580</td>
      <td>32.844037</td>
      <td>109</td>
      <td>1137009.556</td>
      <td>10431.280330</td>
      <td>423</td>
      <td>3.880734</td>
      <td>72</td>
      <td>0.660550</td>
      <td>58</td>
      <td>0.532110</td>
      <td>58</td>
      <td>0.532110</td>
      <td>4308</td>
      <td>39.522936</td>
      <td>3580</td>
      <td>32.844037</td>
      <td>109</td>
      <td>1137009.556</td>
      <td>10431.280330</td>
      <td>423</td>
      <td>3.880734</td>
      <td>72</td>
      <td>0.660550</td>
      <td>58</td>
      <td>0.532110</td>
      <td>58</td>
      <td>0.532110</td>
      <td>4308</td>
      <td>39.522936</td>
      <td>180</td>
      <td>774</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>0</td>
      <td>4.300000</td>
      <td>2017</td>
      <td>2</td>
      <td>26</td>
      <td>6266</td>
      <td>2016</td>
      <td>9</td>
      <td>2</td>
      <td>6089</td>
      <td>0</td>
      <td>0</td>
      <td>2017</td>
      <td>2</td>
      <td>2</td>
      <td>6242</td>
      <td>2017</td>
      <td>3</td>
      <td>1</td>
      <td>6269</td>
      <td>-27</td>
      <td>-24</td>
      <td>-3</td>
    </tr>
    <tr>
      <th>G2UGNLph2J6euGmZ7WIa1+Kc+dPZBJI0HbLPu5YtrZw=</th>
      <td>1</td>
      <td>0</td>
      <td>13</td>
      <td>20161028</td>
      <td>0</td>
      <td>123</td>
      <td>17</td>
      <td>17</td>
      <td>1</td>
      <td>1626.704</td>
      <td>1626.704</td>
      <td>15</td>
      <td>15</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>6</td>
      <td>121</td>
      <td>24.200000</td>
      <td>5</td>
      <td>30054.147</td>
      <td>6010.829400</td>
      <td>29</td>
      <td>5.800000</td>
      <td>10</td>
      <td>2.000000</td>
      <td>5</td>
      <td>1.000000</td>
      <td>2</td>
      <td>0.400000</td>
      <td>123</td>
      <td>24.600000</td>
      <td>192</td>
      <td>17.454545</td>
      <td>11</td>
      <td>43518.795</td>
      <td>3956.254091</td>
      <td>44</td>
      <td>4.000000</td>
      <td>11</td>
      <td>1.000000</td>
      <td>7</td>
      <td>0.636364</td>
      <td>7</td>
      <td>0.636364</td>
      <td>174</td>
      <td>15.818182</td>
      <td>457</td>
      <td>17.576923</td>
      <td>26</td>
      <td>111841.140</td>
      <td>4301.582308</td>
      <td>80</td>
      <td>3.076923</td>
      <td>23</td>
      <td>0.884615</td>
      <td>15</td>
      <td>0.576923</td>
      <td>15</td>
      <td>0.576923</td>
      <td>456</td>
      <td>17.538462</td>
      <td>1229</td>
      <td>21.189655</td>
      <td>58</td>
      <td>287422.839</td>
      <td>4955.566190</td>
      <td>203</td>
      <td>3.500000</td>
      <td>81</td>
      <td>1.396552</td>
      <td>55</td>
      <td>0.948276</td>
      <td>60</td>
      <td>1.034483</td>
      <td>1145</td>
      <td>19.741379</td>
      <td>1441</td>
      <td>20.884058</td>
      <td>69</td>
      <td>326268.069</td>
      <td>4728.522739</td>
      <td>247</td>
      <td>3.579710</td>
      <td>115</td>
      <td>1.666667</td>
      <td>74</td>
      <td>1.072464</td>
      <td>76</td>
      <td>1.101449</td>
      <td>1272</td>
      <td>18.434783</td>
      <td>1441</td>
      <td>20.884058</td>
      <td>69</td>
      <td>326268.069</td>
      <td>4728.522739</td>
      <td>247</td>
      <td>3.579710</td>
      <td>115</td>
      <td>1.666667</td>
      <td>74</td>
      <td>1.072464</td>
      <td>76</td>
      <td>1.101449</td>
      <td>1272</td>
      <td>18.434783</td>
      <td>1441</td>
      <td>20.884058</td>
      <td>69</td>
      <td>326268.069</td>
      <td>4728.522739</td>
      <td>247</td>
      <td>3.579710</td>
      <td>115</td>
      <td>1.666667</td>
      <td>74</td>
      <td>1.072464</td>
      <td>76</td>
      <td>1.101449</td>
      <td>1272</td>
      <td>18.434783</td>
      <td>150</td>
      <td>596</td>
      <td>3.973333</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>0</td>
      <td>4.966667</td>
      <td>2017</td>
      <td>2</td>
      <td>28</td>
      <td>6268</td>
      <td>2016</td>
      <td>10</td>
      <td>28</td>
      <td>6145</td>
      <td>0</td>
      <td>0</td>
      <td>2017</td>
      <td>2</td>
      <td>28</td>
      <td>6268</td>
      <td>2017</td>
      <td>3</td>
      <td>27</td>
      <td>6295</td>
      <td>-27</td>
      <td>0</td>
      <td>-27</td>
    </tr>
    <tr>
      <th>EqSHZpMj5uddJvv2gXcHvuOKFOdS5NN6RalHfzEhhaI=</th>
      <td>1</td>
      <td>0</td>
      <td>13</td>
      <td>20161004</td>
      <td>0</td>
      <td>22</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>156.204</td>
      <td>156.204</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14</td>
      <td>7.000000</td>
      <td>2</td>
      <td>2399.824</td>
      <td>1199.912000</td>
      <td>4</td>
      <td>2.000000</td>
      <td>5</td>
      <td>2.500000</td>
      <td>4</td>
      <td>2.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>5</td>
      <td>2.500000</td>
      <td>17</td>
      <td>4.250000</td>
      <td>4</td>
      <td>2630.818</td>
      <td>657.704500</td>
      <td>5</td>
      <td>1.250000</td>
      <td>7</td>
      <td>1.750000</td>
      <td>4</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>5</td>
      <td>1.250000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>150</td>
      <td>645</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>0</td>
      <td>4.300000</td>
      <td>2016</td>
      <td>10</td>
      <td>26</td>
      <td>6143</td>
      <td>2016</td>
      <td>10</td>
      <td>4</td>
      <td>6121</td>
      <td>0</td>
      <td>0</td>
      <td>2017</td>
      <td>2</td>
      <td>4</td>
      <td>6244</td>
      <td>2017</td>
      <td>3</td>
      <td>3</td>
      <td>6271</td>
      <td>-27</td>
      <td>101</td>
      <td>-128</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="n">df_fa</span><span class="o">.</span><span class="n">shape</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">(88544, 159)</span>
</pre></div>


<h1>7. Quick Exploratory Data Analysis</h1>
<p>Next, we perform some quick EDA on our data.</p>
<h2>Combined Dataset</h2>
<div class="highlight"><pre><span></span><span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="k">for</span> <span class="n">color</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;no_churn&#39;</span><span class="p">,</span> <span class="s1">&#39;churn&#39;</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_fa</span><span class="p">[</span><span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">][</span><span class="s1">&#39;date_featuresdatelistening_tenure&#39;</span><span class="p">],</span>
               <span class="n">df_fa</span><span class="p">[</span><span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">][</span><span class="s1">&#39;within_days_7num_unqmean&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Listening Tenure&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mean Number of Unique listening Periods in the last 7 days&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Text(0,0.5,&#39;Mean Number of Unique listening Periods in the last 7 days&#39;)</span>
</pre></div>


<p><img src="images/churn/output_70_1.png" alt="Drawing" style="width: 750px;"/></p>
<p>Looking at the above plot, we can see that overall people who churn have low numbers of unique plays, meaning they aren't using the music service. We can also see a spike in number of unique plays for users who have a long tenure (&gt;700 days). Intuitively this makes sense as users who are commited to the service (have used the service for a long time) may have developed lifestyle patterns where they use the service while driving/working/etc.</p>
<div class="highlight"><pre><span></span><span class="n">avg_price_no_churn</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">df_fa</span><span class="p">[</span><span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;amount_paid_per_day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">avg_price_is_churn</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">df_fa</span><span class="p">[</span><span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;amount_paid_per_day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Avg cost/day for no churn: </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">avg_price_no_churn</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Avg cost/day for churn: </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">avg_price_is_churn</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Avg cost/day for no churn: 4.54</span>
<span class="err">Avg cost/day for churn: 4.67</span>
</pre></div>


<p>For users who churn, we can see that they tend to spend more per day on the music subscription service. Our analysis will end with an economic analysis which uses the predictions to model how much incentive should be offered to specific users. This will hopefully help incentivize those customers that will churn and prevent it. </p>
<div class="highlight"><pre><span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">df_fa</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">8</span><span class="p">:</span><span class="mi">99</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">&lt;matplotlib.axes._subplots.AxesSubplot at 0x2261eb32550&gt;</span>
</pre></div>


<p><img src="images/churn/output_74_1.png" alt="Drawing" style="width: 750px;"/></p>
<p>The correlation plot shows that there is correlation amongst the number of unique songs played within the last X number of days (where if the two X values are close together the correlation tends to be higher). This makes sense and is what was expected. </p>
<div class="highlight"><pre><span></span><span class="n">mean_col</span> <span class="o">=</span> <span class="n">df_fa</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">7</span><span class="p">:</span><span class="mi">98</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">mean_col</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">within_days_1num_unqmean      20.698794</span>
<span class="err">within_days_7num_unqmean      21.900082</span>
<span class="err">within_days_14num_unqmean     22.383794</span>
<span class="err">within_days_31num_unqmean     23.271521</span>
<span class="err">within_days_90num_unqmean     24.238664</span>
<span class="err">within_days_180num_unqmean    24.740990</span>
<span class="err">within_days_365num_unqmean    25.245055</span>
<span class="c">dtype: float64</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#plt.plot_date(reg_time, df_fa[&#39;within_days_7total_secsmean&#39;], )</span>
<span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">color</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;no_churn&#39;</span><span class="p">,</span> <span class="s1">&#39;churn&#39;</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot_date</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_fa</span><span class="p">[</span><span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">][</span><span class="s1">&#39;registration_init_time&#39;</span><span class="p">],</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span>
               <span class="n">df_fa</span><span class="p">[</span><span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">][</span><span class="s1">&#39;within_days_7total_secsmean&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Registration Date&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of Seconds (Avg) Listed during last 7 days&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Text(0,0.5,&#39;Number of Seconds (Avg) Listed during last 7 days&#39;)</span>
</pre></div>


<p><img src="images/churn/output_77_1.png" alt="Drawing" style="width: 750px;"/></p>
<p>This plot shows the Registration Date vs Avg seconds listened over past 7 days. The intent will be to change this to transaction date as this will more accurately reflect when the user ends service. We can see a trend in more churn occuring in the last 4 years of the dataset. This could be due to an increased level of users however (same proportion of churn).</p>
<div class="highlight"><pre><span></span><span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;registration_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;registration_init_time&#39;</span><span class="p">],</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<span class="n">reg_count</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">thirty_day_churn</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">2018</span><span class="p">):</span>
    <span class="n">reg_count</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;registration_time&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">))</span>
    <span class="n">thirty_day_churn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_fa</span><span class="p">[(</span><span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;registration_time&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;date_featuresdatelistening_tenure&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)])</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;registration_time&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">2018</span><span class="p">),</span> <span class="n">reg_count</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Year of Registration&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Registration Count Per Year&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">&lt;function matplotlib.pyplot.show&gt;</span>
</pre></div>


<p><img src="images/churn/output_79_1.png" alt="Drawing" style="width: 750px;"/></p>
<div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">2018</span><span class="p">),</span> <span class="n">thirty_day_churn</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Proportion of 30 day Churn to Total Registration&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">&lt;function matplotlib.pyplot.show&gt;</span>
</pre></div>


<p><img src="images/churn/output_80_1.png" alt="Drawing" style="width: 750px;"/></p>
<p>This statistic shows that there is a high level of churn recently for users who are using a trial subscription, or who a very short duration subscription. From a business perspective this is concerning, because it means that a very high level of churn is occuring, and the problem needs to be solved to reduce churn levels back. The sharp spike may have been when the company started offering 30 days subscriptions or some other factor that has caused increased churn for customers with less than 30 day subscriptionps.</p>
<div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;date_featuresdatemax_date_month&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Histogram of the last listen date&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img src="images/churn/output_82_0.png" alt="Drawing" style="width: 750px;"/></p>
<p>The dataset (from the dataset description) was collected to include churn statistics for the months of February and March. We can see here a large peak for the month of February, which intuitively makes sense because users are utilizing the service often and most recently listened in the month in which the data was collected. </p>
<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Is Latest Cancel and Is Churn Correlation: </span><span class="si">%0.4f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;latest_is_cancel&#39;</span><span class="p">],</span> <span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Is Latest Cancel and Is Churn Correlation: 0.4328</span>
</pre></div>


<p>Intuitively we had thought there would be a very high correlation between these two variables. However we can see here that, while there is decent correlation between the two variables, they are not perfectly aligned. This is due to the times when a user cancels their service but does not churn (changes plan type, etc). </p>
<h2>User Logs EDA</h2>
<div class="highlight"><pre><span></span><span class="n">user_logs</span><span class="p">[</span><span class="s1">&#39;num_unq&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">user_logs</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday_name</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Unique Play Count Grouped by Weekday&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">&lt;matplotlib.axes._subplots.AxesSubplot at 0x2261b9b3f28&gt;</span>
</pre></div>


<p><img src="images/churn/output_87_1.png" alt="Drawing" style="width: 750px;"/></p>
<p>The figure above looks at listening behavior grouped by the day of the week. We can see that listening is fairly consitent across all days of the week. The above plot looks at listening counts, but doesn't analyze how long a user is listening for, we can look at the total seconds feature included in the dataset to determine this. </p>
<div class="highlight"><pre><span></span><span class="c1">#This cell takes a long time to plot, print statistics to screen instead</span>
<span class="n">user_logs</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">user_logs</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday_name</span><span class="p">)[</span><span class="s1">&#39;total_secs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">date</span>
<span class="err">Friday      -4.334985e+18</span>
<span class="err">Monday      -3.892263e+18</span>
<span class="err">Saturday    -3.431094e+18</span>
<span class="err">Sunday      -3.855369e+18</span>
<span class="err">Thursday    -3.919933e+18</span>
<span class="err">Tuesday     -3.615562e+18</span>
<span class="err">Wednesday   -3.486435e+18</span>
<span class="c">Name: total_secs, dtype: float64</span>
</pre></div>


<p>There is some odd behavior here, where all of the sums are large negative values. We need to analyze the column itself in order to determine why this odd behavior is observed. </p>
<div class="highlight"><pre><span></span><span class="n">user_logs</span><span class="p">[</span><span class="s1">&#39;total_secs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">count    1.971063e+07</span>
<span class="err">mean    -1.346260e+12</span>
<span class="err">std      1.116172e+14</span>
<span class="err">min     -9.223372e+15</span>
<span class="err">25%      1.966237e+03</span>
<span class="err">50%      4.703210e+03</span>
<span class="err">75%      1.028291e+04</span>
<span class="err">max      9.223372e+15</span>
<span class="c">Name: total_secs, dtype: float64</span>
</pre></div>


<p>The mean value for this column is in fact negative, which intuitively doesn't make sense as it is not possible to listen to a song a for a negative time period. Further analysis regarding the method in which the software calculates total_secs will be important to better understand why negative values are being written to the database. </p>
<p>To further explore the total seconds columns, below we analyze the sum of the total seconds by user.</p>
<div class="highlight"><pre><span></span><span class="c1">#This cell takes a long time to plot, print statistics to screen instead</span>
<span class="n">user_logs</span><span class="p">[</span><span class="s1">&#39;total_secs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">user_logs</span><span class="p">[</span><span class="s1">&#39;msno&#39;</span><span class="p">],</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">count    8.855000e+04</span>
<span class="err">mean    -2.996684e+14</span>
<span class="err">std      3.620704e+15</span>
<span class="err">min     -3.135946e+17</span>
<span class="err">25%      2.145492e+05</span>
<span class="err">50%      8.453256e+05</span>
<span class="err">75%      2.223251e+06</span>
<span class="err">max      9.223372e+15</span>
<span class="c">Name: total_secs, dtype: float64</span>
</pre></div>


<p>We continue to see negative values, even when summing over the total listening time for a specific user. This behavior is strange and now well understood. Further investigation into the matter will be necessary to determine why negative listening times are computed. </p>
<div class="highlight"><pre><span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">user_logs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">&lt;matplotlib.axes._subplots.AxesSubplot at 0x2261ba97630&gt;</span>
</pre></div>


<p><img alt="png" src="output_95_1.png"></p>
<p><img src="images/churn/output_82_0.png" alt="Drawing" style="width: 750px;"/></p>
<p>This correlation plot anaylzes the correlation between the num columns in the dataset. From the definition at the start of this notebook, these columns represent the songs that have been played to a certain proportion of the total song length (25%, 50%, etc). Here we can see relatively low correlation between the columns.</p>
<p>The higher listening buckets do not factor in songs that fall below the bucket cutoff (ie for the num_50 bucket it doesn't count a song if it is played &lt;50%, but rather 25-50% of the time). We found this behavior insteresting and wanted to further analyze by plotting a bar chart grouped by these columns.</p>
<div class="highlight"><pre><span></span><span class="n">sum_num</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">user_logs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">2</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">sum_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user_logs</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
    <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sum_num</span><span class="p">)),</span> <span class="n">sum_num</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sum_num</span><span class="p">)),</span> <span class="n">cols</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sum of Proportion Song Listened To&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Text(0.5,1,&#39;Sum of Proportion Song Listened To&#39;)</span>
</pre></div>


<p><img src="images/churn/output_97_1.png" alt="Drawing" style="width: 750px;"/></p>
<p>We can see that num_100 (or listening to the entire song) is by far the most popular method. Num_25 (or less than 25% listened to) was the second most popular column. Intuitively this makes sense as a user is most likely either to like a song and listen to the whole thing, or not like a song and quickly switch to a new song. </p>
<h2>Members EDA</h2>
<div class="highlight"><pre><span></span><span class="n">members</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">members</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Members grouped by gender&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">&lt;matplotlib.axes._subplots.AxesSubplot at 0x2261c88c4e0&gt;</span>
</pre></div>


<p><img src="images/churn/output_100_1.png" alt="Drawing" style="width: 750px;"/></p>
<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Proportion of gender column = N/A: </span><span class="si">%0.4f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">members</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">members</span><span class="p">)))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Proportion of gender column = N/A: 0.4843</span>
</pre></div>


<p>Breakdown by gender, we can see that there are overall a larger proportion of males that utilize the kkbox dataset. Additionally we can see that over 48% of this column is N/A values (meaning that the user didn't supply their gender). This has been accounted for in the combined dataset by separating into two colums of 'male' and 'female' and capturing data in binary format. </p>
<div class="highlight"><pre><span></span><span class="n">members</span><span class="p">[</span><span class="s1">&#39;city&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">members</span><span class="p">[</span><span class="s1">&#39;city&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Count by city&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">&lt;matplotlib.axes._subplots.AxesSubplot at 0x2261b4caf28&gt;</span>
</pre></div>


<p><img src="images/churn/output_103_1.png" alt="Drawing" style="width: 750px;"/></p>
<p>We can see that overall city = 1 has a significantly higher proportion of users, than any other city. The mapping between numeric and actual city names isn't provided, however from an ML perspective this is alright, however for business purposes it would be preferable to have the city names. </p>
<div class="highlight"><pre><span></span><span class="n">members</span><span class="p">[</span><span class="s1">&#39;bd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">members</span><span class="p">[</span><span class="s1">&#39;bd&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Count by birthdate&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">&lt;matplotlib.axes._subplots.AxesSubplot at 0x2261f0ccba8&gt;</span>
</pre></div>


<p><img src="images/churn/output_105_1.png" alt="Drawing" style="width: 750px;"/></p>
<p>The birthdate column has a large peak of entries at the 0 value (presumably not provided by user). Below we filter out the zero value to look at this distribution of birthdays. </p>
<div class="highlight"><pre><span></span><span class="n">members</span><span class="p">[</span><span class="s1">&#39;bd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">members</span><span class="p">[</span><span class="s1">&#39;bd&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Count by birthdate Filtered&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">3000</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img src="images/churn/output_107_0.png" alt="Drawing" style="width: 750px;"/></p>
<p>The distribution of provided birthdays appears to be skewed slightly. From the first plot it was hard to determine the range of entries, below we use the describe function to look at the birthday column. From the data provided we see that there are negative values for the birthate (min = -49) which is odd and needs to be further understood. It would also be helpful to know how this integer is defined (presumably days since a specifc date). </p>
<div class="highlight"><pre><span></span><span class="n">members</span><span class="p">[</span><span class="s1">&#39;bd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">count    89473.000000</span>
<span class="err">mean        14.915069</span>
<span class="err">std         18.416087</span>
<span class="err">min        -49.000000</span>
<span class="err">25%          0.000000</span>
<span class="err">50%         17.000000</span>
<span class="err">75%         27.000000</span>
<span class="err">max       1051.000000</span>
<span class="c">Name: bd, dtype: float64</span>
</pre></div>


<p>The members table provides information about each of the members subscribed to the KKBox service. Through our EDA we noted that there were a few columns with dispraportionately high values, which could make analysis using a machine learning algorithm difficult, as this one common value may make it difficult to discern information from the other data. By including a high number of features, our model will hopefully overcome this difficulty and accurately predict churn. </p>
<p>Moving forward it is preferrable to better understand the data sources and computation and clean up the data collection as best as possible. </p>
<h2>Transactions EDA</h2>
<p>The transactions table contains information related to the subscription to KKBox, including the plan list price, the actual price the user paid as well as payment methods and dates. For payment method, the column is contains integers that map to a specific type of payment, we have not been granted access to the mapping, however from an ML perspective, we can continue to carry out models. When deriving business insight however, access to the mapping of this column will be important. </p>
<div class="highlight"><pre><span></span><span class="n">transactions</span><span class="p">[</span><span class="s1">&#39;payment_method_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">transactions</span><span class="p">[</span><span class="s1">&#39;payment_method_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Count by payment type&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">&lt;matplotlib.axes._subplots.AxesSubplot at 0x2261b7f1588&gt;</span>
</pre></div>


<p><img src="images/churn/output_112_1.png" alt="Drawing" style="width: 750px;"/></p>
<p>From the plot above we can see that payment method 41 is by far the most popular.</p>
<div class="highlight"><pre><span></span><span class="n">transactions</span><span class="p">[</span><span class="s1">&#39;plan_list_price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">transactions</span><span class="p">[</span><span class="s1">&#39;plan_list_price&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Count by plan list price&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">&lt;matplotlib.axes._subplots.AxesSubplot at 0x2262186a6a0&gt;</span>
</pre></div>


<p><img src="images/churn/output_114_1.png" alt="Drawing" style="width: 750px;"/></p>
<p>Above we analyze the popularity of specific plans on kkbox. From their website it appears that there is a free tier, monthly and yearly tiers (this information is as of todays date (4/21/2018) however we do not know the specific plan offerings for the period of data collection for this analysis. </p>
<p>From the plot above we can see there is an overwhelmingly popular plan price at approximately 149.</p>
<div class="highlight"><pre><span></span><span class="n">transactions</span><span class="p">[</span><span class="s1">&#39;prop_collected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">transactions</span><span class="p">[</span><span class="s1">&#39;actual_amount_paid&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">transactions</span><span class="p">[</span><span class="s1">&#39;plan_list_price&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">transactions</span><span class="p">[</span><span class="s1">&#39;prop_collected&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">transactions</span><span class="p">[</span><span class="s1">&#39;prop_collected&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Count by Proportion of Bill Collected&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">&lt;matplotlib.axes._subplots.AxesSubplot at 0x22621958828&gt;</span>
</pre></div>


<p><img src="images/churn/output_116_1.png" alt="Drawing" style="width: 750px;"/></p>
<p>There are two columns in the table that analyze the plan cost and amount collected. We wanted to look and see the distribution of memberships that do not collect the total price of the plan. From above we can see that most plans are fully paid, there is an infinity value which is most likely an error (plan list price of 0 presumably), and there is a peak at 80% </p>
<div class="highlight"><pre><span></span><span class="n">transactions</span><span class="p">[</span><span class="s1">&#39;transaction_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd_to_date</span><span class="p">(</span><span class="n">transactions</span><span class="p">[</span><span class="s1">&#39;transaction_date&#39;</span><span class="p">])</span>
<span class="n">transactions</span><span class="p">[</span><span class="s1">&#39;is_cancel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">transactions</span><span class="p">[</span><span class="s1">&#39;transaction_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Is Cancel by Month&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">&lt;matplotlib.axes._subplots.AxesSubplot at 0x2262195d748&gt;</span>
</pre></div>


<p><img src="images/churn/output_118_1.png" alt="Drawing" style="width: 750px;"/></p>
<p>Our team next wanted to look at the is_cancel category, which has some correlation with churn. By month we can see that users peaked in January and especially February. It would be interesting to see how this correlates to churn (as is_cancel isn't perfectly correlated). If there is a seasonality to churn, then it would be important for predicting churn, and providing business insight to offer incentives to users who's memberships expire in this timeframe to renew.  </p>
<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Is Latest Cancel and Is Auto Renew: </span><span class="si">%0.4f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">transactions</span><span class="p">[</span><span class="s1">&#39;is_cancel&#39;</span><span class="p">],</span> <span class="n">transactions</span><span class="p">[</span><span class="s1">&#39;is_auto_renew&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Is Latest Cancel and Is Auto Renew: 0.0806</span>
</pre></div>


<p>Our team had thought that the cancel and auto renew categories would be negatively correlated (if a user was on an auto renew membership, they may not pay as much attention and forget to cancel/change membership). From the covariance we can see that there is almost no correlation between the two features. </p>
<p>The transactions </p>
<h1>8. Writing Output</h1>
<p>Having extracted our features and performing some data manipulation, we will now write the features file to a .pkl file, allowing us to use this output in the second notebook without having to run all the code above.</p>
<div class="highlight"><pre><span></span><span class="c1">#Write all features to pkl file</span>
<span class="n">df_fa</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;df_fa.pkl&#39;</span><span class="p">)</span>
</pre></div>


<h1>Music Churn:  Predictive Modeling Notebook</h1>
<p>Python Notebook 2 of 3</p>
<h2>W207, Final Project</h2>
<p>Spring, 2018</p>
<p>Team:  Cameron Kennedy, Gaurav Khanna, Aaron Olson</p>
<h2>Overview of Notebooks</h2>
<p>For this project, the team created 3 separate Jupyter Notebooks to document its work.  See notebook #1, (Data Preparation / Feature Extraction) for a brief description of each notebook.</p>
<h2>Table of Contents (this notebook only)</h2>
<ol>
<li>Setup and Loading Libraries</li>
<li>Data Preparation</li>
<li>Predictive Modeling! </li>
<li>Calculating Probabilities</li>
<li>Economic Impact</li>
<li>Final Insights and Takeaways</li>
</ol>
<h1>1. Setup and Loading Libraries</h1>
<div class="highlight"><pre><span></span><span class="c1">#Import Required Libraries</span>
<span class="c1">#Data manipulation and visualization</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="c1">#Models et al</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.grid_search</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">svm</span>
<span class="kn">import</span> <span class="nn">xgboost</span>
<span class="kn">from</span> <span class="nn">sklearn.calibration</span> <span class="kn">import</span> <span class="n">calibration_curve</span><span class="p">,</span> <span class="n">CalibratedClassifierCV</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="p">(</span><span class="n">brier_score_loss</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">log_loss</span><span class="p">)</span>
<span class="c1">#from sklearn.preprocessing import CategoricalEncoder  #Not yet released!</span>

<span class="c1">#Metrics</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="p">(</span><span class="n">roc_curve</span><span class="p">,</span> <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">auc</span><span class="p">,</span> <span class="n">make_scorer</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">,</span> 
    <span class="n">precision_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c">C:\Users\AOlson\AppData\Local\Continuum\anaconda3\lib\site-packages\sklearn\cross_validation.py:41: DeprecationWarning: This module was deprecated in version 0.18 in favor of the model_selection module into which all the refactored classes and functions are moved. Also note that the interface of the new CV iterators are different from that of this module. This module will be removed in 0.20.</span>
<span class="c">  &quot;This module will be removed in 0.20.&quot;, DeprecationWarning)</span>
<span class="c">C:\Users\AOlson\AppData\Local\Continuum\anaconda3\lib\site-packages\sklearn\grid_search.py:42: DeprecationWarning: This module was deprecated in version 0.18 in favor of the model_selection module into which all the refactored classes and functions are moved. This module will be removed in 0.20.</span>
<span class="c">  DeprecationWarning)</span>
</pre></div>


<p>Now we'll load the data and print the first few rows:</p>
<div class="highlight"><pre><span></span><span class="c1"># Load the data</span>
<span class="n">df_fa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s1">&#39;df_fa.pkl&#39;</span><span class="p">)</span>  <span class="c1">#Pickle format preserves file as python object</span>

<span class="c1">#Set initial parameter(s)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_columns</span> <span class="o">=</span> <span class="mi">2000</span>

<span class="c1">#Ensure it&#39;s what we expect:</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_fa</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">df_fa</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">(88544, 160)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>city</th>
      <th>bd</th>
      <th>registered_via</th>
      <th>registration_init_time</th>
      <th>is_churn</th>
      <th>date_featuresdatelistening_tenure</th>
      <th>within_days_1num_unqsum</th>
      <th>within_days_1num_unqmean</th>
      <th>within_days_1num_unqcount</th>
      <th>within_days_1total_secssum</th>
      <th>within_days_1total_secsmean</th>
      <th>within_days_1num_25sum</th>
      <th>within_days_1num_25mean</th>
      <th>within_days_1num_50sum</th>
      <th>within_days_1num_50mean</th>
      <th>within_days_1num_75sum</th>
      <th>within_days_1num_75mean</th>
      <th>within_days_1num_985sum</th>
      <th>within_days_1num_985mean</th>
      <th>within_days_1num_100sum</th>
      <th>within_days_1num_100mean</th>
      <th>within_days_7num_unqsum</th>
      <th>within_days_7num_unqmean</th>
      <th>within_days_7num_unqcount</th>
      <th>within_days_7total_secssum</th>
      <th>within_days_7total_secsmean</th>
      <th>within_days_7num_25sum</th>
      <th>within_days_7num_25mean</th>
      <th>within_days_7num_50sum</th>
      <th>within_days_7num_50mean</th>
      <th>within_days_7num_75sum</th>
      <th>within_days_7num_75mean</th>
      <th>within_days_7num_985sum</th>
      <th>within_days_7num_985mean</th>
      <th>within_days_7num_100sum</th>
      <th>within_days_7num_100mean</th>
      <th>within_days_14num_unqsum</th>
      <th>within_days_14num_unqmean</th>
      <th>within_days_14num_unqcount</th>
      <th>within_days_14total_secssum</th>
      <th>within_days_14total_secsmean</th>
      <th>within_days_14num_25sum</th>
      <th>within_days_14num_25mean</th>
      <th>within_days_14num_50sum</th>
      <th>within_days_14num_50mean</th>
      <th>within_days_14num_75sum</th>
      <th>within_days_14num_75mean</th>
      <th>within_days_14num_985sum</th>
      <th>within_days_14num_985mean</th>
      <th>within_days_14num_100sum</th>
      <th>within_days_14num_100mean</th>
      <th>within_days_31num_unqsum</th>
      <th>within_days_31num_unqmean</th>
      <th>within_days_31num_unqcount</th>
      <th>within_days_31total_secssum</th>
      <th>within_days_31total_secsmean</th>
      <th>within_days_31num_25sum</th>
      <th>within_days_31num_25mean</th>
      <th>within_days_31num_50sum</th>
      <th>within_days_31num_50mean</th>
      <th>within_days_31num_75sum</th>
      <th>within_days_31num_75mean</th>
      <th>within_days_31num_985sum</th>
      <th>within_days_31num_985mean</th>
      <th>within_days_31num_100sum</th>
      <th>within_days_31num_100mean</th>
      <th>within_days_90num_unqsum</th>
      <th>within_days_90num_unqmean</th>
      <th>within_days_90num_unqcount</th>
      <th>within_days_90total_secssum</th>
      <th>within_days_90total_secsmean</th>
      <th>within_days_90num_25sum</th>
      <th>within_days_90num_25mean</th>
      <th>within_days_90num_50sum</th>
      <th>within_days_90num_50mean</th>
      <th>within_days_90num_75sum</th>
      <th>within_days_90num_75mean</th>
      <th>within_days_90num_985sum</th>
      <th>within_days_90num_985mean</th>
      <th>within_days_90num_100sum</th>
      <th>within_days_90num_100mean</th>
      <th>within_days_180num_unqsum</th>
      <th>within_days_180num_unqmean</th>
      <th>within_days_180num_unqcount</th>
      <th>within_days_180total_secssum</th>
      <th>within_days_180total_secsmean</th>
      <th>within_days_180num_25sum</th>
      <th>within_days_180num_25mean</th>
      <th>within_days_180num_50sum</th>
      <th>within_days_180num_50mean</th>
      <th>within_days_180num_75sum</th>
      <th>within_days_180num_75mean</th>
      <th>within_days_180num_985sum</th>
      <th>within_days_180num_985mean</th>
      <th>within_days_180num_100sum</th>
      <th>within_days_180num_100mean</th>
      <th>within_days_365num_unqsum</th>
      <th>within_days_365num_unqmean</th>
      <th>within_days_365num_unqcount</th>
      <th>within_days_365total_secssum</th>
      <th>within_days_365total_secsmean</th>
      <th>within_days_365num_25sum</th>
      <th>within_days_365num_25mean</th>
      <th>within_days_365num_50sum</th>
      <th>within_days_365num_50mean</th>
      <th>within_days_365num_75sum</th>
      <th>within_days_365num_75mean</th>
      <th>within_days_365num_985sum</th>
      <th>within_days_365num_985mean</th>
      <th>within_days_365num_100sum</th>
      <th>within_days_365num_100mean</th>
      <th>within_days_9999num_unqsum</th>
      <th>within_days_9999num_unqmean</th>
      <th>within_days_9999num_unqcount</th>
      <th>within_days_9999total_secssum</th>
      <th>within_days_9999total_secsmean</th>
      <th>within_days_9999num_25sum</th>
      <th>within_days_9999num_25mean</th>
      <th>within_days_9999num_50sum</th>
      <th>within_days_9999num_50mean</th>
      <th>within_days_9999num_75sum</th>
      <th>within_days_9999num_75mean</th>
      <th>within_days_9999num_985sum</th>
      <th>within_days_9999num_985mean</th>
      <th>within_days_9999num_100sum</th>
      <th>within_days_9999num_100mean</th>
      <th>total_plan_days</th>
      <th>total_amount_paid</th>
      <th>amount_paid_per_day</th>
      <th>diff_renewal_duration</th>
      <th>diff_plan_amount_paid_per_day</th>
      <th>latest_payment_method_id</th>
      <th>latest_plan_days</th>
      <th>latest_plan_list_price</th>
      <th>latest_amount_paid</th>
      <th>latest_auto_renew</th>
      <th>latest_is_cancel</th>
      <th>latest_amount_paid_per_day</th>
      <th>date_featuresdatemax_date_year</th>
      <th>date_featuresdatemax_date_month</th>
      <th>date_featuresdatemax_date_day</th>
      <th>date_featuresdatemax_date_absday</th>
      <th>date_featuresdatemin_date_year</th>
      <th>date_featuresdatemin_date_month</th>
      <th>date_featuresdatemin_date_day</th>
      <th>date_featuresdatemin_date_absday</th>
      <th>female</th>
      <th>male</th>
      <th>latest_transaction_date_year</th>
      <th>latest_transaction_date_month</th>
      <th>latest_transaction_date_day</th>
      <th>latest_transaction_date_absday</th>
      <th>latest_expire_date_year</th>
      <th>latest_expire_date_month</th>
      <th>latest_expire_date_day</th>
      <th>latest_expire_date_absday</th>
      <th>latest_trans_vs_expire</th>
      <th>latest_trans_vs_log</th>
      <th>latest_log_vs_expire</th>
      <th>registration_time</th>
    </tr>
    <tr>
      <th>msno</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mKfgXQAmVeSKzN4rXW37qz0HbGCuYBspTBM3ONXZudg=</th>
      <td>1</td>
      <td>0</td>
      <td>13</td>
      <td>20170120</td>
      <td>0</td>
      <td>35</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>10.068</td>
      <td>10.068</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1.000000</td>
      <td>1</td>
      <td>10.068</td>
      <td>10.068000</td>
      <td>2</td>
      <td>2.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1</td>
      <td>1.000000</td>
      <td>1</td>
      <td>10.068</td>
      <td>10.068000</td>
      <td>2</td>
      <td>2.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>27</td>
      <td>6.750000</td>
      <td>4</td>
      <td>3158.450</td>
      <td>789.612500</td>
      <td>33</td>
      <td>8.250000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>9</td>
      <td>2.250000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>29</td>
      <td>4.833333</td>
      <td>6</td>
      <td>3245.638</td>
      <td>540.939667</td>
      <td>41</td>
      <td>6.833333</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>9</td>
      <td>1.500000</td>
      <td>60</td>
      <td>258</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>0</td>
      <td>4.300000</td>
      <td>2017</td>
      <td>2</td>
      <td>24</td>
      <td>6264</td>
      <td>2017</td>
      <td>1</td>
      <td>20</td>
      <td>6229</td>
      <td>0</td>
      <td>0</td>
      <td>2017</td>
      <td>2</td>
      <td>20</td>
      <td>6260</td>
      <td>2017</td>
      <td>3</td>
      <td>19</td>
      <td>6287</td>
      <td>-27</td>
      <td>-4</td>
      <td>-23</td>
      <td>2017</td>
    </tr>
    <tr>
      <th>AFcKYsrudzim8OFa+fL/c9g5gZabAbhaJnoM0qmlJfo=</th>
      <td>1</td>
      <td>0</td>
      <td>13</td>
      <td>20160907</td>
      <td>0</td>
      <td>173</td>
      <td>21</td>
      <td>21</td>
      <td>1</td>
      <td>2633.631</td>
      <td>2633.631</td>
      <td>13</td>
      <td>13</td>
      <td>3</td>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>8</td>
      <td>8</td>
      <td>228</td>
      <td>32.571429</td>
      <td>7</td>
      <td>32731.138</td>
      <td>4675.876857</td>
      <td>140</td>
      <td>20.000000</td>
      <td>29</td>
      <td>4.142857</td>
      <td>14</td>
      <td>2.000000</td>
      <td>20</td>
      <td>2.857143</td>
      <td>95</td>
      <td>13.571429</td>
      <td>512</td>
      <td>36.571429</td>
      <td>14</td>
      <td>98422.408</td>
      <td>7030.172000</td>
      <td>301</td>
      <td>21.500000</td>
      <td>71</td>
      <td>5.071429</td>
      <td>34</td>
      <td>2.428571</td>
      <td>42</td>
      <td>3.000000</td>
      <td>305</td>
      <td>21.785714</td>
      <td>1044</td>
      <td>36.000000</td>
      <td>29</td>
      <td>178909.861</td>
      <td>6169.305552</td>
      <td>656</td>
      <td>22.620690</td>
      <td>135</td>
      <td>4.655172</td>
      <td>61</td>
      <td>2.103448</td>
      <td>74</td>
      <td>2.551724</td>
      <td>571</td>
      <td>19.689655</td>
      <td>4298</td>
      <td>58.876712</td>
      <td>73</td>
      <td>632743.845</td>
      <td>8667.723904</td>
      <td>2717</td>
      <td>37.219178</td>
      <td>393</td>
      <td>5.383562</td>
      <td>188</td>
      <td>2.575342</td>
      <td>189</td>
      <td>2.589041</td>
      <td>2094</td>
      <td>28.684932</td>
      <td>9218</td>
      <td>59.857143</td>
      <td>154</td>
      <td>1232770.399</td>
      <td>8005.002591</td>
      <td>5289</td>
      <td>34.344156</td>
      <td>838</td>
      <td>5.441558</td>
      <td>410</td>
      <td>2.662338</td>
      <td>323</td>
      <td>2.097403</td>
      <td>4204</td>
      <td>27.298701</td>
      <td>9218</td>
      <td>59.857143</td>
      <td>154</td>
      <td>1232770.399</td>
      <td>8005.002591</td>
      <td>5289</td>
      <td>34.344156</td>
      <td>838</td>
      <td>5.441558</td>
      <td>410</td>
      <td>2.662338</td>
      <td>323</td>
      <td>2.097403</td>
      <td>4204</td>
      <td>27.298701</td>
      <td>9218</td>
      <td>59.857143</td>
      <td>154</td>
      <td>1232770.399</td>
      <td>8005.002591</td>
      <td>5289</td>
      <td>34.344156</td>
      <td>838</td>
      <td>5.441558</td>
      <td>410</td>
      <td>2.662338</td>
      <td>323</td>
      <td>2.097403</td>
      <td>4204</td>
      <td>27.298701</td>
      <td>180</td>
      <td>774</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>0</td>
      <td>4.300000</td>
      <td>2017</td>
      <td>2</td>
      <td>27</td>
      <td>6267</td>
      <td>2016</td>
      <td>9</td>
      <td>7</td>
      <td>6094</td>
      <td>0</td>
      <td>0</td>
      <td>2017</td>
      <td>2</td>
      <td>7</td>
      <td>6247</td>
      <td>2017</td>
      <td>3</td>
      <td>6</td>
      <td>6274</td>
      <td>-27</td>
      <td>-20</td>
      <td>-7</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>qk4mEZUYZq+4sQE7bzRYKc5Pvj+Xc7Wmu25DrCzltEU=</th>
      <td>1</td>
      <td>0</td>
      <td>13</td>
      <td>20160902</td>
      <td>0</td>
      <td>177</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>271.093</td>
      <td>271.093</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>243</td>
      <td>34.714286</td>
      <td>7</td>
      <td>60581.740</td>
      <td>8654.534286</td>
      <td>3</td>
      <td>0.428571</td>
      <td>1</td>
      <td>0.142857</td>
      <td>2</td>
      <td>0.285714</td>
      <td>1</td>
      <td>0.142857</td>
      <td>238</td>
      <td>34.000000</td>
      <td>489</td>
      <td>34.928571</td>
      <td>14</td>
      <td>122772.792</td>
      <td>8769.485143</td>
      <td>32</td>
      <td>2.285714</td>
      <td>2</td>
      <td>0.142857</td>
      <td>5</td>
      <td>0.357143</td>
      <td>11</td>
      <td>0.785714</td>
      <td>476</td>
      <td>34.000000</td>
      <td>899</td>
      <td>32.107143</td>
      <td>28</td>
      <td>231622.820</td>
      <td>8272.243571</td>
      <td>73</td>
      <td>2.607143</td>
      <td>7</td>
      <td>0.250000</td>
      <td>11</td>
      <td>0.392857</td>
      <td>14</td>
      <td>0.500000</td>
      <td>893</td>
      <td>31.892857</td>
      <td>2396</td>
      <td>35.235294</td>
      <td>68</td>
      <td>770040.608</td>
      <td>11324.126588</td>
      <td>180</td>
      <td>2.647059</td>
      <td>32</td>
      <td>0.470588</td>
      <td>32</td>
      <td>0.470588</td>
      <td>33</td>
      <td>0.485294</td>
      <td>2953</td>
      <td>43.426471</td>
      <td>3580</td>
      <td>32.844037</td>
      <td>109</td>
      <td>1137009.556</td>
      <td>10431.280330</td>
      <td>423</td>
      <td>3.880734</td>
      <td>72</td>
      <td>0.660550</td>
      <td>58</td>
      <td>0.532110</td>
      <td>58</td>
      <td>0.532110</td>
      <td>4308</td>
      <td>39.522936</td>
      <td>3580</td>
      <td>32.844037</td>
      <td>109</td>
      <td>1137009.556</td>
      <td>10431.280330</td>
      <td>423</td>
      <td>3.880734</td>
      <td>72</td>
      <td>0.660550</td>
      <td>58</td>
      <td>0.532110</td>
      <td>58</td>
      <td>0.532110</td>
      <td>4308</td>
      <td>39.522936</td>
      <td>3580</td>
      <td>32.844037</td>
      <td>109</td>
      <td>1137009.556</td>
      <td>10431.280330</td>
      <td>423</td>
      <td>3.880734</td>
      <td>72</td>
      <td>0.660550</td>
      <td>58</td>
      <td>0.532110</td>
      <td>58</td>
      <td>0.532110</td>
      <td>4308</td>
      <td>39.522936</td>
      <td>180</td>
      <td>774</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>0</td>
      <td>4.300000</td>
      <td>2017</td>
      <td>2</td>
      <td>26</td>
      <td>6266</td>
      <td>2016</td>
      <td>9</td>
      <td>2</td>
      <td>6089</td>
      <td>0</td>
      <td>0</td>
      <td>2017</td>
      <td>2</td>
      <td>2</td>
      <td>6242</td>
      <td>2017</td>
      <td>3</td>
      <td>1</td>
      <td>6269</td>
      <td>-27</td>
      <td>-24</td>
      <td>-3</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>G2UGNLph2J6euGmZ7WIa1+Kc+dPZBJI0HbLPu5YtrZw=</th>
      <td>1</td>
      <td>0</td>
      <td>13</td>
      <td>20161028</td>
      <td>0</td>
      <td>123</td>
      <td>17</td>
      <td>17</td>
      <td>1</td>
      <td>1626.704</td>
      <td>1626.704</td>
      <td>15</td>
      <td>15</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>6</td>
      <td>121</td>
      <td>24.200000</td>
      <td>5</td>
      <td>30054.147</td>
      <td>6010.829400</td>
      <td>29</td>
      <td>5.800000</td>
      <td>10</td>
      <td>2.000000</td>
      <td>5</td>
      <td>1.000000</td>
      <td>2</td>
      <td>0.400000</td>
      <td>123</td>
      <td>24.600000</td>
      <td>192</td>
      <td>17.454545</td>
      <td>11</td>
      <td>43518.795</td>
      <td>3956.254091</td>
      <td>44</td>
      <td>4.000000</td>
      <td>11</td>
      <td>1.000000</td>
      <td>7</td>
      <td>0.636364</td>
      <td>7</td>
      <td>0.636364</td>
      <td>174</td>
      <td>15.818182</td>
      <td>457</td>
      <td>17.576923</td>
      <td>26</td>
      <td>111841.140</td>
      <td>4301.582308</td>
      <td>80</td>
      <td>3.076923</td>
      <td>23</td>
      <td>0.884615</td>
      <td>15</td>
      <td>0.576923</td>
      <td>15</td>
      <td>0.576923</td>
      <td>456</td>
      <td>17.538462</td>
      <td>1229</td>
      <td>21.189655</td>
      <td>58</td>
      <td>287422.839</td>
      <td>4955.566190</td>
      <td>203</td>
      <td>3.500000</td>
      <td>81</td>
      <td>1.396552</td>
      <td>55</td>
      <td>0.948276</td>
      <td>60</td>
      <td>1.034483</td>
      <td>1145</td>
      <td>19.741379</td>
      <td>1441</td>
      <td>20.884058</td>
      <td>69</td>
      <td>326268.069</td>
      <td>4728.522739</td>
      <td>247</td>
      <td>3.579710</td>
      <td>115</td>
      <td>1.666667</td>
      <td>74</td>
      <td>1.072464</td>
      <td>76</td>
      <td>1.101449</td>
      <td>1272</td>
      <td>18.434783</td>
      <td>1441</td>
      <td>20.884058</td>
      <td>69</td>
      <td>326268.069</td>
      <td>4728.522739</td>
      <td>247</td>
      <td>3.579710</td>
      <td>115</td>
      <td>1.666667</td>
      <td>74</td>
      <td>1.072464</td>
      <td>76</td>
      <td>1.101449</td>
      <td>1272</td>
      <td>18.434783</td>
      <td>1441</td>
      <td>20.884058</td>
      <td>69</td>
      <td>326268.069</td>
      <td>4728.522739</td>
      <td>247</td>
      <td>3.579710</td>
      <td>115</td>
      <td>1.666667</td>
      <td>74</td>
      <td>1.072464</td>
      <td>76</td>
      <td>1.101449</td>
      <td>1272</td>
      <td>18.434783</td>
      <td>150</td>
      <td>596</td>
      <td>3.973333</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>0</td>
      <td>4.966667</td>
      <td>2017</td>
      <td>2</td>
      <td>28</td>
      <td>6268</td>
      <td>2016</td>
      <td>10</td>
      <td>28</td>
      <td>6145</td>
      <td>0</td>
      <td>0</td>
      <td>2017</td>
      <td>2</td>
      <td>28</td>
      <td>6268</td>
      <td>2017</td>
      <td>3</td>
      <td>27</td>
      <td>6295</td>
      <td>-27</td>
      <td>0</td>
      <td>-27</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>EqSHZpMj5uddJvv2gXcHvuOKFOdS5NN6RalHfzEhhaI=</th>
      <td>1</td>
      <td>0</td>
      <td>13</td>
      <td>20161004</td>
      <td>0</td>
      <td>22</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>156.204</td>
      <td>156.204</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14</td>
      <td>7.000000</td>
      <td>2</td>
      <td>2399.824</td>
      <td>1199.912000</td>
      <td>4</td>
      <td>2.000000</td>
      <td>5</td>
      <td>2.500000</td>
      <td>4</td>
      <td>2.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>5</td>
      <td>2.500000</td>
      <td>17</td>
      <td>4.250000</td>
      <td>4</td>
      <td>2630.818</td>
      <td>657.704500</td>
      <td>5</td>
      <td>1.250000</td>
      <td>7</td>
      <td>1.750000</td>
      <td>4</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>5</td>
      <td>1.250000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>136</td>
      <td>13.600000</td>
      <td>10</td>
      <td>15562.900</td>
      <td>1556.290000</td>
      <td>76</td>
      <td>7.600000</td>
      <td>36</td>
      <td>3.600000</td>
      <td>22</td>
      <td>2.200000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>21</td>
      <td>2.100000</td>
      <td>150</td>
      <td>645</td>
      <td>4.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>30</td>
      <td>30</td>
      <td>129</td>
      <td>129</td>
      <td>1</td>
      <td>0</td>
      <td>4.300000</td>
      <td>2016</td>
      <td>10</td>
      <td>26</td>
      <td>6143</td>
      <td>2016</td>
      <td>10</td>
      <td>4</td>
      <td>6121</td>
      <td>0</td>
      <td>0</td>
      <td>2017</td>
      <td>2</td>
      <td>4</td>
      <td>6244</td>
      <td>2017</td>
      <td>3</td>
      <td>3</td>
      <td>6271</td>
      <td>-27</td>
      <td>101</td>
      <td>-128</td>
      <td>2016</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="n">df_fa</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>city</th>
      <th>bd</th>
      <th>registered_via</th>
      <th>registration_init_time</th>
      <th>is_churn</th>
      <th>date_featuresdatelistening_tenure</th>
      <th>within_days_1num_unqsum</th>
      <th>within_days_1num_unqmean</th>
      <th>within_days_1num_unqcount</th>
      <th>within_days_1total_secssum</th>
      <th>within_days_1total_secsmean</th>
      <th>within_days_1num_25sum</th>
      <th>within_days_1num_25mean</th>
      <th>within_days_1num_50sum</th>
      <th>within_days_1num_50mean</th>
      <th>within_days_1num_75sum</th>
      <th>within_days_1num_75mean</th>
      <th>within_days_1num_985sum</th>
      <th>within_days_1num_985mean</th>
      <th>within_days_1num_100sum</th>
      <th>within_days_1num_100mean</th>
      <th>within_days_7num_unqsum</th>
      <th>within_days_7num_unqmean</th>
      <th>within_days_7num_unqcount</th>
      <th>within_days_7total_secssum</th>
      <th>within_days_7total_secsmean</th>
      <th>within_days_7num_25sum</th>
      <th>within_days_7num_25mean</th>
      <th>within_days_7num_50sum</th>
      <th>within_days_7num_50mean</th>
      <th>within_days_7num_75sum</th>
      <th>within_days_7num_75mean</th>
      <th>within_days_7num_985sum</th>
      <th>within_days_7num_985mean</th>
      <th>within_days_7num_100sum</th>
      <th>within_days_7num_100mean</th>
      <th>within_days_14num_unqsum</th>
      <th>within_days_14num_unqmean</th>
      <th>within_days_14num_unqcount</th>
      <th>within_days_14total_secssum</th>
      <th>within_days_14total_secsmean</th>
      <th>within_days_14num_25sum</th>
      <th>within_days_14num_25mean</th>
      <th>within_days_14num_50sum</th>
      <th>within_days_14num_50mean</th>
      <th>within_days_14num_75sum</th>
      <th>within_days_14num_75mean</th>
      <th>within_days_14num_985sum</th>
      <th>within_days_14num_985mean</th>
      <th>within_days_14num_100sum</th>
      <th>within_days_14num_100mean</th>
      <th>within_days_31num_unqsum</th>
      <th>within_days_31num_unqmean</th>
      <th>within_days_31num_unqcount</th>
      <th>within_days_31total_secssum</th>
      <th>within_days_31total_secsmean</th>
      <th>within_days_31num_25sum</th>
      <th>within_days_31num_25mean</th>
      <th>within_days_31num_50sum</th>
      <th>within_days_31num_50mean</th>
      <th>within_days_31num_75sum</th>
      <th>within_days_31num_75mean</th>
      <th>within_days_31num_985sum</th>
      <th>within_days_31num_985mean</th>
      <th>within_days_31num_100sum</th>
      <th>within_days_31num_100mean</th>
      <th>within_days_90num_unqsum</th>
      <th>within_days_90num_unqmean</th>
      <th>within_days_90num_unqcount</th>
      <th>within_days_90total_secssum</th>
      <th>within_days_90total_secsmean</th>
      <th>within_days_90num_25sum</th>
      <th>within_days_90num_25mean</th>
      <th>within_days_90num_50sum</th>
      <th>within_days_90num_50mean</th>
      <th>within_days_90num_75sum</th>
      <th>within_days_90num_75mean</th>
      <th>within_days_90num_985sum</th>
      <th>within_days_90num_985mean</th>
      <th>within_days_90num_100sum</th>
      <th>within_days_90num_100mean</th>
      <th>within_days_180num_unqsum</th>
      <th>within_days_180num_unqmean</th>
      <th>within_days_180num_unqcount</th>
      <th>within_days_180total_secssum</th>
      <th>within_days_180total_secsmean</th>
      <th>within_days_180num_25sum</th>
      <th>within_days_180num_25mean</th>
      <th>within_days_180num_50sum</th>
      <th>within_days_180num_50mean</th>
      <th>within_days_180num_75sum</th>
      <th>within_days_180num_75mean</th>
      <th>within_days_180num_985sum</th>
      <th>within_days_180num_985mean</th>
      <th>within_days_180num_100sum</th>
      <th>within_days_180num_100mean</th>
      <th>within_days_365num_unqsum</th>
      <th>within_days_365num_unqmean</th>
      <th>within_days_365num_unqcount</th>
      <th>within_days_365total_secssum</th>
      <th>within_days_365total_secsmean</th>
      <th>within_days_365num_25sum</th>
      <th>within_days_365num_25mean</th>
      <th>within_days_365num_50sum</th>
      <th>within_days_365num_50mean</th>
      <th>within_days_365num_75sum</th>
      <th>within_days_365num_75mean</th>
      <th>within_days_365num_985sum</th>
      <th>within_days_365num_985mean</th>
      <th>within_days_365num_100sum</th>
      <th>within_days_365num_100mean</th>
      <th>within_days_9999num_unqsum</th>
      <th>within_days_9999num_unqmean</th>
      <th>within_days_9999num_unqcount</th>
      <th>within_days_9999total_secssum</th>
      <th>within_days_9999total_secsmean</th>
      <th>within_days_9999num_25sum</th>
      <th>within_days_9999num_25mean</th>
      <th>within_days_9999num_50sum</th>
      <th>within_days_9999num_50mean</th>
      <th>within_days_9999num_75sum</th>
      <th>within_days_9999num_75mean</th>
      <th>within_days_9999num_985sum</th>
      <th>within_days_9999num_985mean</th>
      <th>within_days_9999num_100sum</th>
      <th>within_days_9999num_100mean</th>
      <th>total_plan_days</th>
      <th>total_amount_paid</th>
      <th>amount_paid_per_day</th>
      <th>diff_renewal_duration</th>
      <th>diff_plan_amount_paid_per_day</th>
      <th>latest_payment_method_id</th>
      <th>latest_plan_days</th>
      <th>latest_plan_list_price</th>
      <th>latest_amount_paid</th>
      <th>latest_auto_renew</th>
      <th>latest_is_cancel</th>
      <th>latest_amount_paid_per_day</th>
      <th>date_featuresdatemax_date_year</th>
      <th>date_featuresdatemax_date_month</th>
      <th>date_featuresdatemax_date_day</th>
      <th>date_featuresdatemax_date_absday</th>
      <th>date_featuresdatemin_date_year</th>
      <th>date_featuresdatemin_date_month</th>
      <th>date_featuresdatemin_date_day</th>
      <th>date_featuresdatemin_date_absday</th>
      <th>female</th>
      <th>male</th>
      <th>latest_transaction_date_year</th>
      <th>latest_transaction_date_month</th>
      <th>latest_transaction_date_day</th>
      <th>latest_transaction_date_absday</th>
      <th>latest_expire_date_year</th>
      <th>latest_expire_date_month</th>
      <th>latest_expire_date_day</th>
      <th>latest_expire_date_absday</th>
      <th>latest_trans_vs_expire</th>
      <th>latest_trans_vs_log</th>
      <th>latest_log_vs_expire</th>
      <th>registration_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>8.854400e+04</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.0</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>8.854400e+04</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>8.854400e+04</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>8.854400e+04</td>
      <td>8.854400e+04</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>8.854400e+04</td>
      <td>8.854400e+04</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>8.854400e+04</td>
      <td>8.854400e+04</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>8.854400e+04</td>
      <td>8.854400e+04</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
      <td>88544.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>6.525038</td>
      <td>14.980733</td>
      <td>6.635018</td>
      <td>2.013375e+07</td>
      <td>0.505590</td>
      <td>489.896266</td>
      <td>20.698794</td>
      <td>20.698794</td>
      <td>1.0</td>
      <td>5292.578450</td>
      <td>5292.578450</td>
      <td>4.751005</td>
      <td>4.751005</td>
      <td>1.181175</td>
      <td>1.181175</td>
      <td>0.712719</td>
      <td>0.712719</td>
      <td>0.790985</td>
      <td>0.790985</td>
      <td>20.047660</td>
      <td>20.047660</td>
      <td>94.714458</td>
      <td>21.900082</td>
      <td>3.630568</td>
      <td>25398.043300</td>
      <td>5679.751873</td>
      <td>20.606806</td>
      <td>5.048088</td>
      <td>5.118721</td>
      <td>1.264542</td>
      <td>3.193474</td>
      <td>0.764835</td>
      <td>3.609866</td>
      <td>0.839836</td>
      <td>96.809236</td>
      <td>21.497445</td>
      <td>180.072506</td>
      <td>22.383794</td>
      <td>6.679696</td>
      <td>4.851858e+04</td>
      <td>5818.581592</td>
      <td>38.873690</td>
      <td>5.179982</td>
      <td>9.669735</td>
      <td>1.298046</td>
      <td>6.069570</td>
      <td>0.785710</td>
      <td>6.831553</td>
      <td>0.857796</td>
      <td>185.109313</td>
      <td>22.017982</td>
      <td>386.728101</td>
      <td>23.271521</td>
      <td>13.902444</td>
      <td>1.039538e+05</td>
      <td>6040.184570</td>
      <td>84.352706</td>
      <td>5.450459</td>
      <td>20.850831</td>
      <td>1.359949</td>
      <td>13.151473</td>
      <td>0.825081</td>
      <td>14.948783</td>
      <td>0.904241</td>
      <td>396.595557</td>
      <td>22.841633</td>
      <td>1093.917736</td>
      <td>24.238664</td>
      <td>37.852435</td>
      <td>-8.333365e+11</td>
      <td>-1.651270e+10</td>
      <td>241.791143</td>
      <td>5.797655</td>
      <td>59.157650</td>
      <td>1.442505</td>
      <td>37.497256</td>
      <td>0.874044</td>
      <td>42.036321</td>
      <td>0.943332</td>
      <td>1121.233093</td>
      <td>23.773736</td>
      <td>2090.805633</td>
      <td>24.740990</td>
      <td>71.289811</td>
      <td>-1.979174e+12</td>
      <td>-2.291994e+10</td>
      <td>464.508132</td>
      <td>5.968142</td>
      <td>114.264603</td>
      <td>1.498918</td>
      <td>72.136554</td>
      <td>0.902613</td>
      <td>80.350267</td>
      <td>0.967418</td>
      <td>2124.856648</td>
      <td>24.115101</td>
      <td>3896.207400</td>
      <td>25.245055</td>
      <td>131.113401</td>
      <td>-6.041691e+12</td>
      <td>-3.677399e+10</td>
      <td>859.351520</td>
      <td>6.090492</td>
      <td>212.907018</td>
      <td>1.541631</td>
      <td>133.405527</td>
      <td>0.921047</td>
      <td>148.187715</td>
      <td>0.979698</td>
      <td>3949.711895</td>
      <td>24.569486</td>
      <td>6768.144403</td>
      <td>25.652204</td>
      <td>222.584850</td>
      <td>-2.994804e+14</td>
      <td>-7.498238e+11</td>
      <td>1476.962256</td>
      <td>6.214718</td>
      <td>367.734708</td>
      <td>1.582176</td>
      <td>229.020227</td>
      <td>0.940062</td>
      <td>254.208992</td>
      <td>0.992622</td>
      <td>6864.914574</td>
      <td>24.937062</td>
      <td>437.796169</td>
      <td>2037.669125</td>
      <td>4.602800</td>
      <td>2.989858</td>
      <td>-5.606482</td>
      <td>37.700296</td>
      <td>52.462742</td>
      <td>227.611199</td>
      <td>227.036185</td>
      <td>0.639874</td>
      <td>0.174659</td>
      <td>4.249737</td>
      <td>2016.881234</td>
      <td>2.525117</td>
      <td>21.763507</td>
      <td>6234.178363</td>
      <td>2015.427177</td>
      <td>4.265992</td>
      <td>11.133335</td>
      <td>5744.282097</td>
      <td>0.242998</td>
      <td>0.275456</td>
      <td>2016.841740</td>
      <td>2.525739</td>
      <td>16.539788</td>
      <td>6214.398627</td>
      <td>2016.970320</td>
      <td>2.601565</td>
      <td>15.721178</td>
      <td>6261.820010</td>
      <td>-47.421384</td>
      <td>-19.779737</td>
      <td>-27.641647</td>
      <td>2013.308423</td>
    </tr>
    <tr>
      <th>std</th>
      <td>6.551445</td>
      <td>18.431336</td>
      <td>2.234529</td>
      <td>2.896439e+04</td>
      <td>0.499972</td>
      <td>271.954761</td>
      <td>26.816538</td>
      <td>26.816538</td>
      <td>0.0</td>
      <td>7839.883628</td>
      <td>7839.883628</td>
      <td>11.209580</td>
      <td>11.209580</td>
      <td>3.122491</td>
      <td>3.122491</td>
      <td>1.569186</td>
      <td>1.569186</td>
      <td>2.056548</td>
      <td>2.056548</td>
      <td>31.926074</td>
      <td>31.926074</td>
      <td>123.736267</td>
      <td>22.179267</td>
      <td>2.019227</td>
      <td>37825.652389</td>
      <td>6814.978016</td>
      <td>40.174639</td>
      <td>9.170749</td>
      <td>9.780551</td>
      <td>2.416056</td>
      <td>5.525064</td>
      <td>1.240117</td>
      <td>8.967416</td>
      <td>1.630039</td>
      <td>154.190616</td>
      <td>27.963725</td>
      <td>232.545094</td>
      <td>20.836810</td>
      <td>4.052415</td>
      <td>7.152130e+04</td>
      <td>6539.990675</td>
      <td>69.286828</td>
      <td>8.255339</td>
      <td>16.423555</td>
      <td>2.159017</td>
      <td>9.495713</td>
      <td>1.138329</td>
      <td>16.007510</td>
      <td>1.546520</td>
      <td>291.280077</td>
      <td>26.898005</td>
      <td>477.079939</td>
      <td>19.372295</td>
      <td>8.663977</td>
      <td>1.469971e+05</td>
      <td>6020.766839</td>
      <td>135.636164</td>
      <td>7.741246</td>
      <td>30.899691</td>
      <td>1.919181</td>
      <td>18.358084</td>
      <td>1.029136</td>
      <td>36.104464</td>
      <td>1.563621</td>
      <td>600.717536</td>
      <td>24.834585</td>
      <td>1341.237189</td>
      <td>18.684102</td>
      <td>25.324540</td>
      <td>2.191767e+14</td>
      <td>3.964256e+12</td>
      <td>382.272707</td>
      <td>7.515411</td>
      <td>82.445972</td>
      <td>1.770876</td>
      <td>50.426151</td>
      <td>0.969375</td>
      <td>89.884588</td>
      <td>1.397562</td>
      <td>1663.191691</td>
      <td>24.005779</td>
      <td>2583.529737</td>
      <td>18.290344</td>
      <td>50.173053</td>
      <td>2.754958e+14</td>
      <td>2.817791e+12</td>
      <td>890.415732</td>
      <td>7.904848</td>
      <td>158.377603</td>
      <td>1.721930</td>
      <td>96.141760</td>
      <td>0.912695</td>
      <td>166.964108</td>
      <td>1.336536</td>
      <td>3129.427760</td>
      <td>23.396972</td>
      <td>4890.713126</td>
      <td>17.842956</td>
      <td>99.124183</td>
      <td>3.640763e+14</td>
      <td>2.148897e+12</td>
      <td>2152.429448</td>
      <td>8.587733</td>
      <td>298.543419</td>
      <td>1.634560</td>
      <td>179.646957</td>
      <td>0.882435</td>
      <td>271.766276</td>
      <td>1.137067</td>
      <td>5839.985612</td>
      <td>22.801391</td>
      <td>9203.006883</td>
      <td>17.417302</td>
      <td>196.804976</td>
      <td>3.620312e+15</td>
      <td>9.459203e+12</td>
      <td>3814.395114</td>
      <td>8.261136</td>
      <td>548.144978</td>
      <td>1.622525</td>
      <td>327.643138</td>
      <td>0.872478</td>
      <td>440.184627</td>
      <td>1.023119</td>
      <td>10865.335596</td>
      <td>22.230638</td>
      <td>241.813007</td>
      <td>1234.637258</td>
      <td>1.085134</td>
      <td>51.117939</td>
      <td>237.546015</td>
      <td>4.484667</td>
      <td>79.217446</td>
      <td>332.886694</td>
      <td>333.154660</td>
      <td>0.480039</td>
      <td>0.379677</td>
      <td>47.556868</td>
      <td>0.372700</td>
      <td>2.183868</td>
      <td>8.070249</td>
      <td>94.115610</td>
      <td>0.580881</td>
      <td>3.899945</td>
      <td>9.493778</td>
      <td>261.169278</td>
      <td>0.428896</td>
      <td>0.446746</td>
      <td>0.421588</td>
      <td>2.609233</td>
      <td>8.988002</td>
      <td>96.625628</td>
      <td>0.610677</td>
      <td>0.950015</td>
      <td>8.729970</td>
      <td>221.500069</td>
      <td>232.235329</td>
      <td>123.588333</td>
      <td>231.906681</td>
      <td>2.899407</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>-49.000000</td>
      <td>3.000000</td>
      <td>2.004033e+07</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.0</td>
      <td>0.030000</td>
      <td>0.030000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.078000</td>
      <td>0.078000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>7.800000e-02</td>
      <td>0.078000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>2.130000e-01</td>
      <td>0.213000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>-6.456360e+16</td>
      <td>-1.132695e+15</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>-7.378698e+16</td>
      <td>-6.895979e+14</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>-7.378698e+16</td>
      <td>-3.617009e+14</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>-3.135946e+17</td>
      <td>-8.384884e+14</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-420.000000</td>
      <td>-9999.000000</td>
      <td>3.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-9999.000000</td>
      <td>2015.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>5479.000000</td>
      <td>2015.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>5479.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2015.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>5480.000000</td>
      <td>1970.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>-10957.000000</td>
      <td>-771.000000</td>
      <td>-783.000000</td>
      <td>-820.000000</td>
      <td>2004.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>4.000000</td>
      <td>2.012053e+07</td>
      <td>0.000000</td>
      <td>248.000000</td>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>1.0</td>
      <td>821.058500</td>
      <td>821.058500</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>17.000000</td>
      <td>7.571429</td>
      <td>2.000000</td>
      <td>3718.143000</td>
      <td>1705.418000</td>
      <td>2.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>12.000000</td>
      <td>5.666667</td>
      <td>34.000000</td>
      <td>9.200000</td>
      <td>3.000000</td>
      <td>7.838667e+03</td>
      <td>2116.791375</td>
      <td>5.000000</td>
      <td>1.250000</td>
      <td>1.000000</td>
      <td>0.307692</td>
      <td>1.000000</td>
      <td>0.166667</td>
      <td>1.000000</td>
      <td>0.166667</td>
      <td>27.000000</td>
      <td>7.200000</td>
      <td>84.000000</td>
      <td>11.153846</td>
      <td>6.000000</td>
      <td>1.964592e+04</td>
      <td>2611.727415</td>
      <td>14.000000</td>
      <td>1.714286</td>
      <td>3.000000</td>
      <td>0.450000</td>
      <td>2.000000</td>
      <td>0.294118</td>
      <td>2.000000</td>
      <td>0.300000</td>
      <td>69.000000</td>
      <td>9.000000</td>
      <td>233.000000</td>
      <td>12.710028</td>
      <td>16.000000</td>
      <td>5.537270e+04</td>
      <td>2.998566e+03</td>
      <td>42.000000</td>
      <td>2.113636</td>
      <td>11.000000</td>
      <td>0.565217</td>
      <td>7.000000</td>
      <td>0.382353</td>
      <td>7.000000</td>
      <td>0.387097</td>
      <td>196.000000</td>
      <td>10.500000</td>
      <td>427.000000</td>
      <td>13.490147</td>
      <td>27.000000</td>
      <td>1.021806e+05</td>
      <td>3.180790e+03</td>
      <td>81.000000</td>
      <td>2.329249</td>
      <td>22.000000</td>
      <td>0.625000</td>
      <td>14.000000</td>
      <td>0.426950</td>
      <td>14.000000</td>
      <td>0.427574</td>
      <td>360.000000</td>
      <td>11.166667</td>
      <td>737.750000</td>
      <td>14.224490</td>
      <td>43.000000</td>
      <td>1.753236e+05</td>
      <td>3.351469e+03</td>
      <td>145.000000</td>
      <td>2.510204</td>
      <td>39.000000</td>
      <td>0.677632</td>
      <td>25.000000</td>
      <td>0.454545</td>
      <td>25.000000</td>
      <td>0.454545</td>
      <td>623.000000</td>
      <td>11.806058</td>
      <td>1002.000000</td>
      <td>14.798119</td>
      <td>56.000000</td>
      <td>2.145400e+05</td>
      <td>3.373914e+03</td>
      <td>205.000000</td>
      <td>2.651424</td>
      <td>56.000000</td>
      <td>0.722222</td>
      <td>35.000000</td>
      <td>0.481250</td>
      <td>35.000000</td>
      <td>0.478528</td>
      <td>853.000000</td>
      <td>12.291667</td>
      <td>240.000000</td>
      <td>990.000000</td>
      <td>3.936907</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>36.000000</td>
      <td>30.000000</td>
      <td>99.000000</td>
      <td>99.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>3.300000</td>
      <td>2017.000000</td>
      <td>2.000000</td>
      <td>17.000000</td>
      <td>6247.000000</td>
      <td>2015.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>5481.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2017.000000</td>
      <td>1.000000</td>
      <td>9.000000</td>
      <td>6226.000000</td>
      <td>2017.000000</td>
      <td>2.000000</td>
      <td>8.000000</td>
      <td>6254.000000</td>
      <td>-31.000000</td>
      <td>-28.000000</td>
      <td>-25.000000</td>
      <td>2012.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>4.000000</td>
      <td>17.000000</td>
      <td>7.000000</td>
      <td>2.014073e+07</td>
      <td>1.000000</td>
      <td>509.000000</td>
      <td>11.000000</td>
      <td>11.000000</td>
      <td>1.0</td>
      <td>2595.075000</td>
      <td>2595.075000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>9.000000</td>
      <td>9.000000</td>
      <td>53.000000</td>
      <td>16.000000</td>
      <td>3.000000</td>
      <td>12904.532500</td>
      <td>3780.617429</td>
      <td>8.000000</td>
      <td>2.600000</td>
      <td>2.000000</td>
      <td>0.666667</td>
      <td>1.000000</td>
      <td>0.500000</td>
      <td>2.000000</td>
      <td>0.500000</td>
      <td>47.000000</td>
      <td>13.750000</td>
      <td>105.000000</td>
      <td>17.100000</td>
      <td>6.000000</td>
      <td>2.553986e+04</td>
      <td>4091.579700</td>
      <td>17.000000</td>
      <td>3.000000</td>
      <td>4.000000</td>
      <td>0.800000</td>
      <td>3.000000</td>
      <td>0.500000</td>
      <td>3.000000</td>
      <td>0.538462</td>
      <td>93.000000</td>
      <td>15.000000</td>
      <td>238.000000</td>
      <td>18.777778</td>
      <td>13.000000</td>
      <td>5.835679e+04</td>
      <td>4496.575193</td>
      <td>42.000000</td>
      <td>3.500000</td>
      <td>11.000000</td>
      <td>0.928571</td>
      <td>7.000000</td>
      <td>0.612903</td>
      <td>8.000000</td>
      <td>0.636364</td>
      <td>214.000000</td>
      <td>16.500000</td>
      <td>667.000000</td>
      <td>19.993750</td>
      <td>36.000000</td>
      <td>1.652595e+05</td>
      <td>4.812825e+03</td>
      <td>123.000000</td>
      <td>3.935484</td>
      <td>33.000000</td>
      <td>1.000000</td>
      <td>22.000000</td>
      <td>0.671875</td>
      <td>22.000000</td>
      <td>0.692308</td>
      <td>605.000000</td>
      <td>17.683439</td>
      <td>1263.000000</td>
      <td>20.583333</td>
      <td>65.000000</td>
      <td>3.145153e+05</td>
      <td>4.970085e+03</td>
      <td>235.000000</td>
      <td>4.128933</td>
      <td>63.000000</td>
      <td>1.070945</td>
      <td>41.000000</td>
      <td>0.706897</td>
      <td>43.000000</td>
      <td>0.727273</td>
      <td>1149.000000</td>
      <td>18.196254</td>
      <td>2317.000000</td>
      <td>21.266667</td>
      <td>115.000000</td>
      <td>5.750376e+05</td>
      <td>5.154735e+03</td>
      <td>431.000000</td>
      <td>4.326370</td>
      <td>117.000000</td>
      <td>1.130952</td>
      <td>76.000000</td>
      <td>0.733333</td>
      <td>78.000000</td>
      <td>0.750000</td>
      <td>2102.000000</td>
      <td>18.867847</td>
      <td>3584.000000</td>
      <td>21.936890</td>
      <td>169.000000</td>
      <td>8.452459e+05</td>
      <td>5.233477e+03</td>
      <td>681.000000</td>
      <td>4.500000</td>
      <td>186.000000</td>
      <td>1.181818</td>
      <td>119.000000</td>
      <td>0.757725</td>
      <td>121.000000</td>
      <td>0.769231</td>
      <td>3299.000000</td>
      <td>19.508859</td>
      <td>440.000000</td>
      <td>1788.000000</td>
      <td>4.898667</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>39.000000</td>
      <td>30.000000</td>
      <td>149.000000</td>
      <td>149.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>4.966667</td>
      <td>2017.000000</td>
      <td>2.000000</td>
      <td>26.000000</td>
      <td>6265.000000</td>
      <td>2015.000000</td>
      <td>2.000000</td>
      <td>8.000000</td>
      <td>5710.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2017.000000</td>
      <td>2.000000</td>
      <td>17.000000</td>
      <td>6245.000000</td>
      <td>2017.000000</td>
      <td>3.000000</td>
      <td>16.000000</td>
      <td>6271.000000</td>
      <td>-29.000000</td>
      <td>-14.000000</td>
      <td>-11.000000</td>
      <td>2014.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>13.000000</td>
      <td>27.000000</td>
      <td>9.000000</td>
      <td>2.016012e+07</td>
      <td>1.000000</td>
      <td>776.000000</td>
      <td>27.000000</td>
      <td>27.000000</td>
      <td>1.0</td>
      <td>6509.136500</td>
      <td>6509.136500</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>24.000000</td>
      <td>24.000000</td>
      <td>124.000000</td>
      <td>28.666667</td>
      <td>5.000000</td>
      <td>31483.468500</td>
      <td>7136.028982</td>
      <td>24.000000</td>
      <td>6.000000</td>
      <td>6.000000</td>
      <td>1.500000</td>
      <td>4.000000</td>
      <td>1.000000</td>
      <td>4.000000</td>
      <td>1.000000</td>
      <td>118.000000</td>
      <td>26.833333</td>
      <td>236.000000</td>
      <td>29.000000</td>
      <td>10.000000</td>
      <td>5.991438e+04</td>
      <td>7206.990196</td>
      <td>46.000000</td>
      <td>6.285714</td>
      <td>12.000000</td>
      <td>1.571429</td>
      <td>8.000000</td>
      <td>1.000000</td>
      <td>8.000000</td>
      <td>1.000000</td>
      <td>225.000000</td>
      <td>27.090909</td>
      <td>511.000000</td>
      <td>29.545455</td>
      <td>20.000000</td>
      <td>1.296859e+05</td>
      <td>7375.110225</td>
      <td>103.000000</td>
      <td>6.720556</td>
      <td>26.000000</td>
      <td>1.666667</td>
      <td>17.000000</td>
      <td>1.052632</td>
      <td>18.000000</td>
      <td>1.125000</td>
      <td>484.000000</td>
      <td>27.826087</td>
      <td>1464.000000</td>
      <td>30.166667</td>
      <td>56.000000</td>
      <td>3.737988e+05</td>
      <td>7.603972e+03</td>
      <td>295.000000</td>
      <td>7.100000</td>
      <td>76.000000</td>
      <td>1.769231</td>
      <td>49.000000</td>
      <td>1.098120</td>
      <td>52.000000</td>
      <td>1.166667</td>
      <td>1394.000000</td>
      <td>28.634146</td>
      <td>2802.000000</td>
      <td>30.577022</td>
      <td>108.000000</td>
      <td>7.176428e+05</td>
      <td>7.747661e+03</td>
      <td>567.000000</td>
      <td>7.290698</td>
      <td>147.000000</td>
      <td>1.833333</td>
      <td>95.000000</td>
      <td>1.128512</td>
      <td>100.000000</td>
      <td>1.187500</td>
      <td>2663.000000</td>
      <td>29.039801</td>
      <td>5258.000000</td>
      <td>31.154067</td>
      <td>203.000000</td>
      <td>1.347311e+06</td>
      <td>7.914708e+03</td>
      <td>1058.000000</td>
      <td>7.466156</td>
      <td>275.000000</td>
      <td>1.888889</td>
      <td>175.000000</td>
      <td>1.149123</td>
      <td>185.000000</td>
      <td>1.200000</td>
      <td>5003.000000</td>
      <td>29.706403</td>
      <td>9046.250000</td>
      <td>31.791510</td>
      <td>346.000000</td>
      <td>2.223149e+06</td>
      <td>7.989009e+03</td>
      <td>1798.000000</td>
      <td>7.621627</td>
      <td>468.000000</td>
      <td>1.942504</td>
      <td>297.000000</td>
      <td>1.167134</td>
      <td>313.000000</td>
      <td>1.217949</td>
      <td>8601.250000</td>
      <td>30.343668</td>
      <td>615.000000</td>
      <td>3193.000000</td>
      <td>5.164424</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>41.000000</td>
      <td>30.000000</td>
      <td>149.000000</td>
      <td>149.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>4.966667</td>
      <td>2017.000000</td>
      <td>2.000000</td>
      <td>28.000000</td>
      <td>6268.000000</td>
      <td>2016.000000</td>
      <td>8.000000</td>
      <td>19.000000</td>
      <td>5959.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>2017.000000</td>
      <td>2.000000</td>
      <td>25.000000</td>
      <td>6258.000000</td>
      <td>2017.000000</td>
      <td>3.000000</td>
      <td>23.000000</td>
      <td>6285.000000</td>
      <td>-28.000000</td>
      <td>0.000000</td>
      <td>-1.000000</td>
      <td>2016.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>22.000000</td>
      <td>1051.000000</td>
      <td>13.000000</td>
      <td>2.017023e+07</td>
      <td>1.000000</td>
      <td>789.000000</td>
      <td>661.000000</td>
      <td>661.000000</td>
      <td>1.0</td>
      <td>437603.468000</td>
      <td>437603.468000</td>
      <td>570.000000</td>
      <td>570.000000</td>
      <td>195.000000</td>
      <td>195.000000</td>
      <td>71.000000</td>
      <td>71.000000</td>
      <td>224.000000</td>
      <td>224.000000</td>
      <td>1859.000000</td>
      <td>1859.000000</td>
      <td>2992.000000</td>
      <td>748.000000</td>
      <td>7.000000</td>
      <td>604487.476000</td>
      <td>437603.468000</td>
      <td>3957.000000</td>
      <td>989.250000</td>
      <td>354.000000</td>
      <td>132.500000</td>
      <td>369.000000</td>
      <td>65.500000</td>
      <td>1207.000000</td>
      <td>172.428571</td>
      <td>3211.000000</td>
      <td>1859.000000</td>
      <td>5290.000000</td>
      <td>661.000000</td>
      <td>14.000000</td>
      <td>1.209334e+06</td>
      <td>437603.468000</td>
      <td>5381.000000</td>
      <td>676.000000</td>
      <td>613.000000</td>
      <td>132.500000</td>
      <td>385.000000</td>
      <td>65.500000</td>
      <td>1877.000000</td>
      <td>156.416667</td>
      <td>5765.000000</td>
      <td>1859.000000</td>
      <td>10086.000000</td>
      <td>560.333333</td>
      <td>31.000000</td>
      <td>2.665440e+06</td>
      <td>187136.586000</td>
      <td>10384.000000</td>
      <td>676.000000</td>
      <td>1131.000000</td>
      <td>132.500000</td>
      <td>585.000000</td>
      <td>65.500000</td>
      <td>3930.000000</td>
      <td>151.826087</td>
      <td>13493.000000</td>
      <td>810.000000</td>
      <td>26703.000000</td>
      <td>560.333333</td>
      <td>90.000000</td>
      <td>7.546893e+06</td>
      <td>2.181567e+05</td>
      <td>35029.000000</td>
      <td>676.000000</td>
      <td>3017.000000</td>
      <td>88.333333</td>
      <td>1336.000000</td>
      <td>65.500000</td>
      <td>11151.000000</td>
      <td>159.300000</td>
      <td>35188.000000</td>
      <td>871.250000</td>
      <td>52598.000000</td>
      <td>560.333333</td>
      <td>180.000000</td>
      <td>1.519852e+07</td>
      <td>1.782986e+05</td>
      <td>166936.000000</td>
      <td>932.603352</td>
      <td>8311.000000</td>
      <td>104.333333</td>
      <td>3287.000000</td>
      <td>65.500000</td>
      <td>19803.000000</td>
      <td>133.446429</td>
      <td>64190.000000</td>
      <td>710.333333</td>
      <td>103640.000000</td>
      <td>560.333333</td>
      <td>365.000000</td>
      <td>2.993833e+07</td>
      <td>1.549087e+05</td>
      <td>519451.000000</td>
      <td>1427.063187</td>
      <td>19246.000000</td>
      <td>60.500000</td>
      <td>8016.000000</td>
      <td>65.500000</td>
      <td>26622.000000</td>
      <td>86.155340</td>
      <td>140785.000000</td>
      <td>647.666667</td>
      <td>234810.000000</td>
      <td>560.333333</td>
      <td>790.000000</td>
      <td>9.223372e+15</td>
      <td>1.358376e+13</td>
      <td>911417.000000</td>
      <td>1298.314815</td>
      <td>37859.000000</td>
      <td>60.500000</td>
      <td>16436.000000</td>
      <td>65.500000</td>
      <td>27315.000000</td>
      <td>58.358824</td>
      <td>387552.000000</td>
      <td>647.666667</td>
      <td>1690.000000</td>
      <td>5908.000000</td>
      <td>53.189189</td>
      <td>450.000000</td>
      <td>6.000000</td>
      <td>41.000000</td>
      <td>450.000000</td>
      <td>2000.000000</td>
      <td>2000.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>6.000000</td>
      <td>2017.000000</td>
      <td>12.000000</td>
      <td>31.000000</td>
      <td>6268.000000</td>
      <td>2017.000000</td>
      <td>12.000000</td>
      <td>31.000000</td>
      <td>6268.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>2017.000000</td>
      <td>12.000000</td>
      <td>31.000000</td>
      <td>6268.000000</td>
      <td>2017.000000</td>
      <td>12.000000</td>
      <td>31.000000</td>
      <td>6299.000000</td>
      <td>17207.000000</td>
      <td>789.000000</td>
      <td>17225.000000</td>
      <td>2017.000000</td>
    </tr>
  </tbody>
</table>
</div>

<h1>2. Data Preparation</h1>
<h2>Splitting Train, Dev, and Test</h2>
<p>First, we need to split the data into our train, dev, and test sets, which we'll do at rates of 60%, 25%, and 15% respectively.</p>
<div class="highlight"><pre><span></span><span class="c1">#Split data into a) train, dev, &amp; test, b) data &amp; labels</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1">#Set so that % churn is somewhat consistent</span>

<span class="c1">#Train, Dev, Test splits: 60/25/15</span>
<span class="n">train</span><span class="p">,</span> <span class="n">devtest</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df_fa</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">dev</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">devtest</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mi">15</span><span class="o">/</span><span class="mi">40</span><span class="p">)</span>

<span class="c1">#Calculate churn percentages</span>
<span class="n">churn_rate_all</span> <span class="o">=</span> <span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df_fa</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">churn_rate_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">churn_rate_dev</span> <span class="o">=</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">churn_rate_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#Print churn percentages</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Check churn percentages:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  All data, </span><span class="si">% c</span><span class="s1">hurn: </span><span class="si">{:.1%}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">churn_rate_all</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Train data, </span><span class="si">% c</span><span class="s1">hurn: </span><span class="si">{:.1%}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">churn_rate_train</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Dev data, </span><span class="si">% c</span><span class="s1">hurn: </span><span class="si">{:.1%}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">churn_rate_dev</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; Test data, </span><span class="si">% c</span><span class="s1">hurn: </span><span class="si">{:.1%}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">churn_rate_test</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Check churn percentages:</span>
<span class="err">  All data, % churn: 50.6%</span>
<span class="err">Train data, % churn: 50.7%</span>
<span class="err">  Dev data, % churn: 50.4%</span>
<span class="err"> Test data, % churn: 50.2%</span>
</pre></div>


<p>Training data is fine at 50% churn (we get more training examples for churn)
Changing Dev and Test back to real world (6%)</p>
<div class="highlight"><pre><span></span><span class="c1">#Reduce dev set to 6% churn</span>
<span class="c1">#Select x rows is_churn == 1; append to all rows where is_churn == 0</span>
<span class="n">churn_rate_actual</span> <span class="o">=</span> <span class="mf">0.11</span>  <span class="c1">#Emperically this works</span>
<span class="n">dev_churn_split_factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">churn_rate_dev</span> <span class="o">*</span> <span class="n">churn_rate_actual</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">churn_rate_actual</span><span class="p">)</span>
<span class="n">dummy</span><span class="p">,</span> <span class="n">dev_sub</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">dev</span><span class="p">[</span><span class="n">dev</span><span class="o">.</span><span class="n">is_churn</span><span class="o">==</span><span class="mi">1</span><span class="p">],</span> <span class="n">test_size</span><span class="o">=</span><span class="n">dev_churn_split_factor</span><span class="p">)</span>
<span class="c1"># dev = pd.concat([dev[dev.is_churn==0], dev_sub], ignore_index=True)</span>
<span class="c1"># We&#39;ll not ignore the index. We want msno as the index</span>
<span class="n">dev</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dev</span><span class="p">[</span><span class="n">dev</span><span class="o">.</span><span class="n">is_churn</span><span class="o">==</span><span class="mi">0</span><span class="p">],</span> <span class="n">dev_sub</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Test</span>
<span class="n">dev</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>city</th>
      <th>bd</th>
      <th>registered_via</th>
      <th>registration_init_time</th>
      <th>is_churn</th>
      <th>date_featuresdatelistening_tenure</th>
      <th>within_days_1num_unqsum</th>
      <th>within_days_1num_unqmean</th>
      <th>within_days_1num_unqcount</th>
      <th>within_days_1total_secssum</th>
      <th>within_days_1total_secsmean</th>
      <th>within_days_1num_25sum</th>
      <th>within_days_1num_25mean</th>
      <th>within_days_1num_50sum</th>
      <th>within_days_1num_50mean</th>
      <th>within_days_1num_75sum</th>
      <th>within_days_1num_75mean</th>
      <th>within_days_1num_985sum</th>
      <th>within_days_1num_985mean</th>
      <th>within_days_1num_100sum</th>
      <th>within_days_1num_100mean</th>
      <th>within_days_7num_unqsum</th>
      <th>within_days_7num_unqmean</th>
      <th>within_days_7num_unqcount</th>
      <th>within_days_7total_secssum</th>
      <th>within_days_7total_secsmean</th>
      <th>within_days_7num_25sum</th>
      <th>within_days_7num_25mean</th>
      <th>within_days_7num_50sum</th>
      <th>within_days_7num_50mean</th>
      <th>within_days_7num_75sum</th>
      <th>within_days_7num_75mean</th>
      <th>within_days_7num_985sum</th>
      <th>within_days_7num_985mean</th>
      <th>within_days_7num_100sum</th>
      <th>within_days_7num_100mean</th>
      <th>within_days_14num_unqsum</th>
      <th>within_days_14num_unqmean</th>
      <th>within_days_14num_unqcount</th>
      <th>within_days_14total_secssum</th>
      <th>within_days_14total_secsmean</th>
      <th>within_days_14num_25sum</th>
      <th>within_days_14num_25mean</th>
      <th>within_days_14num_50sum</th>
      <th>within_days_14num_50mean</th>
      <th>within_days_14num_75sum</th>
      <th>within_days_14num_75mean</th>
      <th>within_days_14num_985sum</th>
      <th>within_days_14num_985mean</th>
      <th>within_days_14num_100sum</th>
      <th>within_days_14num_100mean</th>
      <th>within_days_31num_unqsum</th>
      <th>within_days_31num_unqmean</th>
      <th>within_days_31num_unqcount</th>
      <th>within_days_31total_secssum</th>
      <th>within_days_31total_secsmean</th>
      <th>within_days_31num_25sum</th>
      <th>within_days_31num_25mean</th>
      <th>within_days_31num_50sum</th>
      <th>within_days_31num_50mean</th>
      <th>within_days_31num_75sum</th>
      <th>within_days_31num_75mean</th>
      <th>within_days_31num_985sum</th>
      <th>within_days_31num_985mean</th>
      <th>within_days_31num_100sum</th>
      <th>within_days_31num_100mean</th>
      <th>within_days_90num_unqsum</th>
      <th>within_days_90num_unqmean</th>
      <th>within_days_90num_unqcount</th>
      <th>within_days_90total_secssum</th>
      <th>within_days_90total_secsmean</th>
      <th>within_days_90num_25sum</th>
      <th>within_days_90num_25mean</th>
      <th>within_days_90num_50sum</th>
      <th>within_days_90num_50mean</th>
      <th>within_days_90num_75sum</th>
      <th>within_days_90num_75mean</th>
      <th>within_days_90num_985sum</th>
      <th>within_days_90num_985mean</th>
      <th>within_days_90num_100sum</th>
      <th>within_days_90num_100mean</th>
      <th>within_days_180num_unqsum</th>
      <th>within_days_180num_unqmean</th>
      <th>within_days_180num_unqcount</th>
      <th>within_days_180total_secssum</th>
      <th>within_days_180total_secsmean</th>
      <th>within_days_180num_25sum</th>
      <th>within_days_180num_25mean</th>
      <th>within_days_180num_50sum</th>
      <th>within_days_180num_50mean</th>
      <th>within_days_180num_75sum</th>
      <th>within_days_180num_75mean</th>
      <th>within_days_180num_985sum</th>
      <th>within_days_180num_985mean</th>
      <th>within_days_180num_100sum</th>
      <th>within_days_180num_100mean</th>
      <th>within_days_365num_unqsum</th>
      <th>within_days_365num_unqmean</th>
      <th>within_days_365num_unqcount</th>
      <th>within_days_365total_secssum</th>
      <th>within_days_365total_secsmean</th>
      <th>within_days_365num_25sum</th>
      <th>within_days_365num_25mean</th>
      <th>within_days_365num_50sum</th>
      <th>within_days_365num_50mean</th>
      <th>within_days_365num_75sum</th>
      <th>within_days_365num_75mean</th>
      <th>within_days_365num_985sum</th>
      <th>within_days_365num_985mean</th>
      <th>within_days_365num_100sum</th>
      <th>within_days_365num_100mean</th>
      <th>within_days_9999num_unqsum</th>
      <th>within_days_9999num_unqmean</th>
      <th>within_days_9999num_unqcount</th>
      <th>within_days_9999total_secssum</th>
      <th>within_days_9999total_secsmean</th>
      <th>within_days_9999num_25sum</th>
      <th>within_days_9999num_25mean</th>
      <th>within_days_9999num_50sum</th>
      <th>within_days_9999num_50mean</th>
      <th>within_days_9999num_75sum</th>
      <th>within_days_9999num_75mean</th>
      <th>within_days_9999num_985sum</th>
      <th>within_days_9999num_985mean</th>
      <th>within_days_9999num_100sum</th>
      <th>within_days_9999num_100mean</th>
      <th>total_plan_days</th>
      <th>total_amount_paid</th>
      <th>amount_paid_per_day</th>
      <th>diff_renewal_duration</th>
      <th>diff_plan_amount_paid_per_day</th>
      <th>latest_payment_method_id</th>
      <th>latest_plan_days</th>
      <th>latest_plan_list_price</th>
      <th>latest_amount_paid</th>
      <th>latest_auto_renew</th>
      <th>latest_is_cancel</th>
      <th>latest_amount_paid_per_day</th>
      <th>date_featuresdatemax_date_year</th>
      <th>date_featuresdatemax_date_month</th>
      <th>date_featuresdatemax_date_day</th>
      <th>date_featuresdatemax_date_absday</th>
      <th>date_featuresdatemin_date_year</th>
      <th>date_featuresdatemin_date_month</th>
      <th>date_featuresdatemin_date_day</th>
      <th>date_featuresdatemin_date_absday</th>
      <th>female</th>
      <th>male</th>
      <th>latest_transaction_date_year</th>
      <th>latest_transaction_date_month</th>
      <th>latest_transaction_date_day</th>
      <th>latest_transaction_date_absday</th>
      <th>latest_expire_date_year</th>
      <th>latest_expire_date_month</th>
      <th>latest_expire_date_day</th>
      <th>latest_expire_date_absday</th>
      <th>latest_trans_vs_expire</th>
      <th>latest_trans_vs_log</th>
      <th>latest_log_vs_expire</th>
      <th>registration_time</th>
    </tr>
    <tr>
      <th>msno</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>x5+AtzOZKAtnAJBsCIdAyiRl+1p9nIvAYchIkS4zaS4=</th>
      <td>22</td>
      <td>31</td>
      <td>9</td>
      <td>20150202</td>
      <td>0</td>
      <td>748</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>330.174</td>
      <td>330.174</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>179</td>
      <td>44.750000</td>
      <td>4</td>
      <td>41022.435</td>
      <td>10255.608750</td>
      <td>31</td>
      <td>7.750000</td>
      <td>4</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>6</td>
      <td>1.500000</td>
      <td>153</td>
      <td>38.250000</td>
      <td>193</td>
      <td>38.600000</td>
      <td>5</td>
      <td>43158.296</td>
      <td>8631.659200</td>
      <td>34</td>
      <td>6.800000</td>
      <td>11</td>
      <td>2.200000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>6</td>
      <td>1.200000</td>
      <td>158</td>
      <td>31.600000</td>
      <td>275</td>
      <td>22.916667</td>
      <td>12</td>
      <td>59410.879</td>
      <td>4950.906583</td>
      <td>52</td>
      <td>4.333333</td>
      <td>18</td>
      <td>1.500000</td>
      <td>7</td>
      <td>0.583333</td>
      <td>7</td>
      <td>0.583333</td>
      <td>214</td>
      <td>17.833333</td>
      <td>1687</td>
      <td>33.740000</td>
      <td>50</td>
      <td>372126.228</td>
      <td>7442.524560</td>
      <td>371</td>
      <td>7.420000</td>
      <td>79</td>
      <td>1.580000</td>
      <td>52</td>
      <td>1.040000</td>
      <td>50</td>
      <td>1.000000</td>
      <td>1303</td>
      <td>26.060000</td>
      <td>4329</td>
      <td>36.686441</td>
      <td>118</td>
      <td>997354.598</td>
      <td>8452.157610</td>
      <td>719</td>
      <td>6.093220</td>
      <td>137</td>
      <td>1.161017</td>
      <td>92</td>
      <td>0.779661</td>
      <td>118</td>
      <td>1.000000</td>
      <td>3595</td>
      <td>30.466102</td>
      <td>8460</td>
      <td>35.696203</td>
      <td>237</td>
      <td>1947010.556</td>
      <td>8215.234414</td>
      <td>1507</td>
      <td>6.358650</td>
      <td>272</td>
      <td>1.147679</td>
      <td>155</td>
      <td>0.654008</td>
      <td>171</td>
      <td>0.721519</td>
      <td>7136</td>
      <td>30.109705</td>
      <td>21497</td>
      <td>39.883117</td>
      <td>539</td>
      <td>5178191.657</td>
      <td>9607.034614</td>
      <td>3037</td>
      <td>5.634508</td>
      <td>686</td>
      <td>1.272727</td>
      <td>365</td>
      <td>0.677180</td>
      <td>367</td>
      <td>0.680891</td>
      <td>19132</td>
      <td>35.495362</td>
      <td>555</td>
      <td>2682</td>
      <td>4.832432</td>
      <td>0</td>
      <td>0.0</td>
      <td>27</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>0</td>
      <td>4.966667</td>
      <td>2017</td>
      <td>2</td>
      <td>19</td>
      <td>6259</td>
      <td>2015</td>
      <td>2</td>
      <td>2</td>
      <td>5511</td>
      <td>0</td>
      <td>1</td>
      <td>2017</td>
      <td>2</td>
      <td>1</td>
      <td>6241</td>
      <td>2017</td>
      <td>2</td>
      <td>28</td>
      <td>6268</td>
      <td>-27</td>
      <td>-18</td>
      <td>-9</td>
      <td>2015</td>
    </tr>
    <tr>
      <th>WiVvUGUuxmRviEX69svzHUC/zhpyJZdAm3ZyExXsjHA=</th>
      <td>17</td>
      <td>40</td>
      <td>9</td>
      <td>20071006</td>
      <td>0</td>
      <td>787</td>
      <td>46</td>
      <td>46</td>
      <td>1</td>
      <td>11779.310</td>
      <td>11779.310</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>46</td>
      <td>46</td>
      <td>105</td>
      <td>26.250000</td>
      <td>4</td>
      <td>26890.522</td>
      <td>6722.630500</td>
      <td>2</td>
      <td>0.500000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>2</td>
      <td>0.500000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>104</td>
      <td>26.000000</td>
      <td>145</td>
      <td>20.714286</td>
      <td>7</td>
      <td>36302.890</td>
      <td>5186.127143</td>
      <td>7</td>
      <td>1.000000</td>
      <td>1</td>
      <td>0.142857</td>
      <td>2</td>
      <td>0.285714</td>
      <td>2</td>
      <td>0.285714</td>
      <td>137</td>
      <td>19.571429</td>
      <td>276</td>
      <td>25.090909</td>
      <td>11</td>
      <td>55003.399</td>
      <td>5000.309000</td>
      <td>67</td>
      <td>6.090909</td>
      <td>29</td>
      <td>2.636364</td>
      <td>9</td>
      <td>0.818182</td>
      <td>6</td>
      <td>0.545455</td>
      <td>188</td>
      <td>17.090909</td>
      <td>1425</td>
      <td>24.568966</td>
      <td>58</td>
      <td>322053.197</td>
      <td>5552.641328</td>
      <td>275</td>
      <td>4.741379</td>
      <td>170</td>
      <td>2.931034</td>
      <td>74</td>
      <td>1.275862</td>
      <td>40</td>
      <td>0.689655</td>
      <td>1101</td>
      <td>18.982759</td>
      <td>2771</td>
      <td>23.091667</td>
      <td>120</td>
      <td>596865.459</td>
      <td>4973.878825</td>
      <td>617</td>
      <td>5.141667</td>
      <td>347</td>
      <td>2.891667</td>
      <td>140</td>
      <td>1.166667</td>
      <td>110</td>
      <td>0.916667</td>
      <td>2002</td>
      <td>16.683333</td>
      <td>6125</td>
      <td>26.864035</td>
      <td>228</td>
      <td>1388082.365</td>
      <td>6088.080548</td>
      <td>1567</td>
      <td>6.872807</td>
      <td>538</td>
      <td>2.359649</td>
      <td>255</td>
      <td>1.118421</td>
      <td>229</td>
      <td>1.004386</td>
      <td>4862</td>
      <td>21.324561</td>
      <td>26479</td>
      <td>43.408197</td>
      <td>610</td>
      <td>6661356.419</td>
      <td>10920.256425</td>
      <td>5362</td>
      <td>8.790164</td>
      <td>2650</td>
      <td>4.344262</td>
      <td>1323</td>
      <td>2.168852</td>
      <td>1318</td>
      <td>2.160656</td>
      <td>23024</td>
      <td>37.744262</td>
      <td>543</td>
      <td>2831</td>
      <td>5.213628</td>
      <td>0</td>
      <td>0.0</td>
      <td>39</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>0</td>
      <td>4.966667</td>
      <td>2017</td>
      <td>2</td>
      <td>27</td>
      <td>6267</td>
      <td>2015</td>
      <td>1</td>
      <td>2</td>
      <td>5480</td>
      <td>1</td>
      <td>0</td>
      <td>2017</td>
      <td>1</td>
      <td>31</td>
      <td>6240</td>
      <td>2017</td>
      <td>3</td>
      <td>12</td>
      <td>6280</td>
      <td>-40</td>
      <td>-27</td>
      <td>-13</td>
      <td>2007</td>
    </tr>
    <tr>
      <th>ur0rGRoV2XJOYpNbzl5n/jBEV9PrKDwZX4QeO03gXl8=</th>
      <td>6</td>
      <td>21</td>
      <td>4</td>
      <td>20160822</td>
      <td>0</td>
      <td>189</td>
      <td>36</td>
      <td>36</td>
      <td>1</td>
      <td>9240.939</td>
      <td>9240.939</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>35</td>
      <td>35</td>
      <td>371</td>
      <td>61.833333</td>
      <td>6</td>
      <td>107030.392</td>
      <td>17838.398667</td>
      <td>7</td>
      <td>1.166667</td>
      <td>3</td>
      <td>0.500000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1</td>
      <td>0.166667</td>
      <td>415</td>
      <td>69.166667</td>
      <td>756</td>
      <td>68.727273</td>
      <td>11</td>
      <td>220080.304</td>
      <td>20007.300364</td>
      <td>58</td>
      <td>5.272727</td>
      <td>27</td>
      <td>2.454545</td>
      <td>5</td>
      <td>0.454545</td>
      <td>7</td>
      <td>0.636364</td>
      <td>843</td>
      <td>76.636364</td>
      <td>1766</td>
      <td>65.407407</td>
      <td>27</td>
      <td>590614.385</td>
      <td>21874.606852</td>
      <td>138</td>
      <td>5.111111</td>
      <td>74</td>
      <td>2.740741</td>
      <td>15</td>
      <td>0.555556</td>
      <td>16</td>
      <td>0.592593</td>
      <td>2275</td>
      <td>84.259259</td>
      <td>5486</td>
      <td>66.096386</td>
      <td>83</td>
      <td>1899764.373</td>
      <td>22888.727386</td>
      <td>493</td>
      <td>5.939759</td>
      <td>116</td>
      <td>1.397590</td>
      <td>44</td>
      <td>0.530120</td>
      <td>41</td>
      <td>0.493976</td>
      <td>7351</td>
      <td>88.566265</td>
      <td>11591</td>
      <td>68.994048</td>
      <td>168</td>
      <td>3408784.787</td>
      <td>20290.385637</td>
      <td>1131</td>
      <td>6.732143</td>
      <td>198</td>
      <td>1.178571</td>
      <td>90</td>
      <td>0.535714</td>
      <td>160</td>
      <td>0.952381</td>
      <td>13134</td>
      <td>78.178571</td>
      <td>12290</td>
      <td>69.044944</td>
      <td>178</td>
      <td>3576194.197</td>
      <td>20090.978635</td>
      <td>1290</td>
      <td>7.247191</td>
      <td>205</td>
      <td>1.151685</td>
      <td>99</td>
      <td>0.556180</td>
      <td>178</td>
      <td>1.000000</td>
      <td>13798</td>
      <td>77.516854</td>
      <td>12290</td>
      <td>69.044944</td>
      <td>178</td>
      <td>3576194.197</td>
      <td>20090.978635</td>
      <td>1290</td>
      <td>7.247191</td>
      <td>205</td>
      <td>1.151685</td>
      <td>99</td>
      <td>0.556180</td>
      <td>178</td>
      <td>1.000000</td>
      <td>13798</td>
      <td>77.516854</td>
      <td>210</td>
      <td>1043</td>
      <td>4.966667</td>
      <td>0</td>
      <td>0.0</td>
      <td>39</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>0</td>
      <td>4.966667</td>
      <td>2017</td>
      <td>2</td>
      <td>27</td>
      <td>6267</td>
      <td>2016</td>
      <td>8</td>
      <td>22</td>
      <td>6078</td>
      <td>1</td>
      <td>0</td>
      <td>2017</td>
      <td>1</td>
      <td>31</td>
      <td>6240</td>
      <td>2017</td>
      <td>3</td>
      <td>26</td>
      <td>6294</td>
      <td>-54</td>
      <td>-27</td>
      <td>-27</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>M/PccoJW/A9myX+eCodcY8Z4LMD1r+d6YKzUNv4PMZo=</th>
      <td>1</td>
      <td>0</td>
      <td>7</td>
      <td>20130610</td>
      <td>0</td>
      <td>789</td>
      <td>15</td>
      <td>15</td>
      <td>1</td>
      <td>3416.639</td>
      <td>3416.639</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>16</td>
      <td>16</td>
      <td>204</td>
      <td>29.142857</td>
      <td>7</td>
      <td>88005.151</td>
      <td>12572.164429</td>
      <td>5</td>
      <td>0.714286</td>
      <td>3</td>
      <td>0.428571</td>
      <td>2</td>
      <td>0.285714</td>
      <td>2</td>
      <td>0.285714</td>
      <td>395</td>
      <td>56.428571</td>
      <td>441</td>
      <td>31.500000</td>
      <td>14</td>
      <td>168815.462</td>
      <td>12058.247286</td>
      <td>52</td>
      <td>3.714286</td>
      <td>31</td>
      <td>2.214286</td>
      <td>20</td>
      <td>1.428571</td>
      <td>6</td>
      <td>0.428571</td>
      <td>735</td>
      <td>52.500000</td>
      <td>781</td>
      <td>26.033333</td>
      <td>30</td>
      <td>303585.197</td>
      <td>10119.506567</td>
      <td>118</td>
      <td>3.933333</td>
      <td>91</td>
      <td>3.033333</td>
      <td>41</td>
      <td>1.366667</td>
      <td>10</td>
      <td>0.333333</td>
      <td>1282</td>
      <td>42.733333</td>
      <td>1984</td>
      <td>27.178082</td>
      <td>73</td>
      <td>581820.141</td>
      <td>7970.138918</td>
      <td>217</td>
      <td>2.972603</td>
      <td>178</td>
      <td>2.438356</td>
      <td>69</td>
      <td>0.945205</td>
      <td>24</td>
      <td>0.328767</td>
      <td>2343</td>
      <td>32.095890</td>
      <td>3501</td>
      <td>25.554745</td>
      <td>137</td>
      <td>932913.407</td>
      <td>6809.586912</td>
      <td>373</td>
      <td>2.722628</td>
      <td>282</td>
      <td>2.058394</td>
      <td>106</td>
      <td>0.773723</td>
      <td>50</td>
      <td>0.364964</td>
      <td>3661</td>
      <td>26.722628</td>
      <td>7250</td>
      <td>26.459854</td>
      <td>274</td>
      <td>1818035.906</td>
      <td>6635.167540</td>
      <td>768</td>
      <td>2.802920</td>
      <td>504</td>
      <td>1.839416</td>
      <td>196</td>
      <td>0.715328</td>
      <td>116</td>
      <td>0.423358</td>
      <td>7089</td>
      <td>25.872263</td>
      <td>17809</td>
      <td>27.440678</td>
      <td>649</td>
      <td>4533034.736</td>
      <td>6984.645202</td>
      <td>1352</td>
      <td>2.083205</td>
      <td>937</td>
      <td>1.443760</td>
      <td>336</td>
      <td>0.517720</td>
      <td>198</td>
      <td>0.305085</td>
      <td>17432</td>
      <td>26.859784</td>
      <td>840</td>
      <td>3631</td>
      <td>4.322619</td>
      <td>0</td>
      <td>0.0</td>
      <td>41</td>
      <td>30</td>
      <td>99</td>
      <td>99</td>
      <td>1</td>
      <td>0</td>
      <td>3.300000</td>
      <td>2017</td>
      <td>2</td>
      <td>28</td>
      <td>6268</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>5479</td>
      <td>0</td>
      <td>0</td>
      <td>2017</td>
      <td>2</td>
      <td>24</td>
      <td>6264</td>
      <td>2017</td>
      <td>3</td>
      <td>25</td>
      <td>6293</td>
      <td>-29</td>
      <td>-4</td>
      <td>-25</td>
      <td>2013</td>
    </tr>
    <tr>
      <th>BZbN3U+ghA0lwOA34yF/GNHbJb73T48nEZGHc4bcikc=</th>
      <td>9</td>
      <td>31</td>
      <td>9</td>
      <td>20080410</td>
      <td>0</td>
      <td>788</td>
      <td>25</td>
      <td>25</td>
      <td>1</td>
      <td>13113.138</td>
      <td>13113.138</td>
      <td>14</td>
      <td>14</td>
      <td>1</td>
      <td>1</td>
      <td>5</td>
      <td>5</td>
      <td>3</td>
      <td>3</td>
      <td>93</td>
      <td>93</td>
      <td>101</td>
      <td>16.833333</td>
      <td>6</td>
      <td>33808.385</td>
      <td>5634.730833</td>
      <td>29</td>
      <td>4.833333</td>
      <td>2</td>
      <td>0.333333</td>
      <td>12</td>
      <td>2.000000</td>
      <td>6</td>
      <td>1.000000</td>
      <td>165</td>
      <td>27.500000</td>
      <td>157</td>
      <td>13.083333</td>
      <td>12</td>
      <td>48485.571</td>
      <td>4040.464250</td>
      <td>40</td>
      <td>3.333333</td>
      <td>4</td>
      <td>0.333333</td>
      <td>14</td>
      <td>1.166667</td>
      <td>9</td>
      <td>0.750000</td>
      <td>219</td>
      <td>18.250000</td>
      <td>484</td>
      <td>21.043478</td>
      <td>23</td>
      <td>139573.866</td>
      <td>6068.428957</td>
      <td>97</td>
      <td>4.217391</td>
      <td>21</td>
      <td>0.913043</td>
      <td>23</td>
      <td>1.000000</td>
      <td>20</td>
      <td>0.869565</td>
      <td>554</td>
      <td>24.086957</td>
      <td>1416</td>
      <td>22.838710</td>
      <td>62</td>
      <td>380409.666</td>
      <td>6135.639774</td>
      <td>213</td>
      <td>3.435484</td>
      <td>51</td>
      <td>0.822581</td>
      <td>50</td>
      <td>0.806452</td>
      <td>59</td>
      <td>0.951613</td>
      <td>1583</td>
      <td>25.532258</td>
      <td>4484</td>
      <td>30.093960</td>
      <td>149</td>
      <td>1179486.041</td>
      <td>7916.013698</td>
      <td>791</td>
      <td>5.308725</td>
      <td>162</td>
      <td>1.087248</td>
      <td>143</td>
      <td>0.959732</td>
      <td>259</td>
      <td>1.738255</td>
      <td>4752</td>
      <td>31.892617</td>
      <td>8142</td>
      <td>26.607843</td>
      <td>306</td>
      <td>2174747.697</td>
      <td>7107.018618</td>
      <td>1684</td>
      <td>5.503268</td>
      <td>343</td>
      <td>1.120915</td>
      <td>312</td>
      <td>1.019608</td>
      <td>519</td>
      <td>1.696078</td>
      <td>8373</td>
      <td>27.362745</td>
      <td>12775</td>
      <td>20.942623</td>
      <td>610</td>
      <td>3287076.077</td>
      <td>5388.649307</td>
      <td>2773</td>
      <td>4.545902</td>
      <td>602</td>
      <td>0.986885</td>
      <td>543</td>
      <td>0.890164</td>
      <td>926</td>
      <td>1.518033</td>
      <td>12292</td>
      <td>20.150820</td>
      <td>480</td>
      <td>3278</td>
      <td>6.829167</td>
      <td>0</td>
      <td>0.0</td>
      <td>34</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>0</td>
      <td>4.966667</td>
      <td>2017</td>
      <td>2</td>
      <td>27</td>
      <td>6267</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>5479</td>
      <td>1</td>
      <td>0</td>
      <td>2017</td>
      <td>2</td>
      <td>28</td>
      <td>6268</td>
      <td>2017</td>
      <td>3</td>
      <td>31</td>
      <td>6299</td>
      <td>-31</td>
      <td>1</td>
      <td>-32</td>
      <td>2008</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="c1">#Reduce test set to 6% churn</span>
<span class="n">test_churn_split_factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">churn_rate_test</span> <span class="o">*</span> <span class="n">churn_rate_actual</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">churn_rate_actual</span><span class="p">)</span>
<span class="n">dummy</span><span class="p">,</span> <span class="n">test_sub</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="n">test</span><span class="o">.</span><span class="n">is_churn</span><span class="o">==</span><span class="mi">1</span><span class="p">],</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_churn_split_factor</span><span class="p">)</span>
<span class="c1"># test = pd.concat([test[test.is_churn==0], test_sub], ignore_index=True)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="n">test</span><span class="o">.</span><span class="n">is_churn</span><span class="o">==</span><span class="mi">0</span><span class="p">],</span> <span class="n">test_sub</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Test</span>
<span class="n">test</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>city</th>
      <th>bd</th>
      <th>registered_via</th>
      <th>registration_init_time</th>
      <th>is_churn</th>
      <th>date_featuresdatelistening_tenure</th>
      <th>within_days_1num_unqsum</th>
      <th>within_days_1num_unqmean</th>
      <th>within_days_1num_unqcount</th>
      <th>within_days_1total_secssum</th>
      <th>within_days_1total_secsmean</th>
      <th>within_days_1num_25sum</th>
      <th>within_days_1num_25mean</th>
      <th>within_days_1num_50sum</th>
      <th>within_days_1num_50mean</th>
      <th>within_days_1num_75sum</th>
      <th>within_days_1num_75mean</th>
      <th>within_days_1num_985sum</th>
      <th>within_days_1num_985mean</th>
      <th>within_days_1num_100sum</th>
      <th>within_days_1num_100mean</th>
      <th>within_days_7num_unqsum</th>
      <th>within_days_7num_unqmean</th>
      <th>within_days_7num_unqcount</th>
      <th>within_days_7total_secssum</th>
      <th>within_days_7total_secsmean</th>
      <th>within_days_7num_25sum</th>
      <th>within_days_7num_25mean</th>
      <th>within_days_7num_50sum</th>
      <th>within_days_7num_50mean</th>
      <th>within_days_7num_75sum</th>
      <th>within_days_7num_75mean</th>
      <th>within_days_7num_985sum</th>
      <th>within_days_7num_985mean</th>
      <th>within_days_7num_100sum</th>
      <th>within_days_7num_100mean</th>
      <th>within_days_14num_unqsum</th>
      <th>within_days_14num_unqmean</th>
      <th>within_days_14num_unqcount</th>
      <th>within_days_14total_secssum</th>
      <th>within_days_14total_secsmean</th>
      <th>within_days_14num_25sum</th>
      <th>within_days_14num_25mean</th>
      <th>within_days_14num_50sum</th>
      <th>within_days_14num_50mean</th>
      <th>within_days_14num_75sum</th>
      <th>within_days_14num_75mean</th>
      <th>within_days_14num_985sum</th>
      <th>within_days_14num_985mean</th>
      <th>within_days_14num_100sum</th>
      <th>within_days_14num_100mean</th>
      <th>within_days_31num_unqsum</th>
      <th>within_days_31num_unqmean</th>
      <th>within_days_31num_unqcount</th>
      <th>within_days_31total_secssum</th>
      <th>within_days_31total_secsmean</th>
      <th>within_days_31num_25sum</th>
      <th>within_days_31num_25mean</th>
      <th>within_days_31num_50sum</th>
      <th>within_days_31num_50mean</th>
      <th>within_days_31num_75sum</th>
      <th>within_days_31num_75mean</th>
      <th>within_days_31num_985sum</th>
      <th>within_days_31num_985mean</th>
      <th>within_days_31num_100sum</th>
      <th>within_days_31num_100mean</th>
      <th>within_days_90num_unqsum</th>
      <th>within_days_90num_unqmean</th>
      <th>within_days_90num_unqcount</th>
      <th>within_days_90total_secssum</th>
      <th>within_days_90total_secsmean</th>
      <th>within_days_90num_25sum</th>
      <th>within_days_90num_25mean</th>
      <th>within_days_90num_50sum</th>
      <th>within_days_90num_50mean</th>
      <th>within_days_90num_75sum</th>
      <th>within_days_90num_75mean</th>
      <th>within_days_90num_985sum</th>
      <th>within_days_90num_985mean</th>
      <th>within_days_90num_100sum</th>
      <th>within_days_90num_100mean</th>
      <th>within_days_180num_unqsum</th>
      <th>within_days_180num_unqmean</th>
      <th>within_days_180num_unqcount</th>
      <th>within_days_180total_secssum</th>
      <th>within_days_180total_secsmean</th>
      <th>within_days_180num_25sum</th>
      <th>within_days_180num_25mean</th>
      <th>within_days_180num_50sum</th>
      <th>within_days_180num_50mean</th>
      <th>within_days_180num_75sum</th>
      <th>within_days_180num_75mean</th>
      <th>within_days_180num_985sum</th>
      <th>within_days_180num_985mean</th>
      <th>within_days_180num_100sum</th>
      <th>within_days_180num_100mean</th>
      <th>within_days_365num_unqsum</th>
      <th>within_days_365num_unqmean</th>
      <th>within_days_365num_unqcount</th>
      <th>within_days_365total_secssum</th>
      <th>within_days_365total_secsmean</th>
      <th>within_days_365num_25sum</th>
      <th>within_days_365num_25mean</th>
      <th>within_days_365num_50sum</th>
      <th>within_days_365num_50mean</th>
      <th>within_days_365num_75sum</th>
      <th>within_days_365num_75mean</th>
      <th>within_days_365num_985sum</th>
      <th>within_days_365num_985mean</th>
      <th>within_days_365num_100sum</th>
      <th>within_days_365num_100mean</th>
      <th>within_days_9999num_unqsum</th>
      <th>within_days_9999num_unqmean</th>
      <th>within_days_9999num_unqcount</th>
      <th>within_days_9999total_secssum</th>
      <th>within_days_9999total_secsmean</th>
      <th>within_days_9999num_25sum</th>
      <th>within_days_9999num_25mean</th>
      <th>within_days_9999num_50sum</th>
      <th>within_days_9999num_50mean</th>
      <th>within_days_9999num_75sum</th>
      <th>within_days_9999num_75mean</th>
      <th>within_days_9999num_985sum</th>
      <th>within_days_9999num_985mean</th>
      <th>within_days_9999num_100sum</th>
      <th>within_days_9999num_100mean</th>
      <th>total_plan_days</th>
      <th>total_amount_paid</th>
      <th>amount_paid_per_day</th>
      <th>diff_renewal_duration</th>
      <th>diff_plan_amount_paid_per_day</th>
      <th>latest_payment_method_id</th>
      <th>latest_plan_days</th>
      <th>latest_plan_list_price</th>
      <th>latest_amount_paid</th>
      <th>latest_auto_renew</th>
      <th>latest_is_cancel</th>
      <th>latest_amount_paid_per_day</th>
      <th>date_featuresdatemax_date_year</th>
      <th>date_featuresdatemax_date_month</th>
      <th>date_featuresdatemax_date_day</th>
      <th>date_featuresdatemax_date_absday</th>
      <th>date_featuresdatemin_date_year</th>
      <th>date_featuresdatemin_date_month</th>
      <th>date_featuresdatemin_date_day</th>
      <th>date_featuresdatemin_date_absday</th>
      <th>female</th>
      <th>male</th>
      <th>latest_transaction_date_year</th>
      <th>latest_transaction_date_month</th>
      <th>latest_transaction_date_day</th>
      <th>latest_transaction_date_absday</th>
      <th>latest_expire_date_year</th>
      <th>latest_expire_date_month</th>
      <th>latest_expire_date_day</th>
      <th>latest_expire_date_absday</th>
      <th>latest_trans_vs_expire</th>
      <th>latest_trans_vs_log</th>
      <th>latest_log_vs_expire</th>
      <th>registration_time</th>
    </tr>
    <tr>
      <th>msno</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>pGYTw4lPrmjHN9lLR7InnPhzwrtsEI+1auPYpgAk6b0=</th>
      <td>1</td>
      <td>0</td>
      <td>7</td>
      <td>20160108</td>
      <td>0</td>
      <td>363</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>368.661</td>
      <td>368.661</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>24</td>
      <td>12.000000</td>
      <td>2</td>
      <td>11875.661</td>
      <td>5937.830500</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1</td>
      <td>0.500000</td>
      <td>57</td>
      <td>28.500000</td>
      <td>46</td>
      <td>15.333333</td>
      <td>3</td>
      <td>20711.377</td>
      <td>6903.792333</td>
      <td>1</td>
      <td>0.333333</td>
      <td>1</td>
      <td>0.333333</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1</td>
      <td>0.333333</td>
      <td>99</td>
      <td>33.000000</td>
      <td>190</td>
      <td>14.615385</td>
      <td>13</td>
      <td>56847.506</td>
      <td>4372.885077</td>
      <td>8</td>
      <td>0.615385</td>
      <td>3</td>
      <td>0.230769</td>
      <td>2</td>
      <td>0.153846</td>
      <td>4</td>
      <td>0.307692</td>
      <td>267</td>
      <td>20.538462</td>
      <td>268</td>
      <td>14.888889</td>
      <td>18</td>
      <td>81202.505</td>
      <td>4511.250278</td>
      <td>14</td>
      <td>0.777778</td>
      <td>4</td>
      <td>0.222222</td>
      <td>5</td>
      <td>0.277778</td>
      <td>9</td>
      <td>0.500000</td>
      <td>377</td>
      <td>20.944444</td>
      <td>290</td>
      <td>13.181818</td>
      <td>22</td>
      <td>84854.309</td>
      <td>3857.014045</td>
      <td>20</td>
      <td>0.909091</td>
      <td>8</td>
      <td>0.363636</td>
      <td>8</td>
      <td>0.363636</td>
      <td>10</td>
      <td>0.454545</td>
      <td>386</td>
      <td>17.545455</td>
      <td>605</td>
      <td>14.069767</td>
      <td>43</td>
      <td>158621.515</td>
      <td>3688.872442</td>
      <td>55</td>
      <td>1.279070</td>
      <td>21</td>
      <td>0.488372</td>
      <td>20</td>
      <td>0.465116</td>
      <td>19</td>
      <td>0.441860</td>
      <td>663</td>
      <td>15.418605</td>
      <td>605</td>
      <td>14.069767</td>
      <td>43</td>
      <td>158621.515</td>
      <td>3688.872442</td>
      <td>55</td>
      <td>1.279070</td>
      <td>21</td>
      <td>0.488372</td>
      <td>20</td>
      <td>0.465116</td>
      <td>19</td>
      <td>0.441860</td>
      <td>663</td>
      <td>15.418605</td>
      <td>420</td>
      <td>1386</td>
      <td>3.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>41</td>
      <td>30</td>
      <td>99</td>
      <td>99</td>
      <td>1</td>
      <td>0</td>
      <td>3.300000</td>
      <td>2017</td>
      <td>1</td>
      <td>23</td>
      <td>6232</td>
      <td>2016</td>
      <td>1</td>
      <td>26</td>
      <td>5869</td>
      <td>0</td>
      <td>0</td>
      <td>2017</td>
      <td>2</td>
      <td>8</td>
      <td>6248</td>
      <td>2017</td>
      <td>3</td>
      <td>8</td>
      <td>6276</td>
      <td>-28</td>
      <td>16</td>
      <td>-44</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>BLQQH7Gf4iOW4DhlyTBC1YwJgYXEgYkq/0L8VCO/w74=</th>
      <td>15</td>
      <td>28</td>
      <td>7</td>
      <td>20130111</td>
      <td>0</td>
      <td>227</td>
      <td>21</td>
      <td>21</td>
      <td>1</td>
      <td>7849.636</td>
      <td>7849.636</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>31</td>
      <td>31</td>
      <td>95</td>
      <td>23.750000</td>
      <td>4</td>
      <td>28433.210</td>
      <td>7108.302500</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1</td>
      <td>0.250000</td>
      <td>2</td>
      <td>0.500000</td>
      <td>4</td>
      <td>1.000000</td>
      <td>106</td>
      <td>26.500000</td>
      <td>158</td>
      <td>15.800000</td>
      <td>10</td>
      <td>48280.951</td>
      <td>4828.095100</td>
      <td>16</td>
      <td>1.600000</td>
      <td>7</td>
      <td>0.700000</td>
      <td>2</td>
      <td>0.200000</td>
      <td>14</td>
      <td>1.400000</td>
      <td>173</td>
      <td>17.300000</td>
      <td>458</td>
      <td>17.615385</td>
      <td>26</td>
      <td>164517.024</td>
      <td>6327.577846</td>
      <td>44</td>
      <td>1.692308</td>
      <td>33</td>
      <td>1.269231</td>
      <td>13</td>
      <td>0.500000</td>
      <td>43</td>
      <td>1.653846</td>
      <td>590</td>
      <td>22.692308</td>
      <td>1819</td>
      <td>27.149254</td>
      <td>67</td>
      <td>513447.609</td>
      <td>7663.397149</td>
      <td>226</td>
      <td>3.373134</td>
      <td>139</td>
      <td>2.074627</td>
      <td>86</td>
      <td>1.283582</td>
      <td>97</td>
      <td>1.447761</td>
      <td>1808</td>
      <td>26.985075</td>
      <td>4124</td>
      <td>32.992000</td>
      <td>125</td>
      <td>1148673.053</td>
      <td>9189.384424</td>
      <td>435</td>
      <td>3.480000</td>
      <td>219</td>
      <td>1.752000</td>
      <td>147</td>
      <td>1.176000</td>
      <td>194</td>
      <td>1.552000</td>
      <td>4106</td>
      <td>32.848000</td>
      <td>6030</td>
      <td>37.453416</td>
      <td>161</td>
      <td>1588085.229</td>
      <td>9863.883410</td>
      <td>780</td>
      <td>4.844720</td>
      <td>540</td>
      <td>3.354037</td>
      <td>303</td>
      <td>1.881988</td>
      <td>273</td>
      <td>1.695652</td>
      <td>5519</td>
      <td>34.279503</td>
      <td>6030</td>
      <td>37.453416</td>
      <td>161</td>
      <td>1588085.229</td>
      <td>9863.883410</td>
      <td>780</td>
      <td>4.844720</td>
      <td>540</td>
      <td>3.354037</td>
      <td>303</td>
      <td>1.881988</td>
      <td>273</td>
      <td>1.695652</td>
      <td>5519</td>
      <td>34.279503</td>
      <td>277</td>
      <td>1043</td>
      <td>3.765343</td>
      <td>0</td>
      <td>0.0</td>
      <td>40</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>1</td>
      <td>4.966667</td>
      <td>2017</td>
      <td>2</td>
      <td>28</td>
      <td>6268</td>
      <td>2016</td>
      <td>7</td>
      <td>16</td>
      <td>6041</td>
      <td>0</td>
      <td>1</td>
      <td>2017</td>
      <td>2</td>
      <td>21</td>
      <td>6261</td>
      <td>2017</td>
      <td>2</td>
      <td>20</td>
      <td>6260</td>
      <td>1</td>
      <td>-7</td>
      <td>8</td>
      <td>2013</td>
    </tr>
    <tr>
      <th>zm8t3xu/h5PxWJZw6A88Dp1lrzIdEPmqQkKVGhsVzpU=</th>
      <td>13</td>
      <td>47</td>
      <td>7</td>
      <td>20161203</td>
      <td>0</td>
      <td>43</td>
      <td>8</td>
      <td>8</td>
      <td>1</td>
      <td>463.075</td>
      <td>463.075</td>
      <td>6</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>8</td>
      <td>8.000000</td>
      <td>1</td>
      <td>463.075</td>
      <td>463.075000</td>
      <td>6</td>
      <td>6.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1</td>
      <td>1.000000</td>
      <td>47</td>
      <td>7.833333</td>
      <td>6</td>
      <td>4970.152</td>
      <td>828.358667</td>
      <td>38</td>
      <td>6.333333</td>
      <td>4</td>
      <td>0.666667</td>
      <td>1</td>
      <td>0.166667</td>
      <td>3</td>
      <td>0.500000</td>
      <td>15</td>
      <td>2.500000</td>
      <td>214</td>
      <td>11.888889</td>
      <td>18</td>
      <td>38819.765</td>
      <td>2156.653611</td>
      <td>105</td>
      <td>5.833333</td>
      <td>18</td>
      <td>1.000000</td>
      <td>7</td>
      <td>0.388889</td>
      <td>11</td>
      <td>0.611111</td>
      <td>148</td>
      <td>8.222222</td>
      <td>464</td>
      <td>17.185185</td>
      <td>27</td>
      <td>105892.311</td>
      <td>3921.937444</td>
      <td>286</td>
      <td>10.592593</td>
      <td>53</td>
      <td>1.962963</td>
      <td>15</td>
      <td>0.555556</td>
      <td>23</td>
      <td>0.851852</td>
      <td>411</td>
      <td>15.222222</td>
      <td>464</td>
      <td>17.185185</td>
      <td>27</td>
      <td>105892.311</td>
      <td>3921.937444</td>
      <td>286</td>
      <td>10.592593</td>
      <td>53</td>
      <td>1.962963</td>
      <td>15</td>
      <td>0.555556</td>
      <td>23</td>
      <td>0.851852</td>
      <td>411</td>
      <td>15.222222</td>
      <td>464</td>
      <td>17.185185</td>
      <td>27</td>
      <td>105892.311</td>
      <td>3921.937444</td>
      <td>286</td>
      <td>10.592593</td>
      <td>53</td>
      <td>1.962963</td>
      <td>15</td>
      <td>0.555556</td>
      <td>23</td>
      <td>0.851852</td>
      <td>411</td>
      <td>15.222222</td>
      <td>464</td>
      <td>17.185185</td>
      <td>27</td>
      <td>105892.311</td>
      <td>3921.937444</td>
      <td>286</td>
      <td>10.592593</td>
      <td>53</td>
      <td>1.962963</td>
      <td>15</td>
      <td>0.555556</td>
      <td>23</td>
      <td>0.851852</td>
      <td>411</td>
      <td>15.222222</td>
      <td>120</td>
      <td>396</td>
      <td>3.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>41</td>
      <td>30</td>
      <td>99</td>
      <td>99</td>
      <td>1</td>
      <td>0</td>
      <td>3.300000</td>
      <td>2017</td>
      <td>2</td>
      <td>27</td>
      <td>6267</td>
      <td>2017</td>
      <td>1</td>
      <td>15</td>
      <td>6224</td>
      <td>1</td>
      <td>0</td>
      <td>2017</td>
      <td>2</td>
      <td>12</td>
      <td>6252</td>
      <td>2017</td>
      <td>3</td>
      <td>12</td>
      <td>6280</td>
      <td>-28</td>
      <td>-15</td>
      <td>-13</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>oGtvKgIb+1vvcTTPdZWFyeyoUchFtc+9D+KOfR+DIdg=</th>
      <td>1</td>
      <td>0</td>
      <td>7</td>
      <td>20160106</td>
      <td>0</td>
      <td>213</td>
      <td>11</td>
      <td>11</td>
      <td>1</td>
      <td>502.463</td>
      <td>502.463</td>
      <td>8</td>
      <td>8</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>14</td>
      <td>7.000000</td>
      <td>2</td>
      <td>982.412</td>
      <td>491.206000</td>
      <td>9</td>
      <td>4.500000</td>
      <td>3</td>
      <td>1.500000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1</td>
      <td>0.500000</td>
      <td>1</td>
      <td>0.500000</td>
      <td>25</td>
      <td>8.333333</td>
      <td>3</td>
      <td>2976.693</td>
      <td>992.231000</td>
      <td>11</td>
      <td>3.666667</td>
      <td>4</td>
      <td>1.333333</td>
      <td>0</td>
      <td>0.000000</td>
      <td>2</td>
      <td>0.666667</td>
      <td>8</td>
      <td>2.666667</td>
      <td>26</td>
      <td>6.500000</td>
      <td>4</td>
      <td>2981.738</td>
      <td>745.434500</td>
      <td>12</td>
      <td>3.000000</td>
      <td>4</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>2</td>
      <td>0.500000</td>
      <td>8</td>
      <td>2.000000</td>
      <td>196</td>
      <td>16.333333</td>
      <td>12</td>
      <td>47610.576</td>
      <td>3967.548000</td>
      <td>15</td>
      <td>1.250000</td>
      <td>6</td>
      <td>0.500000</td>
      <td>4</td>
      <td>0.333333</td>
      <td>4</td>
      <td>0.333333</td>
      <td>183</td>
      <td>15.250000</td>
      <td>1672</td>
      <td>23.222222</td>
      <td>72</td>
      <td>370688.635</td>
      <td>5148.453264</td>
      <td>256</td>
      <td>3.555556</td>
      <td>91</td>
      <td>1.263889</td>
      <td>44</td>
      <td>0.611111</td>
      <td>32</td>
      <td>0.444444</td>
      <td>1405</td>
      <td>19.513889</td>
      <td>2073</td>
      <td>20.126214</td>
      <td>103</td>
      <td>453956.260</td>
      <td>4407.342330</td>
      <td>384</td>
      <td>3.728155</td>
      <td>126</td>
      <td>1.223301</td>
      <td>74</td>
      <td>0.718447</td>
      <td>49</td>
      <td>0.475728</td>
      <td>1685</td>
      <td>16.359223</td>
      <td>2073</td>
      <td>20.126214</td>
      <td>103</td>
      <td>453956.260</td>
      <td>4407.342330</td>
      <td>384</td>
      <td>3.728155</td>
      <td>126</td>
      <td>1.223301</td>
      <td>74</td>
      <td>0.718447</td>
      <td>49</td>
      <td>0.475728</td>
      <td>1685</td>
      <td>16.359223</td>
      <td>390</td>
      <td>1287</td>
      <td>3.300000</td>
      <td>0</td>
      <td>0.0</td>
      <td>41</td>
      <td>30</td>
      <td>99</td>
      <td>99</td>
      <td>1</td>
      <td>0</td>
      <td>3.300000</td>
      <td>2016</td>
      <td>8</td>
      <td>6</td>
      <td>6062</td>
      <td>2016</td>
      <td>1</td>
      <td>6</td>
      <td>5849</td>
      <td>0</td>
      <td>0</td>
      <td>2017</td>
      <td>2</td>
      <td>5</td>
      <td>6245</td>
      <td>2017</td>
      <td>3</td>
      <td>5</td>
      <td>6273</td>
      <td>-28</td>
      <td>183</td>
      <td>-211</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>shHx7K5hJ3W50FoA4BTEQfSyVcuqCidkjCtY21FdTLs=</th>
      <td>22</td>
      <td>29</td>
      <td>3</td>
      <td>20150916</td>
      <td>0</td>
      <td>531</td>
      <td>42</td>
      <td>42</td>
      <td>1</td>
      <td>8183.695</td>
      <td>8183.695</td>
      <td>10</td>
      <td>10</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>3</td>
      <td>5</td>
      <td>5</td>
      <td>24</td>
      <td>24</td>
      <td>232</td>
      <td>33.142857</td>
      <td>7</td>
      <td>52512.478</td>
      <td>7501.782571</td>
      <td>51</td>
      <td>7.285714</td>
      <td>6</td>
      <td>0.857143</td>
      <td>8</td>
      <td>1.142857</td>
      <td>15</td>
      <td>2.142857</td>
      <td>207</td>
      <td>29.571429</td>
      <td>505</td>
      <td>42.083333</td>
      <td>12</td>
      <td>121942.448</td>
      <td>10161.870667</td>
      <td>64</td>
      <td>5.333333</td>
      <td>12</td>
      <td>1.000000</td>
      <td>14</td>
      <td>1.166667</td>
      <td>19</td>
      <td>1.583333</td>
      <td>510</td>
      <td>42.500000</td>
      <td>806</td>
      <td>36.636364</td>
      <td>22</td>
      <td>181926.222</td>
      <td>8269.373727</td>
      <td>182</td>
      <td>8.272727</td>
      <td>22</td>
      <td>1.000000</td>
      <td>23</td>
      <td>1.045455</td>
      <td>30</td>
      <td>1.363636</td>
      <td>724</td>
      <td>32.909091</td>
      <td>1418</td>
      <td>21.164179</td>
      <td>67</td>
      <td>406302.004</td>
      <td>6064.209015</td>
      <td>318</td>
      <td>4.746269</td>
      <td>56</td>
      <td>0.835821</td>
      <td>39</td>
      <td>0.582090</td>
      <td>60</td>
      <td>0.895522</td>
      <td>1548</td>
      <td>23.104478</td>
      <td>2369</td>
      <td>16.451389</td>
      <td>144</td>
      <td>734855.804</td>
      <td>5103.165306</td>
      <td>468</td>
      <td>3.250000</td>
      <td>94</td>
      <td>0.652778</td>
      <td>63</td>
      <td>0.437500</td>
      <td>80</td>
      <td>0.555556</td>
      <td>2760</td>
      <td>19.166667</td>
      <td>5487</td>
      <td>19.052083</td>
      <td>288</td>
      <td>1727199.616</td>
      <td>5997.220889</td>
      <td>1096</td>
      <td>3.805556</td>
      <td>199</td>
      <td>0.690972</td>
      <td>157</td>
      <td>0.545139</td>
      <td>188</td>
      <td>0.652778</td>
      <td>6452</td>
      <td>22.402778</td>
      <td>5930</td>
      <td>17.390029</td>
      <td>341</td>
      <td>1887033.172</td>
      <td>5533.821619</td>
      <td>1299</td>
      <td>3.809384</td>
      <td>228</td>
      <td>0.668622</td>
      <td>190</td>
      <td>0.557185</td>
      <td>221</td>
      <td>0.648094</td>
      <td>6986</td>
      <td>20.486804</td>
      <td>540</td>
      <td>2682</td>
      <td>4.966667</td>
      <td>0</td>
      <td>0.0</td>
      <td>40</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>0</td>
      <td>4.966667</td>
      <td>2017</td>
      <td>2</td>
      <td>28</td>
      <td>6268</td>
      <td>2015</td>
      <td>9</td>
      <td>16</td>
      <td>5737</td>
      <td>0</td>
      <td>1</td>
      <td>2017</td>
      <td>2</td>
      <td>27</td>
      <td>6267</td>
      <td>2017</td>
      <td>3</td>
      <td>26</td>
      <td>6294</td>
      <td>-27</td>
      <td>-1</td>
      <td>-26</td>
      <td>2015</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="c1">#Split data / labels</span>
<span class="n">train_labels</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;is_churn&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dev_labels</span> <span class="o">=</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span>
<span class="n">dev_data</span> <span class="o">=</span> <span class="n">dev</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;is_churn&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">test_labels</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;is_churn&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Validation</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Check data sizes:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Train data / test: &#39;</span><span class="p">,</span> <span class="n">train_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">train_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Dev data / test: &#39;</span><span class="p">,</span> <span class="n">dev_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dev_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; Test data / test: &#39;</span><span class="p">,</span> <span class="n">test_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">test_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1">#Baseline (if we guess all 0&#39;s, this is what we get)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Baseline Accuracy (dev): </span><span class="si">{:.2%}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">dev</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">())))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Baseline Accuracy (test): </span><span class="si">{:.2%}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;is_churn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">())))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">Check</span> <span class="k">data</span> <span class="n">sizes</span><span class="p">:</span>
<span class="n">Train</span> <span class="k">data</span> <span class="o">/</span> <span class="n">test</span><span class="p">:</span>  <span class="p">(</span><span class="mi">53126</span><span class="p">,</span> <span class="mi">159</span><span class="p">)</span> <span class="p">(</span><span class="mi">53126</span><span class="p">,)</span>
  <span class="n">Dev</span> <span class="k">data</span> <span class="o">/</span> <span class="n">test</span><span class="p">:</span>  <span class="p">(</span><span class="mi">11681</span><span class="p">,</span> <span class="mi">159</span><span class="p">)</span> <span class="p">(</span><span class="mi">11681</span><span class="p">,)</span>
 <span class="n">Test</span> <span class="k">data</span> <span class="o">/</span> <span class="n">test</span><span class="p">:</span>  <span class="p">(</span><span class="mi">7024</span><span class="p">,</span> <span class="mi">159</span><span class="p">)</span> <span class="p">(</span><span class="mi">7024</span><span class="p">,)</span>

<span class="n">Baseline</span> <span class="n">Accuracy</span> <span class="p">(</span><span class="n">dev</span><span class="p">):</span> <span class="mi">94</span><span class="p">.</span><span class="mi">05</span><span class="o">%</span>
<span class="n">Baseline</span> <span class="n">Accuracy</span> <span class="p">(</span><span class="n">test</span><span class="p">):</span> <span class="mi">94</span><span class="p">.</span><span class="mi">09</span><span class="o">%</span>
</pre></div>


<p>Of note, the overall data has a churn rate of roughly 6% (~6% of users churn, ~94% stay).  However, because we want our model to train well on both churned and non-churned users, this data set is split roughly 50/50 between churn and non-churn users.  So we use this 50/50 split to on our 'train' data set, but we reduce it back to 6/94 for both our 'dev' and 'test' data sets, by removing most of the churn cases after data is split into train, dev, and test.  In our initial models, we had not yet peformed the 50/50 spilt of the training data, and our best recall score (of the dev data) was 78%.  Upon making this change to 50/50, our recall score of our best models improved dramattically, to 96%!</p>
<p>Having split our data, we perform some quick inspections:</p>
<div class="highlight"><pre><span></span><span class="n">dev_data</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;</span>
<span class="c">Index: 11681 entries, x5+AtzOZKAtnAJBsCIdAyiRl+1p9nIvAYchIkS4zaS4= to IDkK5VQYefRBzy2GAJgs2ChDorWoKcIBPrnBQGOimbA=</span>
<span class="c">Columns: 159 entries, city to registration_time</span>
<span class="c">dtypes: float64(61), int64(96), uint8(2)</span>
<span class="err">memory usage: 14.1+ MB</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">dev_data</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">city                                 0</span>
<span class="err">bd                                   0</span>
<span class="err">registered_via                       0</span>
<span class="err">registration_init_time               0</span>
<span class="err">date_featuresdatelistening_tenure    0</span>
<span class="err">within_days_1num_unqsum              0</span>
<span class="err">within_days_1num_unqmean             0</span>
<span class="err">within_days_1num_unqcount            0</span>
<span class="err">within_days_1total_secssum           0</span>
<span class="err">within_days_1total_secsmean          0</span>
<span class="err">within_days_1num_25sum               0</span>
<span class="err">within_days_1num_25mean              0</span>
<span class="err">within_days_1num_50sum               0</span>
<span class="err">within_days_1num_50mean              0</span>
<span class="err">within_days_1num_75sum               0</span>
<span class="err">within_days_1num_75mean              0</span>
<span class="err">within_days_1num_985sum              0</span>
<span class="err">within_days_1num_985mean             0</span>
<span class="err">within_days_1num_100sum              0</span>
<span class="err">within_days_1num_100mean             0</span>
<span class="err">within_days_7num_unqsum              0</span>
<span class="err">within_days_7num_unqmean             0</span>
<span class="err">within_days_7num_unqcount            0</span>
<span class="err">within_days_7total_secssum           0</span>
<span class="err">within_days_7total_secsmean          0</span>
<span class="err">within_days_7num_25sum               0</span>
<span class="err">within_days_7num_25mean              0</span>
<span class="err">within_days_7num_50sum               0</span>
<span class="err">within_days_7num_50mean              0</span>
<span class="err">within_days_7num_75sum               0</span>
<span class="err">within_days_7num_75mean              0</span>
<span class="err">within_days_7num_985sum              0</span>
<span class="err">within_days_7num_985mean             0</span>
<span class="err">within_days_7num_100sum              0</span>
<span class="err">within_days_7num_100mean             0</span>
<span class="err">within_days_14num_unqsum             0</span>
<span class="err">within_days_14num_unqmean            0</span>
<span class="err">within_days_14num_unqcount           0</span>
<span class="err">within_days_14total_secssum          0</span>
<span class="err">within_days_14total_secsmean         0</span>
<span class="err">within_days_14num_25sum              0</span>
<span class="err">within_days_14num_25mean             0</span>
<span class="err">within_days_14num_50sum              0</span>
<span class="err">within_days_14num_50mean             0</span>
<span class="err">within_days_14num_75sum              0</span>
<span class="err">within_days_14num_75mean             0</span>
<span class="err">within_days_14num_985sum             0</span>
<span class="err">within_days_14num_985mean            0</span>
<span class="err">within_days_14num_100sum             0</span>
<span class="err">within_days_14num_100mean            0</span>
<span class="err">within_days_31num_unqsum             0</span>
<span class="err">within_days_31num_unqmean            0</span>
<span class="err">within_days_31num_unqcount           0</span>
<span class="err">within_days_31total_secssum          0</span>
<span class="err">within_days_31total_secsmean         0</span>
<span class="err">within_days_31num_25sum              0</span>
<span class="err">within_days_31num_25mean             0</span>
<span class="err">within_days_31num_50sum              0</span>
<span class="err">within_days_31num_50mean             0</span>
<span class="err">within_days_31num_75sum              0</span>
<span class="err">within_days_31num_75mean             0</span>
<span class="err">within_days_31num_985sum             0</span>
<span class="err">within_days_31num_985mean            0</span>
<span class="err">within_days_31num_100sum             0</span>
<span class="err">within_days_31num_100mean            0</span>
<span class="err">within_days_90num_unqsum             0</span>
<span class="err">within_days_90num_unqmean            0</span>
<span class="err">within_days_90num_unqcount           0</span>
<span class="err">within_days_90total_secssum          0</span>
<span class="err">within_days_90total_secsmean         0</span>
<span class="err">within_days_90num_25sum              0</span>
<span class="err">within_days_90num_25mean             0</span>
<span class="err">within_days_90num_50sum              0</span>
<span class="err">within_days_90num_50mean             0</span>
<span class="err">within_days_90num_75sum              0</span>
<span class="err">within_days_90num_75mean             0</span>
<span class="err">within_days_90num_985sum             0</span>
<span class="err">within_days_90num_985mean            0</span>
<span class="err">within_days_90num_100sum             0</span>
<span class="err">within_days_90num_100mean            0</span>
<span class="err">within_days_180num_unqsum            0</span>
<span class="err">within_days_180num_unqmean           0</span>
<span class="err">within_days_180num_unqcount          0</span>
<span class="err">within_days_180total_secssum         0</span>
<span class="err">within_days_180total_secsmean        0</span>
<span class="err">within_days_180num_25sum             0</span>
<span class="err">within_days_180num_25mean            0</span>
<span class="err">within_days_180num_50sum             0</span>
<span class="err">within_days_180num_50mean            0</span>
<span class="err">within_days_180num_75sum             0</span>
<span class="err">within_days_180num_75mean            0</span>
<span class="err">within_days_180num_985sum            0</span>
<span class="err">within_days_180num_985mean           0</span>
<span class="err">within_days_180num_100sum            0</span>
<span class="err">within_days_180num_100mean           0</span>
<span class="err">within_days_365num_unqsum            0</span>
<span class="err">within_days_365num_unqmean           0</span>
<span class="err">within_days_365num_unqcount          0</span>
<span class="err">within_days_365total_secssum         0</span>
<span class="err">within_days_365total_secsmean        0</span>
<span class="err">within_days_365num_25sum             0</span>
<span class="err">within_days_365num_25mean            0</span>
<span class="err">within_days_365num_50sum             0</span>
<span class="err">within_days_365num_50mean            0</span>
<span class="err">within_days_365num_75sum             0</span>
<span class="err">within_days_365num_75mean            0</span>
<span class="err">within_days_365num_985sum            0</span>
<span class="err">within_days_365num_985mean           0</span>
<span class="err">within_days_365num_100sum            0</span>
<span class="err">within_days_365num_100mean           0</span>
<span class="err">within_days_9999num_unqsum           0</span>
<span class="err">within_days_9999num_unqmean          0</span>
<span class="err">within_days_9999num_unqcount         0</span>
<span class="err">within_days_9999total_secssum        0</span>
<span class="err">within_days_9999total_secsmean       0</span>
<span class="err">within_days_9999num_25sum            0</span>
<span class="err">within_days_9999num_25mean           0</span>
<span class="err">within_days_9999num_50sum            0</span>
<span class="err">within_days_9999num_50mean           0</span>
<span class="err">within_days_9999num_75sum            0</span>
<span class="err">within_days_9999num_75mean           0</span>
<span class="err">within_days_9999num_985sum           0</span>
<span class="err">within_days_9999num_985mean          0</span>
<span class="err">within_days_9999num_100sum           0</span>
<span class="err">within_days_9999num_100mean          0</span>
<span class="err">total_plan_days                      0</span>
<span class="err">total_amount_paid                    0</span>
<span class="err">amount_paid_per_day                  0</span>
<span class="err">diff_renewal_duration                0</span>
<span class="err">diff_plan_amount_paid_per_day        0</span>
<span class="err">latest_payment_method_id             0</span>
<span class="err">latest_plan_days                     0</span>
<span class="err">latest_plan_list_price               0</span>
<span class="err">latest_amount_paid                   0</span>
<span class="err">latest_auto_renew                    0</span>
<span class="err">latest_is_cancel                     0</span>
<span class="err">latest_amount_paid_per_day           0</span>
<span class="err">date_featuresdatemax_date_year       0</span>
<span class="err">date_featuresdatemax_date_month      0</span>
<span class="err">date_featuresdatemax_date_day        0</span>
<span class="err">date_featuresdatemax_date_absday     0</span>
<span class="err">date_featuresdatemin_date_year       0</span>
<span class="err">date_featuresdatemin_date_month      0</span>
<span class="err">date_featuresdatemin_date_day        0</span>
<span class="err">date_featuresdatemin_date_absday     0</span>
<span class="err">female                               0</span>
<span class="err">male                                 0</span>
<span class="err">latest_transaction_date_year         0</span>
<span class="err">latest_transaction_date_month        0</span>
<span class="err">latest_transaction_date_day          0</span>
<span class="err">latest_transaction_date_absday       0</span>
<span class="err">latest_expire_date_year              0</span>
<span class="err">latest_expire_date_month             0</span>
<span class="err">latest_expire_date_day               0</span>
<span class="err">latest_expire_date_absday            0</span>
<span class="err">latest_trans_vs_expire               0</span>
<span class="err">latest_trans_vs_log                  0</span>
<span class="err">latest_log_vs_expire                 0</span>
<span class="err">registration_time                    0</span>
<span class="c">dtype: int64</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">dev_data</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>city</th>
      <th>bd</th>
      <th>registered_via</th>
      <th>registration_init_time</th>
      <th>date_featuresdatelistening_tenure</th>
      <th>within_days_1num_unqsum</th>
      <th>within_days_1num_unqmean</th>
      <th>within_days_1num_unqcount</th>
      <th>within_days_1total_secssum</th>
      <th>within_days_1total_secsmean</th>
      <th>within_days_1num_25sum</th>
      <th>within_days_1num_25mean</th>
      <th>within_days_1num_50sum</th>
      <th>within_days_1num_50mean</th>
      <th>within_days_1num_75sum</th>
      <th>within_days_1num_75mean</th>
      <th>within_days_1num_985sum</th>
      <th>within_days_1num_985mean</th>
      <th>within_days_1num_100sum</th>
      <th>within_days_1num_100mean</th>
      <th>within_days_7num_unqsum</th>
      <th>within_days_7num_unqmean</th>
      <th>within_days_7num_unqcount</th>
      <th>within_days_7total_secssum</th>
      <th>within_days_7total_secsmean</th>
      <th>within_days_7num_25sum</th>
      <th>within_days_7num_25mean</th>
      <th>within_days_7num_50sum</th>
      <th>within_days_7num_50mean</th>
      <th>within_days_7num_75sum</th>
      <th>within_days_7num_75mean</th>
      <th>within_days_7num_985sum</th>
      <th>within_days_7num_985mean</th>
      <th>within_days_7num_100sum</th>
      <th>within_days_7num_100mean</th>
      <th>within_days_14num_unqsum</th>
      <th>within_days_14num_unqmean</th>
      <th>within_days_14num_unqcount</th>
      <th>within_days_14total_secssum</th>
      <th>within_days_14total_secsmean</th>
      <th>within_days_14num_25sum</th>
      <th>within_days_14num_25mean</th>
      <th>within_days_14num_50sum</th>
      <th>within_days_14num_50mean</th>
      <th>within_days_14num_75sum</th>
      <th>within_days_14num_75mean</th>
      <th>within_days_14num_985sum</th>
      <th>within_days_14num_985mean</th>
      <th>within_days_14num_100sum</th>
      <th>within_days_14num_100mean</th>
      <th>within_days_31num_unqsum</th>
      <th>within_days_31num_unqmean</th>
      <th>within_days_31num_unqcount</th>
      <th>within_days_31total_secssum</th>
      <th>within_days_31total_secsmean</th>
      <th>within_days_31num_25sum</th>
      <th>within_days_31num_25mean</th>
      <th>within_days_31num_50sum</th>
      <th>within_days_31num_50mean</th>
      <th>within_days_31num_75sum</th>
      <th>within_days_31num_75mean</th>
      <th>within_days_31num_985sum</th>
      <th>within_days_31num_985mean</th>
      <th>within_days_31num_100sum</th>
      <th>within_days_31num_100mean</th>
      <th>within_days_90num_unqsum</th>
      <th>within_days_90num_unqmean</th>
      <th>within_days_90num_unqcount</th>
      <th>within_days_90total_secssum</th>
      <th>within_days_90total_secsmean</th>
      <th>within_days_90num_25sum</th>
      <th>within_days_90num_25mean</th>
      <th>within_days_90num_50sum</th>
      <th>within_days_90num_50mean</th>
      <th>within_days_90num_75sum</th>
      <th>within_days_90num_75mean</th>
      <th>within_days_90num_985sum</th>
      <th>within_days_90num_985mean</th>
      <th>within_days_90num_100sum</th>
      <th>within_days_90num_100mean</th>
      <th>within_days_180num_unqsum</th>
      <th>within_days_180num_unqmean</th>
      <th>within_days_180num_unqcount</th>
      <th>within_days_180total_secssum</th>
      <th>within_days_180total_secsmean</th>
      <th>within_days_180num_25sum</th>
      <th>within_days_180num_25mean</th>
      <th>within_days_180num_50sum</th>
      <th>within_days_180num_50mean</th>
      <th>within_days_180num_75sum</th>
      <th>within_days_180num_75mean</th>
      <th>within_days_180num_985sum</th>
      <th>within_days_180num_985mean</th>
      <th>within_days_180num_100sum</th>
      <th>within_days_180num_100mean</th>
      <th>within_days_365num_unqsum</th>
      <th>within_days_365num_unqmean</th>
      <th>within_days_365num_unqcount</th>
      <th>within_days_365total_secssum</th>
      <th>within_days_365total_secsmean</th>
      <th>within_days_365num_25sum</th>
      <th>within_days_365num_25mean</th>
      <th>within_days_365num_50sum</th>
      <th>within_days_365num_50mean</th>
      <th>within_days_365num_75sum</th>
      <th>within_days_365num_75mean</th>
      <th>within_days_365num_985sum</th>
      <th>within_days_365num_985mean</th>
      <th>within_days_365num_100sum</th>
      <th>within_days_365num_100mean</th>
      <th>within_days_9999num_unqsum</th>
      <th>within_days_9999num_unqmean</th>
      <th>within_days_9999num_unqcount</th>
      <th>within_days_9999total_secssum</th>
      <th>within_days_9999total_secsmean</th>
      <th>within_days_9999num_25sum</th>
      <th>within_days_9999num_25mean</th>
      <th>within_days_9999num_50sum</th>
      <th>within_days_9999num_50mean</th>
      <th>within_days_9999num_75sum</th>
      <th>within_days_9999num_75mean</th>
      <th>within_days_9999num_985sum</th>
      <th>within_days_9999num_985mean</th>
      <th>within_days_9999num_100sum</th>
      <th>within_days_9999num_100mean</th>
      <th>total_plan_days</th>
      <th>total_amount_paid</th>
      <th>amount_paid_per_day</th>
      <th>diff_renewal_duration</th>
      <th>diff_plan_amount_paid_per_day</th>
      <th>latest_payment_method_id</th>
      <th>latest_plan_days</th>
      <th>latest_plan_list_price</th>
      <th>latest_amount_paid</th>
      <th>latest_auto_renew</th>
      <th>latest_is_cancel</th>
      <th>latest_amount_paid_per_day</th>
      <th>date_featuresdatemax_date_year</th>
      <th>date_featuresdatemax_date_month</th>
      <th>date_featuresdatemax_date_day</th>
      <th>date_featuresdatemax_date_absday</th>
      <th>date_featuresdatemin_date_year</th>
      <th>date_featuresdatemin_date_month</th>
      <th>date_featuresdatemin_date_day</th>
      <th>date_featuresdatemin_date_absday</th>
      <th>female</th>
      <th>male</th>
      <th>latest_transaction_date_year</th>
      <th>latest_transaction_date_month</th>
      <th>latest_transaction_date_day</th>
      <th>latest_transaction_date_absday</th>
      <th>latest_expire_date_year</th>
      <th>latest_expire_date_month</th>
      <th>latest_expire_date_day</th>
      <th>latest_expire_date_absday</th>
      <th>latest_trans_vs_expire</th>
      <th>latest_trans_vs_log</th>
      <th>latest_log_vs_expire</th>
      <th>registration_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>1.168100e+04</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.0</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.00000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>1.168100e+04</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>1.168100e+04</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>1.168100e+04</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>1.168100e+04</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>1.168100e+04</td>
      <td>1.168100e+04</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>1.168100e+04</td>
      <td>1.168100e+04</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
      <td>11681.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>5.826727</td>
      <td>13.443712</td>
      <td>6.935536</td>
      <td>2.013228e+07</td>
      <td>514.284479</td>
      <td>22.295009</td>
      <td>22.295009</td>
      <td>1.0</td>
      <td>5841.428795</td>
      <td>5841.428795</td>
      <td>5.029535</td>
      <td>5.029535</td>
      <td>1.189967</td>
      <td>1.189967</td>
      <td>0.743258</td>
      <td>0.743258</td>
      <td>0.839055</td>
      <td>0.839055</td>
      <td>22.308963</td>
      <td>22.308963</td>
      <td>111.650372</td>
      <td>22.691406</td>
      <td>4.167109</td>
      <td>30503.988013</td>
      <td>5985.177092</td>
      <td>23.840938</td>
      <td>5.122138</td>
      <td>5.884342</td>
      <td>1.257663</td>
      <td>3.699854</td>
      <td>0.775567</td>
      <td>4.381988</td>
      <td>0.882703</td>
      <td>116.822104</td>
      <td>22.752969</td>
      <td>211.99221</td>
      <td>22.719871</td>
      <td>7.785720</td>
      <td>5.828727e+04</td>
      <td>6014.422805</td>
      <td>45.381132</td>
      <td>5.193618</td>
      <td>11.183289</td>
      <td>1.276905</td>
      <td>7.068487</td>
      <td>0.781544</td>
      <td>8.186114</td>
      <td>0.874601</td>
      <td>223.294067</td>
      <td>22.854394</td>
      <td>452.812602</td>
      <td>23.127815</td>
      <td>16.307337</td>
      <td>1.236928e+05</td>
      <td>6085.946547</td>
      <td>97.905830</td>
      <td>5.332152</td>
      <td>24.019262</td>
      <td>1.308603</td>
      <td>15.254601</td>
      <td>0.806773</td>
      <td>17.757298</td>
      <td>0.900429</td>
      <td>473.865679</td>
      <td>23.104524</td>
      <td>1318.713552</td>
      <td>23.924663</td>
      <td>46.052050</td>
      <td>3.594315e+05</td>
      <td>6305.510455</td>
      <td>291.725880</td>
      <td>5.636081</td>
      <td>70.684017</td>
      <td>1.378342</td>
      <td>45.068659</td>
      <td>0.848118</td>
      <td>51.324972</td>
      <td>0.930059</td>
      <td>1373.024655</td>
      <td>23.880023</td>
      <td>2541.436093</td>
      <td>24.333497</td>
      <td>87.509545</td>
      <td>6.874662e+05</td>
      <td>6385.243171</td>
      <td>573.163428</td>
      <td>5.812711</td>
      <td>137.585053</td>
      <td>1.428488</td>
      <td>87.280284</td>
      <td>0.871057</td>
      <td>99.230717</td>
      <td>0.948863</td>
      <td>2611.563993</td>
      <td>24.068495</td>
      <td>4755.631624</td>
      <td>24.737577</td>
      <td>161.709357</td>
      <td>-3.948022e+12</td>
      <td>-1.532762e+10</td>
      <td>1078.856776</td>
      <td>5.960090</td>
      <td>258.348087</td>
      <td>1.471240</td>
      <td>162.010273</td>
      <td>0.885842</td>
      <td>183.662272</td>
      <td>0.956174</td>
      <td>4859.338670</td>
      <td>24.379361</td>
      <td>8451.857803</td>
      <td>25.175002</td>
      <td>279.380104</td>
      <td>-3.963815e+14</td>
      <td>-7.873946e+11</td>
      <td>1888.557315</td>
      <td>6.049168</td>
      <td>455.579402</td>
      <td>1.507384</td>
      <td>283.676826</td>
      <td>0.901029</td>
      <td>319.495163</td>
      <td>0.963754</td>
      <td>8641.108980</td>
      <td>24.792486</td>
      <td>485.222327</td>
      <td>2256.692492</td>
      <td>4.543509</td>
      <td>-0.072768</td>
      <td>0.012520</td>
      <td>38.756956</td>
      <td>35.180978</td>
      <td>152.782210</td>
      <td>152.550381</td>
      <td>0.874583</td>
      <td>0.027395</td>
      <td>4.379098</td>
      <td>2016.894444</td>
      <td>2.516480</td>
      <td>24.400822</td>
      <td>6241.423166</td>
      <td>2015.381217</td>
      <td>4.273264</td>
      <td>10.564506</td>
      <td>5727.138687</td>
      <td>0.211797</td>
      <td>0.235254</td>
      <td>2016.962503</td>
      <td>2.059755</td>
      <td>17.265902</td>
      <td>6245.262135</td>
      <td>2016.997089</td>
      <td>2.901293</td>
      <td>16.254944</td>
      <td>6280.439346</td>
      <td>-35.177211</td>
      <td>3.838969</td>
      <td>-39.016180</td>
      <td>2013.161031</td>
    </tr>
    <tr>
      <th>std</th>
      <td>6.345094</td>
      <td>18.346119</td>
      <td>1.899316</td>
      <td>2.984823e+04</td>
      <td>270.362724</td>
      <td>27.289473</td>
      <td>27.289473</td>
      <td>0.0</td>
      <td>8142.475535</td>
      <td>8142.475535</td>
      <td>12.678597</td>
      <td>12.678597</td>
      <td>2.871737</td>
      <td>2.871737</td>
      <td>1.536068</td>
      <td>1.536068</td>
      <td>2.135428</td>
      <td>2.135428</td>
      <td>33.871304</td>
      <td>33.871304</td>
      <td>136.367988</td>
      <td>21.627585</td>
      <td>2.148945</td>
      <td>43854.406776</td>
      <td>6856.053431</td>
      <td>44.162816</td>
      <td>9.053400</td>
      <td>10.632452</td>
      <td>2.175187</td>
      <td>5.571651</td>
      <td>1.087507</td>
      <td>14.222665</td>
      <td>2.166218</td>
      <td>184.086949</td>
      <td>28.805492</td>
      <td>258.14289</td>
      <td>20.281673</td>
      <td>4.420964</td>
      <td>8.320901e+04</td>
      <td>6553.882438</td>
      <td>78.772433</td>
      <td>8.337512</td>
      <td>18.067398</td>
      <td>1.992995</td>
      <td>10.110025</td>
      <td>0.975385</td>
      <td>22.794720</td>
      <td>1.916294</td>
      <td>347.684326</td>
      <td>27.606710</td>
      <td>535.120295</td>
      <td>18.870724</td>
      <td>9.586211</td>
      <td>1.718042e+05</td>
      <td>6076.212087</td>
      <td>157.448568</td>
      <td>7.413234</td>
      <td>34.991492</td>
      <td>1.694762</td>
      <td>20.295165</td>
      <td>0.858649</td>
      <td>44.748413</td>
      <td>1.836051</td>
      <td>723.190582</td>
      <td>25.730783</td>
      <td>1517.857170</td>
      <td>18.160695</td>
      <td>27.728096</td>
      <td>4.829295e+05</td>
      <td>5968.782229</td>
      <td>530.007545</td>
      <td>7.367072</td>
      <td>96.768111</td>
      <td>1.495532</td>
      <td>58.757332</td>
      <td>0.825757</td>
      <td>103.773302</td>
      <td>1.558319</td>
      <td>2005.149579</td>
      <td>25.270982</td>
      <td>2919.897164</td>
      <td>17.656294</td>
      <td>54.891995</td>
      <td>9.095613e+05</td>
      <td>5808.165290</td>
      <td>1734.932914</td>
      <td>10.458405</td>
      <td>189.308082</td>
      <td>1.479933</td>
      <td>111.811107</td>
      <td>0.802158</td>
      <td>214.083712</td>
      <td>1.619215</td>
      <td>3713.410676</td>
      <td>24.500432</td>
      <td>5632.153118</td>
      <td>17.528812</td>
      <td>109.365613</td>
      <td>1.907921e+14</td>
      <td>7.496272e+11</td>
      <td>5003.389049</td>
      <td>14.538201</td>
      <td>373.301292</td>
      <td>1.474342</td>
      <td>212.337775</td>
      <td>0.765136</td>
      <td>346.952630</td>
      <td>1.211172</td>
      <td>6845.962816</td>
      <td>23.693800</td>
      <td>10989.815430</td>
      <td>17.273936</td>
      <td>222.393064</td>
      <td>4.817483e+15</td>
      <td>8.540636e+12</td>
      <td>8821.608529</td>
      <td>13.306385</td>
      <td>713.431408</td>
      <td>1.477271</td>
      <td>407.737201</td>
      <td>0.756774</td>
      <td>564.771146</td>
      <td>1.035766</td>
      <td>13023.760298</td>
      <td>23.003918</td>
      <td>230.848005</td>
      <td>1230.002058</td>
      <td>1.051432</td>
      <td>28.009957</td>
      <td>0.528422</td>
      <td>3.769322</td>
      <td>38.381381</td>
      <td>162.935104</td>
      <td>163.028018</td>
      <td>0.331206</td>
      <td>0.163238</td>
      <td>0.969957</td>
      <td>0.357509</td>
      <td>2.062157</td>
      <td>6.319689</td>
      <td>89.576130</td>
      <td>0.544543</td>
      <td>3.891219</td>
      <td>9.562939</td>
      <td>255.133800</td>
      <td>0.408599</td>
      <td>0.424176</td>
      <td>0.209692</td>
      <td>1.358014</td>
      <td>9.357640</td>
      <td>47.726121</td>
      <td>0.056964</td>
      <td>0.405357</td>
      <td>9.199672</td>
      <td>20.838048</td>
      <td>40.945475</td>
      <td>100.327736</td>
      <td>89.066643</td>
      <td>2.987074</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>3.000000</td>
      <td>2.004033e+07</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.0</td>
      <td>0.255000</td>
      <td>0.255000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.255000</td>
      <td>0.255000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.00000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>2.550000e-01</td>
      <td>0.255000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>7.620000e-01</td>
      <td>0.762000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>7.620000e-01</td>
      <td>0.762000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>7.620000e-01</td>
      <td>0.762000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>-9.223372e+15</td>
      <td>-4.521261e+13</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>-3.135946e+17</td>
      <td>-4.077954e+14</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>7.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-400.000000</td>
      <td>-6.000000</td>
      <td>10.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2015.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>5482.000000</td>
      <td>2015.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>5479.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2015.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>5729.000000</td>
      <td>2015.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>5791.000000</td>
      <td>-522.000000</td>
      <td>-538.000000</td>
      <td>-813.000000</td>
      <td>2004.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>7.000000</td>
      <td>2.012021e+07</td>
      <td>274.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>1.0</td>
      <td>1035.354000</td>
      <td>1035.354000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>3.000000</td>
      <td>3.000000</td>
      <td>22.000000</td>
      <td>8.666667</td>
      <td>2.000000</td>
      <td>5144.756000</td>
      <td>1989.096750</td>
      <td>3.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.200000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>18.000000</td>
      <td>6.800000</td>
      <td>43.00000</td>
      <td>10.000000</td>
      <td>4.000000</td>
      <td>1.006196e+04</td>
      <td>2297.794167</td>
      <td>6.000000</td>
      <td>1.333333</td>
      <td>1.000000</td>
      <td>0.333333</td>
      <td>1.000000</td>
      <td>0.200000</td>
      <td>1.000000</td>
      <td>0.200000</td>
      <td>35.000000</td>
      <td>8.000000</td>
      <td>100.000000</td>
      <td>11.307692</td>
      <td>8.000000</td>
      <td>2.419783e+04</td>
      <td>2669.606818</td>
      <td>16.000000</td>
      <td>1.727273</td>
      <td>4.000000</td>
      <td>0.458333</td>
      <td>3.000000</td>
      <td>0.300000</td>
      <td>3.000000</td>
      <td>0.307692</td>
      <td>85.000000</td>
      <td>9.333333</td>
      <td>309.000000</td>
      <td>12.625000</td>
      <td>21.000000</td>
      <td>7.378727e+04</td>
      <td>3015.113367</td>
      <td>53.000000</td>
      <td>2.117647</td>
      <td>14.000000</td>
      <td>0.571429</td>
      <td>9.000000</td>
      <td>0.387097</td>
      <td>9.000000</td>
      <td>0.392157</td>
      <td>258.000000</td>
      <td>10.553846</td>
      <td>578.000000</td>
      <td>13.242857</td>
      <td>38.000000</td>
      <td>1.407210e+05</td>
      <td>3138.226153</td>
      <td>106.000000</td>
      <td>2.295082</td>
      <td>28.000000</td>
      <td>0.619048</td>
      <td>19.000000</td>
      <td>0.422535</td>
      <td>19.000000</td>
      <td>0.425926</td>
      <td>499.000000</td>
      <td>11.021978</td>
      <td>1011.000000</td>
      <td>13.879630</td>
      <td>63.000000</td>
      <td>2.432913e+05</td>
      <td>3.271425e+03</td>
      <td>192.000000</td>
      <td>2.485714</td>
      <td>52.000000</td>
      <td>0.666667</td>
      <td>34.000000</td>
      <td>0.452128</td>
      <td>34.000000</td>
      <td>0.452586</td>
      <td>865.000000</td>
      <td>11.553398</td>
      <td>1440.000000</td>
      <td>14.409774</td>
      <td>82.000000</td>
      <td>2.978761e+05</td>
      <td>3.232108e+03</td>
      <td>283.000000</td>
      <td>2.615385</td>
      <td>77.000000</td>
      <td>0.707483</td>
      <td>49.000000</td>
      <td>0.473180</td>
      <td>49.000000</td>
      <td>0.470721</td>
      <td>1220.000000</td>
      <td>11.852590</td>
      <td>300.000000</td>
      <td>1192.000000</td>
      <td>3.300000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>38.000000</td>
      <td>30.000000</td>
      <td>99.000000</td>
      <td>99.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>3.300000</td>
      <td>2017.000000</td>
      <td>2.000000</td>
      <td>24.000000</td>
      <td>6262.000000</td>
      <td>2015.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>5480.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2017.000000</td>
      <td>2.000000</td>
      <td>9.000000</td>
      <td>6243.000000</td>
      <td>2017.000000</td>
      <td>3.000000</td>
      <td>8.000000</td>
      <td>6273.000000</td>
      <td>-31.000000</td>
      <td>-22.000000</td>
      <td>-29.000000</td>
      <td>2012.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>7.000000</td>
      <td>2.014052e+07</td>
      <td>554.000000</td>
      <td>13.000000</td>
      <td>13.000000</td>
      <td>1.0</td>
      <td>3004.783000</td>
      <td>3004.783000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>11.000000</td>
      <td>11.000000</td>
      <td>68.000000</td>
      <td>17.000000</td>
      <td>4.000000</td>
      <td>16648.129000</td>
      <td>4122.421714</td>
      <td>10.000000</td>
      <td>2.833333</td>
      <td>3.000000</td>
      <td>0.714286</td>
      <td>2.000000</td>
      <td>0.500000</td>
      <td>2.000000</td>
      <td>0.500000</td>
      <td>61.000000</td>
      <td>15.000000</td>
      <td>130.00000</td>
      <td>17.750000</td>
      <td>8.000000</td>
      <td>3.209375e+04</td>
      <td>4286.554286</td>
      <td>21.000000</td>
      <td>3.000000</td>
      <td>6.000000</td>
      <td>0.818182</td>
      <td>4.000000</td>
      <td>0.538462</td>
      <td>4.000000</td>
      <td>0.571429</td>
      <td>118.000000</td>
      <td>15.800000</td>
      <td>291.000000</td>
      <td>18.705882</td>
      <td>17.000000</td>
      <td>7.235517e+04</td>
      <td>4544.279786</td>
      <td>49.000000</td>
      <td>3.500000</td>
      <td>13.000000</td>
      <td>0.916667</td>
      <td>9.000000</td>
      <td>0.611111</td>
      <td>9.000000</td>
      <td>0.625000</td>
      <td>264.000000</td>
      <td>16.800000</td>
      <td>868.000000</td>
      <td>19.787234</td>
      <td>47.000000</td>
      <td>2.160170e+05</td>
      <td>4801.588723</td>
      <td>156.000000</td>
      <td>3.873239</td>
      <td>41.000000</td>
      <td>1.000000</td>
      <td>27.000000</td>
      <td>0.666667</td>
      <td>28.000000</td>
      <td>0.683333</td>
      <td>793.000000</td>
      <td>17.769231</td>
      <td>1667.000000</td>
      <td>20.263158</td>
      <td>87.000000</td>
      <td>4.120246e+05</td>
      <td>4944.808905</td>
      <td>301.000000</td>
      <td>4.098765</td>
      <td>81.000000</td>
      <td>1.042553</td>
      <td>53.000000</td>
      <td>0.689189</td>
      <td>55.000000</td>
      <td>0.710227</td>
      <td>1513.000000</td>
      <td>18.123967</td>
      <td>3051.000000</td>
      <td>20.703180</td>
      <td>153.000000</td>
      <td>7.594609e+05</td>
      <td>5.081905e+03</td>
      <td>560.000000</td>
      <td>4.229050</td>
      <td>152.000000</td>
      <td>1.100000</td>
      <td>99.000000</td>
      <td>0.713178</td>
      <td>101.000000</td>
      <td>0.733813</td>
      <td>2786.000000</td>
      <td>18.671875</td>
      <td>4851.000000</td>
      <td>21.420779</td>
      <td>228.000000</td>
      <td>1.129275e+06</td>
      <td>5.141641e+03</td>
      <td>894.000000</td>
      <td>4.393484</td>
      <td>246.000000</td>
      <td>1.145631</td>
      <td>157.000000</td>
      <td>0.737609</td>
      <td>162.000000</td>
      <td>0.749035</td>
      <td>4455.000000</td>
      <td>19.231343</td>
      <td>480.000000</td>
      <td>2117.000000</td>
      <td>4.850000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>41.000000</td>
      <td>30.000000</td>
      <td>149.000000</td>
      <td>149.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>4.966667</td>
      <td>2017.000000</td>
      <td>2.000000</td>
      <td>27.000000</td>
      <td>6267.000000</td>
      <td>2015.000000</td>
      <td>2.000000</td>
      <td>7.000000</td>
      <td>5684.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2017.000000</td>
      <td>2.000000</td>
      <td>18.000000</td>
      <td>6253.000000</td>
      <td>2017.000000</td>
      <td>3.000000</td>
      <td>16.000000</td>
      <td>6283.000000</td>
      <td>-28.000000</td>
      <td>-10.000000</td>
      <td>-19.000000</td>
      <td>2014.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>13.000000</td>
      <td>27.000000</td>
      <td>9.000000</td>
      <td>2.016011e+07</td>
      <td>786.000000</td>
      <td>29.000000</td>
      <td>29.000000</td>
      <td>1.0</td>
      <td>7237.710000</td>
      <td>7237.710000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>27.000000</td>
      <td>27.000000</td>
      <td>150.000000</td>
      <td>29.714286</td>
      <td>6.000000</td>
      <td>38096.915000</td>
      <td>7444.710333</td>
      <td>28.000000</td>
      <td>6.000000</td>
      <td>7.000000</td>
      <td>1.500000</td>
      <td>5.000000</td>
      <td>1.000000</td>
      <td>5.000000</td>
      <td>1.000000</td>
      <td>142.000000</td>
      <td>28.000000</td>
      <td>283.00000</td>
      <td>29.142857</td>
      <td>12.000000</td>
      <td>7.219161e+04</td>
      <td>7302.134333</td>
      <td>55.000000</td>
      <td>6.214286</td>
      <td>14.000000</td>
      <td>1.555556</td>
      <td>9.000000</td>
      <td>1.000000</td>
      <td>10.000000</td>
      <td>1.076923</td>
      <td>269.000000</td>
      <td>27.750000</td>
      <td>604.000000</td>
      <td>29.310345</td>
      <td>25.000000</td>
      <td>1.554336e+05</td>
      <td>7393.735423</td>
      <td>120.000000</td>
      <td>6.538462</td>
      <td>30.000000</td>
      <td>1.625000</td>
      <td>20.000000</td>
      <td>1.033333</td>
      <td>21.000000</td>
      <td>1.111111</td>
      <td>579.000000</td>
      <td>27.950000</td>
      <td>1795.000000</td>
      <td>29.746835</td>
      <td>71.000000</td>
      <td>4.604427e+05</td>
      <td>7549.245559</td>
      <td>359.000000</td>
      <td>6.902439</td>
      <td>92.000000</td>
      <td>1.702703</td>
      <td>59.000000</td>
      <td>1.059524</td>
      <td>64.000000</td>
      <td>1.129870</td>
      <td>1717.000000</td>
      <td>28.437500</td>
      <td>3468.000000</td>
      <td>30.159722</td>
      <td>136.000000</td>
      <td>8.872624e+05</td>
      <td>7643.410298</td>
      <td>708.000000</td>
      <td>7.084507</td>
      <td>180.000000</td>
      <td>1.763514</td>
      <td>116.000000</td>
      <td>1.080882</td>
      <td>122.000000</td>
      <td>1.152000</td>
      <td>3306.000000</td>
      <td>28.680556</td>
      <td>6457.000000</td>
      <td>30.614493</td>
      <td>255.000000</td>
      <td>1.655791e+06</td>
      <td>7.835299e+03</td>
      <td>1332.000000</td>
      <td>7.212766</td>
      <td>337.000000</td>
      <td>1.812500</td>
      <td>215.000000</td>
      <td>1.104046</td>
      <td>229.000000</td>
      <td>1.161616</td>
      <td>6188.000000</td>
      <td>29.495098</td>
      <td>11311.000000</td>
      <td>31.182957</td>
      <td>446.000000</td>
      <td>2.804311e+06</td>
      <td>7.882326e+03</td>
      <td>2293.000000</td>
      <td>7.281139</td>
      <td>591.000000</td>
      <td>1.862069</td>
      <td>375.000000</td>
      <td>1.121495</td>
      <td>399.000000</td>
      <td>1.175532</td>
      <td>10945.000000</td>
      <td>29.963964</td>
      <td>720.000000</td>
      <td>3354.000000</td>
      <td>5.165333</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>41.000000</td>
      <td>30.000000</td>
      <td>149.000000</td>
      <td>149.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>4.966667</td>
      <td>2017.000000</td>
      <td>2.000000</td>
      <td>28.000000</td>
      <td>6268.000000</td>
      <td>2016.000000</td>
      <td>8.000000</td>
      <td>18.000000</td>
      <td>5936.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2017.000000</td>
      <td>2.000000</td>
      <td>26.000000</td>
      <td>6262.000000</td>
      <td>2017.000000</td>
      <td>3.000000</td>
      <td>24.000000</td>
      <td>6291.000000</td>
      <td>-28.000000</td>
      <td>0.000000</td>
      <td>-8.000000</td>
      <td>2016.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>22.000000</td>
      <td>942.000000</td>
      <td>13.000000</td>
      <td>2.017022e+07</td>
      <td>789.000000</td>
      <td>530.000000</td>
      <td>530.000000</td>
      <td>1.0</td>
      <td>121364.969000</td>
      <td>121364.969000</td>
      <td>570.000000</td>
      <td>570.000000</td>
      <td>97.000000</td>
      <td>97.000000</td>
      <td>47.000000</td>
      <td>47.000000</td>
      <td>117.000000</td>
      <td>117.000000</td>
      <td>507.000000</td>
      <td>507.000000</td>
      <td>2101.000000</td>
      <td>322.500000</td>
      <td>7.000000</td>
      <td>604487.476000</td>
      <td>121364.969000</td>
      <td>2328.000000</td>
      <td>338.000000</td>
      <td>354.000000</td>
      <td>66.000000</td>
      <td>109.000000</td>
      <td>26.500000</td>
      <td>1207.000000</td>
      <td>172.428571</td>
      <td>3205.000000</td>
      <td>507.000000</td>
      <td>4287.00000</td>
      <td>322.500000</td>
      <td>14.000000</td>
      <td>1.188867e+06</td>
      <td>121364.969000</td>
      <td>3623.000000</td>
      <td>338.000000</td>
      <td>574.000000</td>
      <td>66.000000</td>
      <td>197.000000</td>
      <td>19.000000</td>
      <td>1877.000000</td>
      <td>156.416667</td>
      <td>5765.000000</td>
      <td>507.000000</td>
      <td>8345.000000</td>
      <td>322.500000</td>
      <td>31.000000</td>
      <td>2.418630e+06</td>
      <td>81498.962379</td>
      <td>7309.000000</td>
      <td>338.000000</td>
      <td>1131.000000</td>
      <td>66.000000</td>
      <td>403.000000</td>
      <td>15.454545</td>
      <td>3492.000000</td>
      <td>151.826087</td>
      <td>13493.000000</td>
      <td>449.766667</td>
      <td>23425.000000</td>
      <td>275.588235</td>
      <td>90.000000</td>
      <td>7.056073e+06</td>
      <td>102261.927435</td>
      <td>35029.000000</td>
      <td>393.584270</td>
      <td>3017.000000</td>
      <td>33.898876</td>
      <td>1207.000000</td>
      <td>21.785714</td>
      <td>6953.000000</td>
      <td>124.160714</td>
      <td>35188.000000</td>
      <td>443.492754</td>
      <td>29562.000000</td>
      <td>200.588235</td>
      <td>180.000000</td>
      <td>1.376347e+07</td>
      <td>87110.569297</td>
      <td>166936.000000</td>
      <td>932.603352</td>
      <td>8311.000000</td>
      <td>46.430168</td>
      <td>3287.000000</td>
      <td>18.363128</td>
      <td>14946.000000</td>
      <td>133.446429</td>
      <td>60842.000000</td>
      <td>426.651163</td>
      <td>77035.000000</td>
      <td>249.500000</td>
      <td>365.000000</td>
      <td>2.178917e+07</td>
      <td>7.669030e+04</td>
      <td>519451.000000</td>
      <td>1427.063187</td>
      <td>19246.000000</td>
      <td>52.873626</td>
      <td>8016.000000</td>
      <td>22.021978</td>
      <td>15637.000000</td>
      <td>65.701681</td>
      <td>96565.000000</td>
      <td>426.651163</td>
      <td>154375.000000</td>
      <td>212.053571</td>
      <td>789.000000</td>
      <td>1.424409e+09</td>
      <td>3.050126e+06</td>
      <td>911417.000000</td>
      <td>1298.314815</td>
      <td>37859.000000</td>
      <td>53.930199</td>
      <td>16436.000000</td>
      <td>23.413105</td>
      <td>17188.000000</td>
      <td>32.588378</td>
      <td>251662.000000</td>
      <td>360.992857</td>
      <td>1200.000000</td>
      <td>5669.000000</td>
      <td>13.450000</td>
      <td>420.000000</td>
      <td>6.000000</td>
      <td>41.000000</td>
      <td>450.000000</td>
      <td>1788.000000</td>
      <td>1788.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>6.000000</td>
      <td>2017.000000</td>
      <td>12.000000</td>
      <td>31.000000</td>
      <td>6268.000000</td>
      <td>2017.000000</td>
      <td>12.000000</td>
      <td>31.000000</td>
      <td>6268.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>2017.000000</td>
      <td>12.000000</td>
      <td>31.000000</td>
      <td>6268.000000</td>
      <td>2017.000000</td>
      <td>12.000000</td>
      <td>31.000000</td>
      <td>6299.000000</td>
      <td>46.000000</td>
      <td>782.000000</td>
      <td>353.000000</td>
      <td>2017.000000</td>
    </tr>
  </tbody>
</table>
</div>

<h1>3. Predictive Modeling!</h1>
<p>With our data in good shape, we move on to build predictive models.</p>
<p>We begin by building a couple functions to help automate the evaluation of our models:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_confusion_matrix</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span>
                          <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Confusion Matrix&#39;</span><span class="p">,</span>
                          <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function prints and plots the confusion matrix.</span>
<span class="sd">    Normalization can be applied by setting `normalize=True`.</span>

<span class="sd">    Source: http://scikit-learn.org/stable/auto_examples/model_selection/plot_confusion_matrix.html</span>

<span class="sd">    Documented here as it is in the source.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Normalized Confusion Matrix&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Confusion Matrix&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">tick_marks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">tick_marks</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">tick_marks</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;.1%&#39;</span> <span class="k">if</span> <span class="n">normalize</span> <span class="k">else</span> <span class="s1">&#39;d&#39;</span>
    <span class="n">thresh</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">range</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">fmt</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">thresh</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;True label&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted label&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">summarize_results</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dev_data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">dev_labels</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to automate the displaying modeling results.</span>

<span class="sd">    Args:</span>
<span class="sd">        classifier (a sklearn classifier):  The classifier to plot.</span>

<span class="sd">    Kwargs: </span>
<span class="sd">        data (dataframe):  The data on which to predict labels.  Defaults to dev_data.</span>
<span class="sd">        labels (dataframe):  The correct labels.  Defaults to dev_labels.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None, but prints and plots summary metrics.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#Print Results</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy: </span><span class="si">{:.2%}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">classifier</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>

    <span class="c1">#Plot Results</span>
    <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Compute confusion matrix</span>
    <span class="n">cnf_matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Plot non-normalized confusion matrix</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">cnf_matrix</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="n">class_names</span><span class="p">,</span>
                          <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Confusion Matrix&#39;</span><span class="p">)</span>

    <span class="c1"># Plot normalized confusion matrix</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">cnf_matrix</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="n">class_names</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Normalized Confusion Matrix&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<h3>Model Evaluation</h3>
<p>We're placing an emphasis on recall as our primary metric, moreso than accuracy. Our thinking here is that accuracy has a 'baseline' of 94% (predicting all 0's, i.e., no users churn), making our current best prediction of ~98% much less impressive. Moreover, we're okay with some false positives but would prefer to minimize false negatives. In other words, we'd rather predict a few customers as likely to churn when in fact they would actually stay (false positives) as opposed to predicting customers who would stay but who actually churn (false negatives). This assumption presumes that the long-term cost of keeping customers (for example, the cost of offering discounts) is less than the long-term loss associated with losing customers. Admittedly, more domain knowledge would be required to validate this assumption, but we consider that validation beyond the scope of the project.</p>
<p>In summary, though we calculate several evaluation metrics below, recall is our primary scoring metric, so long as we have a reasonably low False Positive rate.</p>
<h3>Poorly Performing Classifiers</h3>
<p>We initially tried a few different models:</p>
<ul>
<li>Gaussian Naive Bayes</li>
<li>K-Nearest Neighbors</li>
<li>Support Vector Machines</li>
</ul>
<p>None of these had promising results, as shown in the output of the cell below.</p>
<p>Note, though not shown here, the team explored several tuning options with these classifiers, but none of them performed as well as the classifiers further down.</p>
<div class="highlight"><pre><span></span><span class="c1">### NB Attempt ###</span>
<span class="n">clf_NB_Gauss</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">()</span>
<span class="n">clf_NB_Gauss</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NAIVE BAYES CLASSIFIER&#39;</span><span class="p">)</span>
<span class="n">summarize_results</span><span class="p">(</span><span class="n">clf_NB_Gauss</span><span class="p">)</span>

<span class="c1">### KNN Attempt ###</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;KNN CLASSIFIER&#39;</span><span class="p">)</span>
<span class="n">clf_neigh</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>  <span class="c1">#Accuracy plateaus around n=10, all 0&#39;s</span>
<span class="n">clf_neigh</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
<span class="n">summarize_results</span><span class="p">(</span><span class="n">clf_neigh</span><span class="p">)</span>

<span class="c1">#### SVM Attempts ###</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SVM CLASSIFIER&#39;</span><span class="p">)</span>
<span class="n">clf_SVM</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">SVC</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">640</span><span class="p">,</span> <span class="n">probability</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1">#max_iter=635 gives 6% accuracy ... need new approach / tuning</span>
<span class="n">clf_SVM</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
<span class="n">summarize_results</span><span class="p">(</span><span class="n">clf_SVM</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">NAIVE</span> <span class="n">BAYES</span> <span class="n">CLASSIFIER</span>
<span class="n">Accuracy</span><span class="p">:</span> <span class="mi">93</span><span class="p">.</span><span class="mi">97</span><span class="o">%</span>
             <span class="k">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>

          <span class="mi">0</span>       <span class="mi">0</span><span class="p">.</span><span class="mi">94</span>      <span class="mi">1</span><span class="p">.</span><span class="mi">00</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">97</span>     <span class="mi">10986</span>
          <span class="mi">1</span>       <span class="mi">0</span><span class="p">.</span><span class="mi">09</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">00</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">00</span>       <span class="mi">695</span>

<span class="k">avg</span> <span class="o">/</span> <span class="n">total</span>       <span class="mi">0</span><span class="p">.</span><span class="mi">89</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">94</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">91</span>     <span class="mi">11681</span>

<span class="n">Confusion</span> <span class="n">Matrix</span>
<span class="p">[[</span><span class="mi">10976</span>    <span class="mi">10</span><span class="p">]</span>
 <span class="p">[</span>  <span class="mi">694</span>     <span class="mi">1</span><span class="p">]]</span>
<span class="n">Normalized</span> <span class="n">Confusion</span> <span class="n">Matrix</span>
<span class="p">[[</span><span class="mi">9</span><span class="p">.</span><span class="mi">99</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span> <span class="mi">9</span><span class="p">.</span><span class="mi">10</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">9</span><span class="p">.</span><span class="mi">99</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span> <span class="mi">1</span><span class="p">.</span><span class="mi">44</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span><span class="p">]]</span>
</pre></div>


<p><img src="images/churn/output_148_1.png" alt="Drawing" style="width: 750px;"/></p>
<p><img src="images/churn/output_148_2.png" alt="Drawing" style="width: 750px;"/></p>
<div class="highlight"><pre><span></span><span class="n">KNN</span> <span class="n">CLASSIFIER</span>
<span class="n">Accuracy</span><span class="p">:</span> <span class="mi">67</span><span class="p">.</span><span class="mi">01</span><span class="o">%</span>
             <span class="k">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>

          <span class="mi">0</span>       <span class="mi">0</span><span class="p">.</span><span class="mi">95</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">68</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">80</span>     <span class="mi">10986</span>
          <span class="mi">1</span>       <span class="mi">0</span><span class="p">.</span><span class="mi">08</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">45</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">14</span>       <span class="mi">695</span>

<span class="k">avg</span> <span class="o">/</span> <span class="n">total</span>       <span class="mi">0</span><span class="p">.</span><span class="mi">90</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">67</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">76</span>     <span class="mi">11681</span>

<span class="n">Confusion</span> <span class="n">Matrix</span>
<span class="p">[[</span><span class="mi">7512</span> <span class="mi">3474</span><span class="p">]</span>
 <span class="p">[</span> <span class="mi">379</span>  <span class="mi">316</span><span class="p">]]</span>
<span class="n">Normalized</span> <span class="n">Confusion</span> <span class="n">Matrix</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">.</span><span class="mi">68</span> <span class="mi">0</span><span class="p">.</span><span class="mi">32</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">0</span><span class="p">.</span><span class="mi">55</span> <span class="mi">0</span><span class="p">.</span><span class="mi">45</span><span class="p">]]</span>
</pre></div>


<p><img src="images/churn/output_148_4.png" alt="Drawing" style="width: 750px;"/></p>
<p><img src="images/churn/output_148_5.png" alt="Drawing" style="width: 750px;"/></p>
<div class="highlight"><pre><span></span><span class="n">SVM</span> <span class="s">CLASSIFIER</span>


<span class="n">C</span><span class="p">:</span><span class="o">\</span><span class="n">Users</span><span class="o">\</span><span class="n">AOlson</span><span class="o">\</span><span class="n">AppData</span><span class="o">\</span><span class="n">Local</span><span class="o">\</span><span class="n">Continuum</span><span class="o">\</span><span class="n">anaconda3</span><span class="o">\</span><span class="n">lib</span><span class="o">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">\</span><span class="n">sklearn</span><span class="o">\</span><span class="n">svm</span><span class="o">\</span><span class="n">base</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">218</span><span class="p">:</span> <span class="n">ConvergenceWarning</span><span class="p">:</span> <span class="n">Solver</span> <span class="n">terminated</span> <span class="n">early</span> <span class="p">(</span><span class="n">max_iter</span><span class="p">=</span><span class="mi">640</span><span class="p">).</span>  <span class="n">Consider</span> <span class="n">pre</span><span class="o">-</span><span class="n">processing</span> <span class="n">your</span> <span class="n">data</span> <span class="n">with</span> <span class="n">StandardScaler</span> <span class="n">or</span> <span class="n">MinMaxScaler</span><span class="p">.</span>
  <span class="c">% self.max_iter, ConvergenceWarning)</span>


<span class="n">Accuracy</span><span class="p">:</span> <span class="mf">6.06</span><span class="c">%</span>
             <span class="n">precision</span>    <span class="s">recall</span>  <span class="s">f1-score</span>   <span class="s">support</span>

          <span class="n">0</span>       <span class="s">1.00</span>      <span class="s">0.00</span>      <span class="s">0.00</span>     <span class="s">10986</span>
          <span class="n">1</span>       <span class="s">0.06</span>      <span class="s">1.00</span>      <span class="s">0.11</span>       <span class="s">695</span>

<span class="n">avg</span> <span class="o">/</span> <span class="n">total</span>       <span class="mf">0.94</span>      <span class="mf">0.06</span>      <span class="mf">0.01</span>     <span class="mi">11681</span>

<span class="n">Confusion</span> <span class="s">Matrix</span>
<span class="p">[[</span>   <span class="mi">13</span> <span class="mi">10973</span><span class="p">]</span>
 <span class="p">[</span>    <span class="mi">0</span>   <span class="mi">695</span><span class="p">]]</span>
<span class="n">Normalized</span> <span class="s">Confusion</span> <span class="s">Matrix</span>
<span class="p">[[</span><span class="mf">0.</span> <span class="mf">1.</span><span class="p">]</span>
 <span class="p">[</span><span class="mf">0.</span> <span class="mf">1.</span><span class="p">]]</span>
</pre></div>


<p><img src="images/churn/output_148_9.png" alt="Drawing" style="width: 750px;"/></p>
<p><img src="images/churn/output_148_10.png" alt="Drawing" style="width: 750px;"/></p>
<h3>Random Forest Classifier</h3>
<p>Having had little success with the classifiers above, we next tried a random forest, which performed very well:</p>
<div class="highlight"><pre><span></span><span class="c1">### Random Forest Attempt ###</span>
<span class="n">clf_RF</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
<span class="n">clf_RF</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
<span class="n">summarize_results</span><span class="p">(</span><span class="n">clf_RF</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">clf_RF</span><span class="o">.</span><span class="n">get_params</span><span class="p">())</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">Accuracy</span><span class="o">:</span> <span class="mf">97.40</span><span class="o">%</span>
             <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>

          <span class="mi">0</span>       <span class="mf">1.00</span>      <span class="mf">0.97</span>      <span class="mf">0.99</span>     <span class="mi">10986</span>
          <span class="mi">1</span>       <span class="mf">0.70</span>      <span class="mf">0.98</span>      <span class="mf">0.82</span>       <span class="mi">695</span>

<span class="n">avg</span> <span class="o">/</span> <span class="n">total</span>       <span class="mf">0.98</span>      <span class="mf">0.97</span>      <span class="mf">0.98</span>     <span class="mi">11681</span>

<span class="n">Confusion</span> <span class="n">Matrix</span>
<span class="o">[[</span><span class="mi">10696</span>   <span class="mi">290</span><span class="o">]</span>
 <span class="o">[</span>   <span class="mi">14</span>   <span class="mi">681</span><span class="o">]]</span>
<span class="n">Normalized</span> <span class="n">Confusion</span> <span class="n">Matrix</span>
<span class="o">[[</span><span class="mf">0.97</span> <span class="mf">0.03</span><span class="o">]</span>
 <span class="o">[</span><span class="mf">0.02</span> <span class="mf">0.98</span><span class="o">]]</span>
</pre></div>


<p><img src="images/churn/output_150_1.png" alt="Drawing" style="width: 750px;"/></p>
<p><img src="images/churn/output_150_2.png" alt="Drawing" style="width: 750px;"/></p>
<div class="highlight"><pre><span></span><span class="err">{&#39;bootstrap&#39;: True, &#39;class_weight&#39;: None, &#39;criterion&#39;: &#39;gini&#39;, &#39;max_depth&#39;: None, &#39;max_features&#39;: &#39;auto&#39;, &#39;max_leaf_nodes&#39;: None, &#39;min_impurity_decrease&#39;: 0.0, &#39;min_impurity_split&#39;: None, &#39;min_samples_leaf&#39;: 1, &#39;min_samples_split&#39;: 2, &#39;min_weight_fraction_leaf&#39;: 0.0, &#39;n_estimators&#39;: 23, &#39;n_jobs&#39;: 8, &#39;oob_score&#39;: False, &#39;random_state&#39;: None, &#39;verbose&#39;: 0, &#39;warm_start&#39;: False}</span>
</pre></div>


<h3>Random Forest with GridSearchCV</h3>
<p>We next tried Random Forest with GridSearchCV to further tune our parameters:</p>
<div class="highlight"><pre><span></span><span class="c1">#RF Classifier with Grid Search</span>
<span class="n">tuned_parameters</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">150</span><span class="p">],</span>
                     <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">],</span>
                     <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span>

                    <span class="p">}]</span>

<span class="n">clf_GS_RF</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span>
                   <span class="n">tuned_parameters</span><span class="p">,</span>
                   <span class="c1">#cv=4,</span>
                   <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;recall&#39;</span><span class="p">)</span>
<span class="n">clf_GS_RF</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">clf_GS_RF</span><span class="o">.</span><span class="n">grid_scores_</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">clf_GS_RF</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">clf_GS_RF</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
<span class="n">summarize_results</span><span class="p">(</span><span class="n">clf_GS_RF</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">[mean: 0.97473, std: 0.00126, params: {&#39;max_features&#39;: 20, &#39;min_samples_leaf&#39;: 2, &#39;n_estimators&#39;: 150}]</span>
<span class="na">RandomForestClassifier(bootstrap</span><span class="o">=</span><span class="s">True, class_weight=None, criterion=&#39;gini&#39;,</span>
<span class="s">            max_depth=None, max_features=20, max_leaf_nodes=None,</span>
<span class="s">            min_impurity_decrease=0.0, min_impurity_split=None,</span>
<span class="s">            min_samples_leaf=2, min_samples_split=2,</span>
<span class="s">            min_weight_fraction_leaf=0.0, n_estimators=150, n_jobs=8,</span>
<span class="s">            oob_score=False, random_state=None, verbose=0,</span>
<span class="s">            warm_start=False)</span>
<span class="na">{&#39;max_features&#39;: 20, &#39;min_samples_leaf&#39;: 2, &#39;n_estimators&#39;: 150}</span>
<span class="na">Accuracy: 98.13%</span>
             <span class="na">precision    recall  f1-score   support</span>

          <span class="na">0       1.00      0.97      0.99     10986</span>
          <span class="na">1       0.70      0.98      0.82       695</span>

<span class="na">avg / total       0.98      0.97      0.98     11681</span>

<span class="na">Confusion Matrix</span>
<span class="k">[[10699   287]</span>
 <span class="k">[   13   682]]</span>
<span class="na">Normalized Confusion Matrix</span>
<span class="k">[[0.97 0.03]</span>
 <span class="k">[0.02 0.98]]</span>
</pre></div>


<p><img src="images/churn/output_152_1.png" alt="Drawing" style="width: 750px;"/></p>
<p><img src="images/churn/output_152_2.png" alt="Drawing" style="width: 750px;"/></p>
<p>The best parameters turned out to be max_features = 20, min_samples_leaf = 2, and n_estimators = 150, which produced a recall of 0.96890.</p>
<p>Of these parameters, n_estimators seemed to have the most effect on model performance, but it was still fairly small, and none of the parameters showed much difference (our total range was 0.0027, from 0.9662 - 0.9689).</p>
<p>To keep the run time down, we removed all the tuning trials for running multiple tuning parameters.  However, the results of those trials are listed below:</p>
<p>Output of 'print(clf_GS_RF.grid_scores_)':</p>
<p><strong>Tuning max_features, min_samples_leaf, and n_estimators</strong></p>
<ul>
<li>mean: 0.96619, std: 0.00077, params: {'max_features': 20, 'min_samples_leaf': 1, 'n_estimators': 40},</li>
<li>mean: 0.96663, std: 0.00076, params: {'max_features': 20, 'min_samples_leaf': 1, 'n_estimators': 50},</li>
<li>mean: 0.96782, std: 0.00066, params: {'max_features': 20, 'min_samples_leaf': 1, 'n_estimators': 100},</li>
<li>mean: 0.96660, std: 0.00143, params: {'max_features': 20, 'min_samples_leaf': 2, 'n_estimators': 40},</li>
<li>mean: 0.96786, std: 0.00028, params: {'max_features': 20, 'min_samples_leaf': 2, 'n_estimators': 50},</li>
<li>mean: 0.96868, std: 0.00055, params: {'max_features': 20, 'min_samples_leaf': 2, 'n_estimators': 100},</li>
<li>mean: 0.96816, std: 0.00048, params: {'max_features': 20, 'min_samples_leaf': 4, 'n_estimators': 40},</li>
<li>mean: 0.96838, std: 0.00060, params: {'max_features': 20, 'min_samples_leaf': 4, 'n_estimators': 50},</li>
<li>mean: 0.96853, std: 0.00101, params: {'max_features': 20, 'min_samples_leaf': 4, 'n_estimators': 100},</li>
<li>mean: 0.96704, std: 0.00057, params: {'max_features': 20, 'min_samples_leaf': 8, 'n_estimators': 40},</li>
<li>mean: 0.96786, std: 0.00032, params: {'max_features': 20, 'min_samples_leaf': 8, 'n_estimators': 50},</li>
<li>mean: 0.96734, std: 0.00089, params: {'max_features': 20, 'min_samples_leaf': 8, 'n_estimators': 100},</li>
<li>mean: 0.96704, std: 0.00016, params: {'max_features': 40, 'min_samples_leaf': 1, 'n_estimators': 40},</li>
<li>mean: 0.96753, std: 0.00068, params: {'max_features': 40, 'min_samples_leaf': 1, 'n_estimators': 50},</li>
<li>mean: 0.96819, std: 0.00080, params: {'max_features': 40, 'min_samples_leaf': 1, 'n_estimators': 100},</li>
<li>mean: 0.96838, std: 0.00024, params: {'max_features': 40, 'min_samples_leaf': 2, 'n_estimators': 40},</li>
<li>mean: 0.96819, std: 0.00064, params: {'max_features': 40, 'min_samples_leaf': 2, 'n_estimators': 50},</li>
<li>mean: 0.96860, std: 0.00048, params: {'max_features': 40, 'min_samples_leaf': 2, 'n_estimators': 100},</li>
<li>mean: 0.96868, std: 0.00046, params: {'max_features': 40, 'min_samples_leaf': 4, 'n_estimators': 40},</li>
<li>mean: 0.96860, std: 0.00009, params: {'max_features': 40, 'min_samples_leaf': 4, 'n_estimators': 50},</li>
<li>mean: 0.96827, std: 0.00027, params: {'max_features': 40, 'min_samples_leaf': 4, 'n_estimators': 100},</li>
<li>mean: 0.96834, std: 0.00032, params: {'max_features': 40, 'min_samples_leaf': 8, 'n_estimators': 40},</li>
<li>mean: 0.96860, std: 0.00069, params: {'max_features': 40, 'min_samples_leaf': 8, 'n_estimators': 50},</li>
<li>mean: 0.96864, std: 0.00059, params: {'max_features': 40, 'min_samples_leaf': 8, 'n_estimators': 100}]</li>
</ul>
<p><strong> Further tuning n_estimators</strong></p>
<ul>
<li>mean: 0.96842, std: 0.00073, params: {'max_features': 20, 'min_samples_leaf': 2, 'n_estimators': 100},</li>
<li>mean: 0.96890, std: 0.00082, params: {'max_features': 20, 'min_samples_leaf': 2, 'n_estimators': 150},</li>
<li>mean: 0.96838, std: 0.00078, params: {'max_features': 20, 'min_samples_leaf': 2, 'n_estimators': 200}]</li>
</ul>
<h3>XGBoost Classifier</h3>
<p>Having seen strong performance from Random Forest models, we next tried an XGBoost classifier:</p>
<div class="highlight"><pre><span></span><span class="c1">#Basic XGB Classifier</span>
<span class="n">clf_XGB</span> <span class="o">=</span> <span class="n">xgboost</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">clf_XGB</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
<span class="n">summarize_results</span><span class="p">(</span><span class="n">clf_XGB</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>


<span class="n">Accuracy</span><span class="p">:</span> <span class="mi">97</span><span class="p">.</span><span class="mi">11</span><span class="o">%</span>
             <span class="k">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>

          <span class="mi">0</span>       <span class="mi">1</span><span class="p">.</span><span class="mi">00</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">97</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">98</span>     <span class="mi">10986</span>
          <span class="mi">1</span>       <span class="mi">0</span><span class="p">.</span><span class="mi">68</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">97</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">80</span>       <span class="mi">695</span>

<span class="k">avg</span> <span class="o">/</span> <span class="n">total</span>       <span class="mi">0</span><span class="p">.</span><span class="mi">98</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">97</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">97</span>     <span class="mi">11681</span>

<span class="n">Confusion</span> <span class="n">Matrix</span>
<span class="p">[[</span><span class="mi">10667</span>   <span class="mi">319</span><span class="p">]</span>
 <span class="p">[</span>   <span class="mi">18</span>   <span class="mi">677</span><span class="p">]]</span>
<span class="n">Normalized</span> <span class="n">Confusion</span> <span class="n">Matrix</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">.</span><span class="mi">97</span> <span class="mi">0</span><span class="p">.</span><span class="mi">03</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">0</span><span class="p">.</span><span class="mi">03</span> <span class="mi">0</span><span class="p">.</span><span class="mi">97</span><span class="p">]]</span>
</pre></div>


<p><img src="images/churn/output_155_2.png" alt="Drawing" style="width: 750px;"/></p>
<p><img src="images/churn/output_155_3.png" alt="Drawing" style="width: 750px;"/></p>
<p>The results of the XGBoost classifier were also very promising.  With no tuning, they weren't quite as good as the Random Forest, but they were very close.</p>
<h3>XGBoost with GridSearchCV</h3>
<p>We next tried XGBoost with GridSearchCV to further tune our parameters:</p>
<div class="highlight"><pre><span></span><span class="c1">#XGB Classifier with Grid Search</span>
<span class="n">tuned_parameters</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;reg_lambda&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">],</span>
                     <span class="c1">#&#39;learning_rate&#39;: [0.01, 0.1, 1],</span>
                     <span class="c1">#&#39;max_depth&#39;: [3, 5, 7, 9],</span>
                     <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">],</span>  <span class="c1">#Landed on 5</span>
                     <span class="c1">#&#39;min_child_weight&#39;: [1, 3, 5],</span>
                     <span class="s1">&#39;min_child_weight&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="c1">#Landed on 1</span>
                     <span class="c1">#&#39;gamma&#39;:[i/10.0 for i in range(0,5)],</span>
                     <span class="s1">&#39;gamma&#39;</span><span class="p">:[</span><span class="mf">0.01</span><span class="p">],</span>  <span class="c1">#Landed on 0.01</span>
                     <span class="c1">#&#39;reg_alpha&#39;:[1e-5, 1e-2, 0.1, 1, 100], #NEXT TRY THIS, BUT NOT WITH COMBO ABOVE</span>
                     <span class="s1">&#39;reg_alpha&#39;</span><span class="p">:[</span><span class="mf">0.1</span><span class="p">],</span>
                    <span class="p">}]</span>

<span class="n">clf_GS_XGB</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">xgboost</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span>
                   <span class="n">tuned_parameters</span><span class="p">,</span>
                   <span class="c1">#cv=4,</span>
                   <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;recall&#39;</span><span class="p">)</span>
<span class="n">clf_GS_XGB</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
<span class="n">summarize_results</span><span class="p">(</span><span class="n">clf_GS_XGB</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>


<span class="n">Accuracy</span><span class="p">:</span> <span class="mi">97</span><span class="p">.</span><span class="mi">84</span><span class="o">%</span>
             <span class="k">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>

          <span class="mi">0</span>       <span class="mi">1</span><span class="p">.</span><span class="mi">00</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">98</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">99</span>     <span class="mi">10986</span>
          <span class="mi">1</span>       <span class="mi">0</span><span class="p">.</span><span class="mi">71</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">98</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">83</span>       <span class="mi">695</span>

<span class="k">avg</span> <span class="o">/</span> <span class="n">total</span>       <span class="mi">0</span><span class="p">.</span><span class="mi">98</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">98</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">98</span>     <span class="mi">11681</span>

<span class="n">Confusion</span> <span class="n">Matrix</span>
<span class="p">[[</span><span class="mi">10713</span>   <span class="mi">273</span><span class="p">]</span>
 <span class="p">[</span>   <span class="mi">15</span>   <span class="mi">680</span><span class="p">]]</span>
<span class="n">Normalized</span> <span class="n">Confusion</span> <span class="n">Matrix</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">.</span><span class="mi">98</span> <span class="mi">0</span><span class="p">.</span><span class="mi">02</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">0</span><span class="p">.</span><span class="mi">02</span> <span class="mi">0</span><span class="p">.</span><span class="mi">98</span><span class="p">]]</span>
</pre></div>


<p><img src="images/churn/output_157_2.png" alt="Drawing" style="width: 750px;"/></p>
<p><img src="images/churn/output_157_3.png" alt="Drawing" style="width: 750px;"/></p>
<p>From the code and results shown above, we were able to get results that slightly exceeded the Random Forest model.</p>
<p>To keep the run time down, we commented out the cells that ran multiple tuning parameters.  However, the results of those trials are as follows:</p>
<p>Output of 'print(clf_GS_XGB.grid_scores_)':</p>
<p><strong>Tuning max depth and min child weight</strong></p>
<ul>
<li>mean: 0.96971, std: 0.00072, params: {'max_depth': 3, 'min_child_weight': 1, 'reg_lambda': 0.01}</li>
<li>mean: 0.96990, std: 0.00064, params: {'max_depth': 3, 'min_child_weight': 3, 'reg_lambda': 0.01}</li>
<li>mean: 0.96990, std: 0.00061, params: {'max_depth': 3, 'min_child_weight': 5, 'reg_lambda': 0.01}</li>
<li>mean: 0.97012, std: 0.00023, params: {'max_depth': 5, 'min_child_weight': 1, 'reg_lambda': 0.01}</li>
<li>mean: 0.97042, std: 0.00014, params: {'max_depth': 5, 'min_child_weight': 3, 'reg_lambda': 0.01}</li>
<li>mean: 0.96983, std: 0.00055, params: {'max_depth': 5, 'min_child_weight': 5, 'reg_lambda': 0.01}</li>
<li>mean: 0.96994, std: 0.00048, params: {'max_depth': 7, 'min_child_weight': 1, 'reg_lambda': 0.01}</li>
<li>mean: 0.97038, std: 0.00125, params: {'max_depth': 7, 'min_child_weight': 3, 'reg_lambda': 0.01}</li>
<li>mean: 0.97031, std: 0.00026, params: {'max_depth': 7, 'min_child_weight': 5, 'reg_lambda': 0.01}</li>
<li>mean: 0.97038, std: 0.00096, params: {'max_depth': 9, 'min_child_weight': 1, 'reg_lambda': 0.01}</li>
<li>mean: 0.97057, std: 0.00115, params: {'max_depth': 9, 'min_child_weight': 3, 'reg_lambda': 0.01}</li>
<li>mean: 0.97038, std: 0.00024, params: {'max_depth': 9, 'min_child_weight': 5, 'reg_lambda': 0.01}</li>
</ul>
<p><strong>Tuning reg_alpha (with optimal values from above)</strong></p>
<ul>
<li>mean: 0.97005, std: 0.00018, params: {'max_depth': 5, 'min_child_weight': 1, 'reg_alpha': 1e-05, 'reg_lambda': 0.01}</li>
<li>mean: 0.97012, std: 0.00052, params: {'max_depth': 5, 'min_child_weight': 1, 'reg_alpha': 0.01, 'reg_lambda': 0.01}</li>
<li>mean: 0.97016, std: 0.00016, params: {'max_depth': 5, 'min_child_weight': 1, 'reg_alpha': 0.1, 'reg_lambda': 0.01}</li>
<li>mean: 0.97009, std: 0.00045, params: {'max_depth': 5, 'min_child_weight': 1, 'reg_alpha': 1, 'reg_lambda': 0.01}</li>
<li>mean: 0.96738, std: 0.00057, params: {'max_depth': 5, 'min_child_weight': 1, 'reg_alpha': 100, 'reg_lambda': 0.01}</li>
</ul>
<p><strong>Tuning gamma (with optimal values from above)</strong></p>
<ul>
<li>mean: 0.97016, std: 0.00016, params: {'gamma': 0.0, 'max_depth': 5, 'min_child_weight': 1, 'reg_alpha': 0.1, 'reg_lambda': 0.01}</li>
<li>mean: 0.97020, std: 0.00029, params: {'gamma': 0.1, 'max_depth': 5, 'min_child_weight': 1, 'reg_alpha': 0.1, 'reg_lambda': 0.01}</li>
<li>mean: 0.97001, std: 0.00028, params: {'gamma': 0.2, 'max_depth': 5, 'min_child_weight': 1, 'reg_alpha': 0.1, 'reg_lambda': 0.01}</li>
<li>mean: 0.97016, std: 0.00083, params: {'gamma': 0.3, 'max_depth': 5, 'min_child_weight': 1, 'reg_alpha': 0.1, 'reg_lambda': 0.01}</li>
<li>mean: 0.97012, std: 0.00056, params: {'gamma': 0.4, 'max_depth': 5, 'min_child_weight': 1, 'reg_alpha': 0.1, 'reg_lambda': 0.01}</li>
</ul>
<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">clf_GS_XGB</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">dev_data</span><span class="p">,</span> <span class="n">dev_labels</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="mi">0</span><span class="p">.</span><span class="mi">9784172661870504</span>


<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
</pre></div>


<h2>Final Run on Test Data</h2>
<p>The cell below runs our best model on the not-yet-touched test data:</p>
<div class="highlight"><pre><span></span><span class="n">summarize_results</span><span class="p">(</span><span class="n">clf_GS_XGB</span><span class="p">,</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>


<span class="n">Accuracy</span><span class="p">:</span> <span class="mi">98</span><span class="p">.</span><span class="mi">31</span><span class="o">%</span>
             <span class="k">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>

          <span class="mi">0</span>       <span class="mi">1</span><span class="p">.</span><span class="mi">00</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">98</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">99</span>      <span class="mi">6609</span>
          <span class="mi">1</span>       <span class="mi">0</span><span class="p">.</span><span class="mi">71</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">98</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">83</span>       <span class="mi">415</span>

<span class="k">avg</span> <span class="o">/</span> <span class="n">total</span>       <span class="mi">0</span><span class="p">.</span><span class="mi">98</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">98</span>      <span class="mi">0</span><span class="p">.</span><span class="mi">98</span>      <span class="mi">7024</span>

<span class="n">Confusion</span> <span class="n">Matrix</span>
<span class="p">[[</span><span class="mi">6444</span>  <span class="mi">165</span><span class="p">]</span>
 <span class="p">[</span>   <span class="mi">7</span>  <span class="mi">408</span><span class="p">]]</span>
<span class="n">Normalized</span> <span class="n">Confusion</span> <span class="n">Matrix</span>
<span class="p">[[</span><span class="mi">0</span><span class="p">.</span><span class="mi">98</span> <span class="mi">0</span><span class="p">.</span><span class="mi">02</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">0</span><span class="p">.</span><span class="mi">02</span> <span class="mi">0</span><span class="p">.</span><span class="mi">98</span><span class="p">]]</span>
</pre></div>


<p><img src="images/churn/output_161_2.png" alt="Drawing" style="width: 750px;"/></p>
<p><img src="images/churn/output_161_3.png" alt="Drawing" style="width: 750px;"/></p>
<p>The test results confirm the same strong findings we saw in the dev data.</p>
<h2>Modeling Results</h2>
<p>Here are the key points summarizing our predictive modeling findings:</p>
<ul>
<li>XGBoost worked the best, slightly outperforming Random Forest.  No other model we tried came close to their results.</li>
<li>Scores:<ul>
<li>We achieved a recall of 97.8% with the dev data, and 98.3% with the test data (not used to tune any of the models), which resulted in correctly predicting 680 / 408 users who churned and only missing 15 / 7 in the dev / test data, respectively.</li>
<li>Our false positive rate was 2.5% in both the dev and test data, incorrectly predicting 273 / 165 users who actually did not churn in the dev / test data, respectively.  The economic modeling below will give more insight into if these levels are acceptable, but they seem quite good for now.</li>
</ul>
</li>
<li>In our initial models, we had not yet peformed the 50/50 spilt of the training data, and our best recall score (of the dev data) was 78%.  Upon making this change to 50/50, our recall score of our best models improved dramattically, to 96%!</li>
<li>Additional feature engineering proved useful also.  Notably, adding features of date interactions (expiry date, last transaction, and last usage, along with the differences among these dates), reduced false positives in our dev data from 415 to 273, a big improvement.</li>
</ul>
<h1>4. Calculating Probabilities</h1>
<p>Our model has shown very promising results both in terms of recall and accuracy, meaning we can accurately predict which customers will churn. However from a business perspective, we would also like to go further and look at the probability of churn, in order to determine how much should be spent to prevent churn. </p>
<p>When looking at probility we want to ensure that it is accurately calibrated (ie when the model predicts 60% probability of churn, 60% of customers did churn). We can do this by creating a calibration plot. </p>
<p>When we performed the train/dev/test split, we kept a 50% churn proportion in the train dataset, but a 6% (native) churn proportion in both the dev and test splits. Therefore, because we trained on the train dataset, but our proportions are very different between train/dev datasets, our calibration is very innacurate:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_calibration</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="n">testing_data</span><span class="p">,</span> <span class="n">testing_labels</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This function plots calibration plot using sklearn packages in order to visualize</span>
<span class="sd">    the efficiency in which models predict probabilities. It is based on the work presented</span>
<span class="sd">    in the sklearn documentation (http://scikit-learn.org/stable/auto_examples/calibration/plot_calibration_curve.html).</span>

<span class="sd">    Also prints the brier score for reference.</span>

<span class="sd">    Args:</span>
<span class="sd">        models: A list of tuples that contain the pre-fit model (with predict_proba as a method)</span>
<span class="sd">            as well as a string of the name of the model</span>
<span class="sd">        testing_data: Data used for testing the pre-fit model. **Data should not have previously</span>
<span class="sd">            been used for testing</span>
<span class="sd">        testing_labels: Labels for the testing data</span>
<span class="sd">        title: String to be used as title for plot</span>

<span class="sd">    Returns:</span>
<span class="sd">        N/A: Prints plot to screen</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Perfect Calibration&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">clf</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
        <span class="c1">#Get probabilities for the specific model using the test dataset</span>
        <span class="n">prob_pos</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">testing_data</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#Use sklearn calibraiton_curve implementation to extract data to plot in calibration curve</span>
        <span class="n">frac_pos</span><span class="p">,</span> <span class="n">mean_pred</span> <span class="o">=</span> <span class="n">calibration_curve</span><span class="p">(</span><span class="n">testing_labels</span><span class="p">,</span> <span class="n">prob_pos</span><span class="p">,</span> <span class="n">n_bins</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_pred</span><span class="p">,</span> <span class="n">frac_pos</span><span class="p">,</span> <span class="s2">&quot;s-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,))</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">prob_pos</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1">#Print the Brier Score - used for quantifying calibration success</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> Brier Score: </span><span class="si">%1.3f</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">brier_score_loss</span><span class="p">(</span><span class="n">testing_labels</span><span class="p">,</span> <span class="n">prob_pos</span><span class="p">)))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Fraction of positives&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mean predicted value&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#Baseline score using models that were previously computed to optimize for recall and accuracy</span>
<span class="n">model</span> <span class="o">=</span> <span class="p">[(</span><span class="n">clf_NB_Gauss</span><span class="p">,</span> <span class="s1">&#39;Naive Bayes&#39;</span><span class="p">),</span> 
                  <span class="p">(</span><span class="n">clf_neigh</span><span class="p">,</span> <span class="s1">&#39;Nearest Neighbors&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">clf_RF</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">clf_SVM</span><span class="p">,</span> <span class="s1">&#39;Support Vector Machine&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">clf_XGB</span><span class="p">,</span> <span class="s1">&#39;XG Boost&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">clf_GS_XGB</span><span class="p">,</span> <span class="s1">&#39;XG Boost Optimized&#39;</span><span class="p">)]</span>
<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Calibration Plot for Previously Computed Models&#39;</span>
<span class="n">plot_calibration</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dev_data</span><span class="p">,</span> <span class="n">dev_labels</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Naive Bayes Brier Score: 0.060</span>
<span class="err">Nearest Neighbors Brier Score: 0.243</span>
<span class="err">Random Forest Brier Score: 0.027</span>
<span class="err">Support Vector Machine Brier Score: 0.256</span>
<span class="err">XG Boost Brier Score: 0.025</span>
<span class="err">XG Boost Optimized Brier Score: 0.022</span>
</pre></div>


<p><img src="images/churn/output_166_1.png" alt="Drawing" style="width: 750px;"/></p>
<p>Because of the very different proportion of churn data between the train and dev dataset, our calibration curves for all models performs very poorly. We therefore need to run a calibration model (trained on the dev set - which hasn't been used for training and provides the correct proportion of churn). Training using the dev set, we can then determine calibration efficiency by looking at the test set which until now has not been utilized. Due to the limited size of our dataset, we will train on the dev set, however an additional subset of data that hasn't previously been used would be a preferred approach and is recommended for future development. </p>
<p>We can see the affect of different proportion churn datsets for train and test in the histogram underneath the calibration curve. We know that in the dev set 94% of the data is labeled 0 (so should have a small probability) however there are peaks around the 50% mark especially in the SVM model. This distorts the probability computation and causes the models to be poorly calibrated. </p>
<p>We will start by training using the built in sklearn packages which utilizes Platt's scaling (fitting a logistic regression model) or isotonic calibration procedures. </p>
<div class="highlight"><pre><span></span><span class="c1">#Fit isotonic and sigmoid calibration to the XG Boost Model</span>
<span class="n">clf_isotonic</span> <span class="o">=</span> <span class="n">CalibratedClassifierCV</span><span class="p">(</span><span class="n">clf_GS_XGB</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;isotonic&#39;</span><span class="p">)</span>
<span class="n">clf_isotonic</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dev_data</span><span class="p">,</span> <span class="n">dev_labels</span><span class="p">)</span>

<span class="n">clf_sigmoid</span> <span class="o">=</span> <span class="n">CalibratedClassifierCV</span><span class="p">(</span><span class="n">clf_GS_XGB</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;sigmoid&#39;</span><span class="p">)</span>
<span class="n">clf_sigmoid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dev_data</span><span class="p">,</span> <span class="n">dev_labels</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
<span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">AOlson</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Continuum</span><span class="err">\</span><span class="n">anaconda3</span><span class="err">\</span><span class="n">lib</span><span class="err">\</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="err">\</span><span class="n">sklearn</span><span class="err">\</span><span class="n">preprocessing</span><span class="err">\</span><span class="n">label</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span> <span class="n">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="k">of</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">array</span> <span class="k">is</span> <span class="n">ambiguous</span><span class="p">.</span> <span class="n">Returning</span> <span class="k">False</span><span class="p">,</span> <span class="n">but</span> <span class="k">in</span> <span class="n">future</span> <span class="n">this</span> <span class="n">will</span> <span class="k">result</span> <span class="k">in</span> <span class="n">an</span> <span class="n">error</span><span class="p">.</span> <span class="n">Use</span> <span class="o">`</span><span class="nb">array</span><span class="p">.</span><span class="k">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">`</span> <span class="k">to</span> <span class="k">check</span> <span class="n">that</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">is</span> <span class="k">not</span> <span class="n">empty</span><span class="p">.</span>
  <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>





<span class="n">CalibratedClassifierCV</span><span class="p">(</span><span class="n">base_estimator</span><span class="o">=</span><span class="n">GridSearchCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">error_score</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">,</span>
       <span class="n">estimator</span><span class="o">=</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">base_score</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">booster</span><span class="o">=</span><span class="s1">&#39;gbtree&#39;</span><span class="p">,</span> <span class="n">colsample_bylevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
       <span class="n">colsample_bytree</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_delta_step</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
       <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_child_weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
       <span class="n">n_jo</span><span class="p">....</span><span class="mi">01</span><span class="p">],</span> <span class="s1">&#39;reg_alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">]</span><span class="err">}</span><span class="p">],</span>
       <span class="n">pre_dispatch</span><span class="o">=</span><span class="s1">&#39;2*n_jobs&#39;</span><span class="p">,</span> <span class="n">refit</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;recall&#39;</span><span class="p">,</span> <span class="k">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">cv</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="k">method</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)</span>
</pre></div>


<p>The sklearn calibration functions utilize the dataset in raw form (rather than feeding in predicted probabilities from the prior model). Below when we implement our own model, we train on the former predicted model probabilities (clf_GS_XGB) to compute the calibrated model. </p>
<div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span>  <span class="p">[(</span><span class="n">clf_GS_XGB</span><span class="p">,</span> <span class="s1">&#39;XG Boost&#39;</span><span class="p">),</span>
                 <span class="p">(</span><span class="n">clf_isotonic</span><span class="p">,</span> <span class="s1">&#39;XGB Isotonic Calibration&#39;</span><span class="p">),</span>
                 <span class="p">(</span><span class="n">clf_sigmoid</span><span class="p">,</span> <span class="s1">&#39;XGB Sigmoid Calibration&#39;</span><span class="p">)]</span>
<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Calibration Plot for Isotonic and Sigmoid Calibration Functions&#39;</span>
<span class="n">plot_calibration</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">XG Boost Brier Score: 0.021</span>
<span class="err">XGB Isotonic Calibration Brier Score: 0.013</span>
<span class="err">XGB Sigmoid Calibration Brier Score: 0.015</span>
</pre></div>


<p><img src="images/churn/output_170_1.png" alt="Drawing" style="width: 750px;"/></p>
<p>We can see that both calibration procedures significantly improved over the non-calibrated XG-Boost method (we are calibrating on XG Boost because this provided the highest accuracy and recall). The isotonic calibration worked better than sigmoid. </p>
<p>From the histogram plot we can see that most predictions have a low probability, which makes sense based on the skew in the dev and test datasets (only 6% churn). </p>
<p>We then wanted to test other methods of calibration to determine if our own implementation would result in improved calibration. </p>
<div class="highlight"><pre><span></span><span class="c1">#Initialize models used for calibration</span>
<span class="n">clf_LR_class</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<span class="n">clf_RF_class</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">clf_NB_class</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">()</span>
<span class="n">clf_SVM_class</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">SVC</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span> <span class="n">probability</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1">#Get probability data from the former model (XG Boost) in order to fit the calibration model</span>
<span class="n">probs_dev</span> <span class="o">=</span> <span class="n">clf_GS_XGB</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">dev_data</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">probs_dev</span> <span class="o">=</span> <span class="n">probs_dev</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">probs_test</span> <span class="o">=</span> <span class="n">clf_GS_XGB</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">test_data</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">probs_test</span> <span class="o">=</span> <span class="n">probs_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="p">[(</span><span class="n">clf_LR_class</span><span class="p">,</span> <span class="s1">&#39;Logistic Regression Calibration&#39;</span><span class="p">),</span>
                 <span class="p">(</span><span class="n">clf_RF_class</span><span class="p">,</span> <span class="s1">&#39;Random Forrest Calibration&#39;</span><span class="p">),</span>
                 <span class="p">(</span><span class="n">clf_NB_class</span><span class="p">,</span> <span class="s1">&#39;Naive Bayes Calibration&#39;</span><span class="p">),</span>
                 <span class="p">(</span><span class="n">clf_SVM_class</span><span class="p">,</span> <span class="s1">&#39;SVM Calibration&#39;</span><span class="p">)]</span>
<span class="c1">#Fit the models used for calibration with the probability output from XG Boost</span>
<span class="k">for</span> <span class="n">clf</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">probs_dev</span><span class="p">,</span> <span class="n">dev_labels</span><span class="p">)</span>
<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Calibration Plot for Implementation of Calibrated Models using other ML Models&#39;</span>
<span class="n">plot_calibration</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">probs_test</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Logistic Regression Calibration Brier Score: 0.013</span>
<span class="err">Random Forrest Calibration Brier Score: 0.017</span>
<span class="err">Naive Bayes Calibration Brier Score: 0.020</span>
<span class="err">SVM Calibration Brier Score: 0.011</span>
</pre></div>


<p><img src="images/churn/output_172_1.png" alt="Drawing" style="width: 750px;"/></p>
<p>Here we can see that our implementation, using the default hyperparameters for the sklearn modeling packages, improved the baseline accuracy (clf_GS_XGB). Additionally, while visually all lines appear to be less calibrated than the former calibration steps (isotonic and sigmoid), the brier score for the SVM implementation was actually lower (better) than the isotonic implementation. The dataset here was limited (5000 samples) and visually isotonic does appear to follow the 45 deg line more closely than SVM. We can see that in several locations SVM is very close to the 45 deg line which may help to bring down the brier score calculation on this limited dataset, but overall performance would be hindered. </p>
<p>Because the intent of the calibration is to feed an economic model that will analyze probability of churn over a range of probabilities, we will utilize the isotonic calibration model as it stays closs to the 45 deg line throughout the range of probabilities where we would like to recommend action taken to prevent churn. </p>
<p>Future work should involve larger datasets to validate the use of the isotonic calibration or support an alternative method. </p>
<p>We can now use our calibrated probabilities to feed our economic model and allow business insight into the problem of business churn.</p>
<h1>5. Economic Impact</h1>
<h2>Economic model to plug into the business plan</h2>
<p>To this point we have the following information:</p>
<div class="highlight"><pre><span></span><span class="err">*Users who could churn (from the model)</span>
<span class="err">*Probability for churn (from the calibrated model)</span>
<span class="err">*Spending metrics (from the data)</span>
</pre></div>


<p>Next step would be to guide the business on worthwhile spending to keep the customers at risk. We'll come up with a model for this spend (marketing spend) and then apply it to our data. The marketing spend can be used for loyalty programs, incentives or other kinds of tiered discounting programs. We'll keep the spend formfactor out of scope for this report. </p>
<p>For the economic analysis, data has been provided in NTD (New Taiwan Dollars). This will be the currency used throughout this analysis.</p>
<h3>Coming up with the economic model for retention</h3>
<p>We'll start with some metrics for the customer and business that are visible from the data or our feature list</p>
<div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">Optimum</span> <span class="n">lifetime</span> <span class="n">value</span> <span class="k">of</span> <span class="n">a</span> <span class="n">customer</span> <span class="k">is</span> <span class="n">assumed</span> <span class="k">to</span> <span class="n">be</span> <span class="n">the</span> <span class="n">revenue</span> <span class="k">from</span> <span class="n">the</span> <span class="n">highest</span> <span class="n">paying</span> <span class="n">customer</span> <span class="p">(</span><span class="k">for</span> <span class="n">the</span> <span class="n">purpose</span> <span class="k">of</span> <span class="n">this</span> <span class="n">report</span><span class="p">).</span> <span class="n">We</span> <span class="n">calculate</span> <span class="mi">2</span> <span class="n">metrics</span> <span class="k">for</span> <span class="n">this</span><span class="p">:</span> 
    <span class="o">*</span> <span class="n">Optimum</span> <span class="n">lifetime</span> <span class="n">value</span> <span class="o">-</span><span class="n">OLTV</span><span class="o">-</span> <span class="k">max</span> <span class="n">paid</span><span class="o">/</span><span class="k">day</span> <span class="k">from</span> <span class="n">our</span> <span class="n">sample</span>
    <span class="o">*</span> <span class="n">Optimum</span> <span class="n">lietime</span> <span class="n">value</span> <span class="p">(</span><span class="mi">3</span> <span class="n">years</span><span class="p">)</span> <span class="o">-</span> <span class="n">OLTV3y</span>

<span class="o">*</span> <span class="n">Lifetime</span> <span class="n">value</span> <span class="k">of</span> <span class="n">a</span> <span class="n">customer</span> <span class="k">is</span> <span class="n">the</span> <span class="n">actual</span> <span class="n">revenue</span> <span class="k">from</span> <span class="n">the</span> <span class="n">customer</span><span class="p">.</span> <span class="n">We</span> <span class="n">again</span> <span class="n">consider</span> <span class="mi">2</span> <span class="n">metrics</span> <span class="k">for</span> <span class="n">this</span><span class="p">:</span>
    <span class="o">*</span> <span class="n">Life</span> <span class="k">time</span> <span class="n">value</span> <span class="o">-</span> <span class="n">LTV</span> <span class="o">-</span> <span class="n">actuals</span> <span class="k">from</span> <span class="n">the</span> <span class="n">customer</span><span class="o">/</span><span class="k">day</span>
    <span class="o">*</span> <span class="n">Life</span> <span class="k">time</span> <span class="n">value</span> <span class="p">(</span><span class="mi">3</span> <span class="n">years</span><span class="p">)</span> <span class="o">-</span> <span class="n">LTV3y</span>

<span class="o">*</span> <span class="n">Average</span> <span class="n">lifetime</span> <span class="n">value</span> <span class="k">of</span> <span class="n">a</span> <span class="n">customer</span> <span class="k">is</span> <span class="n">the</span> <span class="n">average</span> <span class="n">what</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">paid</span> <span class="k">by</span> <span class="n">our</span> <span class="n">sample</span> <span class="n">customers</span><span class="p">.</span> <span class="n">The</span> <span class="mi">2</span> <span class="n">metrics</span> <span class="k">for</span> <span class="n">this</span> <span class="k">are</span><span class="p">:</span>
    <span class="o">*</span> <span class="n">Average</span> <span class="n">life</span> <span class="k">time</span> <span class="n">value</span> <span class="o">-</span> <span class="n">ALTV</span> <span class="o">-</span> <span class="n">average</span><span class="o">/</span><span class="k">day</span>
    <span class="o">*</span> <span class="n">Average</span> <span class="n">life</span> <span class="k">time</span> <span class="n">value</span> <span class="p">(</span><span class="mi">3</span> <span class="n">years</span><span class="p">)</span> <span class="o">-</span> <span class="n">altv3y</span>
</pre></div>


<p>The Average 3 year life value of a customer can help us make assumptions on what can be spend to acuire the customer in the first place (CAC). We're assuming that this value is 10% of the average lifetime value
    *CAC = .1 * altv3y</p>
<p>Now know the value (revenue) of our customers and what it cost to acquire them. We'll move on to find out the spend to keep them. CAC is relevant as it helps us establish a ceiling for our retention/reacquisition cost (RAC) spend. We'll assert that the reacquistion cost for the customer cannot exceed 75% of the original acquisition cost.</p>
<p>We'd not want to spend the "reacquistion $" equally on all customers. We'd want to optimize this spend based on the forllowing: </p>
<div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">Value</span> <span class="k">of</span> <span class="n">the</span> <span class="n">customer</span><span class="p">.</span> <span class="n">ltv</span><span class="o">/</span><span class="n">oltv</span> <span class="p">(</span><span class="n">lifetime</span> <span class="n">value</span> <span class="k">of</span> <span class="n">a</span> <span class="n">customer</span><span class="o">/</span><span class="n">lifetime</span> <span class="n">value</span> <span class="k">of</span> <span class="n">our</span> <span class="n">optimum</span> <span class="n">customer</span><span class="p">)</span> <span class="k">is</span> <span class="n">a</span> <span class="n">good</span> <span class="n">representation</span> <span class="k">of</span> <span class="n">a</span> <span class="n">customer</span> <span class="n">value</span><span class="p">.</span> <span class="n">It</span> <span class="n">simplistic</span> <span class="k">as</span> <span class="n">leaves</span> <span class="k">out</span> <span class="k">all</span> <span class="n">intangibles</span> <span class="k">like</span> <span class="n">social</span> <span class="k">and</span> <span class="n">support</span> <span class="n">cost</span> <span class="n">impact</span> <span class="k">of</span> <span class="k">some</span> <span class="n">customers</span><span class="p">.</span> <span class="n">We</span> <span class="n">can</span> <span class="n">easily</span> <span class="n">extend</span> <span class="n">our</span> <span class="n">model</span> <span class="k">for</span> <span class="n">those</span> <span class="n">factors</span>

<span class="o">*</span> <span class="n">Risk</span> <span class="k">of</span> <span class="n">flight</span><span class="p">.</span> <span class="n">The</span> <span class="n">probability</span> <span class="k">of</span> <span class="n">churn</span> <span class="k">is</span> <span class="n">a</span> <span class="n">good</span> <span class="n">represention</span> <span class="k">of</span> <span class="n">this</span>
</pre></div>


<p>Combining all of the above, we arrive at the following model for reacqusition spending (RAC)</p>
<div class="highlight"><pre><span></span><span class="err">** RAC = .75 * CAC * POC * (LTV/OLTV)**</span>
</pre></div>


<p>We'll calculate this value individually for each customer.</p>
<p>An enchancement to our recommendation can be finding RAC clusters to suggest tiers of spending. We've not attempted that in this report.</p>
<h3>Probabilities from our model</h3>
<div class="highlight"><pre><span></span><span class="c1"># Get the probabilities for economic model</span>
<span class="c1"># We&#39;ll use the calibrated model</span>

<span class="c1"># Prediction probabilities</span>
<span class="n">predictions_prob</span> <span class="o">=</span> <span class="n">clf_isotonic</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">dev_data</span><span class="p">)</span>

<span class="c1"># Predictions</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">clf_isotonic</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dev_data</span><span class="p">)</span>

<span class="c1"># Test</span>

<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>

<span class="s1">Dev data shape: </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">Predictions shape: </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">Sample of predictions: </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">Prediction probabilities shape: </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">Sample of prediction probabilities: </span>
<span class="si">{}</span><span class="s1"></span>

<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dev_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">predictions</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span> <span class="n">predictions_prob</span><span class="o">.</span><span class="n">shape</span> <span class="p">,</span><span class="n">predictions_prob</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
      <span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Dev data shape: (11681, 159)</span>
<span class="err">Predictions shape: (11681,)</span>
<span class="err">Sample of predictions: [0 0 0 0 0]</span>
<span class="err">Prediction probabilities shape: (11681, 2)</span>
<span class="err">Sample of prediction probabilities: </span>
<span class="err">[[9.91e-01 8.57e-03]</span>
<span class="err"> [9.98e-01 1.70e-03]</span>
<span class="err"> [9.99e-01 1.18e-03]</span>
<span class="err"> [1.00e+00 0.00e+00]</span>
<span class="err"> [1.00e+00 2.04e-04]]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Starting the marketing data frame</span>

<span class="n">marketing_data</span> <span class="o">=</span> <span class="n">dev_data</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Test</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Marketing_data shape: </span><span class="si">{}</span><span class="s1"></span>

<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">marketing_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
     <span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Marketing_data shape: (11681, 159)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Adding predictions and probability (From the model)</span>

<span class="n">marketing_data</span><span class="p">[</span><span class="s1">&#39;predictions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictions</span>
<span class="n">marketing_data</span><span class="p">[</span><span class="s1">&#39;probability_churn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictions_prob</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>


<h3>Lifetime value metrics for the customers</h3>
<div class="highlight"><pre><span></span><span class="c1"># Optimum life time value (per day ) can be represented by the max of &quot;amount paid per day&quot; among our sample</span>

<span class="n">oltv</span> <span class="o">=</span> <span class="n">marketing_data</span><span class="p">[</span><span class="s1">&#39;amount_paid_per_day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">oltv3y</span> <span class="o">=</span> <span class="n">oltv</span> <span class="o">*</span> <span class="mi">365</span> <span class="o">*</span> <span class="mi">3</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Optimum lifetime value of the customer per day (NTD/day): NT$</span><span class="si">{:,.2f}</span><span class="s1"></span>
<span class="s1">Optimum lifetime value of the customer (3 Years) (NTD): NT$</span><span class="si">{:,.2f}</span><span class="s1"></span>

<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oltv</span><span class="p">,</span> <span class="n">oltv3y</span><span class="p">)</span>
     <span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Optimum lifetime value of the customer per day (NTD/day): NT$13.45</span>
<span class="err">Optimum lifetime value of the customer (3 Years) (NTD): NT$14,727.75</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Average lifetime value (ALTV) can be represented by spend/day </span>
<span class="c1"># Over 3 years it helps us calculate the cost to acquire the customer (CAC)</span>
<span class="c1"># The business plan allows CAC to be 10% of revenue from the customer</span>

<span class="n">altv</span> <span class="o">=</span> <span class="n">marketing_data</span><span class="p">[</span><span class="s1">&#39;amount_paid_per_day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">altv3y</span> <span class="o">=</span> <span class="n">marketing_data</span><span class="p">[</span><span class="s1">&#39;amount_paid_per_day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="mi">365</span> <span class="o">*</span> <span class="mi">3</span>
<span class="n">cac</span> <span class="o">=</span> <span class="o">.</span><span class="mi">1</span> <span class="o">*</span> <span class="n">altv3y</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Average lifetime value of the customer per day (NTD/day): NT$</span><span class="si">{:,.4f}</span><span class="s1"></span>
<span class="s1">Average lifetime value of the customer: (3 Years) (NTD): NT$</span><span class="si">{:,.4f}</span><span class="s1"></span>
<span class="s1">Customer acquisition cost (NTD): NT$</span><span class="si">{:,.4f}</span><span class="s1"></span>

<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">altv</span><span class="p">,</span> <span class="n">altv3y</span><span class="p">,</span> <span class="n">cac</span><span class="p">)</span>
     <span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Average lifetime value of the customer per day (NTD/day): NT$4.5435</span>
<span class="err">Average lifetime value of the customer: (3 Years) (NTD): NT$4,975.1425</span>
<span class="err">Customer acquisition cost (NTD): NT$497.5143</span>
</pre></div>


<h3>Adding the reacquisition cost suggestion to our model</h3>
<h3>RAC = .75 * CAC * POC * (LTV/OLTV)</h3>
<div class="highlight"><pre><span></span><span class="c1"># Reacquistion cost (marketing spend to prevent churn):</span>
<span class="c1"># RAC = .75 * CAC * POC * (LTV/OLTV)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>

<span class="s1">Shape of predictions: </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">Shape of predictions_prob: </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">Shape of marketing_data[&#39;amount_paid_per_day&#39;]: </span><span class="si">{}</span><span class="s1"></span>

<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">predictions_prob</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">marketing_data</span><span class="p">[</span><span class="s1">&#39;amount_paid_per_day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
     <span class="p">)</span>
<span class="n">marketing_data</span><span class="p">[</span><span class="s1">&#39;proposed_spend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="o">.</span><span class="mi">75</span> <span class="o">*</span> <span class="n">cac</span>
                                    <span class="o">*</span> <span class="n">predictions_prob</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                                    <span class="o">*</span> <span class="n">predictions</span>
                                    <span class="o">*</span> <span class="p">(</span><span class="n">marketing_data</span><span class="p">[</span><span class="s1">&#39;amount_paid_per_day&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">oltv</span><span class="p">)</span>
                                    <span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Shape of predictions: (11681,)</span>
<span class="err">Shape of predictions_prob: (11681,)</span>
<span class="err">Shape of marketing_data[&#39;amount_paid_per_day&#39;]: (11681,)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Test</span>
<span class="nb">print</span><span class="p">(</span><span class="n">marketing_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">marketing_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">(11681, 162)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>city</th>
      <th>bd</th>
      <th>registered_via</th>
      <th>registration_init_time</th>
      <th>date_featuresdatelistening_tenure</th>
      <th>within_days_1num_unqsum</th>
      <th>within_days_1num_unqmean</th>
      <th>within_days_1num_unqcount</th>
      <th>within_days_1total_secssum</th>
      <th>within_days_1total_secsmean</th>
      <th>within_days_1num_25sum</th>
      <th>within_days_1num_25mean</th>
      <th>within_days_1num_50sum</th>
      <th>within_days_1num_50mean</th>
      <th>within_days_1num_75sum</th>
      <th>within_days_1num_75mean</th>
      <th>within_days_1num_985sum</th>
      <th>within_days_1num_985mean</th>
      <th>within_days_1num_100sum</th>
      <th>within_days_1num_100mean</th>
      <th>within_days_7num_unqsum</th>
      <th>within_days_7num_unqmean</th>
      <th>within_days_7num_unqcount</th>
      <th>within_days_7total_secssum</th>
      <th>within_days_7total_secsmean</th>
      <th>within_days_7num_25sum</th>
      <th>within_days_7num_25mean</th>
      <th>within_days_7num_50sum</th>
      <th>within_days_7num_50mean</th>
      <th>within_days_7num_75sum</th>
      <th>within_days_7num_75mean</th>
      <th>within_days_7num_985sum</th>
      <th>within_days_7num_985mean</th>
      <th>within_days_7num_100sum</th>
      <th>within_days_7num_100mean</th>
      <th>within_days_14num_unqsum</th>
      <th>within_days_14num_unqmean</th>
      <th>within_days_14num_unqcount</th>
      <th>within_days_14total_secssum</th>
      <th>within_days_14total_secsmean</th>
      <th>within_days_14num_25sum</th>
      <th>within_days_14num_25mean</th>
      <th>within_days_14num_50sum</th>
      <th>within_days_14num_50mean</th>
      <th>within_days_14num_75sum</th>
      <th>within_days_14num_75mean</th>
      <th>within_days_14num_985sum</th>
      <th>within_days_14num_985mean</th>
      <th>within_days_14num_100sum</th>
      <th>within_days_14num_100mean</th>
      <th>within_days_31num_unqsum</th>
      <th>within_days_31num_unqmean</th>
      <th>within_days_31num_unqcount</th>
      <th>within_days_31total_secssum</th>
      <th>within_days_31total_secsmean</th>
      <th>within_days_31num_25sum</th>
      <th>within_days_31num_25mean</th>
      <th>within_days_31num_50sum</th>
      <th>within_days_31num_50mean</th>
      <th>within_days_31num_75sum</th>
      <th>within_days_31num_75mean</th>
      <th>within_days_31num_985sum</th>
      <th>within_days_31num_985mean</th>
      <th>within_days_31num_100sum</th>
      <th>within_days_31num_100mean</th>
      <th>within_days_90num_unqsum</th>
      <th>within_days_90num_unqmean</th>
      <th>within_days_90num_unqcount</th>
      <th>within_days_90total_secssum</th>
      <th>within_days_90total_secsmean</th>
      <th>within_days_90num_25sum</th>
      <th>within_days_90num_25mean</th>
      <th>within_days_90num_50sum</th>
      <th>within_days_90num_50mean</th>
      <th>within_days_90num_75sum</th>
      <th>within_days_90num_75mean</th>
      <th>within_days_90num_985sum</th>
      <th>within_days_90num_985mean</th>
      <th>within_days_90num_100sum</th>
      <th>within_days_90num_100mean</th>
      <th>within_days_180num_unqsum</th>
      <th>within_days_180num_unqmean</th>
      <th>within_days_180num_unqcount</th>
      <th>within_days_180total_secssum</th>
      <th>within_days_180total_secsmean</th>
      <th>within_days_180num_25sum</th>
      <th>within_days_180num_25mean</th>
      <th>within_days_180num_50sum</th>
      <th>within_days_180num_50mean</th>
      <th>within_days_180num_75sum</th>
      <th>within_days_180num_75mean</th>
      <th>within_days_180num_985sum</th>
      <th>within_days_180num_985mean</th>
      <th>within_days_180num_100sum</th>
      <th>within_days_180num_100mean</th>
      <th>within_days_365num_unqsum</th>
      <th>within_days_365num_unqmean</th>
      <th>within_days_365num_unqcount</th>
      <th>within_days_365total_secssum</th>
      <th>within_days_365total_secsmean</th>
      <th>within_days_365num_25sum</th>
      <th>within_days_365num_25mean</th>
      <th>within_days_365num_50sum</th>
      <th>within_days_365num_50mean</th>
      <th>within_days_365num_75sum</th>
      <th>within_days_365num_75mean</th>
      <th>within_days_365num_985sum</th>
      <th>within_days_365num_985mean</th>
      <th>within_days_365num_100sum</th>
      <th>within_days_365num_100mean</th>
      <th>within_days_9999num_unqsum</th>
      <th>within_days_9999num_unqmean</th>
      <th>within_days_9999num_unqcount</th>
      <th>within_days_9999total_secssum</th>
      <th>within_days_9999total_secsmean</th>
      <th>within_days_9999num_25sum</th>
      <th>within_days_9999num_25mean</th>
      <th>within_days_9999num_50sum</th>
      <th>within_days_9999num_50mean</th>
      <th>within_days_9999num_75sum</th>
      <th>within_days_9999num_75mean</th>
      <th>within_days_9999num_985sum</th>
      <th>within_days_9999num_985mean</th>
      <th>within_days_9999num_100sum</th>
      <th>within_days_9999num_100mean</th>
      <th>total_plan_days</th>
      <th>total_amount_paid</th>
      <th>amount_paid_per_day</th>
      <th>diff_renewal_duration</th>
      <th>diff_plan_amount_paid_per_day</th>
      <th>latest_payment_method_id</th>
      <th>latest_plan_days</th>
      <th>latest_plan_list_price</th>
      <th>latest_amount_paid</th>
      <th>latest_auto_renew</th>
      <th>latest_is_cancel</th>
      <th>latest_amount_paid_per_day</th>
      <th>date_featuresdatemax_date_year</th>
      <th>date_featuresdatemax_date_month</th>
      <th>date_featuresdatemax_date_day</th>
      <th>date_featuresdatemax_date_absday</th>
      <th>date_featuresdatemin_date_year</th>
      <th>date_featuresdatemin_date_month</th>
      <th>date_featuresdatemin_date_day</th>
      <th>date_featuresdatemin_date_absday</th>
      <th>female</th>
      <th>male</th>
      <th>latest_transaction_date_year</th>
      <th>latest_transaction_date_month</th>
      <th>latest_transaction_date_day</th>
      <th>latest_transaction_date_absday</th>
      <th>latest_expire_date_year</th>
      <th>latest_expire_date_month</th>
      <th>latest_expire_date_day</th>
      <th>latest_expire_date_absday</th>
      <th>latest_trans_vs_expire</th>
      <th>latest_trans_vs_log</th>
      <th>latest_log_vs_expire</th>
      <th>registration_time</th>
      <th>predictions</th>
      <th>probability_churn</th>
      <th>proposed_spend</th>
    </tr>
    <tr>
      <th>msno</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>x5+AtzOZKAtnAJBsCIdAyiRl+1p9nIvAYchIkS4zaS4=</th>
      <td>22</td>
      <td>31</td>
      <td>9</td>
      <td>20150202</td>
      <td>748</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>330.174</td>
      <td>330.174</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>179</td>
      <td>44.750000</td>
      <td>4</td>
      <td>41022.435</td>
      <td>10255.608750</td>
      <td>31</td>
      <td>7.750000</td>
      <td>4</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>6</td>
      <td>1.500000</td>
      <td>153</td>
      <td>38.250000</td>
      <td>193</td>
      <td>38.600000</td>
      <td>5</td>
      <td>43158.296</td>
      <td>8631.659200</td>
      <td>34</td>
      <td>6.800000</td>
      <td>11</td>
      <td>2.200000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>6</td>
      <td>1.200000</td>
      <td>158</td>
      <td>31.600000</td>
      <td>275</td>
      <td>22.916667</td>
      <td>12</td>
      <td>59410.879</td>
      <td>4950.906583</td>
      <td>52</td>
      <td>4.333333</td>
      <td>18</td>
      <td>1.500000</td>
      <td>7</td>
      <td>0.583333</td>
      <td>7</td>
      <td>0.583333</td>
      <td>214</td>
      <td>17.833333</td>
      <td>1687</td>
      <td>33.740000</td>
      <td>50</td>
      <td>372126.228</td>
      <td>7442.524560</td>
      <td>371</td>
      <td>7.420000</td>
      <td>79</td>
      <td>1.580000</td>
      <td>52</td>
      <td>1.040000</td>
      <td>50</td>
      <td>1.000000</td>
      <td>1303</td>
      <td>26.060000</td>
      <td>4329</td>
      <td>36.686441</td>
      <td>118</td>
      <td>997354.598</td>
      <td>8452.157610</td>
      <td>719</td>
      <td>6.093220</td>
      <td>137</td>
      <td>1.161017</td>
      <td>92</td>
      <td>0.779661</td>
      <td>118</td>
      <td>1.000000</td>
      <td>3595</td>
      <td>30.466102</td>
      <td>8460</td>
      <td>35.696203</td>
      <td>237</td>
      <td>1947010.556</td>
      <td>8215.234414</td>
      <td>1507</td>
      <td>6.358650</td>
      <td>272</td>
      <td>1.147679</td>
      <td>155</td>
      <td>0.654008</td>
      <td>171</td>
      <td>0.721519</td>
      <td>7136</td>
      <td>30.109705</td>
      <td>21497</td>
      <td>39.883117</td>
      <td>539</td>
      <td>5178191.657</td>
      <td>9607.034614</td>
      <td>3037</td>
      <td>5.634508</td>
      <td>686</td>
      <td>1.272727</td>
      <td>365</td>
      <td>0.677180</td>
      <td>367</td>
      <td>0.680891</td>
      <td>19132</td>
      <td>35.495362</td>
      <td>555</td>
      <td>2682</td>
      <td>4.832432</td>
      <td>0</td>
      <td>0.0</td>
      <td>27</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>0</td>
      <td>4.966667</td>
      <td>2017</td>
      <td>2</td>
      <td>19</td>
      <td>6259</td>
      <td>2015</td>
      <td>2</td>
      <td>2</td>
      <td>5511</td>
      <td>0</td>
      <td>1</td>
      <td>2017</td>
      <td>2</td>
      <td>1</td>
      <td>6241</td>
      <td>2017</td>
      <td>2</td>
      <td>28</td>
      <td>6268</td>
      <td>-27</td>
      <td>-18</td>
      <td>-9</td>
      <td>2015</td>
      <td>0</td>
      <td>0.008569</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>WiVvUGUuxmRviEX69svzHUC/zhpyJZdAm3ZyExXsjHA=</th>
      <td>17</td>
      <td>40</td>
      <td>9</td>
      <td>20071006</td>
      <td>787</td>
      <td>46</td>
      <td>46</td>
      <td>1</td>
      <td>11779.310</td>
      <td>11779.310</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>46</td>
      <td>46</td>
      <td>105</td>
      <td>26.250000</td>
      <td>4</td>
      <td>26890.522</td>
      <td>6722.630500</td>
      <td>2</td>
      <td>0.500000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>2</td>
      <td>0.500000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>104</td>
      <td>26.000000</td>
      <td>145</td>
      <td>20.714286</td>
      <td>7</td>
      <td>36302.890</td>
      <td>5186.127143</td>
      <td>7</td>
      <td>1.000000</td>
      <td>1</td>
      <td>0.142857</td>
      <td>2</td>
      <td>0.285714</td>
      <td>2</td>
      <td>0.285714</td>
      <td>137</td>
      <td>19.571429</td>
      <td>276</td>
      <td>25.090909</td>
      <td>11</td>
      <td>55003.399</td>
      <td>5000.309000</td>
      <td>67</td>
      <td>6.090909</td>
      <td>29</td>
      <td>2.636364</td>
      <td>9</td>
      <td>0.818182</td>
      <td>6</td>
      <td>0.545455</td>
      <td>188</td>
      <td>17.090909</td>
      <td>1425</td>
      <td>24.568966</td>
      <td>58</td>
      <td>322053.197</td>
      <td>5552.641328</td>
      <td>275</td>
      <td>4.741379</td>
      <td>170</td>
      <td>2.931034</td>
      <td>74</td>
      <td>1.275862</td>
      <td>40</td>
      <td>0.689655</td>
      <td>1101</td>
      <td>18.982759</td>
      <td>2771</td>
      <td>23.091667</td>
      <td>120</td>
      <td>596865.459</td>
      <td>4973.878825</td>
      <td>617</td>
      <td>5.141667</td>
      <td>347</td>
      <td>2.891667</td>
      <td>140</td>
      <td>1.166667</td>
      <td>110</td>
      <td>0.916667</td>
      <td>2002</td>
      <td>16.683333</td>
      <td>6125</td>
      <td>26.864035</td>
      <td>228</td>
      <td>1388082.365</td>
      <td>6088.080548</td>
      <td>1567</td>
      <td>6.872807</td>
      <td>538</td>
      <td>2.359649</td>
      <td>255</td>
      <td>1.118421</td>
      <td>229</td>
      <td>1.004386</td>
      <td>4862</td>
      <td>21.324561</td>
      <td>26479</td>
      <td>43.408197</td>
      <td>610</td>
      <td>6661356.419</td>
      <td>10920.256425</td>
      <td>5362</td>
      <td>8.790164</td>
      <td>2650</td>
      <td>4.344262</td>
      <td>1323</td>
      <td>2.168852</td>
      <td>1318</td>
      <td>2.160656</td>
      <td>23024</td>
      <td>37.744262</td>
      <td>543</td>
      <td>2831</td>
      <td>5.213628</td>
      <td>0</td>
      <td>0.0</td>
      <td>39</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>0</td>
      <td>4.966667</td>
      <td>2017</td>
      <td>2</td>
      <td>27</td>
      <td>6267</td>
      <td>2015</td>
      <td>1</td>
      <td>2</td>
      <td>5480</td>
      <td>1</td>
      <td>0</td>
      <td>2017</td>
      <td>1</td>
      <td>31</td>
      <td>6240</td>
      <td>2017</td>
      <td>3</td>
      <td>12</td>
      <td>6280</td>
      <td>-40</td>
      <td>-27</td>
      <td>-13</td>
      <td>2007</td>
      <td>0</td>
      <td>0.001696</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ur0rGRoV2XJOYpNbzl5n/jBEV9PrKDwZX4QeO03gXl8=</th>
      <td>6</td>
      <td>21</td>
      <td>4</td>
      <td>20160822</td>
      <td>189</td>
      <td>36</td>
      <td>36</td>
      <td>1</td>
      <td>9240.939</td>
      <td>9240.939</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>35</td>
      <td>35</td>
      <td>371</td>
      <td>61.833333</td>
      <td>6</td>
      <td>107030.392</td>
      <td>17838.398667</td>
      <td>7</td>
      <td>1.166667</td>
      <td>3</td>
      <td>0.500000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1</td>
      <td>0.166667</td>
      <td>415</td>
      <td>69.166667</td>
      <td>756</td>
      <td>68.727273</td>
      <td>11</td>
      <td>220080.304</td>
      <td>20007.300364</td>
      <td>58</td>
      <td>5.272727</td>
      <td>27</td>
      <td>2.454545</td>
      <td>5</td>
      <td>0.454545</td>
      <td>7</td>
      <td>0.636364</td>
      <td>843</td>
      <td>76.636364</td>
      <td>1766</td>
      <td>65.407407</td>
      <td>27</td>
      <td>590614.385</td>
      <td>21874.606852</td>
      <td>138</td>
      <td>5.111111</td>
      <td>74</td>
      <td>2.740741</td>
      <td>15</td>
      <td>0.555556</td>
      <td>16</td>
      <td>0.592593</td>
      <td>2275</td>
      <td>84.259259</td>
      <td>5486</td>
      <td>66.096386</td>
      <td>83</td>
      <td>1899764.373</td>
      <td>22888.727386</td>
      <td>493</td>
      <td>5.939759</td>
      <td>116</td>
      <td>1.397590</td>
      <td>44</td>
      <td>0.530120</td>
      <td>41</td>
      <td>0.493976</td>
      <td>7351</td>
      <td>88.566265</td>
      <td>11591</td>
      <td>68.994048</td>
      <td>168</td>
      <td>3408784.787</td>
      <td>20290.385637</td>
      <td>1131</td>
      <td>6.732143</td>
      <td>198</td>
      <td>1.178571</td>
      <td>90</td>
      <td>0.535714</td>
      <td>160</td>
      <td>0.952381</td>
      <td>13134</td>
      <td>78.178571</td>
      <td>12290</td>
      <td>69.044944</td>
      <td>178</td>
      <td>3576194.197</td>
      <td>20090.978635</td>
      <td>1290</td>
      <td>7.247191</td>
      <td>205</td>
      <td>1.151685</td>
      <td>99</td>
      <td>0.556180</td>
      <td>178</td>
      <td>1.000000</td>
      <td>13798</td>
      <td>77.516854</td>
      <td>12290</td>
      <td>69.044944</td>
      <td>178</td>
      <td>3576194.197</td>
      <td>20090.978635</td>
      <td>1290</td>
      <td>7.247191</td>
      <td>205</td>
      <td>1.151685</td>
      <td>99</td>
      <td>0.556180</td>
      <td>178</td>
      <td>1.000000</td>
      <td>13798</td>
      <td>77.516854</td>
      <td>210</td>
      <td>1043</td>
      <td>4.966667</td>
      <td>0</td>
      <td>0.0</td>
      <td>39</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>0</td>
      <td>4.966667</td>
      <td>2017</td>
      <td>2</td>
      <td>27</td>
      <td>6267</td>
      <td>2016</td>
      <td>8</td>
      <td>22</td>
      <td>6078</td>
      <td>1</td>
      <td>0</td>
      <td>2017</td>
      <td>1</td>
      <td>31</td>
      <td>6240</td>
      <td>2017</td>
      <td>3</td>
      <td>26</td>
      <td>6294</td>
      <td>-54</td>
      <td>-27</td>
      <td>-27</td>
      <td>2016</td>
      <td>0</td>
      <td>0.001179</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>M/PccoJW/A9myX+eCodcY8Z4LMD1r+d6YKzUNv4PMZo=</th>
      <td>1</td>
      <td>0</td>
      <td>7</td>
      <td>20130610</td>
      <td>789</td>
      <td>15</td>
      <td>15</td>
      <td>1</td>
      <td>3416.639</td>
      <td>3416.639</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>16</td>
      <td>16</td>
      <td>204</td>
      <td>29.142857</td>
      <td>7</td>
      <td>88005.151</td>
      <td>12572.164429</td>
      <td>5</td>
      <td>0.714286</td>
      <td>3</td>
      <td>0.428571</td>
      <td>2</td>
      <td>0.285714</td>
      <td>2</td>
      <td>0.285714</td>
      <td>395</td>
      <td>56.428571</td>
      <td>441</td>
      <td>31.500000</td>
      <td>14</td>
      <td>168815.462</td>
      <td>12058.247286</td>
      <td>52</td>
      <td>3.714286</td>
      <td>31</td>
      <td>2.214286</td>
      <td>20</td>
      <td>1.428571</td>
      <td>6</td>
      <td>0.428571</td>
      <td>735</td>
      <td>52.500000</td>
      <td>781</td>
      <td>26.033333</td>
      <td>30</td>
      <td>303585.197</td>
      <td>10119.506567</td>
      <td>118</td>
      <td>3.933333</td>
      <td>91</td>
      <td>3.033333</td>
      <td>41</td>
      <td>1.366667</td>
      <td>10</td>
      <td>0.333333</td>
      <td>1282</td>
      <td>42.733333</td>
      <td>1984</td>
      <td>27.178082</td>
      <td>73</td>
      <td>581820.141</td>
      <td>7970.138918</td>
      <td>217</td>
      <td>2.972603</td>
      <td>178</td>
      <td>2.438356</td>
      <td>69</td>
      <td>0.945205</td>
      <td>24</td>
      <td>0.328767</td>
      <td>2343</td>
      <td>32.095890</td>
      <td>3501</td>
      <td>25.554745</td>
      <td>137</td>
      <td>932913.407</td>
      <td>6809.586912</td>
      <td>373</td>
      <td>2.722628</td>
      <td>282</td>
      <td>2.058394</td>
      <td>106</td>
      <td>0.773723</td>
      <td>50</td>
      <td>0.364964</td>
      <td>3661</td>
      <td>26.722628</td>
      <td>7250</td>
      <td>26.459854</td>
      <td>274</td>
      <td>1818035.906</td>
      <td>6635.167540</td>
      <td>768</td>
      <td>2.802920</td>
      <td>504</td>
      <td>1.839416</td>
      <td>196</td>
      <td>0.715328</td>
      <td>116</td>
      <td>0.423358</td>
      <td>7089</td>
      <td>25.872263</td>
      <td>17809</td>
      <td>27.440678</td>
      <td>649</td>
      <td>4533034.736</td>
      <td>6984.645202</td>
      <td>1352</td>
      <td>2.083205</td>
      <td>937</td>
      <td>1.443760</td>
      <td>336</td>
      <td>0.517720</td>
      <td>198</td>
      <td>0.305085</td>
      <td>17432</td>
      <td>26.859784</td>
      <td>840</td>
      <td>3631</td>
      <td>4.322619</td>
      <td>0</td>
      <td>0.0</td>
      <td>41</td>
      <td>30</td>
      <td>99</td>
      <td>99</td>
      <td>1</td>
      <td>0</td>
      <td>3.300000</td>
      <td>2017</td>
      <td>2</td>
      <td>28</td>
      <td>6268</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>5479</td>
      <td>0</td>
      <td>0</td>
      <td>2017</td>
      <td>2</td>
      <td>24</td>
      <td>6264</td>
      <td>2017</td>
      <td>3</td>
      <td>25</td>
      <td>6293</td>
      <td>-29</td>
      <td>-4</td>
      <td>-25</td>
      <td>2013</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>BZbN3U+ghA0lwOA34yF/GNHbJb73T48nEZGHc4bcikc=</th>
      <td>9</td>
      <td>31</td>
      <td>9</td>
      <td>20080410</td>
      <td>788</td>
      <td>25</td>
      <td>25</td>
      <td>1</td>
      <td>13113.138</td>
      <td>13113.138</td>
      <td>14</td>
      <td>14</td>
      <td>1</td>
      <td>1</td>
      <td>5</td>
      <td>5</td>
      <td>3</td>
      <td>3</td>
      <td>93</td>
      <td>93</td>
      <td>101</td>
      <td>16.833333</td>
      <td>6</td>
      <td>33808.385</td>
      <td>5634.730833</td>
      <td>29</td>
      <td>4.833333</td>
      <td>2</td>
      <td>0.333333</td>
      <td>12</td>
      <td>2.000000</td>
      <td>6</td>
      <td>1.000000</td>
      <td>165</td>
      <td>27.500000</td>
      <td>157</td>
      <td>13.083333</td>
      <td>12</td>
      <td>48485.571</td>
      <td>4040.464250</td>
      <td>40</td>
      <td>3.333333</td>
      <td>4</td>
      <td>0.333333</td>
      <td>14</td>
      <td>1.166667</td>
      <td>9</td>
      <td>0.750000</td>
      <td>219</td>
      <td>18.250000</td>
      <td>484</td>
      <td>21.043478</td>
      <td>23</td>
      <td>139573.866</td>
      <td>6068.428957</td>
      <td>97</td>
      <td>4.217391</td>
      <td>21</td>
      <td>0.913043</td>
      <td>23</td>
      <td>1.000000</td>
      <td>20</td>
      <td>0.869565</td>
      <td>554</td>
      <td>24.086957</td>
      <td>1416</td>
      <td>22.838710</td>
      <td>62</td>
      <td>380409.666</td>
      <td>6135.639774</td>
      <td>213</td>
      <td>3.435484</td>
      <td>51</td>
      <td>0.822581</td>
      <td>50</td>
      <td>0.806452</td>
      <td>59</td>
      <td>0.951613</td>
      <td>1583</td>
      <td>25.532258</td>
      <td>4484</td>
      <td>30.093960</td>
      <td>149</td>
      <td>1179486.041</td>
      <td>7916.013698</td>
      <td>791</td>
      <td>5.308725</td>
      <td>162</td>
      <td>1.087248</td>
      <td>143</td>
      <td>0.959732</td>
      <td>259</td>
      <td>1.738255</td>
      <td>4752</td>
      <td>31.892617</td>
      <td>8142</td>
      <td>26.607843</td>
      <td>306</td>
      <td>2174747.697</td>
      <td>7107.018618</td>
      <td>1684</td>
      <td>5.503268</td>
      <td>343</td>
      <td>1.120915</td>
      <td>312</td>
      <td>1.019608</td>
      <td>519</td>
      <td>1.696078</td>
      <td>8373</td>
      <td>27.362745</td>
      <td>12775</td>
      <td>20.942623</td>
      <td>610</td>
      <td>3287076.077</td>
      <td>5388.649307</td>
      <td>2773</td>
      <td>4.545902</td>
      <td>602</td>
      <td>0.986885</td>
      <td>543</td>
      <td>0.890164</td>
      <td>926</td>
      <td>1.518033</td>
      <td>12292</td>
      <td>20.150820</td>
      <td>480</td>
      <td>3278</td>
      <td>6.829167</td>
      <td>0</td>
      <td>0.0</td>
      <td>34</td>
      <td>30</td>
      <td>149</td>
      <td>149</td>
      <td>1</td>
      <td>0</td>
      <td>4.966667</td>
      <td>2017</td>
      <td>2</td>
      <td>27</td>
      <td>6267</td>
      <td>2015</td>
      <td>1</td>
      <td>1</td>
      <td>5479</td>
      <td>1</td>
      <td>0</td>
      <td>2017</td>
      <td>2</td>
      <td>28</td>
      <td>6268</td>
      <td>2017</td>
      <td>3</td>
      <td>31</td>
      <td>6299</td>
      <td>-31</td>
      <td>1</td>
      <td>-32</td>
      <td>2008</td>
      <td>0</td>
      <td>0.000204</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>

<h3>Validation</h3>
<p>We're working out the following to make sure that the nubmers for the reacquistion marketing spend make sense in the context of our business:
    * Total marketing spend
    * Marketing spend per customer (all customers)
    * Marketing spend per customer with probability of churn (indicated as churn by the model)
    * Comparison with the earnings from the sample</p>
<div class="highlight"><pre><span></span><span class="c1"># Validation</span>
<span class="c1"># What is the total proposed marketing spend? </span>
<span class="n">tpms</span> <span class="o">=</span> <span class="n">marketing_data</span><span class="p">[</span><span class="s1">&#39;proposed_spend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1"># Averaging (per user)</span>
<span class="n">tpmsa</span> <span class="o">=</span> <span class="n">tpms</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
<span class="c1"># Averaging (for users marked for churn)</span>
<span class="n">ch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
<span class="n">tpmsac</span> <span class="o">=</span> <span class="n">tpms</span><span class="o">/</span><span class="n">ch</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Total proposed marketing spend (NTD): NT$</span><span class="si">{:,.0f}</span><span class="s1"></span>
<span class="s1">Total number of users in the sample: </span><span class="si">{:d}</span><span class="s1"></span>
<span class="s1">Average Reacquisition/retention marketing spend/user (NTD): NT$</span><span class="si">{:,.4f}</span><span class="s1"></span>
<span class="s1">Total number of users projected to churn (any probability): </span><span class="si">{:d}</span><span class="s1"></span>
<span class="s1">Average Reacquisition/rention marketing spend for users marked to churn (NTD): NT$</span><span class="si">{:,.4f}</span><span class="s1"></span>

<span class="s1">&#39;&#39;&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tpms</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">),</span> <span class="n">tpmsa</span><span class="p">,</span> <span class="n">ch</span><span class="p">,</span>  <span class="n">tpmsac</span><span class="p">)</span>
     <span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Total proposed marketing spend (NTD): NT$77,025</span>
<span class="err">Total number of users in the sample: 11681</span>
<span class="err">Average Reacquisition/retention marketing spend/user (NTD): NT$6.5940</span>
<span class="err">Total number of users projected to churn (any probability): 705</span>
<span class="err">Average Reacquisition/rention marketing spend for users marked to churn (NTD): NT$109.2551</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Validation</span>
<span class="c1"># How does the marketing spend compare to the projected earnings from this sample</span>

<span class="c1"># Ratio of marketing(per user) to topline for this sample</span>
<span class="n">rms</span> <span class="o">=</span> <span class="p">(</span><span class="n">tpms</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">))</span><span class="o">/</span><span class="n">altv3y</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Projected 3 year earnings from users in dev data (per user) (NTD): NT$</span><span class="si">{:,.4f}</span><span class="s1"></span>
<span class="s1">Ratio of Reacquistion/Retention marketing to topline from users in dev data: </span><span class="si">{:.4f}</span><span class="s1"></span>

<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">altv3y</span><span class="p">,</span> <span class="n">rms</span><span class="p">)</span>
     <span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Projected 3 year earnings from users in dev data (per user) (NTD): NT$4,975.1425</span>
<span class="err">Ratio of Reacquistion/Retention marketing to topline from users in dev data: 0.0013</span>
</pre></div>


<h4>Visual for marketing spend - amoung spent/day by all the customers</h4>
<div class="highlight"><pre><span></span><span class="c1"># Marketing spend - amount spent/day by the users</span>
<span class="c1"># plt.scatter(marketing_data[&#39;amount_paid_per_day&#39;], marketing_data[&#39;proposed_spend&#39;], s=4,</span>
           <span class="c1">#c=cm.hot(marketing_data[&#39;proposed_spend&#39;]))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Amount paid per day by a customer (NTD)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Proposed retention marketing spend per customer (NTD)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Retention marketing spend - Amount paid per day by a customer&#39;</span><span class="p">)</span>    
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">marketing_data</span><span class="p">[</span><span class="s1">&#39;amount_paid_per_day&#39;</span><span class="p">],</span> <span class="n">marketing_data</span><span class="p">[</span><span class="s1">&#39;proposed_spend&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img src="images/churn/output_190_0.png" alt="Drawing" style="width: 750px;"/></p>
<p>The plot above looks at proposed retention spend by customer against the amount paid per day by customer. Some scatter exists in the plot showing that not all members at a specific NTD/day price level are equal in terms of risk of churn. The proposed retention spend is calculated over the three year (assumed lifetime) of the customer (so at a level of 100 NTD, the proposed incentive per day would be ~0.09 NTD). </p>
<h4>Visual for marketing spend in the context of the total number of customers</h4>
<div class="highlight"><pre><span></span><span class="c1"># Visual of spend in context of the number of users</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Proposed retention marketing spend spread among all customers&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Proposed retention marketing spend per customer&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of customers&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">marketing_data</span><span class="p">[</span><span class="s1">&#39;proposed_spend&#39;</span><span class="p">]</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img src="images/churn/output_193_0.png" alt="Drawing" style="width: 750px;"/></p>
<p>From the plot above, we can see that for most users, the proposed spend is 0, due to the predicted probability that they won't churn, and therefore no incentives should be offered. This makes economic sense as our dataset only contains 6% churn, and we cannot afford to offer incentives to too many members if their unlikely to churn. </p>
<p>We do see that there is some data for proposed spend between 50-150 which is consistent with the former scatter plot, however overwhemingly the proposed spend on a customer is 0 NTD (New Taiwan Dollar). </p>
<h4>Visual for marketing spend per user</h4>
<div class="highlight"><pre><span></span><span class="c1">#Scatter Plot to Show Proposed Spend per User</span>
<span class="n">sorted_marketing</span> <span class="o">=</span> <span class="n">marketing_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;proposed_spend&#39;</span><span class="p">)</span>
<span class="n">sorted_marketing</span> <span class="o">=</span> <span class="n">sorted_marketing</span><span class="p">[</span><span class="n">sorted_marketing</span><span class="p">[</span><span class="s1">&#39;proposed_spend&#39;</span><span class="p">]</span> <span class="o">&gt;</span><span class="mf">0.0</span><span class="p">][</span><span class="s1">&#39;proposed_spend&#39;</span><span class="p">]</span>
<span class="n">sorted_marketing</span> <span class="o">=</span> <span class="n">sorted_marketing</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sorted_marketing</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">sorted_marketing</span><span class="p">[</span><span class="s1">&#39;proposed_spend&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Member - re-indexed to integer for plotting purposes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Maximum proposed spend on each user (NTD)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sorted proposed spend on user over 3 year lifetime&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Text(0.5,1,&#39;Sorted proposed spend on user over 3 year lifetime&#39;)</span>
</pre></div>


<p><img src="images/churn/output_196_1.png" alt="Drawing" style="width: 750px;"/></p>
<p>The plot above looks at the sorted proposed spend for users. The plot has been sorted in order to determine if there are any insights that can be made by looking at proposed spend levels. We can see near the 85 NTD (New Taiwan Dollar) mark there is a slight plateau, which could indicate a good level of incentive to offer users. </p>
<p>Beyond the slight plateau the maximum proposed spend appears to increase approximately linearly over the range of 75 to 130 NTD. Indication from this plot shows that users who's proposed spend is &gt;130 may not be worthwhile pursuing due to the high cost of incentives. </p>
<p>The proposed spend is the maximum spend allocated over the customer lifetime (assumed 3 years) and would be distributed through discounts and incentives. It may be possible to prevent churn by offering less than this maximum spend amount, which is an opportunity for a future ML model. </p>
<div class="highlight"><pre><span></span><span class="c1"># Recap of key metrics</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">------&gt; Key metrics from the model:</span>

<span class="s1">Total number of users in the sample: </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">Total number of users projected to churn (any probability): </span><span class="si">{}</span><span class="s1"></span>

<span class="s1">Total proposed marketing spend: NT$</span><span class="si">{:,.0f}</span><span class="s1"></span>
<span class="s1">Total revenue (3 year) from all users in the sample: NT$</span><span class="si">{:,.0f}</span><span class="s1"></span>
<span class="s1">Total revenue (3 year) from users at risk in the sample: NT$</span><span class="si">{:,.0f}</span><span class="s1"></span>

<span class="s1">Average Reacquisition/retention marketing spend/user: </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">Average Reacquisition/retention marketing spend for users marked to churn: </span><span class="si">{}</span><span class="s1"></span>

<span class="s1">Ratio of Reacquistion marketing spend to revenue from all users: </span><span class="si">{:.4f}</span><span class="s1"></span>
<span class="s1">Ratio of Reacquistion marketing spend to reveuene from at risk users: </span><span class="si">{:.4f}</span><span class="s1"></span>

<span class="s1">&#39;&#39;&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">),</span> <span class="n">ch</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">tpms</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">altv3y</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">)),</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">altv3y</span><span class="o">*</span><span class="n">ch</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">tpmsa</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">tpmsac</span><span class="p">),</span>
           <span class="n">tpms</span><span class="o">/</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">altv3y</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">))),</span>
           <span class="n">tpms</span><span class="o">/</span><span class="nb">int</span><span class="p">(</span><span class="n">altv3y</span><span class="o">*</span><span class="n">ch</span><span class="p">)</span> <span class="p">)</span>
     <span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">------&gt; Key metrics from the model:</span>

<span class="n">Total</span> <span class="nb">number</span> <span class="k">of</span> <span class="n">users</span> <span class="k">in</span> <span class="n">the</span> <span class="n">sample</span><span class="p">:</span> <span class="mi">11681</span>
<span class="n">Total</span> <span class="nb">number</span> <span class="k">of</span> <span class="n">users</span> <span class="n">projected</span> <span class="k">to</span> <span class="n">churn</span> <span class="p">(</span><span class="k">any</span> <span class="n">probability</span><span class="p">):</span> <span class="mi">705</span>

<span class="n">Total</span> <span class="n">proposed</span> <span class="n">marketing</span> <span class="n">spend</span><span class="p">:</span> <span class="n">NT$77</span><span class="p">,</span><span class="mi">024</span>
<span class="n">Total</span> <span class="n">revenue</span> <span class="p">(</span><span class="mi">3</span> <span class="k">year</span><span class="p">)</span> <span class="k">from</span> <span class="k">all</span> <span class="n">users</span> <span class="k">in</span> <span class="n">the</span> <span class="n">sample</span><span class="p">:</span> <span class="n">NT$58</span><span class="p">,</span><span class="mi">114</span><span class="p">,</span><span class="mi">639</span>
<span class="n">Total</span> <span class="n">revenue</span> <span class="p">(</span><span class="mi">3</span> <span class="k">year</span><span class="p">)</span> <span class="k">from</span> <span class="n">users</span> <span class="k">at</span> <span class="n">risk</span> <span class="k">in</span> <span class="n">the</span> <span class="n">sample</span><span class="p">:</span> <span class="n">NT$3</span><span class="p">,</span><span class="mi">507</span><span class="p">,</span><span class="mi">475</span>

<span class="n">Average</span> <span class="n">Reacquisition</span><span class="o">/</span><span class="n">retention</span> <span class="n">marketing</span> <span class="n">spend</span><span class="o">/</span><span class="k">user</span><span class="p">:</span> <span class="mi">6</span>
<span class="n">Average</span> <span class="n">Reacquisition</span><span class="o">/</span><span class="n">retention</span> <span class="n">marketing</span> <span class="n">spend</span> <span class="k">for</span> <span class="n">users</span> <span class="n">marked</span> <span class="k">to</span> <span class="n">churn</span><span class="p">:</span> <span class="mi">109</span>

<span class="n">Ratio</span> <span class="k">of</span> <span class="n">Reacquistion</span> <span class="n">marketing</span> <span class="n">spend</span> <span class="k">to</span> <span class="n">revenue</span> <span class="k">from</span> <span class="k">all</span> <span class="n">users</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0013</span>
<span class="n">Ratio</span> <span class="k">of</span> <span class="n">Reacquistion</span> <span class="n">marketing</span> <span class="n">spend</span> <span class="k">to</span> <span class="n">reveuene</span> <span class="k">from</span> <span class="k">at</span> <span class="n">risk</span> <span class="n">users</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0220</span>
</pre></div>


<h2>Economic Impact Summary</h2>
<p>We're able to create a very usable model for the retention/reacquistion effort in the business.  In summary, of our NT\$58M 3-year revenue from our customer base, we estimate we will lose NT\$3.5M to churn.  Accounting for the probability that users will actually churn, the team recommends spending NT\$77K on trying to retain these users.  In the marketing data, the NT\$77K is broken down by user, however, we would recommend a discount program with a few tiers, as opposed to custom offers for every user.</p>
<p>The marketing data base keeps most original customer parameters and adds the following for use in business planning:</p>
<ul>
<li>predictions - Will the customer churn (1 will churn)</li>
<li>predctions_prob - What's the probability of the customer leaving (Higher is bad)</li>
<li>proposed_spend - We can spend up to this value to keep this customer</li>
</ul>
<p>Our calculations (mostly for validation in the report) show that the retention marketing spend is inline with the revenue opportunity for the business. Key metrics are calculated again above.</p>
<p>One caveat to our assertion is effectiveness of reacquistion marketing spend. Feedback on that could influence the value of our spend as we put the model into production.</p>
<p>Another thing to note in our model is that we're proposing a spend for every customer at risk. Reality may be that we cannot save customers above 80% probability of churn. Should we invest in these users?</p>
<h1>6. Final Insights and Takeaways</h1>
<p>Here are our insights and commentary from our analysis:</p>
<h2>Predictive Modeling Summary and Future Considerations</h2>
<p>As discussed in the modeling section, the final model had a recall performance of 98.3% (on the test data), correctly predicting almost every user who actually churned (408 of 415 users), and also correctly predicting amost every user who would actually stay (6,444 of 6,609 users).</p>
<p>Given the strong performance of the current model, any future enhancements would need to balance the cost of making those enhancements against the potential benefits of retaining a few more users.  That said, the team thinks the best place to find additional gains in the model is by engineering additional features from the users, potentially from reviewing user listening habits such as music genre.</p>
<h2>Economic Impact</h2>
<p>We created and validated a model to guide retention program spending for customers at the risk of churn (<strong>RAC = .75 * CAC * POC * (LTV/OLTV)</strong> where RAC is the Reacquistion cost or retention spending/customer, CAC is the cost of customer acquistion, LTV is the lifetime value of a customer and OLTV is the optimum lifetime value (the revenue from our best customer). </p>
<p>The model works with a spend ceiling (Customer acquisiton cost) that's about 10% of the lifetime value of an average customer. We stay below this limit by reducing the amount by value of the customer and her probability of churn. </p>
<p>A sample run with our development data shows a total marketing spend between 77K to protect ~3.5 M of revenue. The model shows how this amount can be divvied up among the customers (in the marketing data frame).</p>
<p>A production version of this model can guide the business on both the candidates and amount for retention spending among the customer base.</p>
<h2>Productization and Future Development</h2>
<h3>Implementation as a pipeline, performance testing and feedback loop</h3>
<p>Our assessment is that at least the following would have to be done to put the model into production:</p>
<div class="highlight"><pre><span></span><span class="o">*</span> <span class="k">Implementation</span> <span class="k">as</span> <span class="n">a</span> <span class="n">pipeline</span><span class="p">:</span> <span class="n">The</span> <span class="n">model</span> <span class="k">is</span> <span class="n">quite</span> <span class="n">efficient</span> <span class="k">and</span> <span class="n">can</span> <span class="n">be</span> <span class="n">implemented</span> <span class="n">offline</span> <span class="k">or</span> <span class="n">a</span> <span class="n">near</span> <span class="n">realtime</span> <span class="k">implementation</span>
    <span class="o">*</span><span class="k">For</span> <span class="n">a</span> <span class="n">offline</span> <span class="k">implementation</span><span class="p">,</span> <span class="k">data</span> <span class="n">can</span> <span class="n">be</span> <span class="n">picked</span> <span class="n">up</span> <span class="k">from</span> <span class="n">backup</span> <span class="n">databases</span> <span class="k">and</span> <span class="n">pumped</span> <span class="k">into</span> <span class="n">a</span> <span class="k">system</span> <span class="k">like</span> <span class="n">HDFS</span><span class="p">.</span> <span class="n">Calculations</span> <span class="k">on</span> <span class="n">predictions</span> <span class="n">can</span> <span class="k">then</span> <span class="n">be</span> <span class="n">done</span> <span class="k">by</span> <span class="n">compute</span> <span class="k">on</span> <span class="n">Hadoop</span> <span class="k">or</span> <span class="n">an</span> <span class="n">application</span> <span class="k">like</span> <span class="n">SPARK</span>   
    <span class="o">*</span><span class="n">A</span> <span class="k">new</span> <span class="n">realtime</span> <span class="n">pipeline</span> <span class="n">can</span> <span class="n">be</span> <span class="n">built</span> <span class="k">by</span> <span class="n">duplicating</span> <span class="k">usage</span> <span class="k">and</span> <span class="n">transaction</span> <span class="n">events</span> <span class="k">to</span> <span class="n">a</span> <span class="n">KAFKA</span><span class="c1">---&gt;SPARK---&gt;HDFS pipeline for writing and then batch processing similar to above</span>

<span class="o">*</span><span class="n">Performance</span> <span class="n">testing</span><span class="p">:</span> <span class="n">Further</span> <span class="n">performance</span> <span class="n">testing</span> <span class="k">is</span> <span class="n">recommended</span> <span class="k">for</span> <span class="k">both</span> <span class="n">an</span> <span class="n">offline</span> <span class="k">or</span> <span class="n">realtime</span> <span class="n">pipeline</span><span class="p">.</span> <span class="n">Our</span> <span class="n">testing</span> <span class="n">was</span> <span class="k">with</span> <span class="n">a</span> <span class="n">small</span> <span class="n">subset</span> <span class="k">on</span> <span class="n">a</span> <span class="n">laptop</span> <span class="k">and</span> <span class="n">may</span> <span class="k">not</span> <span class="n">reflect</span> <span class="n">the</span> <span class="n">needs</span> <span class="k">of</span> <span class="n">the</span> <span class="n">enterprise</span>

<span class="o">*</span><span class="n">Feedback</span> <span class="n">loop</span><span class="p">:</span> <span class="n">A</span> <span class="n">feedback</span> <span class="n">loop</span> <span class="k">and</span> <span class="n">experiments</span> <span class="k">for</span> <span class="n">following</span> <span class="n">could</span> <span class="n">increase</span> <span class="n">the</span> <span class="n">efficacy</span> <span class="k">of</span> <span class="n">the</span> <span class="n">model</span>
    <span class="o">*</span><span class="n">Predictions</span><span class="p">:</span> <span class="n">Feedback</span> <span class="k">on</span> <span class="n">predictions</span> <span class="n">can</span> <span class="n">be</span> <span class="n">implemented</span> <span class="k">by</span> <span class="k">having</span> <span class="n">a</span> <span class="n">small</span> <span class="n">control</span> <span class="k">group</span> <span class="k">where</span> <span class="n">we</span> <span class="k">do</span> <span class="k">not</span> <span class="n">use</span> <span class="n">our</span> <span class="n">retention</span> <span class="n">methods</span>
    <span class="o">*</span><span class="n">Retention</span> <span class="n">spending</span><span class="p">:</span> <span class="n">Feedback</span> <span class="k">on</span> <span class="n">our</span> <span class="n">retention</span> <span class="n">methods</span> <span class="n">can</span> <span class="n">directly</span> <span class="n">come</span> <span class="k">from</span> <span class="n">the</span> <span class="k">group</span> <span class="k">on</span> <span class="n">which</span> <span class="n">we</span> <span class="k">are</span> <span class="k">using</span> <span class="n">the</span> <span class="n">methods</span><span class="p">.</span> <span class="k">In</span> <span class="n">the</span> <span class="n">simplest</span> <span class="k">case</span> <span class="n">we</span><span class="err">&#39;</span><span class="n">ll</span> <span class="n">just</span> <span class="n">have</span> <span class="k">to</span> <span class="n">find</span> <span class="k">out</span> <span class="k">if</span> <span class="n">the</span> <span class="n">customer</span> <span class="n">stayed</span> <span class="k">with</span> <span class="n">the</span> <span class="n">service</span>
    <span class="o">*</span><span class="n">Models</span> <span class="k">and</span> <span class="n">calibration</span><span class="p">:</span> <span class="n">Testing</span> <span class="k">and</span> <span class="n">calibration</span> <span class="n">would</span> <span class="n">be</span> <span class="n">needed</span> <span class="n">about</span> <span class="n">once</span> <span class="k">in</span> <span class="n">a</span> <span class="n">Q</span>
</pre></div>


<p>The goal of above would be to maintain or improve the performance vs accuracy/recall for the model while rolling it out to growing customer cohorts. From this analysis, we hope to provide insight into customers that have a potential to churn, and recommend incentives for those customers to prevent churn. We believe that the future work listed above will help to make a significant impact in business operations which will generate more revenue and profit for the company.</p>
<p>An additional topic that could be explored in the future is understanding at what incentive level a user won't churn. Here we present the maximum incentive spend (over a 3 year span) for a customer, however from a business sens we would like to offer the minimum incentive to prevent churn. This model can build on what has alredy been developed here and will require additional data to capture incentives that have previously been offered and the outcome of the offering. </p>
<h1>Initial Data Filter and QC</h1>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">google.datalab.bigquery</span> <span class="k">as</span> <span class="nn">bq</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>


<p>Pasted here is the code that was initially ran. As mentioned in the report, our dataset is large (~31GB combined tables) and couldn't all be ran on a single computer. For the sake of this analysis, we have filtered the data down to a mangageable size (~1.5GB). Additionally, we saw initially that our dataset contained only 6% churn. In order to help improve our model, we wanted to have a filtered dataset that contained a 50/50 split between churn and not churn. </p>
<p>The methodology to get this data into a useable format was the following:
    - Upload data into google cloud storage
    - Utilize Google BigQuery to run SQL statement against the datasets
    - Export the datasets as CSV files to be managed locally</p>
<p>For our dataset we wanted to have approximately 100k members (total dataset size is ~993k members so approximately 10% of our data). Utilizing a 50/50 split we therefore wantedk 50k members who did churn and 50k members who didn't churn. In order to filter the tables we first ran a query to get 50k members who did churn in the labels table:</p>
<div class="highlight"><pre><span></span><span class="err">SELECT * FROM [w207_kkbox_bq_data.labels] WHERE (RAND(5) &lt; 50000/(SELECT COUNT(*) FROM [w207_kkbox_bq_data.labels] WHERE is_churn = 0) AND is_churn = 0)</span>
<span class="err">SELECT * FROM [w207_kkbox_bq_data.labels] WHERE (RAND(5) &lt; 50000/(SELECT COUNT(*) FROM [w207_kkbox_bq_data.labels] WHERE is_churn = 0) AND is_churn = 1)</span>
</pre></div>


<p>These two tables were written to cloud storage and provided the baseline of the members that we would keep when querying other tables. The labels table contains member ID as well as the is_churn (dependent) variable. We now utilize these two tables to query the other datasets joining on the members ID [we kept these two tables separate and then combined the is_churn = 0 and is_churn = 1 into a combined table at the end, in hindsight it would have been more efficient to combine the labels table first]. </p>
<p>Members Table:</p>
<div class="highlight"><pre><span></span><span class="err">SELECT members.*  FROM [w207_kkbox_bq_data.members] as members INNER JOIN [w207_kkbox_bq_data.labels_filtered_50k_churn_1] as lab ON members.msno = lab.msno</span>
<span class="err">SELECT members.*  FROM [w207_kkbox_bq_data.members] as members INNER JOIN [w207_kkbox_bq_data.labels_filtered_50k_churn_0] as lab ON members.msno = lab.msno</span>
</pre></div>


<p>Transactions Table:</p>
<div class="highlight"><pre><span></span><span class="err">SELECT transactions.*  FROM [w207_kkbox_bq_data.transactions] as transactions INNER JOIN [w207_kkbox_bq_data.labels_filtered_50k_churn_0] as lab ON transactions.msno = lab.msno</span>
<span class="err">SELECT transactions.*  FROM [w207_kkbox_bq_data.transactions] as transactions INNER JOIN [w207_kkbox_bq_data.labels_filtered_50k_churn_1] as lab ON transactions.msno = lab.msno</span>
</pre></div>


<p>User_Logs Table:</p>
<div class="highlight"><pre><span></span><span class="err">    SELECT user_logs.*  FROM [w207_kkbox_bq_data.user_logs] as user_logs INNER JOIN [w207_kkbox_bq_data.labels_filtered_50k_churn_1] as lab ON user_logs.msno = lab.msno</span>
<span class="err">    SELECT user_logs.*  FROM [w207_kkbox_bq_data.user_logs] as user_logs INNER JOIN [w207_kkbox_bq_data.labels_filtered_50k_churn_0] as lab ON user_logs.msno = lab.msno</span>
</pre></div>


<p>With this methodology there was two tables (is_churn = 0 and is_churn = 1) for each table in the original dataset. We then combined/appended the two tables back into a singular table and exported to csv (labels_filtered.csv, members_filtered.csv, transactions_filtered.csv, user_logs_filtered.csv). From these local files we then began development towards predcting churn. </p>
<p>While we moved ahead with this filtered dataset, we also wanted to perform quick EDA on the entire dataset to the filtered dataset, to compare and contrast some of the features in the dataset. We understand that we artificially inflated the is_churn = 1 statistic for purposes of model training, therefore there will be some changes between the filtered and original dataset. </p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">bq</span> <span class="n">query</span> <span class="o">--</span><span class="n">name</span> <span class="n">is_churn_large</span>
<span class="n">SELECT</span> <span class="n">SUM</span><span class="p">(</span><span class="n">is_churn</span><span class="p">)</span> <span class="o">/</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">is_churn</span><span class="p">)</span>
<span class="n">FROM</span> <span class="err">`</span><span class="n">w207_kkbox_bq_data</span><span class="o">.</span><span class="n">labels</span><span class="err">`</span> <span class="n">AS</span> <span class="n">labels</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">is_churn_large</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>


<div class="bqtv" id="10_152436758645"><table><tr><th>f0_</th></tr><tr><td>0.06392287077349786</td></tr></table></div>

<p><br />(rows: 1, time: 0.3s, cached, job: job_WFvTJUNTiVU0lg8eZM7HiKzbFhYR)<br />
<script src="/static/components/requirejs/require.js"></script>
<script>
  require.config({
    paths: {
      base: '/static/base',
      d3: '//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3',
      plotly: 'https://cdn.plot.ly/plotly-1.5.1.min.js?noext',
      jquery: '//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min'
    },
    map: {
      '*': {
        datalab: 'nbextensions/gcpdatalab'
      }
    },
    shim: {
      plotly: {
        deps: ['d3', 'jquery'],
        exports: 'plotly'
      }
    }
  });</p>
<p>require(['datalab/charting', 'datalab/element!10_152436758645', 'base/js/events',
      'datalab/style!/nbextensions/gcpdatalab/charting.css'],
    function(charts, dom, events) {
      charts.render('gcharts', dom, events, 'table', [], {"rows": [{"c": [{"v": 0.06392287077349786}]}], "cols": [{"label": "f0_", "id": "f0_", "type": "number"}]},
        {
          pageSize: 25,
          cssClassNames:  {
            tableRow: 'gchart-table-row',
            headerRow: 'gchart-table-headerrow',
            oddTableRow: 'gchart-table-oddrow',
            selectedTableRow: 'gchart-table-selectedrow',
            hoverTableRow: 'gchart-table-hoverrow',
            tableCell: 'gchart-table-cell',
            headerCell: 'gchart-table-headercell',
            rowNumberCell: 'gchart-table-rownumcell'
          }
        },
        {source_index: 0, fields: 'f0_'},
        0,
        1);
    }
  );
</script></p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">bq</span> <span class="n">query</span> <span class="o">--</span><span class="n">name</span> <span class="n">is_churn_small</span>
<span class="n">SELECT</span> <span class="n">SUM</span><span class="p">(</span><span class="n">is_churn</span><span class="p">)</span> <span class="o">/</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">is_churn</span><span class="p">)</span>
<span class="n">FROM</span> <span class="err">`</span><span class="n">w207_kkbox_bq_data</span><span class="o">.</span><span class="n">labels_filtered_100k</span><span class="err">`</span> <span class="n">AS</span> <span class="n">labels</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">is_churn_small</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>


<div class="bqtv" id="11_152436758857"><table><tr><th>f0_</th></tr><tr><td>0.5005559729526672</td></tr></table></div>

<p><br />(rows: 1, time: 0.1s, cached, job: job_6qccT3EvuDYAbLt8e7bMXy_rQuJC)<br />
<script src="/static/components/requirejs/require.js"></script>
<script>
  require.config({
    paths: {
      base: '/static/base',
      d3: '//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3',
      plotly: 'https://cdn.plot.ly/plotly-1.5.1.min.js?noext',
      jquery: '//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min'
    },
    map: {
      '*': {
        datalab: 'nbextensions/gcpdatalab'
      }
    },
    shim: {
      plotly: {
        deps: ['d3', 'jquery'],
        exports: 'plotly'
      }
    }
  });</p>
<p>require(['datalab/charting', 'datalab/element!11_152436758857', 'base/js/events',
      'datalab/style!/nbextensions/gcpdatalab/charting.css'],
    function(charts, dom, events) {
      charts.render('gcharts', dom, events, 'table', [], {"rows": [{"c": [{"v": 0.5005559729526672}]}], "cols": [{"label": "f0_", "id": "f0_", "type": "number"}]},
        {
          pageSize: 25,
          cssClassNames:  {
            tableRow: 'gchart-table-row',
            headerRow: 'gchart-table-headerrow',
            oddTableRow: 'gchart-table-oddrow',
            selectedTableRow: 'gchart-table-selectedrow',
            hoverTableRow: 'gchart-table-hoverrow',
            tableCell: 'gchart-table-cell',
            headerCell: 'gchart-table-headercell',
            rowNumberCell: 'gchart-table-rownumcell'
          }
        },
        {source_index: 9, fields: 'f0_'},
        0,
        1);
    }
  );
</script></p>
<p>Here we look at the proportion of is_churn data. We can see that we manipulated the churn percentage in the filtered dataset. This was intentional in order to create an approximate even split between is churn and is_not_churn to benefit the model training and increase the number of examples of is_churn (since our original dataset only contains 6% is_churn). </p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">bq</span> <span class="n">query</span> <span class="o">--</span><span class="n">name</span> <span class="n">cities</span>
<span class="n">SELECT</span> <span class="n">city</span><span class="p">,</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">msno</span><span class="p">)</span> <span class="n">AS</span> <span class="n">population</span>
<span class="n">FROM</span> <span class="err">`</span><span class="n">w207_kkbox_bq_data</span><span class="o">.</span><span class="n">members</span><span class="err">`</span> 
<span class="n">GROUP</span> <span class="n">BY</span> <span class="n">city</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">cities</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>


<div class="bqtv" id="12_152436759069"><table><tr><th>city</th><th>population</th></tr><tr><td>1</td><td>4804326</td></tr><tr><td>5</td><td>385069</td></tr><tr><td>9</td><td>47639</td></tr><tr><td>6</td><td>135200</td></tr><tr><td>4</td><td>246848</td></tr><tr><td>13</td><td>320978</td></tr><tr><td>22</td><td>210407</td></tr><tr><td>14</td><td>89940</td></tr><tr><td>8</td><td>45975</td></tr><tr><td>15</td><td>190213</td></tr><tr><td>17</td><td>27772</td></tr><tr><td>10</td><td>32482</td></tr><tr><td>11</td><td>47489</td></tr><tr><td>18</td><td>38039</td></tr><tr><td>12</td><td>66843</td></tr><tr><td>16</td><td>5092</td></tr><tr><td>21</td><td>30837</td></tr><tr><td>7</td><td>11610</td></tr><tr><td>3</td><td>27282</td></tr><tr><td>19</td><td>1199</td></tr><tr><td>20</td><td>4233</td></tr></table></div>

<p><br />(rows: 21, time: 0.1s, cached, job: job_VRruJOzjmzBAePlRp8ei86w2l3uB)<br />
<script src="/static/components/requirejs/require.js"></script>
<script>
  require.config({
    paths: {
      base: '/static/base',
      d3: '//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3',
      plotly: 'https://cdn.plot.ly/plotly-1.5.1.min.js?noext',
      jquery: '//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min'
    },
    map: {
      '*': {
        datalab: 'nbextensions/gcpdatalab'
      }
    },
    shim: {
      plotly: {
        deps: ['d3', 'jquery'],
        exports: 'plotly'
      }
    }
  });</p>
<p>require(['datalab/charting', 'datalab/element!12_152436759069', 'base/js/events',
      'datalab/style!/nbextensions/gcpdatalab/charting.css'],
    function(charts, dom, events) {
      charts.render('gcharts', dom, events, 'table', [], {"rows": [{"c": [{"v": 1}, {"v": 4804326}]}, {"c": [{"v": 5}, {"v": 385069}]}, {"c": [{"v": 9}, {"v": 47639}]}, {"c": [{"v": 6}, {"v": 135200}]}, {"c": [{"v": 4}, {"v": 246848}]}, {"c": [{"v": 13}, {"v": 320978}]}, {"c": [{"v": 22}, {"v": 210407}]}, {"c": [{"v": 14}, {"v": 89940}]}, {"c": [{"v": 8}, {"v": 45975}]}, {"c": [{"v": 15}, {"v": 190213}]}, {"c": [{"v": 17}, {"v": 27772}]}, {"c": [{"v": 10}, {"v": 32482}]}, {"c": [{"v": 11}, {"v": 47489}]}, {"c": [{"v": 18}, {"v": 38039}]}, {"c": [{"v": 12}, {"v": 66843}]}, {"c": [{"v": 16}, {"v": 5092}]}, {"c": [{"v": 21}, {"v": 30837}]}, {"c": [{"v": 7}, {"v": 11610}]}, {"c": [{"v": 3}, {"v": 27282}]}, {"c": [{"v": 19}, {"v": 1199}]}, {"c": [{"v": 20}, {"v": 4233}]}], "cols": [{"label": "city", "id": "city", "type": "number"}, {"label": "population", "id": "population", "type": "number"}]},
        {
          pageSize: 25,
          cssClassNames:  {
            tableRow: 'gchart-table-row',
            headerRow: 'gchart-table-headerrow',
            oddTableRow: 'gchart-table-oddrow',
            selectedTableRow: 'gchart-table-selectedrow',
            hoverTableRow: 'gchart-table-hoverrow',
            tableCell: 'gchart-table-cell',
            headerCell: 'gchart-table-headercell',
            rowNumberCell: 'gchart-table-rownumcell'
          }
        },
        {source_index: 10, fields: 'city,population'},
        0,
        21);
    }
  );
</script></p>
<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">chart</span> <span class="n">columns</span> <span class="o">--</span><span class="n">data</span> <span class="n">cities</span> <span class="o">--</span><span class="n">fields</span> <span class="n">city</span><span class="p">,</span><span class="n">population</span>
</pre></div>


<div class="bqgc-container">

  <div class="bqgc " id="4_152436759091">
  </div>
</div>

<script src="/static/components/requirejs/require.js"></script>

<script>

  require.config({
    paths: {
      base: '/static/base',
      d3: '//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3',
      plotly: 'https://cdn.plot.ly/plotly-1.5.1.min.js?noext',
      jquery: '//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min'
    },
    map: {
      '*': {
        datalab: 'nbextensions/gcpdatalab'
      }
    },
    shim: {
      plotly: {
        deps: ['d3', 'jquery'],
        exports: 'plotly'
      }
    }
  });

  require(['datalab/charting',
           'datalab/element!4_152436759091',
           'base/js/events',
           'datalab/style!/nbextensions/gcpdatalab/charting.css'
          ],
    function(charts, dom, events) {
      charts.render(
          'gcharts',
          dom,
          events,
          'columns',
          [],
          {"rows": [{"c": [{"v": 1}, {"v": 4804326}]}, {"c": [{"v": 5}, {"v": 385069}]}, {"c": [{"v": 9}, {"v": 47639}]}, {"c": [{"v": 6}, {"v": 135200}]}, {"c": [{"v": 4}, {"v": 246848}]}, {"c": [{"v": 13}, {"v": 320978}]}, {"c": [{"v": 22}, {"v": 210407}]}, {"c": [{"v": 14}, {"v": 89940}]}, {"c": [{"v": 8}, {"v": 45975}]}, {"c": [{"v": 15}, {"v": 190213}]}, {"c": [{"v": 17}, {"v": 27772}]}, {"c": [{"v": 10}, {"v": 32482}]}, {"c": [{"v": 11}, {"v": 47489}]}, {"c": [{"v": 18}, {"v": 38039}]}, {"c": [{"v": 12}, {"v": 66843}]}, {"c": [{"v": 16}, {"v": 5092}]}, {"c": [{"v": 21}, {"v": 30837}]}, {"c": [{"v": 7}, {"v": 11610}]}, {"c": [{"v": 3}, {"v": 27282}]}, {"c": [{"v": 19}, {"v": 1199}]}, {"c": [{"v": 20}, {"v": 4233}]}], "cols": [{"label": "city", "id": "city", "type": "number"}, {"label": "population", "id": "population", "type": "number"}]},
          {},
          {"source_index": 1, "fields": "city,population", "name": 1},
          0,
          21);
      }
    );
</script>

<p><img src="images/churn/output_214_1.png" alt="Drawing" style="width: 750px;"/></p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">bq</span> <span class="n">query</span> <span class="o">--</span><span class="n">name</span> <span class="n">cities</span>
<span class="n">SELECT</span> <span class="n">members_city</span> <span class="n">AS</span> <span class="n">city</span><span class="p">,</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">members_msno</span><span class="p">)</span> <span class="n">AS</span> <span class="n">population</span>
<span class="n">FROM</span> <span class="err">`</span><span class="n">w207_kkbox_bq_data</span><span class="o">.</span><span class="n">members_filtered_100k</span><span class="err">`</span> 
<span class="n">GROUP</span> <span class="n">BY</span> <span class="n">city</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">cities</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>


<div class="bqtv" id="13_152436759488"><table><tr><th>city</th><th>population</th></tr><tr><td>1</td><td>40639</td></tr><tr><td>10</td><td>763</td></tr><tr><td>4</td><td>5670</td></tr><tr><td>5</td><td>8469</td></tr><tr><td>13</td><td>11012</td></tr><tr><td>14</td><td>2273</td></tr><tr><td>15</td><td>5032</td></tr><tr><td>8</td><td>937</td></tr><tr><td>12</td><td>1395</td></tr><tr><td>22</td><td>4825</td></tr><tr><td>7</td><td>290</td></tr><tr><td>6</td><td>3113</td></tr><tr><td>21</td><td>657</td></tr><tr><td>17</td><td>581</td></tr><tr><td>11</td><td>1021</td></tr><tr><td>16</td><td>118</td></tr><tr><td>9</td><td>1107</td></tr><tr><td>18</td><td>900</td></tr><tr><td>3</td><td>584</td></tr><tr><td>20</td><td>76</td></tr><tr><td>19</td><td>11</td></tr></table></div>

<p><br />(rows: 21, time: 0.2s, cached, job: job_gV83pX9lLCc3jSdGZhB1sEsQFWW0)<br />
<script src="/static/components/requirejs/require.js"></script>
<script>
  require.config({
    paths: {
      base: '/static/base',
      d3: '//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3',
      plotly: 'https://cdn.plot.ly/plotly-1.5.1.min.js?noext',
      jquery: '//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min'
    },
    map: {
      '*': {
        datalab: 'nbextensions/gcpdatalab'
      }
    },
    shim: {
      plotly: {
        deps: ['d3', 'jquery'],
        exports: 'plotly'
      }
    }
  });</p>
<p>require(['datalab/charting', 'datalab/element!13_152436759488', 'base/js/events',
      'datalab/style!/nbextensions/gcpdatalab/charting.css'],
    function(charts, dom, events) {
      charts.render('gcharts', dom, events, 'table', [], {"rows": [{"c": [{"v": 1}, {"v": 40639}]}, {"c": [{"v": 10}, {"v": 763}]}, {"c": [{"v": 4}, {"v": 5670}]}, {"c": [{"v": 5}, {"v": 8469}]}, {"c": [{"v": 13}, {"v": 11012}]}, {"c": [{"v": 14}, {"v": 2273}]}, {"c": [{"v": 15}, {"v": 5032}]}, {"c": [{"v": 8}, {"v": 937}]}, {"c": [{"v": 12}, {"v": 1395}]}, {"c": [{"v": 22}, {"v": 4825}]}, {"c": [{"v": 7}, {"v": 290}]}, {"c": [{"v": 6}, {"v": 3113}]}, {"c": [{"v": 21}, {"v": 657}]}, {"c": [{"v": 17}, {"v": 581}]}, {"c": [{"v": 11}, {"v": 1021}]}, {"c": [{"v": 16}, {"v": 118}]}, {"c": [{"v": 9}, {"v": 1107}]}, {"c": [{"v": 18}, {"v": 900}]}, {"c": [{"v": 3}, {"v": 584}]}, {"c": [{"v": 20}, {"v": 76}]}, {"c": [{"v": 19}, {"v": 11}]}], "cols": [{"label": "city", "id": "city", "type": "number"}, {"label": "population", "id": "population", "type": "number"}]},
        {
          pageSize: 25,
          cssClassNames:  {
            tableRow: 'gchart-table-row',
            headerRow: 'gchart-table-headerrow',
            oddTableRow: 'gchart-table-oddrow',
            selectedTableRow: 'gchart-table-selectedrow',
            hoverTableRow: 'gchart-table-hoverrow',
            tableCell: 'gchart-table-cell',
            headerCell: 'gchart-table-headercell',
            rowNumberCell: 'gchart-table-rownumcell'
          }
        },
        {source_index: 11, fields: 'city,population'},
        0,
        21);
    }
  );
</script></p>
<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">chart</span> <span class="n">columns</span> <span class="o">--</span><span class="n">data</span> <span class="n">cities</span> <span class="o">--</span><span class="n">fields</span> <span class="n">city</span><span class="p">,</span><span class="n">population</span>
</pre></div>


<div class="bqgc-container">

  <div class="bqgc " id="5_152436759510">
  </div>
</div>

<script src="/static/components/requirejs/require.js"></script>

<script>

  require.config({
    paths: {
      base: '/static/base',
      d3: '//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3',
      plotly: 'https://cdn.plot.ly/plotly-1.5.1.min.js?noext',
      jquery: '//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min'
    },
    map: {
      '*': {
        datalab: 'nbextensions/gcpdatalab'
      }
    },
    shim: {
      plotly: {
        deps: ['d3', 'jquery'],
        exports: 'plotly'
      }
    }
  });

  require(['datalab/charting',
           'datalab/element!5_152436759510',
           'base/js/events',
           'datalab/style!/nbextensions/gcpdatalab/charting.css'
          ],
    function(charts, dom, events) {
      charts.render(
          'gcharts',
          dom,
          events,
          'columns',
          [],
          {"rows": [{"c": [{"v": 1}, {"v": 40639}]}, {"c": [{"v": 10}, {"v": 763}]}, {"c": [{"v": 4}, {"v": 5670}]}, {"c": [{"v": 5}, {"v": 8469}]}, {"c": [{"v": 13}, {"v": 11012}]}, {"c": [{"v": 14}, {"v": 2273}]}, {"c": [{"v": 15}, {"v": 5032}]}, {"c": [{"v": 8}, {"v": 937}]}, {"c": [{"v": 12}, {"v": 1395}]}, {"c": [{"v": 22}, {"v": 4825}]}, {"c": [{"v": 7}, {"v": 290}]}, {"c": [{"v": 6}, {"v": 3113}]}, {"c": [{"v": 21}, {"v": 657}]}, {"c": [{"v": 17}, {"v": 581}]}, {"c": [{"v": 11}, {"v": 1021}]}, {"c": [{"v": 16}, {"v": 118}]}, {"c": [{"v": 9}, {"v": 1107}]}, {"c": [{"v": 18}, {"v": 900}]}, {"c": [{"v": 3}, {"v": 584}]}, {"c": [{"v": 20}, {"v": 76}]}, {"c": [{"v": 19}, {"v": 11}]}], "cols": [{"label": "city", "id": "city", "type": "number"}, {"label": "population", "id": "population", "type": "number"}]},
          {},
          {"source_index": 1, "fields": "city,population", "name": 1},
          0,
          21);
      }
    );
</script>

<p><img src="images/churn/output_217_1.png" alt="Drawing" style="width: 750px;"/></p>
<p>We can see that there is one city (labeled city = 1 that uses kkbox service far more than any other city accross the geographical area that kkbox is used. Comparing the two datasets, we see that overall city one has a higher proportion of the total members in the original dataset compared to the filtered. </p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">bq</span> <span class="n">query</span> <span class="o">--</span><span class="n">name</span> <span class="n">city_renew</span>
<span class="n">SELECT</span> <span class="n">members</span><span class="o">.</span><span class="n">city</span> <span class="n">AS</span> <span class="n">city</span><span class="p">,</span> <span class="n">CAST</span><span class="p">(</span><span class="n">SUM</span><span class="p">(</span><span class="n">transactions</span><span class="o">.</span><span class="n">is_auto_renew</span><span class="p">)</span> <span class="o">/</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">members</span><span class="o">.</span><span class="n">city</span><span class="p">)</span> <span class="n">AS</span> <span class="n">FLOAT64</span><span class="p">)</span> <span class="n">AS</span> <span class="n">renew_by_city</span>
<span class="n">FROM</span> <span class="err">`</span><span class="n">w207_kkbox_bq_data</span><span class="o">.</span><span class="n">members</span><span class="err">`</span> <span class="n">AS</span> <span class="n">members</span>
<span class="n">INNER</span> <span class="n">JOIN</span> <span class="err">`</span><span class="n">w207_kkbox_bq_data</span><span class="o">.</span><span class="n">transactions</span><span class="err">`</span> <span class="n">AS</span> <span class="n">transactions</span>
<span class="n">ON</span> <span class="n">members</span><span class="o">.</span><span class="n">msno</span> <span class="o">=</span> <span class="n">transactions</span><span class="o">.</span><span class="n">msno</span>
<span class="n">GROUP</span> <span class="n">BY</span> <span class="n">members</span><span class="o">.</span><span class="n">city</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="n">renew_by_city</span> <span class="n">DESC</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">chart</span> <span class="n">columns</span> <span class="o">--</span><span class="n">data</span> <span class="n">city_renew</span> <span class="o">--</span><span class="n">fields</span> <span class="n">city</span><span class="p">,</span><span class="n">renew_by_city</span>
</pre></div>


<div class="bqgc-container">

  <div class="bqgc " id="6_152436759709">
  </div>
</div>

<script src="/static/components/requirejs/require.js"></script>

<script>

  require.config({
    paths: {
      base: '/static/base',
      d3: '//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3',
      plotly: 'https://cdn.plot.ly/plotly-1.5.1.min.js?noext',
      jquery: '//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min'
    },
    map: {
      '*': {
        datalab: 'nbextensions/gcpdatalab'
      }
    },
    shim: {
      plotly: {
        deps: ['d3', 'jquery'],
        exports: 'plotly'
      }
    }
  });

  require(['datalab/charting',
           'datalab/element!6_152436759709',
           'base/js/events',
           'datalab/style!/nbextensions/gcpdatalab/charting.css'
          ],
    function(charts, dom, events) {
      charts.render(
          'gcharts',
          dom,
          events,
          'columns',
          [],
          {"rows": [{"c": [{"v": 1}, {"v": 0.8945960127765824}]}, {"c": [{"v": 14}, {"v": 0.8189751372584029}]}, {"c": [{"v": 16}, {"v": 0.8168234643054787}]}, {"c": [{"v": 17}, {"v": 0.8127863844643247}]}, {"c": [{"v": 7}, {"v": 0.8071678266620477}]}, {"c": [{"v": 13}, {"v": 0.8046112985334092}]}, {"c": [{"v": 4}, {"v": 0.7876644693624822}]}, {"c": [{"v": 5}, {"v": 0.7868372006362852}]}, {"c": [{"v": 22}, {"v": 0.7864741596560252}]}, {"c": [{"v": 15}, {"v": 0.7863995501572723}]}, {"c": [{"v": 18}, {"v": 0.781381180189894}]}, {"c": [{"v": 19}, {"v": 0.7798003523194363}]}, {"c": [{"v": 20}, {"v": 0.779194753142649}]}, {"c": [{"v": 11}, {"v": 0.7785532844289343}]}, {"c": [{"v": 6}, {"v": 0.7748307372423409}]}, {"c": [{"v": 10}, {"v": 0.7684719825969545}]}, {"c": [{"v": 3}, {"v": 0.7579729978471905}]}, {"c": [{"v": 12}, {"v": 0.7488124303143071}]}, {"c": [{"v": 8}, {"v": 0.7483064937021473}]}, {"c": [{"v": 21}, {"v": 0.7167859733215604}]}, {"c": [{"v": 9}, {"v": 0.6872863817093813}]}], "cols": [{"label": "city", "id": "city", "type": "number"}, {"label": "renew_by_city", "id": "renew_by_city", "type": "number"}]},
          {},
          {"source_index": 2, "fields": "city,renew_by_city", "name": 2},
          0,
          21);
      }
    );
</script>

<p><img src="images/churn/output_220_1.png" alt="Drawing" style="width: 750px;"/></p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">bq</span> <span class="n">query</span> <span class="o">--</span><span class="n">name</span> <span class="n">city_renew</span>
<span class="n">SELECT</span> <span class="n">members</span><span class="o">.</span><span class="n">members_city</span> <span class="n">AS</span> <span class="n">city</span><span class="p">,</span> <span class="n">CAST</span><span class="p">(</span><span class="n">SUM</span><span class="p">(</span><span class="n">transactions</span><span class="o">.</span><span class="n">transactions_is_auto_renew</span><span class="p">)</span> <span class="o">/</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">members</span><span class="o">.</span><span class="n">members_city</span><span class="p">)</span> <span class="n">AS</span> <span class="n">FLOAT64</span><span class="p">)</span> <span class="n">AS</span> <span class="n">renew_by_city</span>
<span class="n">FROM</span> <span class="err">`</span><span class="n">w207_kkbox_bq_data</span><span class="o">.</span><span class="n">members_filtered_100k</span><span class="err">`</span> <span class="n">AS</span> <span class="n">members</span>
<span class="n">INNER</span> <span class="n">JOIN</span> <span class="err">`</span><span class="n">w207_kkbox_bq_data</span><span class="o">.</span><span class="n">transactions_filtered_100k</span><span class="err">`</span> <span class="n">AS</span> <span class="n">transactions</span>
<span class="n">ON</span> <span class="n">members</span><span class="o">.</span><span class="n">members_msno</span> <span class="o">=</span> <span class="n">transactions</span><span class="o">.</span><span class="n">transactions_msno</span>
<span class="n">GROUP</span> <span class="n">BY</span> <span class="n">city</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="n">renew_by_city</span> <span class="n">DESC</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">chart</span> <span class="n">columns</span> <span class="o">--</span><span class="n">data</span> <span class="n">city_renew</span> <span class="o">--</span><span class="n">fields</span> <span class="n">city</span><span class="p">,</span><span class="n">renew_by_city</span>
</pre></div>


<div class="bqgc-container">

  <div class="bqgc " id="7_152436760604">
  </div>
</div>

<script src="/static/components/requirejs/require.js"></script>

<script>

  require.config({
    paths: {
      base: '/static/base',
      d3: '//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3',
      plotly: 'https://cdn.plot.ly/plotly-1.5.1.min.js?noext',
      jquery: '//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min'
    },
    map: {
      '*': {
        datalab: 'nbextensions/gcpdatalab'
      }
    },
    shim: {
      plotly: {
        deps: ['d3', 'jquery'],
        exports: 'plotly'
      }
    }
  });

  require(['datalab/charting',
           'datalab/element!7_152436760604',
           'base/js/events',
           'datalab/style!/nbextensions/gcpdatalab/charting.css'
          ],
    function(charts, dom, events) {
      charts.render(
          'gcharts',
          dom,
          events,
          'columns',
          [],
          {"rows": [{"c": [{"v": 1}, {"v": 0.8957308843271565}]}, {"c": [{"v": 19}, {"v": 0.8531468531468531}]}, {"c": [{"v": 16}, {"v": 0.78980490874764}]}, {"c": [{"v": 14}, {"v": 0.7861950763477719}]}, {"c": [{"v": 17}, {"v": 0.7710740785792483}]}, {"c": [{"v": 9}, {"v": 0.7675121891007838}]}, {"c": [{"v": 13}, {"v": 0.7637058753366438}]}, {"c": [{"v": 7}, {"v": 0.7519286403085824}]}, {"c": [{"v": 5}, {"v": 0.7464286949603957}]}, {"c": [{"v": 10}, {"v": 0.7457795431976166}]}, {"c": [{"v": 22}, {"v": 0.7445258853483527}]}, {"c": [{"v": 4}, {"v": 0.7395663567973507}]}, {"c": [{"v": 15}, {"v": 0.7389468455042225}]}, {"c": [{"v": 11}, {"v": 0.7377781141213864}]}, {"c": [{"v": 6}, {"v": 0.7349130583020798}]}, {"c": [{"v": 3}, {"v": 0.7313613771366226}]}, {"c": [{"v": 18}, {"v": 0.7240743708927713}]}, {"c": [{"v": 12}, {"v": 0.7027717602621786}]}, {"c": [{"v": 8}, {"v": 0.7011804384485666}]}, {"c": [{"v": 20}, {"v": 0.6908358509566969}]}, {"c": [{"v": 21}, {"v": 0.6564617618586641}]}], "cols": [{"label": "city", "id": "city", "type": "number"}, {"label": "renew_by_city", "id": "renew_by_city", "type": "number"}]},
          {},
          {"source_index": 2, "fields": "city,renew_by_city", "name": 2},
          0,
          21);
      }
    );
</script>

<p><img src="images/churn/output_222_1.png" alt="Drawing" style="width: 750px;"/></p>
<p>In the plot above we analyze the proportion of auto-renew customers by city. From before we saw that city 1 had the highest count overall for users. Here we can see that it also has the highest proportion of auto-renew customers. Overall, it appears that most customers are on an auto-renew plan which is good from a business perspective.</p>
<p>Comparing the two dataframes there is similar structure to both bar charts, which means the datasets for this feature are consistent. </p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">bq</span> <span class="n">query</span> <span class="o">--</span><span class="n">name</span> <span class="n">gender_describe</span>
<span class="n">SELECT</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">gender</span><span class="p">)</span> <span class="n">AS</span> <span class="n">gen</span> <span class="n">FROM</span> <span class="err">`</span><span class="n">w207_kkbox_bq_data</span><span class="o">.</span><span class="n">members</span><span class="err">`</span> <span class="n">AS</span> <span class="n">members</span> <span class="n">GROUP</span> <span class="n">BY</span> <span class="n">gender</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">gender_describe</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>


<div class="bqtv" id="14_152436780635"><table><tr><th>gen</th></tr><tr><td>1144613</td></tr><tr><td>1195355</td></tr><tr><td>0</td></tr></table></div>

<p><br />(rows: 3, time: 0.2s, cached, job: job_AfNz0MGXT8OgGZx6EY3RMrmDKeOA)<br />
<script src="/static/components/requirejs/require.js"></script>
<script>
  require.config({
    paths: {
      base: '/static/base',
      d3: '//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3',
      plotly: 'https://cdn.plot.ly/plotly-1.5.1.min.js?noext',
      jquery: '//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min'
    },
    map: {
      '*': {
        datalab: 'nbextensions/gcpdatalab'
      }
    },
    shim: {
      plotly: {
        deps: ['d3', 'jquery'],
        exports: 'plotly'
      }
    }
  });</p>
<p>require(['datalab/charting', 'datalab/element!14_152436780635', 'base/js/events',
      'datalab/style!/nbextensions/gcpdatalab/charting.css'],
    function(charts, dom, events) {
      charts.render('gcharts', dom, events, 'table', [], {"rows": [{"c": [{"v": 1144613}]}, {"c": [{"v": 1195355}]}, {"c": [{"v": 0}]}], "cols": [{"label": "gen", "id": "gen", "type": "number"}]},
        {
          pageSize: 25,
          cssClassNames:  {
            tableRow: 'gchart-table-row',
            headerRow: 'gchart-table-headerrow',
            oddTableRow: 'gchart-table-oddrow',
            selectedTableRow: 'gchart-table-selectedrow',
            hoverTableRow: 'gchart-table-hoverrow',
            tableCell: 'gchart-table-cell',
            headerCell: 'gchart-table-headercell',
            rowNumberCell: 'gchart-table-rownumcell'
          }
        },
        {source_index: 1, fields: 'gen'},
        0,
        3);
    }
  );
</script></p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">bq</span> <span class="n">query</span> <span class="o">--</span><span class="n">name</span> <span class="n">gender_describe</span>
<span class="n">SELECT</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">members_gender</span><span class="p">)</span> <span class="n">AS</span> <span class="n">gen</span> <span class="n">FROM</span> <span class="err">`</span><span class="n">w207_kkbox_bq_data</span><span class="o">.</span><span class="n">members_filtered_100k</span><span class="err">`</span> <span class="n">AS</span> <span class="n">members</span> <span class="n">GROUP</span> <span class="n">BY</span> <span class="n">members_gender</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">gender_describe</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>


<div class="bqtv" id="15_152436780843"><table><tr><th>gen</th></tr><tr><td>24507</td></tr><tr><td>21630</td></tr><tr><td>0</td></tr></table></div>

<p><br />(rows: 3, time: 0.1s, cached, job: job__0rEg7lP0hion9yO77VylbSMR6ij)<br />
<script src="/static/components/requirejs/require.js"></script>
<script>
  require.config({
    paths: {
      base: '/static/base',
      d3: '//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3',
      plotly: 'https://cdn.plot.ly/plotly-1.5.1.min.js?noext',
      jquery: '//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min'
    },
    map: {
      '*': {
        datalab: 'nbextensions/gcpdatalab'
      }
    },
    shim: {
      plotly: {
        deps: ['d3', 'jquery'],
        exports: 'plotly'
      }
    }
  });</p>
<p>require(['datalab/charting', 'datalab/element!15_152436780843', 'base/js/events',
      'datalab/style!/nbextensions/gcpdatalab/charting.css'],
    function(charts, dom, events) {
      charts.render('gcharts', dom, events, 'table', [], {"rows": [{"c": [{"v": 24507}]}, {"c": [{"v": 21630}]}, {"c": [{"v": 0}]}], "cols": [{"label": "gen", "id": "gen", "type": "number"}]},
        {
          pageSize: 25,
          cssClassNames:  {
            tableRow: 'gchart-table-row',
            headerRow: 'gchart-table-headerrow',
            oddTableRow: 'gchart-table-oddrow',
            selectedTableRow: 'gchart-table-selectedrow',
            hoverTableRow: 'gchart-table-hoverrow',
            tableCell: 'gchart-table-cell',
            headerCell: 'gchart-table-headercell',
            rowNumberCell: 'gchart-table-rownumcell'
          }
        },
        {source_index: 2, fields: 'gen'},
        0,
        3);
    }
  );
</script></p>
<p>From the printout above, we can see that there is similarity amongst the gender distribution between the whole and filtered dataset, male has a slightly higher population than female. </p>
<p>Below we will now printout the description of the tables for comparison. </p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">bq</span> <span class="n">query</span> <span class="o">--</span><span class="n">name</span> <span class="n">describe_members</span>
<span class="n">SELECT</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">DISTINCT</span><span class="p">(</span><span class="n">city</span><span class="p">))</span> <span class="n">AS</span> <span class="n">city_count</span><span class="p">,</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">DISTINCT</span><span class="p">(</span><span class="n">registered_via</span><span class="p">))</span> <span class="n">AS</span> <span class="n">registration_type</span><span class="p">,</span> <span class="n">AVG</span><span class="p">(</span><span class="n">bd</span><span class="p">)</span> <span class="n">AS</span> <span class="n">average_bd</span>
<span class="n">FROM</span> <span class="err">`</span><span class="n">w207_kkbox_bq_data</span><span class="o">.</span><span class="n">members</span><span class="err">`</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">describe_members</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>


<div class="bqtv" id="16_152436781060"><table><tr><th>city_count</th><th>registration_type</th><th>average_bd</th></tr><tr><td>21</td><td>18</td><td>9.795794295951625</td></tr></table></div>

<p><br />(rows: 1, time: 0.2s, cached, job: job_s_s-BUim86KEeQsaPWK8aI7ePUsl)<br />
<script src="/static/components/requirejs/require.js"></script>
<script>
  require.config({
    paths: {
      base: '/static/base',
      d3: '//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3',
      plotly: 'https://cdn.plot.ly/plotly-1.5.1.min.js?noext',
      jquery: '//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min'
    },
    map: {
      '*': {
        datalab: 'nbextensions/gcpdatalab'
      }
    },
    shim: {
      plotly: {
        deps: ['d3', 'jquery'],
        exports: 'plotly'
      }
    }
  });</p>
<p>require(['datalab/charting', 'datalab/element!16_152436781060', 'base/js/events',
      'datalab/style!/nbextensions/gcpdatalab/charting.css'],
    function(charts, dom, events) {
      charts.render('gcharts', dom, events, 'table', [], {"rows": [{"c": [{"v": 21}, {"v": 18}, {"v": 9.795794295951625}]}], "cols": [{"label": "city_count", "id": "city_count", "type": "number"}, {"label": "registration_type", "id": "registration_type", "type": "number"}, {"label": "average_bd", "id": "average_bd", "type": "number"}]},
        {
          pageSize: 25,
          cssClassNames:  {
            tableRow: 'gchart-table-row',
            headerRow: 'gchart-table-headerrow',
            oddTableRow: 'gchart-table-oddrow',
            selectedTableRow: 'gchart-table-selectedrow',
            hoverTableRow: 'gchart-table-hoverrow',
            tableCell: 'gchart-table-cell',
            headerCell: 'gchart-table-headercell',
            rowNumberCell: 'gchart-table-rownumcell'
          }
        },
        {source_index: 3, fields: 'city_count,registration_type,average_bd'},
        0,
        1);
    }
  );
</script></p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">bq</span> <span class="n">query</span> <span class="o">--</span><span class="n">name</span> <span class="n">describe_members</span>
<span class="n">SELECT</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">DISTINCT</span><span class="p">(</span><span class="n">members_city</span><span class="p">))</span> <span class="n">AS</span> <span class="n">city_count</span><span class="p">,</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">DISTINCT</span><span class="p">(</span><span class="n">members_registered_via</span><span class="p">))</span> <span class="n">AS</span> <span class="n">registration_type</span><span class="p">,</span> <span class="n">AVG</span><span class="p">(</span><span class="n">members_bd</span><span class="p">)</span> <span class="n">AS</span> <span class="n">average_bd</span>
<span class="n">FROM</span> <span class="err">`</span><span class="n">w207_kkbox_bq_data</span><span class="o">.</span><span class="n">members_filtered_100k</span><span class="err">`</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">describe_members</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>


<div class="bqtv" id="17_152436781276"><table><tr><th>city_count</th><th>registration_type</th><th>average_bd</th></tr><tr><td>21</td><td>5</td><td>14.915069350530343</td></tr></table></div>

<p><br />(rows: 1, time: 0.2s, cached, job: job_RCIg6slHgd8nt-De7OuUfeub23gU)<br />
<script src="/static/components/requirejs/require.js"></script>
<script>
  require.config({
    paths: {
      base: '/static/base',
      d3: '//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3',
      plotly: 'https://cdn.plot.ly/plotly-1.5.1.min.js?noext',
      jquery: '//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min'
    },
    map: {
      '*': {
        datalab: 'nbextensions/gcpdatalab'
      }
    },
    shim: {
      plotly: {
        deps: ['d3', 'jquery'],
        exports: 'plotly'
      }
    }
  });</p>
<p>require(['datalab/charting', 'datalab/element!17_152436781276', 'base/js/events',
      'datalab/style!/nbextensions/gcpdatalab/charting.css'],
    function(charts, dom, events) {
      charts.render('gcharts', dom, events, 'table', [], {"rows": [{"c": [{"v": 21}, {"v": 5}, {"v": 14.915069350530343}]}], "cols": [{"label": "city_count", "id": "city_count", "type": "number"}, {"label": "registration_type", "id": "registration_type", "type": "number"}, {"label": "average_bd", "id": "average_bd", "type": "number"}]},
        {
          pageSize: 25,
          cssClassNames:  {
            tableRow: 'gchart-table-row',
            headerRow: 'gchart-table-headerrow',
            oddTableRow: 'gchart-table-oddrow',
            selectedTableRow: 'gchart-table-selectedrow',
            hoverTableRow: 'gchart-table-hoverrow',
            tableCell: 'gchart-table-cell',
            headerCell: 'gchart-table-headercell',
            rowNumberCell: 'gchart-table-rownumcell'
          }
        },
        {source_index: 4, fields: 'city_count,registration_type,average_bd'},
        0,
        1);
    }
  );
</script></p>
<p>We can see here that the filtered dataset doesn't capture all of the registration types (only 5 of the 18 total). Presumably there are a select number of very popular registration types, and several lesser used, which is why our data subset only contains a portion of the total registration types. Average birthday is higher (presumably younger if birthday is computed as days after a particular date) in our filtered dataset. </p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">bq</span> <span class="n">query</span> <span class="o">--</span><span class="n">name</span> <span class="n">describe_transactions</span>
<span class="n">SELECT</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">DISTINCT</span><span class="p">(</span><span class="n">payment_method_id</span><span class="p">))</span> <span class="k">as</span> <span class="n">payment_method</span><span class="p">,</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">DISTINCT</span><span class="p">(</span><span class="n">plan_list_price</span><span class="p">))</span> <span class="k">as</span> <span class="n">num_plans</span><span class="p">,</span> <span class="n">SUM</span><span class="p">(</span><span class="n">is_auto_renew</span><span class="p">)</span> <span class="o">/</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">is_auto_renew</span><span class="p">)</span> <span class="k">as</span> <span class="n">prop_auto_renew</span><span class="p">,</span> 
<span class="n">AVG</span><span class="p">(</span><span class="n">actual_amount_paid</span><span class="p">)</span> <span class="n">AS</span> <span class="n">plan_revenue</span><span class="p">,</span> <span class="n">SUM</span><span class="p">(</span><span class="n">is_cancel</span><span class="p">)</span> <span class="o">/</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">is_cancel</span><span class="p">)</span> <span class="n">AS</span> <span class="n">prop_cancel</span>
<span class="n">FROM</span> <span class="err">`</span><span class="n">w207_kkbox_bq_data</span><span class="o">.</span><span class="n">transactions</span><span class="err">`</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">describe_transactions</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>


<div class="bqtv" id="18_152436781483"><table><tr><th>payment_method</th><th>num_plans</th><th>prop_auto_renew</th><th>plan_revenue</th><th>prop_cancel</th></tr><tr><td>40</td><td>51</td><td>0.8519661406812573</td><td>141.98732048354586</td><td>0.03976522648819046</td></tr></table></div>

<p><br />(rows: 1, time: 0.1s, cached, job: job_w7nJR7nlHvuW0mk-jUsSP5EW_pu6)<br />
<script src="/static/components/requirejs/require.js"></script>
<script>
  require.config({
    paths: {
      base: '/static/base',
      d3: '//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3',
      plotly: 'https://cdn.plot.ly/plotly-1.5.1.min.js?noext',
      jquery: '//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min'
    },
    map: {
      '*': {
        datalab: 'nbextensions/gcpdatalab'
      }
    },
    shim: {
      plotly: {
        deps: ['d3', 'jquery'],
        exports: 'plotly'
      }
    }
  });</p>
<p>require(['datalab/charting', 'datalab/element!18_152436781483', 'base/js/events',
      'datalab/style!/nbextensions/gcpdatalab/charting.css'],
    function(charts, dom, events) {
      charts.render('gcharts', dom, events, 'table', [], {"rows": [{"c": [{"v": 40}, {"v": 51}, {"v": 0.8519661406812573}, {"v": 141.98732048354586}, {"v": 0.03976522648819046}]}], "cols": [{"label": "payment_method", "id": "payment_method", "type": "number"}, {"label": "num_plans", "id": "num_plans", "type": "number"}, {"label": "prop_auto_renew", "id": "prop_auto_renew", "type": "number"}, {"label": "plan_revenue", "id": "plan_revenue", "type": "number"}, {"label": "prop_cancel", "id": "prop_cancel", "type": "number"}]},
        {
          pageSize: 25,
          cssClassNames:  {
            tableRow: 'gchart-table-row',
            headerRow: 'gchart-table-headerrow',
            oddTableRow: 'gchart-table-oddrow',
            selectedTableRow: 'gchart-table-selectedrow',
            hoverTableRow: 'gchart-table-hoverrow',
            tableCell: 'gchart-table-cell',
            headerCell: 'gchart-table-headercell',
            rowNumberCell: 'gchart-table-rownumcell'
          }
        },
        {source_index: 5, fields: 'payment_method,num_plans,prop_auto_renew,plan_revenue,prop_cancel'},
        0,
        1);
    }
  );
</script></p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">bq</span> <span class="n">query</span> <span class="o">--</span><span class="n">name</span> <span class="n">describe_transactions</span>
<span class="n">SELECT</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">DISTINCT</span><span class="p">(</span><span class="n">transactions_payment_method_id</span><span class="p">))</span> <span class="k">as</span> <span class="n">payment_method</span><span class="p">,</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">DISTINCT</span><span class="p">(</span><span class="n">transactions_plan_list_price</span><span class="p">))</span> <span class="k">as</span> <span class="n">num_plans</span><span class="p">,</span> <span class="n">SUM</span><span class="p">(</span><span class="n">transactions_is_auto_renew</span><span class="p">)</span> <span class="o">/</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">transactions_is_auto_renew</span><span class="p">)</span> <span class="k">as</span> <span class="n">prop_auto_renew</span><span class="p">,</span> 
<span class="n">AVG</span><span class="p">(</span><span class="n">transactions_actual_amount_paid</span><span class="p">)</span> <span class="n">AS</span> <span class="n">plan_revenue</span><span class="p">,</span> <span class="n">SUM</span><span class="p">(</span><span class="n">transactions_is_cancel</span><span class="p">)</span> <span class="o">/</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">transactions_is_cancel</span><span class="p">)</span> <span class="n">AS</span> <span class="n">prop_cancel</span>
<span class="n">FROM</span> <span class="err">`</span><span class="n">w207_kkbox_bq_data</span><span class="o">.</span><span class="n">transactions_filtered_100k</span><span class="err">`</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">describe_transactions</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>


<div class="bqtv" id="19_152436781700"><table><tr><th>payment_method</th><th>num_plans</th><th>prop_auto_renew</th><th>plan_revenue</th><th>prop_cancel</th></tr><tr><td>37</td><td>42</td><td>0.8315028382832431</td><td>145.68530483745585</td><td>0.031064849396989492</td></tr></table></div>

<p><br />(rows: 1, time: 0.1s, cached, job: job_HNnfHsxnSm7qJdbkItU1IJPU4-ej)<br />
<script src="/static/components/requirejs/require.js"></script>
<script>
  require.config({
    paths: {
      base: '/static/base',
      d3: '//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3',
      plotly: 'https://cdn.plot.ly/plotly-1.5.1.min.js?noext',
      jquery: '//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min'
    },
    map: {
      '*': {
        datalab: 'nbextensions/gcpdatalab'
      }
    },
    shim: {
      plotly: {
        deps: ['d3', 'jquery'],
        exports: 'plotly'
      }
    }
  });</p>
<p>require(['datalab/charting', 'datalab/element!19_152436781700', 'base/js/events',
      'datalab/style!/nbextensions/gcpdatalab/charting.css'],
    function(charts, dom, events) {
      charts.render('gcharts', dom, events, 'table', [], {"rows": [{"c": [{"v": 37}, {"v": 42}, {"v": 0.8315028382832431}, {"v": 145.68530483745585}, {"v": 0.031064849396989492}]}], "cols": [{"label": "payment_method", "id": "payment_method", "type": "number"}, {"label": "num_plans", "id": "num_plans", "type": "number"}, {"label": "prop_auto_renew", "id": "prop_auto_renew", "type": "number"}, {"label": "plan_revenue", "id": "plan_revenue", "type": "number"}, {"label": "prop_cancel", "id": "prop_cancel", "type": "number"}]},
        {
          pageSize: 25,
          cssClassNames:  {
            tableRow: 'gchart-table-row',
            headerRow: 'gchart-table-headerrow',
            oddTableRow: 'gchart-table-oddrow',
            selectedTableRow: 'gchart-table-selectedrow',
            hoverTableRow: 'gchart-table-hoverrow',
            tableCell: 'gchart-table-cell',
            headerCell: 'gchart-table-headercell',
            rowNumberCell: 'gchart-table-rownumcell'
          }
        },
        {source_index: 6, fields: 'payment_method,num_plans,prop_auto_renew,plan_revenue,prop_cancel'},
        0,
        1);
    }
  );
</script></p>
<p>Comparing the filtered and total datasets, we can see that both payment method and number of plans decreases slightly in the filtered dataset, but not too much. One key highlight here is that moving to the full dataset will require fitting on the larger dataset, because there is data objects that have not been seen by the smaller model. The proportion of auto renew members is very similar across both datasets as is the revenue from the plan (average plan price). We can see the slightly lower members cancel in the filtered dataset when compared to the total dataset, however both datasets have a low proportion of cancel (and from before, cancel is lower than is_churn which is an interesting observation). Additionally, as the filtered dataset contains 50% churn, having such a low (and even lower than the total dataset) churn statistic is surprising. </p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">bq</span> <span class="n">query</span> <span class="o">--</span><span class="n">name</span> <span class="n">describe_user_logs</span>
<span class="n">SELECT</span> <span class="n">SUM</span><span class="p">(</span><span class="n">total_secs</span><span class="p">)</span> <span class="n">AS</span> <span class="n">listening_time</span><span class="p">,</span> <span class="n">SUM</span><span class="p">(</span><span class="n">num_unq</span><span class="p">)</span> <span class="n">AS</span> <span class="n">number_unique</span><span class="p">,</span> <span class="n">AVG</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="n">AS</span> <span class="n">average_date</span><span class="p">,</span> <span class="n">SUM</span><span class="p">(</span><span class="n">num_100</span><span class="p">)</span> <span class="n">AS</span> <span class="n">sum_full_songs</span><span class="p">,</span> <span class="n">SUM</span><span class="p">(</span><span class="n">num_25</span><span class="p">)</span> <span class="n">AS</span> <span class="n">sum_25per_songs</span>
<span class="n">FROM</span> <span class="err">`</span><span class="n">w207_kkbox_bq_data</span><span class="o">.</span><span class="n">user_logs</span><span class="err">`</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">describe_user_logs</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>


<div class="bqtv" id="20_152436781906"><table><tr><th>listening_time</th><th>number_unique</th><th>average_date</th><th>sum_full_songs</th><th>sum_25per_songs</th></tr><tr><td>-5.665342138557264e+20</td><td>11798546903</td><td>20157392.77279009</td><td>12045813613</td><td>2553501878</td></tr></table></div>

<p><br />(rows: 1, time: 0.1s, cached, job: job_SJWC3sRNxUqMaP_eGiz7LB-SRhZk)<br />
<script src="/static/components/requirejs/require.js"></script>
<script>
  require.config({
    paths: {
      base: '/static/base',
      d3: '//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3',
      plotly: 'https://cdn.plot.ly/plotly-1.5.1.min.js?noext',
      jquery: '//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min'
    },
    map: {
      '*': {
        datalab: 'nbextensions/gcpdatalab'
      }
    },
    shim: {
      plotly: {
        deps: ['d3', 'jquery'],
        exports: 'plotly'
      }
    }
  });</p>
<p>require(['datalab/charting', 'datalab/element!20_152436781906', 'base/js/events',
      'datalab/style!/nbextensions/gcpdatalab/charting.css'],
    function(charts, dom, events) {
      charts.render('gcharts', dom, events, 'table', [], {"rows": [{"c": [{"v": -5.665342138557264e+20}, {"v": 11798546903}, {"v": 20157392.77279009}, {"v": 12045813613}, {"v": 2553501878}]}], "cols": [{"label": "listening_time", "id": "listening_time", "type": "number"}, {"label": "number_unique", "id": "number_unique", "type": "number"}, {"label": "average_date", "id": "average_date", "type": "number"}, {"label": "sum_full_songs", "id": "sum_full_songs", "type": "number"}, {"label": "sum_25per_songs", "id": "sum_25per_songs", "type": "number"}]},
        {
          pageSize: 25,
          cssClassNames:  {
            tableRow: 'gchart-table-row',
            headerRow: 'gchart-table-headerrow',
            oddTableRow: 'gchart-table-oddrow',
            selectedTableRow: 'gchart-table-selectedrow',
            hoverTableRow: 'gchart-table-hoverrow',
            tableCell: 'gchart-table-cell',
            headerCell: 'gchart-table-headercell',
            rowNumberCell: 'gchart-table-rownumcell'
          }
        },
        {source_index: 7, fields: 'listening_time,number_unique,average_date,sum_full_songs,sum_25per_songs'},
        0,
        1);
    }
  );
</script></p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">bq</span> <span class="n">query</span> <span class="o">--</span><span class="n">name</span> <span class="n">describe_user_logs</span>
<span class="n">SELECT</span> <span class="n">SUM</span><span class="p">(</span><span class="n">user_logs_total_secs</span><span class="p">)</span> <span class="n">AS</span> <span class="n">listening_time</span><span class="p">,</span> <span class="n">SUM</span><span class="p">(</span><span class="n">user_logs_num_unq</span><span class="p">)</span> <span class="n">AS</span> <span class="n">number_unique</span><span class="p">,</span> <span class="n">AVG</span><span class="p">(</span><span class="n">user_logs_date</span><span class="p">)</span> <span class="n">AS</span> <span class="n">average_date</span><span class="p">,</span> <span class="n">SUM</span><span class="p">(</span><span class="n">user_logs_num_100</span><span class="p">)</span> <span class="n">AS</span> <span class="n">sum_full_songs</span><span class="p">,</span> <span class="n">SUM</span><span class="p">(</span><span class="n">user_logs_num_25</span><span class="p">)</span> <span class="n">AS</span> <span class="n">sum_25per_songs</span>
<span class="n">FROM</span> <span class="err">`</span><span class="n">w207_kkbox_bq_data</span><span class="o">.</span><span class="n">user_logs_filtered_100k</span><span class="err">`</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">describe_user_logs</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>


<div class="bqtv" id="21_152436782112"><table><tr><th>listening_time</th><th>number_unique</th><th>average_date</th><th>sum_full_songs</th><th>sum_25per_songs</th></tr><tr><td>-3.1202667405739975e+19</td><td>711055859</td><td>20158095.16186604</td><td>719873498</td><td>155565964</td></tr></table></div>

<p><br />(rows: 1, time: 0.1s, cached, job: job_6Zclmg8gA3QsOm_qb04JlROqwHV9)<br />
<script src="/static/components/requirejs/require.js"></script>
<script>
  require.config({
    paths: {
      base: '/static/base',
      d3: '//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3',
      plotly: 'https://cdn.plot.ly/plotly-1.5.1.min.js?noext',
      jquery: '//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min'
    },
    map: {
      '*': {
        datalab: 'nbextensions/gcpdatalab'
      }
    },
    shim: {
      plotly: {
        deps: ['d3', 'jquery'],
        exports: 'plotly'
      }
    }
  });</p>
<p>require(['datalab/charting', 'datalab/element!21_152436782112', 'base/js/events',
      'datalab/style!/nbextensions/gcpdatalab/charting.css'],
    function(charts, dom, events) {
      charts.render('gcharts', dom, events, 'table', [], {"rows": [{"c": [{"v": -3.1202667405739975e+19}, {"v": 711055859}, {"v": 20158095.16186604}, {"v": 719873498}, {"v": 155565964}]}], "cols": [{"label": "listening_time", "id": "listening_time", "type": "number"}, {"label": "number_unique", "id": "number_unique", "type": "number"}, {"label": "average_date", "id": "average_date", "type": "number"}, {"label": "sum_full_songs", "id": "sum_full_songs", "type": "number"}, {"label": "sum_25per_songs", "id": "sum_25per_songs", "type": "number"}]},
        {
          pageSize: 25,
          cssClassNames:  {
            tableRow: 'gchart-table-row',
            headerRow: 'gchart-table-headerrow',
            oddTableRow: 'gchart-table-oddrow',
            selectedTableRow: 'gchart-table-selectedrow',
            hoverTableRow: 'gchart-table-hoverrow',
            tableCell: 'gchart-table-cell',
            headerCell: 'gchart-table-headercell',
            rowNumberCell: 'gchart-table-rownumcell'
          }
        },
        {source_index: 8, fields: 'listening_time,number_unique,average_date,sum_full_songs,sum_25per_songs'},
        0,
        1);
    }
  );
</script></p>
<p>Comparing the two datasets, we can see that both have an average listening time of a negative value (which intuitiviely doesn't make sens). It will be important to better understand how this data is collected to properly quality check the column and values. Number of unique is higher in the entire dataset, which makes sense as there is more data. Average date is in the form YYYYMMDD so the average date for user logs is in 2015 (averageing a date as an integer produces an incorrect date - datalab doesn't handle dates the same way as big query so further analysis in this notebook was not carried out). The sum of full songs and 25% songs is also higher in the full dataset which again makes sense. It is interesting to see that the proportion to full_songs/25per_songs is approximately the same (4.71 in the full vs 4.63 in the filtered). </p></p>
        </div>
    </div>

<div class="fh5co-narrow-content">
<div class="animate-box" data-animate-effect="fadeInLeft">
    <h2><!-- <i class="icon-speech-bubble"></i>  -->Comments</h2>
</div>
<div class="animate-box" data-animate-effect="fadeInLeft">
    <div id="disqus_thread"></div>
</div>

<script>
var disqus_config = function () { 
  this.language = "english";
};
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript><a href="https://disqus.com/?ref_noscript">Please enable JavaScript to view the comments powered by Disqus.</a></noscript>
<div class="fh5co-footer">
    <p><small>&copy; 2016 Blend Free HTML5. All Rights Reserved.</span> <span>Designed by <a href="http://freehtml5.co/" target="_blank">FreeHTML5.co</a></span>
    <br /><span>Pelican Theme by: <a href="https://github.com/claudio-walser/pelican-fh5co-marble" target="_blank">Claudio Walser</a></span></small></p>

</div>                
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://aaron-j-olson.com/theme/js/jquery.min.js"></script>
    <!-- jQuery Easing -->
    <script src="https://aaron-j-olson.com/theme/js/jquery.easing.1.3.js"></script>
    <!-- Bootstrap -->
    <script src="https://aaron-j-olson.com/theme/js/bootstrap.min.js"></script>
    <!-- Waypoints -->
    <script src="https://aaron-j-olson.com/theme/js/jquery.waypoints.min.js"></script>
    <!-- Flexslider -->
    <script src="https://aaron-j-olson.com/theme/js/jquery.flexslider-min.js"></script>


    <!-- MAIN JS -->
    <script src="https://aaron-j-olson.com/theme/js/main.js"></script>
    </body>
</html>
